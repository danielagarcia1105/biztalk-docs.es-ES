---
title: Las transacciones de larga ejecución | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- long-running transactions, about long-running transactions
- atomic transactions, long-running transactions
- long-running transactions, orchestrations
- long-running transactions, nesting
- scopes, examples
- orchestrations, transactions
- compensations, long-running transactions
- compensations, customizing
- transactions, long-running
- transactions, compensation blocks
- long-running transactions
- long-running transactions, timeouts
- compensations, examples
- fault tolerance, long-running transactions
- transactions, examples
- orchestrations, long-running transactions
- transactions, atomic
- transactions, fault tolerance
- scopes, long-running transactions
- long-running transactions, fault tolerance
- transactions, nesting
- examples, scopes
ms.assetid: 4bf4d0c8-903a-411f-963b-bd4cfdfc2958
caps.latest.revision: 9
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 86c419c79b9de6287a0361dfe4e2e6b9dc555153
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22262780"
---
# <a name="long-running-transactions"></a><span data-ttu-id="2cc28-102">Transacciones de larga ejecución</span><span class="sxs-lookup"><span data-stu-id="2cc28-102">Long-Running Transactions</span></span>
<span data-ttu-id="2cc28-103">Las transacciones de larga ejecución son construcciones importantes y utilizadas frecuentemente en orquestaciones de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="2cc28-103">Long-running transactions are important, commonly used constructs in BizTalk orchestrations.</span></span> <span data-ttu-id="2cc28-104">Proporcionan funciones para la compensación personalizada y el control de excepciones personalizado basados en el ámbito, así como la capacidad para anidar transacciones; todo ello ofrece una gran flexibilidad a la hora de diseñar una arquitectura de transacciones sólida.</span><span class="sxs-lookup"><span data-stu-id="2cc28-104">They provide you with facilities for custom scope-based compensation, custom scope-based exception handling, and the ability to nest transactions, all of which give you great flexibility in designing robust transaction architecture.</span></span>  
  
 <span data-ttu-id="2cc28-105">Las transacciones de larga ejecución se utilizan cuando es posible que la transacción deba ejecutarse durante un período prolongado y no son necesarias las propiedades ACID completas (es decir, no es necesario garantizar el aislamiento de los datos procedentes de otras transacciones).</span><span class="sxs-lookup"><span data-stu-id="2cc28-105">You use a long-running transaction when the transaction might need to run for an extended time and you do not need full ACID properties (that is, you do not need to guarantee isolation of data from other transactions).</span></span> <span data-ttu-id="2cc28-106">Una transacción de larga ejecución puede tener largos períodos de inactividad que suelen deberse a la espera de la llegada de mensajes externos.</span><span class="sxs-lookup"><span data-stu-id="2cc28-106">A long-running transaction might have long periods of inactivity, often due to waiting for external messages to arrive.</span></span>  
  
 <span data-ttu-id="2cc28-107">Las transacciones de larga ejecución poseen coherencia y durabilidad, pero no atomicidad ni aislamiento.</span><span class="sxs-lookup"><span data-stu-id="2cc28-107">Long-running transactions possess consistency, and durability, but not atomicity and isolation.</span></span> <span data-ttu-id="2cc28-108">Los datos dentro de una transacción de larga ejecución no están bloqueados; otros procesos o aplicaciones pueden modificarlos.</span><span class="sxs-lookup"><span data-stu-id="2cc28-108">The data within a long-running transaction is not locked; other processes or applications can modify it.</span></span> <span data-ttu-id="2cc28-109">La propiedad de aislamiento para actualizaciones de estado no se conserva porque no se pueden mantener los bloqueos durante un período prolongado.</span><span class="sxs-lookup"><span data-stu-id="2cc28-109">The isolation property for state updates is not maintained because holding locks for a long duration is impractical.</span></span>  
  
 <span data-ttu-id="2cc28-110">La confirmación de una transacción de larga ejecución es distinta de la confirmación de una transacción atómica.</span><span class="sxs-lookup"><span data-stu-id="2cc28-110">Commitment of a long-running transaction is different than commitment of an atomic transaction.</span></span> <span data-ttu-id="2cc28-111">No hay ningún supuesto implícito de coordinación distribuida en lo que respecta al resultado (una transacción de larga ejecución existe únicamente dentro de una sola instancia de orquestación).</span><span class="sxs-lookup"><span data-stu-id="2cc28-111">There is no implicit assumption of distributed coordination regarding the outcome (a long-running transaction exists only within a single orchestration instance).</span></span> <span data-ttu-id="2cc28-112">En su lugar, una transacción de larga ejecución se considera confirmada cuando se ha completado la última instrucción contenida en ella.</span><span class="sxs-lookup"><span data-stu-id="2cc28-112">Instead, a long-running transaction is considered committed when the last statement in it has completed.</span></span> <span data-ttu-id="2cc28-113">No se produce ninguna reversión automática del estado en caso de la anulación de una transacción.</span><span class="sxs-lookup"><span data-stu-id="2cc28-113">There is no "auto" rollback of state in case of a transaction abort.</span></span> <span data-ttu-id="2cc28-114">Esto se puede conseguir mediante la programación de los controladores de excepción y compensación.</span><span class="sxs-lookup"><span data-stu-id="2cc28-114">You can achieve this programmatically through the exception and compensation handlers.</span></span>  
  
 <span data-ttu-id="2cc28-115">Un ámbito puede definir su propio estado mediante la declaración de variables, mensajes y componentes .NET.</span><span class="sxs-lookup"><span data-stu-id="2cc28-115">A scope can define its own state by declaring variables, messages, and .NET components.</span></span> <span data-ttu-id="2cc28-116">Una transacción de larga ejecución tiene acceso a la información de estado de su propio ámbito, a cualquier ámbito que la contenga y a cualquier información de estado que esté definida globalmente dentro de la orquestación.</span><span class="sxs-lookup"><span data-stu-id="2cc28-116">A long-running transaction has access to the state information of its own scope, any scope that encloses it, and any state information that is globally defined within the orchestration.</span></span> <span data-ttu-id="2cc28-117">Sin embargo, no dispone de acceso a la información de estado de ningún ámbito que no la contenga.</span><span class="sxs-lookup"><span data-stu-id="2cc28-117">It does not have access to the state information of any scopes that do not enclose it.</span></span>  
  
## <a name="nesting"></a><span data-ttu-id="2cc28-118">Anidación</span><span class="sxs-lookup"><span data-stu-id="2cc28-118">Nesting</span></span>  
 <span data-ttu-id="2cc28-119">Las transacciones de larga ejecución pueden contener transacciones atómicas u otras transacciones de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="2cc28-119">Long-running transactions can contain atomic transactions or other long-running transactions.</span></span> <span data-ttu-id="2cc28-120">Se pueden anidar en niveles de profundidad arbitrarios.</span><span class="sxs-lookup"><span data-stu-id="2cc28-120">They can be nested to arbitrary depths.</span></span> <span data-ttu-id="2cc28-121">Por ejemplo, la transacción podría contener otras dos transacciones de larga ejecución, cada una de las cuales podría contener transacciones atómicas.</span><span class="sxs-lookup"><span data-stu-id="2cc28-121">For example, your transaction might contain two other long-running transactions, each of which might contain atomic transactions.</span></span>  
  
 <span data-ttu-id="2cc28-122">La anidación resulta especialmente útil cuando uno o más componentes de la transacción global tienen que ser atómicos, mientras que la transacción global tiene que ser de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="2cc28-122">Nesting is particularly useful when one or more components of the overall transaction need to be atomic while the overall transaction needs to be long-running.</span></span> <span data-ttu-id="2cc28-123">Considere el ejemplo de recepción y cumplimentación de un pedido.</span><span class="sxs-lookup"><span data-stu-id="2cc28-123">Consider the example of receiving and fulfilling a purchase order.</span></span> <span data-ttu-id="2cc28-124">El pedido puede llegar en cualquier momento y los distintos pasos para cumplimentarlo pueden tardar en producirse, pero aún así desea tratar todo el proceso como una transacción.</span><span class="sxs-lookup"><span data-stu-id="2cc28-124">The purchase order can arrive at any time, and the various steps in fulfilling the order might take time to occur, but you still want to treat the entire process as a transaction.</span></span> <span data-ttu-id="2cc28-125">En este caso, la transacción global tiene que ser obviamente una de larga ejecución, aunque uno de los pasos, como la confirmación de un pago, tenga que ser atómico.</span><span class="sxs-lookup"><span data-stu-id="2cc28-125">The overall transaction in this case clearly needs to be long-running, but an individual step, such as acknowledging a payment, might need to be atomic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2cc28-126">No se puede anidar un ámbito transaccional dentro de un ámbito o una orquestación que no lo sea.</span><span class="sxs-lookup"><span data-stu-id="2cc28-126">You cannot nest a transactional scope within a scope or orchestration that is not transactional.</span></span> <span data-ttu-id="2cc28-127">Una orquestación o un ámbito de inclusión que no sea transaccional no administrará el estado, ya que debe controlar debidamente la administración de estado de cualquier ámbito que contenga.</span><span class="sxs-lookup"><span data-stu-id="2cc28-127">An enclosing scope or orchestration that is not transactional will not manage state, as it must to properly handle the state management of any scopes within it.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2cc28-128">Una transacción sincronizada no puede incluir ninguna otra transacción ni ámbitos sincronizados.</span><span class="sxs-lookup"><span data-stu-id="2cc28-128">A synchronized transaction cannot include any other transactions or synchronized scopes.</span></span>  
  
## <a name="compensation"></a><span data-ttu-id="2cc28-129">Compensación</span><span class="sxs-lookup"><span data-stu-id="2cc28-129">Compensation</span></span>  
 <span data-ttu-id="2cc28-130">Una transacción de larga ejecución puede especificar un bloque de compensación al que se llamará para compensar las actividades de la transacción una vez se confirme.</span><span class="sxs-lookup"><span data-stu-id="2cc28-130">A long-running transaction can specify a compensation block that will be called to compensate for the transaction's activities, after it commits.</span></span> <span data-ttu-id="2cc28-131">Podría bastar con deshacer la transacción donde sea factible o realizar alguna otra función, como la notificación, que ayude a paliar en cierta medida los efectos de la transacción.</span><span class="sxs-lookup"><span data-stu-id="2cc28-131">It might simply undo the transaction where feasible, or perform some other function, such as notification, that helps mitigate the effects of the transaction in some way.</span></span> <span data-ttu-id="2cc28-132">Si no agrega su propio código de compensación, el motor de tiempo de ejecución llamará de forma predeterminada a los bloques de compensación de las transacciones internas, tanto de larga ejecución como atómicas, en orden inverso, comenzando por la última transacción confirmada y terminando por la primera.</span><span class="sxs-lookup"><span data-stu-id="2cc28-132">If you do not add your own compensation code, the runtime engine will by default call the compensation blocks of the inner transactions, both long-running and atomic, in reverse order, starting with the last transaction committed and finishing with the first transaction committed.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2cc28-133">La compensación solo puede realizarse en una transacción que se haya confirmado correctamente.</span><span class="sxs-lookup"><span data-stu-id="2cc28-133">Compensation can only be done on a transaction that has committed successfully.</span></span>  
  
## <a name="fault-tolerance"></a><span data-ttu-id="2cc28-134">Tolerancia a errores</span><span class="sxs-lookup"><span data-stu-id="2cc28-134">Fault tolerance</span></span>  
 <span data-ttu-id="2cc28-135">Las transacciones admiten la tolerancia a errores para la recuperación tanto de errores internos (como averías del equipo y errores de software) como de errores externos (como mensajes de cancelación).</span><span class="sxs-lookup"><span data-stu-id="2cc28-135">Transactions support fault tolerance for recovery from both internal faults (such as machine failures and software faults) and external faults (such as cancel messages).</span></span> <span data-ttu-id="2cc28-136">Cuando se produce un error en una transacción, las actualizaciones parciales dentro de transacciones de larga ejecución no se deshacen automáticamente ya que están en transacciones ACID.</span><span class="sxs-lookup"><span data-stu-id="2cc28-136">Partial updates within long-running transactions are not rolled back automatically when a transaction failure occurs, as they are in ACID transactions.</span></span>  
  
 <span data-ttu-id="2cc28-137">Si se produce un error, se llama al bloque de código de excepción correspondiente a la transacción de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="2cc28-137">The exception code block for the long-running transaction is called when a fault occurs.</span></span> <span data-ttu-id="2cc28-138">El bloque de código de excepción contiene un conjunto de controladores de errores que se escriben para tratar cualquiera de los errores que puedan surgir durante la ejecución de la transacción.</span><span class="sxs-lookup"><span data-stu-id="2cc28-138">The exception code block contains a set of fault handlers that you write to deal with any of the faults that can arise during the execution of the transaction.</span></span> <span data-ttu-id="2cc28-139">Para controlar el error, puede basarse en el último estado conocido de mensajes, variables y objetos.</span><span class="sxs-lookup"><span data-stu-id="2cc28-139">You can rely on the last known state of the messages, variables, and objects in handling the fault.</span></span>  
  
 <span data-ttu-id="2cc28-140">Normalmente, deseará que el controlador de excepción evalúe el estado de la orquestación en el momento en que se produce la excepción, lleve a cabo cualquier acción necesaria basada en dicho estado y llame a las compensaciones de las transacciones anidadas.</span><span class="sxs-lookup"><span data-stu-id="2cc28-140">You will typically want your exception handler to evaluate the state of the orchestration at the time the exception occurs, take any necessary action based on that state, and call the compensations of any nested transactions.</span></span>  
  
 <span data-ttu-id="2cc28-141">Cuando se produce un error, se interrumpe la ejecución de las transacciones de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="2cc28-141">The execution of the long-running transaction is interrupted when a fault occurs.</span></span> <span data-ttu-id="2cc28-142">Una vez que se produce un error, no se puede reanudar.</span><span class="sxs-lookup"><span data-stu-id="2cc28-142">It cannot be resumed after a fault occurs.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2cc28-143">Vea también</span><span class="sxs-lookup"><span data-stu-id="2cc28-143">See Also</span></span>  
 <span data-ttu-id="2cc28-144">[Escenarios de uso de transacciones de larga ejecución](../core/scenarios-using-long-running-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="2cc28-144">[Scenarios Using Long-Running Transactions](../core/scenarios-using-long-running-transactions.md) </span></span>  
 <span data-ttu-id="2cc28-145">[Transacciones atómicas](../core/atomic-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="2cc28-145">[Atomic Transactions](../core/atomic-transactions.md) </span></span>  
 [<span data-ttu-id="2cc28-146">Uso de transacciones y control de excepciones</span><span class="sxs-lookup"><span data-stu-id="2cc28-146">Using Transactions and Handling Exceptions</span></span>](../core/using-transactions-and-handling-exceptions.md)