---
title: "Cómo controlar errores de los adaptadores | Documentos de Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: bdceb364-38d6-4aab-a176-bf751da1be25
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 94ce45dbf8fcc46c952ddd5ccf7ed45e633641a4
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-handle-adapter-failures"></a><span data-ttu-id="bb231-102">Cómo controlar errores de adaptador</span><span class="sxs-lookup"><span data-stu-id="bb231-102">How to Handle Adapter Failures</span></span>
<span data-ttu-id="bb231-103">Por lo general, los adaptadores deberían suspender los mensajes que no pueden procesar.</span><span class="sxs-lookup"><span data-stu-id="bb231-103">In general, adapters should suspend messages that they cannot process.</span></span> <span data-ttu-id="bb231-104">Un adaptador de recepción, por ejemplo, que experimente un error de envío debería suspender los mensajes, aunque esta decisión depende del propósito del adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-104">For example, a receive adapter that experiences a submit failure should typically suspend the messages, although this decision depends upon the purpose of the adapter.</span></span> <span data-ttu-id="bb231-105">Además, hay consideraciones de seguridad que se deben tener en cuenta con respecto al control de errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-105">There are also security considerations around handling failures.</span></span> <span data-ttu-id="bb231-106">Si un adaptador, por ejemplo, suspende de forma automática todos los mensajes con errores, es posible que el adaptador esté abierto a un ataque de denegación de servicio que provoque que se llene la cola de suspensión de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-106">For example, if an adapter automatically suspends all failed messages, the adapter might be open to a denial-of-service attack that causes the BizTalk Server Suspended queue to fill up.</span></span>  <span data-ttu-id="bb231-107">Algunos adaptadores, como HTTP, pueden devolver un código de error al cliente que indique que se ha rechazado la solicitud.</span><span class="sxs-lookup"><span data-stu-id="bb231-107">Some adapters, such as HTTP, can return a failure code to the client indicating that the request has been rejected.</span></span> <span data-ttu-id="bb231-108">Para estos tipos de adaptadores resulta conveniente devolver un código de error en lugar de suspender el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-108">For these types of adapters it often makes sense to return a failure code rather than suspend the message.</span></span> <span data-ttu-id="bb231-109">Como norma general, los adaptadores de envío solo suspenden los mensajes una vez que se han agotado los reintentos tanto para los transportes primarios como los secundarios.</span><span class="sxs-lookup"><span data-stu-id="bb231-109">Typically send adapters only suspend messages after all of the retries have been exhausted for both primary and secondary transports.</span></span>  
  
## <a name="associate-error-processing-with-an-individual-operation-and-not-with-the-batch-that-contains-the-operation"></a><span data-ttu-id="bb231-110">Asociar el procesamiento de errores con una operación individual y no con el lote que contiene la operación</span><span class="sxs-lookup"><span data-stu-id="bb231-110">Associate Error Processing with an Individual Operation and Not with the Batch That Contains the Operation</span></span>  
 <span data-ttu-id="bb231-111">El procesamiento por lotes de los mensajes de un adaptador debería ser invisible al usuario de éste.</span><span class="sxs-lookup"><span data-stu-id="bb231-111">The batching of messages within an adapter should be invisible to the user of the adapter.</span></span> <span data-ttu-id="bb231-112">Esto significa que el error de una operación en un lote no debería afectar en ningún caso a ninguna operación.</span><span class="sxs-lookup"><span data-stu-id="bb231-112">This means that the failure of one operation in a batch should not affect any other operation in any way.</span></span> <span data-ttu-id="bb231-113">Sin embargo, los lotes son atómicos con lo que el error de un mensaje provoca un error en el lote y no se procesan las operaciones.</span><span class="sxs-lookup"><span data-stu-id="bb231-113">However, batches are atomic, so the failure of one message results in an error for the batch, and no operations are processed.</span></span>  
  
 <span data-ttu-id="bb231-114">Escriba el código responsable del control de errores, volviendo a enviar los mensajes correctos y suspendiendo los que no lo son.</span><span class="sxs-lookup"><span data-stu-id="bb231-114">You write the code that is responsible for handling the error, resubmitting the successful messages, and suspending the unsuccessful ones.</span></span> <span data-ttu-id="bb231-115">Afortunadamente, BizTalk Server proporciona una estructura de errores detallada que permite al adaptador determinar la operación específica en la que se ha producido el error.</span><span class="sxs-lookup"><span data-stu-id="bb231-115">Fortunately, BizTalk Server provides a detailed error structure that enables your adapter to determine the specific operation that failed.</span></span> <span data-ttu-id="bb231-116">Además, permite crear más lotes en los que las operaciones correctas se vuelven a enviar y las que no lo son se suspenden.</span><span class="sxs-lookup"><span data-stu-id="bb231-116">It permits construction of further batches in which the successful operations are resubmitted and the unsuccessful ones suspended.</span></span>  
  
 <span data-ttu-id="bb231-117">El estado final de la operación no debería verse afectado por el procesamiento por lotes del adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-117">The final state of the operation should not be affected by the batching within the adapter.</span></span>  
  
## <a name="use-seterrorinfo-to-report-failure-to-biztalk-server"></a><span data-ttu-id="bb231-118">Utilizar SetErrorInfo para informar de los errores a BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="bb231-118">Use SetErrorInfo to Report Failure to BizTalk Server</span></span>  
 <span data-ttu-id="bb231-119">Si está suspendiendo un mensaje, debe proporcionar información de los errores a BizTalk Server desde el contexto del mensaje anterior.</span><span class="sxs-lookup"><span data-stu-id="bb231-119">If you are suspending a message, you must provide failure information to BizTalk Server from the previous message context.</span></span> <span data-ttu-id="bb231-120">BizTalk Server proporciona capacidades de uso de informes de errores el **SetErrorInfo** método tanto la **IBaseMessage** y **ITransportProxy** interfaces.</span><span class="sxs-lookup"><span data-stu-id="bb231-120">BizTalk Server provides error reporting capabilities using the **SetErrorInfo** method on both the **IBaseMessage** and **ITransportProxy** interfaces.</span></span> <span data-ttu-id="bb231-121">Es posible informar de los errores de la siguiente forma:</span><span class="sxs-lookup"><span data-stu-id="bb231-121">You can report errors as follows:</span></span>  
  
-   <span data-ttu-id="bb231-122">Cuando se produce un error al procesar un mensaje, establezca la excepción mediante **SetErrorInfo (Exception e)** en el mensaje (**IBaseMessage**) va a suspender.</span><span class="sxs-lookup"><span data-stu-id="bb231-122">When a failure occurs while processing a message, set the exception using **SetErrorInfo(Exception e)** on the message (**IBaseMessage**) to be suspended.</span></span> <span data-ttu-id="bb231-123">Esto permite al motor conservar el error con el mensaje para un diagnóstico posterior y registrarlo en el registro de eventos para alertar al administrador.</span><span class="sxs-lookup"><span data-stu-id="bb231-123">This allows the engine to preserve the error with the message for later diagnosis and logs it to the event log to alert the administrator.</span></span>  
  
-   <span data-ttu-id="bb231-124">Si se produce un error durante la inicialización o contabilización interna (no durante el procesamiento de mensajes) debe llamar a **SetErrorInfo (Exception e)** en el **ITransportProxy** puntero que se pasa a los usuarios durante la inicialización.</span><span class="sxs-lookup"><span data-stu-id="bb231-124">If you encounter an error during initialization or internal bookkeeping (not during message processing) you should call **SetErrorInfo(Exception e)** on the **ITransportProxy** pointer that was passed to you during initialization.</span></span> <span data-ttu-id="bb231-125">Si el adaptador se basa en la implementación de BaseAdapter, siempre debería tener acceso a este puntero.</span><span class="sxs-lookup"><span data-stu-id="bb231-125">If your adapter is based on the BaseAdapter implementation, you should always have access to this pointer.</span></span> <span data-ttu-id="bb231-126">De lo contrario, debe asegurarse de que lo almacena en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="bb231-126">Otherwise, you should be certain that you cache it.</span></span>  
  
 <span data-ttu-id="bb231-127">Al informar de un error mediante alguno de estos métodos, el mensaje de error se escribe en el registro de eventos.</span><span class="sxs-lookup"><span data-stu-id="bb231-127">Reporting an error with either of these methods results in the error message being written to the event log.</span></span> <span data-ttu-id="bb231-128">Es importante que, siempre que sea posible, se asocie el error con el mensaje relacionado.</span><span class="sxs-lookup"><span data-stu-id="bb231-128">It is important that you associate the error with the related message if you are able to do so.</span></span>  
  
## <a name="handle-a-database-offline-condition"></a><span data-ttu-id="bb231-129">Controlar una condición de base de datos sin conexión</span><span class="sxs-lookup"><span data-stu-id="bb231-129">Handle a Database-Offline Condition</span></span>  
 <span data-ttu-id="bb231-130">Si alguna de las bases de datos de BizTalk Server se desconecta, el servicio de BizTalk se recicla.</span><span class="sxs-lookup"><span data-stu-id="bb231-130">If one of the BizTalk Server databases goes offline, the BizTalk service recycles itself.</span></span> <span data-ttu-id="bb231-131">El motor de mensajería hace lo posible por cerrar todas las ubicaciones de recepción antes de reciclar el servicio.</span><span class="sxs-lookup"><span data-stu-id="bb231-131">The Messaging Engine makes a best effort to shut down all of the receive locations before recycling the service.</span></span> <span data-ttu-id="bb231-132">Si este proceso tarda más de 60 segundos, el servicio finaliza.</span><span class="sxs-lookup"><span data-stu-id="bb231-132">If this takes longer than 60 seconds, the service terminates.</span></span> <span data-ttu-id="bb231-133">Debido a que se trata de un motor de transacción, no se pierden datos.</span><span class="sxs-lookup"><span data-stu-id="bb231-133">Because the engine is transacted, this does not cause data loss.</span></span>  
  
 <span data-ttu-id="bb231-134">Este tiempo de espera puede ajustarse en el Registro mediante la siguiente tecla:</span><span class="sxs-lookup"><span data-stu-id="bb231-134">This time-out can be tuned in the registry by using the key:</span></span>  
  
```  
DWORD   
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\BTSSvc{Host Guid}\MessagingDBFailoverShutdownTimeLimit  
```  
  
 <span data-ttu-id="bb231-135">En el caso de adaptadores aislados, debido a que no es un proceso propio de BizTalk Server, se deshabilitan las ubicaciones de recepción cuando una de las bases de datos de BizTalk Server se desconecta.</span><span class="sxs-lookup"><span data-stu-id="bb231-135">For isolated adapters, because BizTalk Server does not own the process, the receive locations are disabled when one of the BizTalk Server databases goes offline.</span></span> <span data-ttu-id="bb231-136">Las ubicaciones de recepción se habilitan de nuevo una vez que la base de datos se vuelve a conectar.</span><span class="sxs-lookup"><span data-stu-id="bb231-136">After the database comes back online those receive locations are re-enabled.</span></span>  
  
## <a name="write-to-the-event-log"></a><span data-ttu-id="bb231-137">Escribir en el registro de eventos</span><span class="sxs-lookup"><span data-stu-id="bb231-137">Write to the Event Log</span></span>  
 <span data-ttu-id="bb231-138">El adaptador puede escribir entradas del registro de eventos mediante el **IBTTransportProxy** interfaz pasa una excepción.</span><span class="sxs-lookup"><span data-stu-id="bb231-138">The adapter can write event log entries by using the **IBTTransportProxy** interface passing in an exception.</span></span> <span data-ttu-id="bb231-139">Adaptadores desarrollados en código nativo deben pasar en un **IErrorInfo** interfaz, **IBTTransportProxy.SetErrorInfo (excepción** `e` **)**.</span><span class="sxs-lookup"><span data-stu-id="bb231-139">Adapters developed in native code need to pass in an **IErrorInfo** interface, **IBTTransportProxy.SetErrorInfo( Exception** `e` **)**.</span></span>  
  
 <span data-ttu-id="bb231-140">El motor de mensajería escribe en el registro de eventos en nombre del adaptador los eventos en los que se da alguno de los siguientes casos: un adaptador vuelve a intentar un mensaje después de un error en la transmisión, mueve un mensaje al transporte de reserva o suspende un mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-140">The Messaging Engine writes to the event log on behalf of the adapter for events such as when an adapter retries a message after transmission failure, moves a message to its backup transport, or suspends a message.</span></span> <span data-ttu-id="bb231-141">Para operaciones como las anteriores, el adaptador solo necesita establecer la excepción en el mensaje antes de llamar a la API.</span><span class="sxs-lookup"><span data-stu-id="bb231-141">For operations such as these the adapter only needs to set the exception on the message before calling the API.</span></span> <span data-ttu-id="bb231-142">En el siguiente fragmento de código se muestra este caso:</span><span class="sxs-lookup"><span data-stu-id="bb231-142">The following code fragment demonstrates this:</span></span>  
  
```  
IBaseMessage msg;  
...  
// Set exception on msg to indicate why transmission failed...  
msg.SetErrorInfo(  
 new ApplicationException(  
 "The TCP connection was closed by the destination"));  
```  
  
## <a name="handle-receive-specific-batch-errors"></a><span data-ttu-id="bb231-143">Controlar errores de lote específicos de recepciones</span><span class="sxs-lookup"><span data-stu-id="bb231-143">Handle Receive-Specific Batch Errors</span></span>  
  
### <a name="handle-receive-failures"></a><span data-ttu-id="bb231-144">Controlar errores de recepción</span><span class="sxs-lookup"><span data-stu-id="bb231-144">Handle Receive Failures</span></span>  
 <span data-ttu-id="bb231-145">Cuando un adaptador envía una operación (o un lote de operaciones) a BizTalk Server pueden producirse errores por varias razones.</span><span class="sxs-lookup"><span data-stu-id="bb231-145">When an adapter submits an operation (or batch of operations) to BizTalk Server there can be various reasons for failure.</span></span> <span data-ttu-id="bb231-146">A continuación se indican las dos más importantes:</span><span class="sxs-lookup"><span data-stu-id="bb231-146">The two most significant are:</span></span>  
  
-   <span data-ttu-id="bb231-147">Error en la canalización de recepción.</span><span class="sxs-lookup"><span data-stu-id="bb231-147">The receive pipeline failed.</span></span>  
  
-   <span data-ttu-id="bb231-148">Error de enrutamiento mientras se publicaba un mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-148">A routing failure occurred while publishing a message.</span></span>  
  
 <span data-ttu-id="bb231-149">El motor de mensajería intenta suspender de forma automática el mensaje cuando se produce un error en la canalización de recepción.</span><span class="sxs-lookup"><span data-stu-id="bb231-149">The Messaging Engine automatically tries to suspend the message when it gets a receive pipeline failure.</span></span> <span data-ttu-id="bb231-150">Es posible que la operación de suspensión no siempre se ejecute correctamente.</span><span class="sxs-lookup"><span data-stu-id="bb231-150">The suspend operation may not always be successful.</span></span> <span data-ttu-id="bb231-151">Por ejemplo, si el motor de mensajería coincide con un error de enrutamiento mientras se publica un mensaje, no intentará siquiera suspender el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-151">For example, if the Messaging Engine hits a routing failure while publishing a message, then the engine does not even try to suspend the message.</span></span>  
  
 <span data-ttu-id="bb231-152">Siempre existe la posibilidad de que se produzca un error en un mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-152">It is always possible that a message will fail.</span></span> <span data-ttu-id="bb231-153">En esta situación, el adaptador debería llamar explícitamente la **MoveToSuspendQ** API y debería intentar suspender el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-153">In such a situation, the adapter should explicitly call the **MoveToSuspendQ** API and should try to suspend the message.</span></span> <span data-ttu-id="bb231-154">Cuando un adaptador intenta suspender un mensaje, una de las siguientes afirmaciones debería ser verdadera:</span><span class="sxs-lookup"><span data-stu-id="bb231-154">When an adapter tries to suspend a message, one of the following should be true:</span></span>  
  
-   <span data-ttu-id="bb231-155">Se debería suspender el mismo objeto de mensaje que el adaptador enviado (recomendado).</span><span class="sxs-lookup"><span data-stu-id="bb231-155">The same message object that the adapter submitted (recommended) should be suspended.</span></span>  
  
-   <span data-ttu-id="bb231-156">Si el adaptador tiene que crear un mensaje nuevo, debería establecerse el contexto de mensaje del mensaje nuevo con el puntero como contexto de mensaje del mensaje que se envió en un principio.</span><span class="sxs-lookup"><span data-stu-id="bb231-156">If the adapter has to create a new message, then it should set the message context of the new message with the pointer to the message context of the message that was originally submitted.</span></span> <span data-ttu-id="bb231-157">Esto se debe a que el contexto de mensaje de un mensaje contiene bastante información valiosa acerca del mensaje y del error.</span><span class="sxs-lookup"><span data-stu-id="bb231-157">This is because the message context of a message has a lot of valuable information about the message and the failure.</span></span> <span data-ttu-id="bb231-158">Esta información es necesaria para depurar el mensaje con errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-158">This information is required to debug the failed message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bb231-159">Si el adaptador crea un objeto nuevo de mensaje y lo suspende, debería copiar la información del error del objeto anterior del mensaje al nuevo.</span><span class="sxs-lookup"><span data-stu-id="bb231-159">If the adapter creates a new message object and suspends it, the adapter should copy the error information from the old message object to the new message object.</span></span>  
  
 <span data-ttu-id="bb231-160">Algunos adaptadores, como el HTTP que se proporciona con BizTalk Server, no requieren que se suspenda el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-160">Some adapters, such as the HTTP adapter provided with BizTalk Server, do not require that the message be suspended.</span></span> <span data-ttu-id="bb231-161">Estos adaptadores pueden devolver un error a sus equipos cliente.</span><span class="sxs-lookup"><span data-stu-id="bb231-161">These adapters can return an error back to their client.</span></span>  
  
#### <a name="causes-of-failure"></a><span data-ttu-id="bb231-162">Causas de error</span><span class="sxs-lookup"><span data-stu-id="bb231-162">Causes of failure</span></span>  
 <span data-ttu-id="bb231-163">Las causas más sencillas son los errores que se pueden producir a medida que se crea el lote o cuando **Ibttransportbatch** se llama.</span><span class="sxs-lookup"><span data-stu-id="bb231-163">Simple causes of failure are the errors that can occur as the batch is constructed or when **IBTTransportBatch::Done** is called.</span></span>  
  
-   <span data-ttu-id="bb231-164">**Error de envío.**</span><span class="sxs-lookup"><span data-stu-id="bb231-164">**Submit failure.**</span></span> <span data-ttu-id="bb231-165">El **enviar** puede producir un error de llamada para un número limitado de razones y todas ellas son fatales.</span><span class="sxs-lookup"><span data-stu-id="bb231-165">The **Submit** call can fail for a limited number of reasons, and all of them are fatal.</span></span> <span data-ttu-id="bb231-166">Estas razones incluyen las siguientes:</span><span class="sxs-lookup"><span data-stu-id="bb231-166">These reasons include:</span></span>  
  
-   <span data-ttu-id="bb231-167">Los errores de memoria insuficiente que se producen en el espacio de procesos de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-167">Out-of-memory errors occurring in the BizTalk Server process space.</span></span>  
  
-   <span data-ttu-id="bb231-168">El ensamblado de esquema se ha colocado desde la implementación.</span><span class="sxs-lookup"><span data-stu-id="bb231-168">The schema assembly has been dropped from the deployment.</span></span> <span data-ttu-id="bb231-169">En este caso, el **enviar** se produce un error críptico.</span><span class="sxs-lookup"><span data-stu-id="bb231-169">In this case, the **Submit** fails with a cryptic error.</span></span> <span data-ttu-id="bb231-170">En el adaptador de MQSeries, se captura la excepción de error genérico de BizTalk Server y se escribe un mensaje de error extendido en el registro de eventos del sistema.</span><span class="sxs-lookup"><span data-stu-id="bb231-170">In the MQSeries adapter, the generic failure exception from BizTalk Server is caught, and an extended error message is written in the system event log.</span></span> <span data-ttu-id="bb231-171">Este mensaje sugiere que una de las posibles causas del error es que, de alguna forma, el ensamblado de esquema se ha colocado desde la implementación.</span><span class="sxs-lookup"><span data-stu-id="bb231-171">This message suggests that one of the possible causes of the error is that the schema assembly has somehow been dropped from the deployment.</span></span>  
  
     <span data-ttu-id="bb231-172">En general, si **enviar** se produce un error, debe intentar suspender el mensaje mediante la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-172">In general, if **Submit** fails you should try to suspend the message using the same transaction.</span></span>  
  
-   <span data-ttu-id="bb231-173">**Error ibttransportbatch:: done.**</span><span class="sxs-lookup"><span data-stu-id="bb231-173">**IBTTransportBatch::Done failure.**</span></span> <span data-ttu-id="bb231-174">El **Ibttransportbatch** llamada puede tener errores por varias razones.</span><span class="sxs-lookup"><span data-stu-id="bb231-174">The **IBTTransportBatch::Done** call can fail for one of several reasons.</span></span> <span data-ttu-id="bb231-175">Por lo general, debería intentar suspender una operación y finalizar la transacción solo si se producen errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-175">In general, you should always attempt one suspend operation and end the transaction only if that fails.</span></span> <span data-ttu-id="bb231-176">Uno de los códigos de error que puede recibir el error de **ibttransportbatch:: Done** es que BizTalk Server está intentando cerrarse.</span><span class="sxs-lookup"><span data-stu-id="bb231-176">One of the error codes you might receive from the failure of **IBTTransportBatch::Done** is that BizTalk Server is trying to shut down.</span></span> <span data-ttu-id="bb231-177">En este caso, solo debe finalizar la transacción y dejarla porque la **Terminate** llamada probablemente está ocurriendo al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="bb231-177">In this case, you should just end the transaction and leave it because the **Terminate** call is probably happening concurrently.</span></span> <span data-ttu-id="bb231-178">Si se ha creado correctamente el lote y se ha ejecutado correctamente se producen otros escenarios **Ibttransportbatch**.</span><span class="sxs-lookup"><span data-stu-id="bb231-178">Other scenarios occur when you have successfully constructed the batch and successfully executed **IBTTransportBatch::Done**.</span></span> <span data-ttu-id="bb231-179">En estos casos, los errores se devuelven en **BatchComplete** y el adaptador debe determinar qué hacer con ellos.</span><span class="sxs-lookup"><span data-stu-id="bb231-179">In these cases, the errors are returned in **BatchComplete** and the adapter must determine what to do with them.</span></span> <span data-ttu-id="bb231-180">El resto de la sección trata este caso.</span><span class="sxs-lookup"><span data-stu-id="bb231-180">The rest of this section deals with this case.</span></span>  
  
#### <a name="processing-batchcomplete-errors"></a><span data-ttu-id="bb231-181">Procesamiento de errores BatchComplete</span><span class="sxs-lookup"><span data-stu-id="bb231-181">Processing BatchComplete errors</span></span>  
 <span data-ttu-id="bb231-182">**BatchComplete** es una devolución de llamada proporcionada por el adaptador que se invoca por BizTalk Server para indicar el estado de finalización de una operación por lotes.</span><span class="sxs-lookup"><span data-stu-id="bb231-182">**BatchComplete** is a callback provided by the adapter that is invoked by BizTalk Server to indicate the completion status of a batch operation.</span></span>  
  
 <span data-ttu-id="bb231-183">El parámetro más importante pasado a **BatchComplete** es el estado del lote `hResult`.</span><span class="sxs-lookup"><span data-stu-id="bb231-183">The most important parameter passed to **BatchComplete** is the batch status `hResult`.</span></span> <span data-ttu-id="bb231-184">Esto indica si el lote es correcto o contiene errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-184">This indicates success or failure for the batch.</span></span> <span data-ttu-id="bb231-185">Si el lote contiene errores, significa que ninguna de las operaciones que se han realizado en el lote se ha hecho de forma correcta.</span><span class="sxs-lookup"><span data-stu-id="bb231-185">If the batch failed, it means that none of the operations in the batch succeeded.</span></span> <span data-ttu-id="bb231-186">El adaptador pasa a través de la estructura de estado de lote y determina qué mensajes con errores (Esto se conoce como *filtrado del lote*).</span><span class="sxs-lookup"><span data-stu-id="bb231-186">The adapter goes through the batch status structure and determines which messages failed (this is known as *filtering the batch*).</span></span>  
  
#### <a name="nontransactional-batchcomplete-errors"></a><span data-ttu-id="bb231-187">Errores BatchComplete no transaccionales</span><span class="sxs-lookup"><span data-stu-id="bb231-187">Nontransactional BatchComplete errors</span></span>  
 <span data-ttu-id="bb231-188">Adaptadores no transaccionales, debe elegir la respuesta si se produce un error para un **SubmitMessage**/**SubmitRequestMessage** o **SubmitResponseMessage** operación.</span><span class="sxs-lookup"><span data-stu-id="bb231-188">For nontransactional adapters, you must choose your response if a failure occurs for a **SubmitMessage**/**SubmitRequestMessage** or **SubmitResponseMessage** operation.</span></span> <span data-ttu-id="bb231-189">Los adaptadores suelen suspender el mensaje mediante una llamada a **MoveToSuspendQ**.</span><span class="sxs-lookup"><span data-stu-id="bb231-189">Typically adapters suspend the message by calling **MoveToSuspendQ**.</span></span>  
  
 <span data-ttu-id="bb231-190">Siempre se deberían producirse las siguientes operaciones: **DeleteMessage**, **MoveToSuspendQ**, **ResubmitMessage**.</span><span class="sxs-lookup"><span data-stu-id="bb231-190">The following operations are always expected to pass: **DeleteMessage**, **MoveToSuspendQ**, **ResubmitMessage**.</span></span> <span data-ttu-id="bb231-191">Si se producen errores en estas operaciones, significa, por lo general, que hay un error en el adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-191">If these operations fail, it typically means that there is a bug in the adapter.</span></span> <span data-ttu-id="bb231-192">En esos casos, no es necesario que escriba código para controlar un error.</span><span class="sxs-lookup"><span data-stu-id="bb231-192">You do not have to write code to handle a failure in these cases.</span></span> <span data-ttu-id="bb231-193">Sin embargo, si se produce un error en el lote porque hay errores en otra operación, esas operaciones deben volver a ejecutarse en un lote nuevo.</span><span class="sxs-lookup"><span data-stu-id="bb231-193">However if the batch failed because another operation failed, then these operations must be re-executed in a fresh batch.</span></span>  
  
 <span data-ttu-id="bb231-194">Si el adaptador llama a **MovetoBackupTransport** y que se produce un error (porque no había ningún transporte de reserva), a continuación, el adaptador debería llamar a **MoveToSuspendQ** para suspender el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-194">If the adapter calls **MovetoBackupTransport** and that fails (because there was no backup transport), then the adapter should call **MoveToSuspendQ** to suspend the message.</span></span>  
  
#### <a name="transactional-batchcomplete-errors"></a><span data-ttu-id="bb231-195">Errores BatchComplete transaccionales</span><span class="sxs-lookup"><span data-stu-id="bb231-195">Transactional BatchComplete errors</span></span>  
 <span data-ttu-id="bb231-196">Cuando envía lotes a BizTalk Server mediante una transacción que ha creado el adaptador, debería seguir uno de los dos escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="bb231-196">When you submit batches to BizTalk Server using a transaction created by the adapter, you should follow one of these two scenarios:</span></span>  
  
-   <span data-ttu-id="bb231-197">**Usar lotes de mensajes únicos.**</span><span class="sxs-lookup"><span data-stu-id="bb231-197">**Use single-message batches.**</span></span> <span data-ttu-id="bb231-198">Enviar un lote de mensaje único a BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-198">Send a single-message batch to BizTalk Server.</span></span> <span data-ttu-id="bb231-199">Si se producen errores en ese único mensaje, puede enviar de forma válida un segundo lote a BizTalk Server en la misma transacción pero debe mover el mensaje infractor a la cola de suspensión en lugar de reenviarlo.</span><span class="sxs-lookup"><span data-stu-id="bb231-199">If that single message fails, then you can legally send BizTalk Server a second batch under the same transaction, but you must move the offending message to the Suspended queue rather than resubmitting it.</span></span> <span data-ttu-id="bb231-200">Una vez que se ha eliminado el mensaje con errores, el envío del segundo lote debería producirse de forma correcta.</span><span class="sxs-lookup"><span data-stu-id="bb231-200">After the failed message is removed, the submission of the second batch should succeed.</span></span> <span data-ttu-id="bb231-201">Cuando esto suceda, puede confirmar la transacción una vez que BizTalk Server confirme que el segundo lote es correcto.</span><span class="sxs-lookup"><span data-stu-id="bb231-201">After that occurs you can commit the transaction when BizTalk Server confirms that the second batch was successful.</span></span> <span data-ttu-id="bb231-202">Si se producen errores en el segundo lote, el adaptador debe anular la transacción o encontrar otro sitio donde colocar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-202">If the second batch fails, the adapter must abort the transaction, or find somewhere else to place that message.</span></span> <span data-ttu-id="bb231-203">En este escenario, enseguida sufrirá una importante merma en el rendimiento debido al procesamiento de reversión de transacciones.</span><span class="sxs-lookup"><span data-stu-id="bb231-203">In this scenario, you immediately take a significant performance hit due to transaction rollback processing.</span></span>  
  
     <span data-ttu-id="bb231-204">Para mejorar el rendimiento del adaptador se pueden utilizar algunas técnicas.</span><span class="sxs-lookup"><span data-stu-id="bb231-204">There are some techniques that you can use to improve the performance of the adapter.</span></span> <span data-ttu-id="bb231-205">Por ejemplo, el adaptador de MQSeries ajusta su aproximación de forma dinámica al tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="bb231-205">For example, the MQSeries adapter adjusts its approach dynamically at run time.</span></span> <span data-ttu-id="bb231-206">Se ejecuta con lotes de 100 mensajes.</span><span class="sxs-lookup"><span data-stu-id="bb231-206">It runs with 100-message batches.</span></span> <span data-ttu-id="bb231-207">Si se produce un error, se debe finalizar el lote pero cambia a lotes de mensajes únicos durante un breve período de tiempo cuando pasa por el mensaje malintencionado.</span><span class="sxs-lookup"><span data-stu-id="bb231-207">If it hits an error, it must end the batch, but it switches to single-message batches for a short time as it gets past the bad message.</span></span> <span data-ttu-id="bb231-208">A continuación, vuelve a lotes de 100 mensajes.</span><span class="sxs-lookup"><span data-stu-id="bb231-208">It then reverts to 100-message batches.</span></span> <span data-ttu-id="bb231-209">Si se produce el error de nuevo, se vuelve a ralentizar.</span><span class="sxs-lookup"><span data-stu-id="bb231-209">If it hits the error again, it slows down again.</span></span>  
  
-   <span data-ttu-id="bb231-210">**Utilizar suspensión preferente.**</span><span class="sxs-lookup"><span data-stu-id="bb231-210">**Use preemptive suspension.**</span></span> <span data-ttu-id="bb231-211">Construir un lote de mensajes múltiples en los que los mensajes erróneos se suspenden de forma preferente.</span><span class="sxs-lookup"><span data-stu-id="bb231-211">Construct a multi-message batch in which the erroneous messages are preemptively suspended.</span></span> <span data-ttu-id="bb231-212">El lote contiene una mezcla de **enviar** y **MoveToSuspendQ** operaciones, y es el primer y único lote en la transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-212">The batch contains a mix of **Submit** and **MoveToSuspendQ** operations, and is the first and only batch under the transaction.</span></span> <span data-ttu-id="bb231-213">Debería realizarse de forma correcta porque los datos no válidos se han suspendido de forma preferente y, además, se puede confirmar la transacción (después de esperar para recibir la confirmación de BizTalk Server).</span><span class="sxs-lookup"><span data-stu-id="bb231-213">It should succeed because the bad data was preemptively suspended, and the transaction can be committed (after waiting to receive the confirmation from BizTalk Server).</span></span>  
  
     <span data-ttu-id="bb231-214">Puede parecer que sea necesario adelantarse en el futuro, pero esta técnica se ha utilizado en el adaptador de MSMQ.</span><span class="sxs-lookup"><span data-stu-id="bb231-214">This might seem to require looking into the future, but this technique has been used in the MSMQ adapter.</span></span> <span data-ttu-id="bb231-215">Depende de si se tiene o no identificadores de mensajes únicos confiables.</span><span class="sxs-lookup"><span data-stu-id="bb231-215">It depends on having reliably unique message IDs.</span></span> <span data-ttu-id="bb231-216">Este adaptador construye un lote de mensajes.</span><span class="sxs-lookup"><span data-stu-id="bb231-216">This adapter constructs a batch of messages.</span></span> <span data-ttu-id="bb231-217">Si no se producen errores se revierte la transacción (y, por lo tanto, el lote), pero recuerda el Id. de mensaje en una estructura temporal de datos.</span><span class="sxs-lookup"><span data-stu-id="bb231-217">If anything fails it rolls back the transaction (and therefore the batch), but remembers the message ID in a temporary data structure.</span></span> <span data-ttu-id="bb231-218">(Para evitar que esta estructura crezca de forma indefinida, se eliminan elementos de ella tras un retardo fijo.) Antes de que se envíe cada lote, el adaptador comprueba la lista de los Id. de mensajes no válidos.</span><span class="sxs-lookup"><span data-stu-id="bb231-218">(To prevent this structure from growing indefinitely, items in it are removed after some fixed time delay.) Before each batch is submitted, the adapter checks the list of bad message IDs.</span></span> <span data-ttu-id="bb231-219">Si ve uno, sabe que se van a producir errores en él (porque ya sucedió lo mismo con anterioridad) y lo suspende de forma preferente en lugar de intentar enviarlo.</span><span class="sxs-lookup"><span data-stu-id="bb231-219">If it sees one, it knows that message will fail (because it failed once in the past), and preemptively suspends it rather than trying to submit it.</span></span>  
  
     <span data-ttu-id="bb231-220">No todos los adaptadores tienen un Id. de mensaje único confiable y es menos probable que un almacén transaccional lo tenga.</span><span class="sxs-lookup"><span data-stu-id="bb231-220">Not every adapter has a reliably unique message ID, and a transactional store is less likely to have one.</span></span> <span data-ttu-id="bb231-221">Debido a esto, numerosos adaptadores transaccionales están restringidos al envío de lotes de mensajes únicos.</span><span class="sxs-lookup"><span data-stu-id="bb231-221">Because of this, many transactional adapters are restricted to sending single-message batches.</span></span>  
  
#### <a name="processing-other-errors"></a><span data-ttu-id="bb231-222">Procesamiento de otros errores</span><span class="sxs-lookup"><span data-stu-id="bb231-222">Processing other errors</span></span>  
 <span data-ttu-id="bb231-223">En el resto de los casos (como en los errores de los mensajes de suspensión), el adaptador debe finalizar la transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-223">In all other cases (such as failures in suspending messages), the adapter must end the transaction.</span></span> <span data-ttu-id="bb231-224">Cualquier otro resultado produce mensajes duplicados o quita mensajes.</span><span class="sxs-lookup"><span data-stu-id="bb231-224">Any other outcome results in either duplicate or dropped messages.</span></span>  
  
 <span data-ttu-id="bb231-225">Siempre que el adaptador pueda, debería anular la transacción cuando se produzcan errores en un lote.</span><span class="sxs-lookup"><span data-stu-id="bb231-225">Whenever the adapter can, it should abort the transaction if a batch fails.</span></span> <span data-ttu-id="bb231-226">Sin embargo, hay escenarios en los que el adaptador no puede anular la transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-226">However there are scenarios where the adapter cannot abort the transaction.</span></span> <span data-ttu-id="bb231-227">En dichos escenarios, se debería suspender el mensaje mediante la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-227">In such a scenario it should suspend the message using the same transaction.</span></span>  
  
#### <a name="processing-errors-on-transactional-receive"></a><span data-ttu-id="bb231-228">Procesamiento de errores en la recepción transaccional</span><span class="sxs-lookup"><span data-stu-id="bb231-228">Processing errors on transactional receive</span></span>  
 <span data-ttu-id="bb231-229">Un patrón de procesos transaccional común es finalizar una transacción cuando se produce un error.</span><span class="sxs-lookup"><span data-stu-id="bb231-229">A common transactional processing pattern is to end a transaction when an error occurs.</span></span> <span data-ttu-id="bb231-230">En ese caso todo vuelve al estado anterior y no se pierden datos.</span><span class="sxs-lookup"><span data-stu-id="bb231-230">In this case everything returns to its previous state and no data is lost.</span></span> <span data-ttu-id="bb231-231">Sin embargo, si utiliza datos de un suministro transaccional (por ejemplo, extrayendo filas de una en una de una tabla provisional de una base de datos o extrayendo mensajes de uno en uno de productos de cola como MQSeries o MSMQ), es posible que esto no sea suficiente.</span><span class="sxs-lookup"><span data-stu-id="bb231-231">However, if you are consuming data from a transactional feed (for example, pulling a row at a time from a staging table in a database, or pulling one message at a time from a queuing product like MQSeries or MSMQ), then this might not be enough.</span></span> <span data-ttu-id="bb231-232">Si simplemente finaliza la transacción, vuelve atrás y recoge los mismos datos de nuevo, es posible que se produzca el mismo error y que el sistema se quede bloqueado en un bucle repetido.</span><span class="sxs-lookup"><span data-stu-id="bb231-232">If you simply end the transaction and go back and pick up the same data again, the same error is likely to occur and the system becomes stuck in a repeated loop.</span></span>  
  
 <span data-ttu-id="bb231-233">El adaptador de SQL en una versión anterior de BizTalk Server se envió con este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="bb231-233">The SQL adapter in an earlier version of BizTalk Server shipped with this behavior.</span></span> <span data-ttu-id="bb231-234">Sin embargo, poco después de liberar el adaptador, el comportamiento se cambia para intentar suspender un mensaje con errores y confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-234">However, soon after release the adapter behavior was changed to attempt to suspend a failed message and commit the transaction.</span></span> <span data-ttu-id="bb231-235">Al mover un mensaje a la cola de suspensión en la misma transacción y, a continuación, confirmar la transacción, se evita que se pierdan datos y, además, permite que el adaptador pase datos no válidos.</span><span class="sxs-lookup"><span data-stu-id="bb231-235">Moving a message to the Suspended queue under the same transaction and then committing the transaction saves the data from being lost and also allows the adapter to get past bad data.</span></span>  
  
 <span data-ttu-id="bb231-236">Cuando la parte de recepción de un adaptador se pasa un mensaje de error en respuesta a un **enviar** mensaje de operación, el adaptador debería procesar ese error y mover el mensaje a la cola de suspensión.</span><span class="sxs-lookup"><span data-stu-id="bb231-236">When the receive portion of an adapter is passed an error message in response to a **Submit** message operation, the adapter should process that error and move the message to the Suspended queue.</span></span>  
  
 <span data-ttu-id="bb231-237">En el caso de lotes transaccionales en los que el adaptador ha creado el objeto de transacción y envía mensajes en la transacción, el adaptador debería mover el mensaje de forma lógica a la cola de suspensión en la misma transacción cuando se produce el error.</span><span class="sxs-lookup"><span data-stu-id="bb231-237">In the case of transactional batches in which the adapter has created the transaction object and submits messages under the transaction, the adapter should logically move the message to the Suspended queue under the same transaction when failures occur.</span></span> <span data-ttu-id="bb231-238">La transacción asegura que no se quitan datos aunque provoquen errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-238">The transaction ensures that data is not dropped, and even data that is causing an error should never be dropped.</span></span>  
  
### <a name="handle-messages-without-subscriptions"></a><span data-ttu-id="bb231-239">Controlar mensajes sin suscripciones</span><span class="sxs-lookup"><span data-stu-id="bb231-239">Handle Messages without Subscriptions</span></span>  
 <span data-ttu-id="bb231-240">BizTalk Server no acepta que se publique un mensaje en su base de datos de cuadro de mensajes si no hay suscripciones definidas que lo acepten.</span><span class="sxs-lookup"><span data-stu-id="bb231-240">BizTalk Server does not accept a message to be published in its MessageBox database if there are no subscriptions defined to accept it.</span></span> <span data-ttu-id="bb231-241">Las orquestaciones o los puertos de envío registran las suscripciones.</span><span class="sxs-lookup"><span data-stu-id="bb231-241">Subscriptions are registered by either orchestrations or send ports.</span></span> <span data-ttu-id="bb231-242">Se pueden definir numerosas suscripciones, en cuyo caso el mensaje se envía a varios destinos.</span><span class="sxs-lookup"><span data-stu-id="bb231-242">Multiple subscriptions can be defined, in which case the message is sent to multiple destinations.</span></span> <span data-ttu-id="bb231-243">Si no hay suscripciones, BizTalk Server rechaza el mensaje y no intenta suspenderlo.</span><span class="sxs-lookup"><span data-stu-id="bb231-243">If there are no subscriptions, BizTalk Server rejects the message and does not attempt to suspend it.</span></span> <span data-ttu-id="bb231-244">Si el adaptador no controla este error y suspende el mensaje de forma explícita, se quita el mensaje y es posible que se pierdan sus datos.</span><span class="sxs-lookup"><span data-stu-id="bb231-244">If the adapter does not handle this error and explicitly suspend the message, then the message is dropped and its data is potentially lost.</span></span> <span data-ttu-id="bb231-245">Es evidente que un adaptador transaccional puede finalizar la transacción y devolver el mensaje a su destino.</span><span class="sxs-lookup"><span data-stu-id="bb231-245">Of course a transactional adapter may end the transaction and return the message to its destination.</span></span>  
  
### <a name="support-seek-with-your-receive-stream"></a><span data-ttu-id="bb231-246">Búsqueda con la secuencia de recepción</span><span class="sxs-lookup"><span data-stu-id="bb231-246">Support Seek with Your Receive Stream</span></span>  
 <span data-ttu-id="bb231-247">La secuencia de lado de recepción debe admitir la **Seek** método para que BizTalk Server para que pueda suspender el mensaje en caso de un error de canalización.</span><span class="sxs-lookup"><span data-stu-id="bb231-247">The receive-side stream must support the **Seek** method for BizTalk Server to be able to suspend the message on a pipeline failure.</span></span> <span data-ttu-id="bb231-248">Si la secuencia de mensajes no pueden realizar búsqueda, BizTalk Server genera un error cuando intenta ejecutar **Seek**.</span><span class="sxs-lookup"><span data-stu-id="bb231-248">If the message stream is not seekable, then BizTalk Server generates an error when it tries to run **Seek**.</span></span>  
  
 <span data-ttu-id="bb231-249">En muchos casos que admiten **Seek** no es fácil.</span><span class="sxs-lookup"><span data-stu-id="bb231-249">In many cases supporting **Seek** is not easy.</span></span> <span data-ttu-id="bb231-250">Cuando se transmiten datos por secuencias desde una red, por ejemplo, puede resultar difícil volver al recurso de red y solicitar los datos de nuevo.</span><span class="sxs-lookup"><span data-stu-id="bb231-250">When streaming data from a network, for example, it may be difficult to go back to the network resource and request the data again.</span></span>  
  
 <span data-ttu-id="bb231-251">Varios adaptadores que se incluyen con BizTalk Server ponen en cola los datos de mensaje en un archivo de un disco al mismo tiempo que BizTalk Server lee los datos.</span><span class="sxs-lookup"><span data-stu-id="bb231-251">Several adapters that ship with BizTalk Server spool the message data onto a file on disk at the same time as BizTalk Server reads the data.</span></span> <span data-ttu-id="bb231-252">Esto permite que el adaptador se debe usar **Seek** en ese archivo si encuentra un error (en el procesamiento de canalización de los datos del mensaje, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="bb231-252">This allows the adapter to use **Seek** on that file if it encounters an error (in the pipeline processing of the message data, for example).</span></span> <span data-ttu-id="bb231-253">Internamente, el adaptador utiliza la **ReadOnlySeekableStream** clase que contiene una secuencia no permite búsquedas entrante y se desborda en el disco cuando se alcanza un umbral de tamaño configurable.</span><span class="sxs-lookup"><span data-stu-id="bb231-253">Internally the adapter uses the **ReadOnlySeekableStream** class that wraps an incoming non-seekable stream and overflows to disk when a configurable size threshold is reached.</span></span> <span data-ttu-id="bb231-254">En caso de que haya mensajes más pequeños que el tamaño del umbral, nunca se utiliza el disco.</span><span class="sxs-lookup"><span data-stu-id="bb231-254">For messages smaller than the threshold size, the disk is never hit.</span></span>  
  
### <a name="consider-user-configurable-error-handling-options"></a><span data-ttu-id="bb231-255">Considerar opciones configurables por el usuario para el control de errores</span><span class="sxs-lookup"><span data-stu-id="bb231-255">Consider User-Configurable Error-Handling Options</span></span>  
 <span data-ttu-id="bb231-256">En algunos casos no existe una respuesta correcta para un error.</span><span class="sxs-lookup"><span data-stu-id="bb231-256">Sometimes there is no one correct response to an error.</span></span> <span data-ttu-id="bb231-257">Si esto sucede, debería considerar una opción configurable por el usuario para elegir entre comportamientos.</span><span class="sxs-lookup"><span data-stu-id="bb231-257">In this case, you should consider a user-configurable option to choose between behaviors.</span></span> <span data-ttu-id="bb231-258">El adaptador de MQSeries realiza esta operación.</span><span class="sxs-lookup"><span data-stu-id="bb231-258">The MQSeries adapter does this.</span></span>  
  
 <span data-ttu-id="bb231-259">El problema de que el adaptador suspenda mensajes cuando ve un error es que la cola de suspensión en BizTalk Server es algo parecido a un "agujero negro".</span><span class="sxs-lookup"><span data-stu-id="bb231-259">The problem with having the adapter suspend messages when it sees an error is that the Suspended queue in BizTalk Server is something of a "black hole."</span></span> <span data-ttu-id="bb231-260">Es relativamente sencillo llevar mensajes a la cola, pero algo complicado sacarlos de nuevo.</span><span class="sxs-lookup"><span data-stu-id="bb231-260">It is relatively easy to get messages into the queue, but harder to get them out again.</span></span>  
  
 <span data-ttu-id="bb231-261">Es posible que algunos usuarios del adaptador no deseen utilizar la cola de suspensión.</span><span class="sxs-lookup"><span data-stu-id="bb231-261">Some users of the adapter might not want anything in the Suspended queue.</span></span> <span data-ttu-id="bb231-262">Por ejemplo, en el caso del adaptador de MQSeries, el usuario cuenta con una opción de configuración para realizar una de las siguientes operaciones:</span><span class="sxs-lookup"><span data-stu-id="bb231-262">For example, in the case of the MQSeries adapter, the user is offered a configuration option to do one of the following:</span></span>  
  
-   <span data-ttu-id="bb231-263">Configurar el adaptador para que finalice la transacción actual y se deshabilite cuando vea un error.</span><span class="sxs-lookup"><span data-stu-id="bb231-263">Set the adapter to end the current transaction and disable itself when it sees an error.</span></span>  
  
-   <span data-ttu-id="bb231-264">Suspender el mensaje con errores y confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="bb231-264">Suspend the failed message and commit the transaction.</span></span> <span data-ttu-id="bb231-265">El adaptador realiza esta operación incluso cuando BizTalk Server ha suspendido el mensaje correctamente.</span><span class="sxs-lookup"><span data-stu-id="bb231-265">The adapter does this even when BizTalk Server has successfully suspended the message.</span></span> <span data-ttu-id="bb231-266">Esta acción cumple los requisitos del cliente incluso si provoca que el registro de eventos no sea del todo correcto.</span><span class="sxs-lookup"><span data-stu-id="bb231-266">This action meets the requirements of the customer even if it causes the event log to not be strictly correct.</span></span>  
  
### <a name="implement-receive-ordering-by-using-a-single-thread-and-waiting-on-batchcomplete"></a><span data-ttu-id="bb231-267">Implementar órdenes de recepción mediante un único subproceso y a la espera de BatchComplete</span><span class="sxs-lookup"><span data-stu-id="bb231-267">Implement Receive Ordering by Using a Single Thread and Waiting on BatchComplete</span></span>  
 <span data-ttu-id="bb231-268">La interfaz de BizTalk Server está diseñada para conseguir rendimiento y la capacidad para escalar admitiendo concurrencia.</span><span class="sxs-lookup"><span data-stu-id="bb231-268">The interface to BizTalk Server is designed for performance and the ability to scale out by supporting concurrency.</span></span> <span data-ttu-id="bb231-269">Sin embargo, si desea una recepción estrictamente ordenada de mensajes (como la que se requiere en ocasiones cuando se reciben mensajes de un producto de cola de mensajes, como MQSeries o MSMQ), deberá realizar algunas operaciones adicionales en el adaptador para deshabilitar esa concurrencia.</span><span class="sxs-lookup"><span data-stu-id="bb231-269">However, if you want a strictly ordered receive of messages (as is sometimes required when receiving messages from a message queue product like MQSeries or MSMQ), then you must do some additional work in the adapter to disable some of that concurrency.</span></span> <span data-ttu-id="bb231-270">Esto se puede llevar a cabo en dos pasos:</span><span class="sxs-lookup"><span data-stu-id="bb231-270">This can be done in two steps:</span></span>  
  
1.  <span data-ttu-id="bb231-271">Debe utilizar un único subproceso para el procesamiento de todos los datos en el adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-271">You must use a single thread for all the data processing in the adapter.</span></span>  
  
2.  <span data-ttu-id="bb231-272">Debe esperar a que BizTalk Server procese por completo cada lote.</span><span class="sxs-lookup"><span data-stu-id="bb231-272">You must wait for BizTalk Server to completely process each batch.</span></span> <span data-ttu-id="bb231-273">Este requisito es importante y se puede conseguir utilizando primitivas de sincronización de subprocesos .NET.</span><span class="sxs-lookup"><span data-stu-id="bb231-273">This requirement is important and can be accomplished by using .NET thread synchronization primitives.</span></span> <span data-ttu-id="bb231-274">Por ejemplo, si se usa un **AutoResetEvent**, lo haría con:</span><span class="sxs-lookup"><span data-stu-id="bb231-274">For example, using an **AutoResetEvent**, you would:</span></span>  
  
    -   <span data-ttu-id="bb231-275">Declare el objeto de evento en el subproceso de trabajo principal tener acceso y la **BatchComplete** objeto de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="bb231-275">Declare the event object where it can be accessed by both the main worker thread and the **BatchComplete** callback object.</span></span>  
  
    -   <span data-ttu-id="bb231-276">En el subproceso de trabajo principal, envíe los mensajes al lote como de costumbre, pero, a continuación, llame a **AutoResetEvent.Reset** en el objeto de evento justo antes de llamar al lote **Ibttransportbatch**.</span><span class="sxs-lookup"><span data-stu-id="bb231-276">On the main worker thread, submit the messages to the batch as usual but then call **AutoResetEvent.Reset** on the event object just before the call to the batch **IBTTransportBatch::Done**.</span></span>  
  
    -   <span data-ttu-id="bb231-277">Llame a **AutoResetEvent.WaitOne** en el objeto de evento desde este mismo subproceso.</span><span class="sxs-lookup"><span data-stu-id="bb231-277">Call **AutoResetEvent.WaitOne** on the event object from this same thread.</span></span> <span data-ttu-id="bb231-278">Esto provoca el bloqueo del subproceso de trabajo principal.</span><span class="sxs-lookup"><span data-stu-id="bb231-278">This causees the main worker thread to block.</span></span> <span data-ttu-id="bb231-279">En el **BatchComplete** devolución de llamada de BizTalk Server, a continuación, llamar a **AutoResetEvent.Set** en el mismo objeto de evento para desbloquear el subproceso de trabajo para que esté preparada procesar otro mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-279">In the **BatchComplete** callback from BizTalk Server you then call **AutoResetEvent.Set** on the same event object to unblock the worker thread so it is ready to process another message.</span></span>  
  
 <span data-ttu-id="bb231-280">Se recomienda encarecidamente que *órdenes de recepción* como se vuelve configurable porque hace que degradación significativa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="bb231-280">It is strongly suggested that *receive ordering* like this be made configurable because it causes significant performance degradation.</span></span> <span data-ttu-id="bb231-281">Numerosos escenarios de usuarios, si no se trata de la mayoría, no requieren órdenes de mensajes.</span><span class="sxs-lookup"><span data-stu-id="bb231-281">Many, if not most, user scenarios do not require ordering of messages.</span></span> <span data-ttu-id="bb231-282">La suspensión de mensajes puede interrumpir también la orden.</span><span class="sxs-lookup"><span data-stu-id="bb231-282">Suspending messages can also break ordering.</span></span> <span data-ttu-id="bb231-283">Lo que se deba hacer en este caso exactamente depende de la aplicación, por lo tanto lo mejor que puede hacer el adaptador es ofrecer al usuario un punto de configuración.</span><span class="sxs-lookup"><span data-stu-id="bb231-283">Exactly what to do in this case is application-dependent, so the best thing for your adapter to do is to offer the user a configuration point.</span></span>  
  
 <span data-ttu-id="bb231-284">En escenarios ordenados, algunos clientes han declarado que preferirían detener el procesamiento, es decir, deshabilitar el adaptador en lugar de interrumpir la orden.</span><span class="sxs-lookup"><span data-stu-id="bb231-284">In ordered scenarios, some customers have stated that they would prefer to stop the processing, that is, disable the adapter, rather than break ordering.</span></span> <span data-ttu-id="bb231-285">El adaptador de MQSeries, que admite la recepción ordenada, proporciona esta opción al usuario.</span><span class="sxs-lookup"><span data-stu-id="bb231-285">The MQSeries adapter, which supports ordered receive, provides this option to the user.</span></span>  
  
## <a name="handle-send-specific-batch-errors"></a><span data-ttu-id="bb231-286">Controlar errores de lote específicos de envíos</span><span class="sxs-lookup"><span data-stu-id="bb231-286">Handle Send-Specific Batch Errors</span></span>  
  
### <a name="handle-send-retry-and-batching"></a><span data-ttu-id="bb231-287">Controlar el reintento y el procesamiento por lotes de envíos</span><span class="sxs-lookup"><span data-stu-id="bb231-287">Handle Send Retry and Batching</span></span>  
 <span data-ttu-id="bb231-288">A continuación se muestra un ejemplo frecuente de procesamiento por lotes de envíos:</span><span class="sxs-lookup"><span data-stu-id="bb231-288">Here is a typical example of send-side batching:</span></span>  
  
-   <span data-ttu-id="bb231-289">BizTalk Server proporciona un lote de mensajes al adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-289">BizTalk Server gives a batch of messages to the adapter.</span></span>  
  
-   <span data-ttu-id="bb231-290">Cuando el adaptador determina que ha entregado el mensaje en su destino de forma correcta, ejecuta la eliminación en BizTalk Server para indicar que está listo.</span><span class="sxs-lookup"><span data-stu-id="bb231-290">When the adapter determines that it has given the message to its destination correctly, it executes delete back on BizTalk Server indicating that it is done.</span></span> <span data-ttu-id="bb231-291">(Como es habitual, varios mensajes de eliminación pueden procesarse en lotes de forma arbitraria para mejorar el rendimiento.)</span><span class="sxs-lookup"><span data-stu-id="bb231-291">(As usual, several delete messages can be arbitrarily batched up to improve performance.)</span></span>  
  
 <span data-ttu-id="bb231-292">Si el adaptador de envíos produce errores al procesar un mensaje, se puede realizar una de las siguientes operaciones con ese mensaje:</span><span class="sxs-lookup"><span data-stu-id="bb231-292">If the send-side adapter fails to process a message, then it may do one of several things with that message:</span></span>  
  
-   <span data-ttu-id="bb231-293">El adaptador debería decir a BizTalk Server que quiere que se reintente un mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-293">The adapter should tell BizTalk Server that it wants a message retried.</span></span> <span data-ttu-id="bb231-294">BizTalk Server no reintenta de forma automática el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-294">BizTalk Server does not automatically retry a message.</span></span> <span data-ttu-id="bb231-295">BizTalk Server mantiene un recuento de los reintentos, que puede consultarse en el contexto del mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-295">BizTalk Server keeps a count of the retries, and this count can be seen in the message context.</span></span>  
  
-   <span data-ttu-id="bb231-296">El adaptador puede determinar que no puede procesar un mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-296">The adapter may determine that it cannot process a message.</span></span> <span data-ttu-id="bb231-297">En ese caso, el adaptador puede mover el mensaje al siguiente transporte.</span><span class="sxs-lookup"><span data-stu-id="bb231-297">In this case, the adapter might move the message to the next transport.</span></span> <span data-ttu-id="bb231-298">El adaptador realiza esto con el **MoveToNextTransport** llamar a en el **lote** objeto.</span><span class="sxs-lookup"><span data-stu-id="bb231-298">The adapter does this with the **MoveToNextTransport** call on the **Batch** object.</span></span>  
  
-   <span data-ttu-id="bb231-299">El adaptador puede mover el mensaje a la cola de suspensión.</span><span class="sxs-lookup"><span data-stu-id="bb231-299">The adapter may move the message to the Suspended queue.</span></span>  
  
 <span data-ttu-id="bb231-300">El adaptador determina lo que le ocurrirá al mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-300">The adapter determines what happens to the message.</span></span> <span data-ttu-id="bb231-301">Sin embargo, se recomienda que cuente con adaptadores que se comporten de forma coherente ya que esto hace que se admita de forma más sencilla la instalación de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-301">However, it is recommended that you have adapters behave in a consistent manner because this makes a BizTalk Server installation easier to support.</span></span>  
  
 <span data-ttu-id="bb231-302">Se recomienda encarecidamente que los adaptadores se comporten como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="bb231-302">It is highly recommended that adapters behave as described below.</span></span> <span data-ttu-id="bb231-303">Los adaptadores incluidos con BizTalk Server se comportan de la siguiente forma.</span><span class="sxs-lookup"><span data-stu-id="bb231-303">The adapters shipped with BizTalk Server behave like this.</span></span>  
  
### <a name="recommended-behavior-for-handling-send-errors-in-a-batch"></a><span data-ttu-id="bb231-304">Comportamiento recomendado para el control de errores de envío en un lote</span><span class="sxs-lookup"><span data-stu-id="bb231-304">Recommended Behavior for Handling Send Errors in a Batch</span></span>  
 <span data-ttu-id="bb231-305">El adaptador de envío recibe algunos mensajes y los envía a BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-305">The send adapter receives some messages and submits them to BizTalk Server.</span></span>  
  
 <span data-ttu-id="bb231-306">Por cada mensaje correcto, el adaptador debería eliminar ese mensaje en BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-306">For each successful message the adapter should delete that message on BizTalk Server.</span></span> <span data-ttu-id="bb231-307">Toda la comunicación que se devuelve a BizTalk Server se produce mediante lotes; las eliminaciones también se pueden procesar por lotes.</span><span class="sxs-lookup"><span data-stu-id="bb231-307">All communication back to BizTalk Server is done through batches, and the deletes can be batched up.</span></span> <span data-ttu-id="bb231-308">No tiene que ser el mismo lote que BizTalk Server creó en el adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-308">They do not have to be the same batch that BizTalk Server created on the adapter.</span></span> <span data-ttu-id="bb231-309">Si hay mensajes de respuesta (como en un escenario SolicitResponse), se deberían enviar de vuelta a BizTalk Server (con SubmitResponse) junto con la eliminación asociada.</span><span class="sxs-lookup"><span data-stu-id="bb231-309">If there are any response messages (as in a SolicitResponse scenario), then they should be submitted back to BizTalk Server (with SubmitResponse) along with the associated delete.</span></span>  
  
-   <span data-ttu-id="bb231-310">Si los mensajes no se han procesado de forma correcta en el adaptador, compruebe el número de reintentos.</span><span class="sxs-lookup"><span data-stu-id="bb231-310">If the message processing in the adapter was unsuccessful, check the retry count.</span></span>  
  
    -   <span data-ttu-id="bb231-311">Si no se ha superado el número de reintentos, reenvíe el mensaje a BizTalk Server, sin olvidarse de definir el tiempo de reintentos en el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-311">If the retry count was not exceeded, resubmit the message to BizTalk Server, remembering to set the retry time on the message.</span></span> <span data-ttu-id="bb231-312">El contexto del mensaje proporciona el número y el intervalo de reintentos que debería utilizar el adaptador.</span><span class="sxs-lookup"><span data-stu-id="bb231-312">The message context provides the retry count and the retry interval the adapter should use.</span></span>  
  
    -   <span data-ttu-id="bb231-313">Si se ha superado el número de reintentos, el adaptador debería intentar mover el mensaje mediante **MoveToNextTransport**.</span><span class="sxs-lookup"><span data-stu-id="bb231-313">If the retry count was exceeded, then the adapter should attempt to move the message by using **MoveToNextTransport**.</span></span> <span data-ttu-id="bb231-314">El reenvío y **MoveToNextTransport** mensajes se pueden combinar con las eliminaciones en el mismo lote en BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-314">The resubmit and **MoveToNextTransport** messages can be mixed with the deletes in the same batch back to BizTalk Server.</span></span> <span data-ttu-id="bb231-315">Esto no es necesario, pero puede ser un paso útil.</span><span class="sxs-lookup"><span data-stu-id="bb231-315">This is not required, but can be a useful step.</span></span>  
  
-   <span data-ttu-id="bb231-316">El reenvío y la **MoveToNextTransport** son formas para que el adaptador resolver los errores.</span><span class="sxs-lookup"><span data-stu-id="bb231-316">The resubmit and the **MoveToNextTransport** are ways for the adapter to deal with failures.</span></span> <span data-ttu-id="bb231-317">Pero, es posible que se produzcan errores dentro del procesamiento del error.</span><span class="sxs-lookup"><span data-stu-id="bb231-317">But there can be a failure within the processing of the failure.</span></span> <span data-ttu-id="bb231-318">En este caso, al procesar la respuesta del servidor BizTalk Server (en el **BatchComplete** método) el adaptador debe crear otro lote de BizTalk Server para indicar qué hacer con ese error.</span><span class="sxs-lookup"><span data-stu-id="bb231-318">In this case, in processing the response from BizTalk Server (in the **BatchComplete** method) the adapter must create another batch against BizTalk Server to indicate what to do with that failure.</span></span>  
  
     <span data-ttu-id="bb231-319">Siga los pasos que se presentan a continuación cuando se procese un error que se ha producido en el procesamiento de otro error:</span><span class="sxs-lookup"><span data-stu-id="bb231-319">Follow these steps when processing a failure that occurs within the processing of another failure:</span></span>  
  
    -   <span data-ttu-id="bb231-320">Si se produce un error en el reenvío, utilice **MoveToNextTransport**.</span><span class="sxs-lookup"><span data-stu-id="bb231-320">If the resubmit fails, use **MoveToNextTransport**.</span></span>  
  
    -   <span data-ttu-id="bb231-321">Si el **MoveToNextTransport** se produce un error, utilice **MoveToSuspendQ**.</span><span class="sxs-lookup"><span data-stu-id="bb231-321">If the **MoveToNextTransport** fails, use **MoveToSuspendQ**.</span></span>  
  
 <span data-ttu-id="bb231-322">Debe continuar con la creación de lotes en BizTalk Server hasta que reciba una acción correcta en BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="bb231-322">You must keep creating batches on BizTalk Server until you receive a successful action back on BizTalk Server.</span></span>  
  
### <a name="serialization-of-message-context-property"></a><span data-ttu-id="bb231-323">Serialización de propiedad del contexto de mensaje</span><span class="sxs-lookup"><span data-stu-id="bb231-323">Serialization of Message Context Property</span></span>  
 <span data-ttu-id="bb231-324">Todos los objetos que estén asignados a una propiedad de contexto de mensaje deben ser serializables.</span><span class="sxs-lookup"><span data-stu-id="bb231-324">All objects assigned to a message context property must be serializable.</span></span> <span data-ttu-id="bb231-325">En caso contrario, el motor de mensajería se iniciará una excepción de tipo **E_NOINTERFACE**.</span><span class="sxs-lookup"><span data-stu-id="bb231-325">Otherwise the Messaging Engine will throw an exception of type **E_NOINTERFACE**.</span></span> <span data-ttu-id="bb231-326">Este valor devuelto representa de forma ambigua un objeto no serializable que intenta que se le asigne al contexto del mensaje.</span><span class="sxs-lookup"><span data-stu-id="bb231-326">This return value ambiguously represents a non-serializable object attempting to be assigned the message context.</span></span>