---
title: Cómo diseñar un adaptador de rendimiento | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b5a1f338-fd7c-41c8-a181-8da8b293c4cc
caps.latest.revision: 15
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e7958968809dc224a3446ac81f3f89d08f6128a0
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22250540"
---
# <a name="how-to-design-a-performant-adapter"></a><span data-ttu-id="1d522-102">Cómo diseñar un adaptador con el que optimizar el rendimiento</span><span class="sxs-lookup"><span data-stu-id="1d522-102">How to Design a Performant Adapter</span></span>
<span data-ttu-id="1d522-103">Para optimizar el rendimiento, todos los adaptadores deberían admitir lotes con respecto al envío de lotes de mensajes, a la transmisión de lotes y, en general, a la realización de operaciones de mensajes en lotes.</span><span class="sxs-lookup"><span data-stu-id="1d522-103">For performance purposes all adapters should be batch-aware with regard to submitting batches of messages, transmitting batches, and generally performing operations on messages in batches.</span></span> <span data-ttu-id="1d522-104">Los adaptadores deberían intentar exponer atributos configurables relacionados con el rendimiento, como, por ejemplo, el tamaño de los lotes o el número de bytes de un lote, que se puedan configurar en la interfaz de usuario de tiempo de diseño del adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-104">Adapters should try to expose configurable performance-related attributes, such as the size of batches or the number of bytes in a batch, that are configurable from the adapter's design-time user interface.</span></span>  
  
 <span data-ttu-id="1d522-105">Como se ha mencionado anteriormente, los adaptadores de envío deberían realizar siempre envíos que no sean de bloqueo para evitar la disminución del rendimiento del host de envío.</span><span class="sxs-lookup"><span data-stu-id="1d522-105">As mentioned earlier, send adapters should always perform non-blocking sends to avoid degrading the performance of the send host.</span></span> <span data-ttu-id="1d522-106">No se recomienda el bloqueo adicional de las API del motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="1d522-106">Further blocking of Messaging Engine APIs is not recommended.</span></span>  
  
 <span data-ttu-id="1d522-107">Leer y escribir en el contexto del mensaje influye en el rendimiento en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1d522-107">Writing to and reading from the message context affects run-time performance.</span></span> <span data-ttu-id="1d522-108">Por lo general, los adaptadores deben evitar la lectura, escritura y promoción de una cantidad excesiva de propiedades de contexto del mensaje.</span><span class="sxs-lookup"><span data-stu-id="1d522-108">In general, adapters should avoid reading, writing, and promoting excessive numbers of message-context properties.</span></span> <span data-ttu-id="1d522-109">La promoción de propiedades da lugar a una mejora adicional del rendimiento debido a la evaluación de la suscripción que tiene lugar en cada propiedad promocionada en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1d522-109">Promoting properties creates an additional performance drain because of the subscription evaluation that occurs on each promoted property at run time.</span></span> <span data-ttu-id="1d522-110">Sin embargo, sería necesario que un adaptador promocionara una cantidad elevada de propiedades para influir de un modo perceptible en el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1d522-110">However, an adapter would need to promote a huge number of properties to noticeably impact performance.</span></span> <span data-ttu-id="1d522-111">En cualquier caso, se recomienda promocionar solo las propiedades que así lo requieran.</span><span class="sxs-lookup"><span data-stu-id="1d522-111">Still it is a good practice to promote only those properties that are required to be promoted.</span></span>  
  
## <a name="throttle-send-and-receive"></a><span data-ttu-id="1d522-112">Limitar envío y recepción</span><span class="sxs-lookup"><span data-stu-id="1d522-112">Throttle Send and Receive</span></span>  
 <span data-ttu-id="1d522-113">Cuando la carga del motor de BizTalk supera el umbral configurado, el motor limita los adaptadores y las orquestaciones para asegurar el rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="1d522-113">When the load on the BizTalk engine exceeds the configured threshold, the engine throttles adapters and orchestrations to ensure optimum performance.</span></span> <span data-ttu-id="1d522-114">En el lado de recepción, cuando la carga de trabajo en el motor supera un umbral determinado, la llamada del adaptador para **IBTTransportBatch.Done** se bloquea hasta que la carga disminuye lo suficiente.</span><span class="sxs-lookup"><span data-stu-id="1d522-114">On the receive side, when the workload on the engine exceeds a given threshold, the adapter's call to **IBTTransportBatch.Done** is blocked until the load has decreased sufficiently.</span></span> <span data-ttu-id="1d522-115">Este hecho obliga al adaptador a enviar un trabajo nuevo al motor solo cuando éste se encuentra disponible.</span><span class="sxs-lookup"><span data-stu-id="1d522-115">This forces the adapter to submit new work into the engine only when the engine is available.</span></span> <span data-ttu-id="1d522-116">En el caso del envío, cuando el motor limita los adaptadores que envían mensajes salientes, el motor no entrega mensajes nuevos que deban transmitirse hasta que la carga disminuya.</span><span class="sxs-lookup"><span data-stu-id="1d522-116">On the send side, when the engine is throttling adapters sending outbound messages, the engine does not deliver new messages to be transmitted until its load is reduced.</span></span>  
  
 <span data-ttu-id="1d522-117">Por estos motivos, no es preciso tener en cuenta la limitación en lo que respecta al adaptador, a menos que sea necesario, por ejemplo, para limitar el número de conexiones a un sistema de servidor.</span><span class="sxs-lookup"><span data-stu-id="1d522-117">For these reasons, the adapter does not need to be concerned with throttling unless it is required, for example, to limit the number of connections to a back-end system.</span></span> <span data-ttu-id="1d522-118">Para estos tipos de escenarios, ni el motor ni el marco de trabajo de adaptadores proporcionan ninguna asistencia.</span><span class="sxs-lookup"><span data-stu-id="1d522-118">For these types of scenarios, neither the engine nor the Adapter Framework provides any support.</span></span>  
  
 <span data-ttu-id="1d522-119">Puede controlar la limitación del número de mensajes enviados desde un adaptador de envío personalizado de varias formas, dependiendo de si controla el código fuente del adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-119">You can handle throttling the number of messages sent from a custom send adapter in several ways depending on whether you control the source code for the adapter.</span></span>  
  
### <a name="send-side-throttling-improves-performance"></a><span data-ttu-id="1d522-120">La limitación de los envíos mejora el rendimiento</span><span class="sxs-lookup"><span data-stu-id="1d522-120">Send-Side Throttling Improves Performance</span></span>  
 <span data-ttu-id="1d522-121">Si controla el código fuente del adaptador, puede determinar, a partir de métodos heurísticos, el número máximo de mensajes que desee tener en cola para enviarlos en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="1d522-121">If you control the source code for the adapter, you can determine from heuristics the maximum number of messages that you want to have in the queue to send at any time.</span></span> <span data-ttu-id="1d522-122">Cuando se llama el motor de mensajería la `TransmitMessage` método y pasa el adaptador de envío de un mensaje nuevo, puede elegir bloquear el subproceso o comprobar para ver si el número de mensajes en la cola es mayor que el valor máximo que ha determinado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="1d522-122">When the Messaging Engine calls the `TransmitMessage` method and passes the send adapter a new message, you can choose to either block the thread or check to see if the number of messages in the queue is larger than the maximum value you determined previously.</span></span> <span data-ttu-id="1d522-123">Si se ha superado el número máximo de mensajes, puede usar el `Resubmit` método para volver a enviar el mensaje al motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="1d522-123">If the maximum number of messages has been exceeded, you can use the `Resubmit` method to resubmit the message to the Messaging Engine.</span></span> <span data-ttu-id="1d522-124">Tenga en cuenta que si el adaptador es sincrónico, el mensaje ya debería estar bloqueado.</span><span class="sxs-lookup"><span data-stu-id="1d522-124">Note that if the adapter is synchronous, the message would already be blocked.</span></span>  
  
 <span data-ttu-id="1d522-125">Si no se controla el código fuente para el adaptador, puede cambiar el número de mensajes en cola cambiando el **Highwatermark** valor en la tabla Adm_serviceclass de la base de datos de administración de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="1d522-125">If you do not control the source code for the adapter, you can change the number of queued messages by changing the **Highwatermark** value in the Adm_serviceclass table in the BizTalk Management database.</span></span> <span data-ttu-id="1d522-126">El valor máximo para el **Highwatermark** propiedad es 200.</span><span class="sxs-lookup"><span data-stu-id="1d522-126">The maximum value for the **Highwatermark** property is 200.</span></span> <span data-ttu-id="1d522-127">También puede cambiar el valor de la **límite mínimo** propiedad con un valor menor.</span><span class="sxs-lookup"><span data-stu-id="1d522-127">You can also change the value for the **Lowwatermark** property to a smaller value.</span></span>  
  
 <span data-ttu-id="1d522-128">Recuerde que el valor de la **Highwatermark** propiedad para las cuentas de adaptadores asíncronos para el número de mensajes que el motor de mensajería ha proporcionado para el adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-128">Remember that the value of the **Highwatermark** property for asynchronous adapters accounts for the number of messages that the Messaging Engine has given to the adapter.</span></span> <span data-ttu-id="1d522-129">El motor de mensajería los pasa al adaptador a través de la `TransmitMessage` método, estos mensajes pueden estar pendientes aún en la transmisión, por ejemplo, si el adaptador no ha realizado una llamada correspondiente a la `DeleteMessage`, `Resubmit`, `MoveToNextTransport` , o [Microsoft.BizTalk.TransportProxy.Interop.BatchOperationType.MoveToSuspendQ](http://msdn.microsoft.com/library/microsoft.biztalk.transportproxy.interop.batchoperationtype.aspx) métodos.</span><span class="sxs-lookup"><span data-stu-id="1d522-129">The Messaging Engine passes them to the adapter through the `TransmitMessage` method, These messages can be still outstanding in their transmission—for example, if the adapter has not made a corresponding call to the `DeleteMessage`, `Resubmit`, `MoveToNextTransport`, or [Microsoft.BizTalk.TransportProxy.Interop.BatchOperationType.MoveToSuspendQ](http://msdn.microsoft.com/library/microsoft.biztalk.transportproxy.interop.batchoperationtype.aspx) methods.</span></span> <span data-ttu-id="1d522-130">Para los adaptadores sincrónicos, la **Highwatermark** propiedad solo representan el número de mensajes que el motor de mensajería ha pasado al adaptador mediante utilizando la **TransmitMessage** método porque esta llamada procesa de manera sincrónica, bloquear el subproceso que realiza la llamada del motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="1d522-130">For synchronous adapters, the **Highwatermark** property only accounts for the number of messages the Messaging Engine has passed to the adapter by using the **TransmitMessage** method because this call processes synchronously, blocking the calling Messaging Engine thread.</span></span>  
  
 <span data-ttu-id="1d522-131">Si escribe un adaptador de envío para un protocolo que es de naturaleza inherentemente lenta (por ejemplo, HTTP, FTP o SOAP bidireccional), tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1d522-131">If you are writing a send adapter for a protocol that is inherently slow in nature (such as HTTP, FTP, or two-way SOAP), consider the following:</span></span>  
  
-   <span data-ttu-id="1d522-132">Es posible que un adaptador de este tipo reciba mensajes para su transmisión desde el motor de mensajería de BizTalk más rápido de lo que puede transmitirlos.</span><span class="sxs-lookup"><span data-stu-id="1d522-132">Such an adapter might receive messages for transmission from the BizTalk Messaging Engine faster than it can transmit them.</span></span> <span data-ttu-id="1d522-133">Esta discrepancia ocasiona problemas a distintos niveles.</span><span class="sxs-lookup"><span data-stu-id="1d522-133">This discrepancy causes problems at various levels.</span></span> <span data-ttu-id="1d522-134">Los mensajes en transmisión permanecen en memoria y ocupan la memoria virtual, con lo que todo el sistema se ralentiza.</span><span class="sxs-lookup"><span data-stu-id="1d522-134">The messages under transmission remain in memory and take up the virtual memory, slowing down the entire system.</span></span>  
  
-   <span data-ttu-id="1d522-135">Es posible que el adaptador ocupe los recursos específicos del protocolo.</span><span class="sxs-lookup"><span data-stu-id="1d522-135">The adapter might take up protocol-specific resources.</span></span> <span data-ttu-id="1d522-136">Por ejemplo, puede que abra demasiadas conexiones simultáneas al servidor, lo que podría interrumpir el servidor remoto.</span><span class="sxs-lookup"><span data-stu-id="1d522-136">For example, it might open too many concurrent connections to the server, which could disrupt the remote server.</span></span>  
  
-   <span data-ttu-id="1d522-137">El adaptador puede influir en otros adaptadores.</span><span class="sxs-lookup"><span data-stu-id="1d522-137">The adapter might affect other adapters.</span></span> <span data-ttu-id="1d522-138">Por ejemplo, si hay demasiados mensajes en cola de un adaptador concreto, el motor de mensajería detiene la emisión de solicitudes a otros adaptadores de envío en ese proceso.</span><span class="sxs-lookup"><span data-stu-id="1d522-138">For example, if too many messages queue up for a particular adapter, the Messaging Engine stops issuing requests to other send adapters in that process.</span></span>  
  
 <span data-ttu-id="1d522-139">Una solución es colocar los adaptadores lentos y rápidos en hosts de BizTalk independientes y controlar el número de mensajes mediante los valores de configuración de "marca de agua máxima" y "marca de agua mínima".</span><span class="sxs-lookup"><span data-stu-id="1d522-139">A solution is to put the slow and fast adapters in separate BizTalk Hosts and control the number of messages by using the "High Watermark" and "Low Watermark" settings.</span></span>  
  
### <a name="receive-side-throttling-improves-performance"></a><span data-ttu-id="1d522-140">La limitación de recepción mejora el rendimiento</span><span class="sxs-lookup"><span data-stu-id="1d522-140">Receive-Side Throttling Improves Performance</span></span>  
 <span data-ttu-id="1d522-141">Existen numerosas situaciones en las que un adaptador de recepción recibe los mensajes a una velocidad superior que aquella a la que el resto del sistema procesa los mensajes.</span><span class="sxs-lookup"><span data-stu-id="1d522-141">There are numerous situations in which a receive adapter receives messages faster than the rate at which the rest of the system can process the messages.</span></span> <span data-ttu-id="1d522-142">Cuando se produce una situación de este tipo, el trabajo de la base de datos de cuadro de mensajes se acumula.</span><span class="sxs-lookup"><span data-stu-id="1d522-142">When such a situation occurs, the MessageBox database becomes backlogged.</span></span> <span data-ttu-id="1d522-143">Si esto sucede, el rendimiento de todo el sistema disminuye de forma considerable.</span><span class="sxs-lookup"><span data-stu-id="1d522-143">When this happens, the performance of the whole system drops dramatically.</span></span>  
  
 <span data-ttu-id="1d522-144">Si esto sucede con el adaptador, puede usar una de las siguientes técnicas para reducir la velocidad del adaptador de recepción:</span><span class="sxs-lookup"><span data-stu-id="1d522-144">If this is happening with your adapter, you can use one of the following techniques to reduce the speed of the receive adapter:</span></span>  
  
-   <span data-ttu-id="1d522-145">Reduzca el tamaño del grupo de subprocesos del motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="1d522-145">Reduce the Messaging Engine thread pool size.</span></span> <span data-ttu-id="1d522-146">Puede controlar el número de subprocesos que el motor de mensajería usa para publicar mensajes en el cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="1d522-146">You can control the number of threads that the Messaging Engine uses to publish messages into the MessageBox.</span></span> <span data-ttu-id="1d522-147">Mediante la reducción del número de subprocesos, puede reducir la velocidad a la que el adaptador de recepción recibe mensajes en el cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="1d522-147">By reducing the number of threads, you reduce the rate at which the receive adapter receives messages into the MessageBox.</span></span> <span data-ttu-id="1d522-148">Solo es necesario que esta configuración se lleve a cabo para el host correspondiente en el controlador de recepción del adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-148">This setting only needs to be done for the host corresponding to the receive handler for the adapter.</span></span> <span data-ttu-id="1d522-149">No debe establecer esta configuración para el host correspondiente al controlador de envío del adaptador, a menos que desee ralentizar también el adaptador de envío.</span><span class="sxs-lookup"><span data-stu-id="1d522-149">You should not set this for the host corresponding to the send handler for the adapter, unless you want to slow down the send adapter as well.</span></span>  
  
-   <span data-ttu-id="1d522-150">Reduzca el tamaño del lote del adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-150">Reduce the adapter batch size.</span></span> <span data-ttu-id="1d522-151">Los adaptadores de recepción más rápidos publican mensajes en el cuadro de mensajes en lotes.</span><span class="sxs-lookup"><span data-stu-id="1d522-151">Most fast receive adapters publish messages to the MessageBox in batches.</span></span> <span data-ttu-id="1d522-152">El tamaño de estos lotes se configura normalmente en la página de propiedades de la ubicación de recepción.</span><span class="sxs-lookup"><span data-stu-id="1d522-152">The size of these batches is usually configurable in the receive location property page.</span></span> <span data-ttu-id="1d522-153">Mediante la disminución del tamaño del lote, puede disminuir el rendimiento global de los mensajes que entran en el sistema.</span><span class="sxs-lookup"><span data-stu-id="1d522-153">By decreasing the batch size you can decrease the overall throughput of messages coming into the system.</span></span>  
  
-   <span data-ttu-id="1d522-154">Cambie otros valores de configuración específicos del adaptador.</span><span class="sxs-lookup"><span data-stu-id="1d522-154">Change other adapter-specific settings.</span></span> <span data-ttu-id="1d522-155">Una vez que complete los dos pasos anteriores, puede tratar de ajustar otros parámetros del adaptador para efectuar una disminución adicional del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1d522-155">After you complete the two previous steps, you can try adjusting other adapter parameters to further decrease throughput.</span></span> <span data-ttu-id="1d522-156">Algunos adaptadores exponen parámetros internos que se pueden usar para disminuir el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1d522-156">Some adapters expose internal parameters that can be used to decrease throughput.</span></span> <span data-ttu-id="1d522-157">Por ejemplo, el adaptador de MQSeries tiene un parámetro de configuración para la “entrega ordenada”.</span><span class="sxs-lookup"><span data-stu-id="1d522-157">For example, the MQSeries adapter has a setting for “Ordered Delivery.”</span></span> <span data-ttu-id="1d522-158">La entrega ordenada especifica que el adaptador publicará un lote de mensajes, esperará a que se complete y, a continuación, publicará el siguiente lote.</span><span class="sxs-lookup"><span data-stu-id="1d522-158">Ordered Delivery specifies that the adapter will publish a batch of messages, wait for it to complete, and then publish the next batch.</span></span> <span data-ttu-id="1d522-159">Mediante la habilitación de este parámetro de configuración, quita esencialmente todo paralelismo del adaptador de recepción.</span><span class="sxs-lookup"><span data-stu-id="1d522-159">By enabling this setting, you essentially remove all parallelism from the receive adapter.</span></span> <span data-ttu-id="1d522-160">Por el contrario, el ajuste de los parámetros en el modo opuesto se puede usar para aumentar la velocidad de recepción de un adaptador de recepción.</span><span class="sxs-lookup"><span data-stu-id="1d522-160">Conversely, tuning the parameters in the opposite way can be used to increase the receiving rate of a receive adapter.</span></span>  
  
 <span data-ttu-id="1d522-161">Un adaptador puede enviar tantos lotes como sea necesario al proxy de transporte.</span><span class="sxs-lookup"><span data-stu-id="1d522-161">An adapter can submit as many batches as required to the transport proxy.</span></span> <span data-ttu-id="1d522-162">Cuando el sistema se encuentra sobrecargado, una llamada a la **realiza** método de la **IBTTransportBatch** interfaz bloqueará el mensaje hasta que se liberen los recursos necesarios para el sistema.</span><span class="sxs-lookup"><span data-stu-id="1d522-162">When the system is heavily stressed, a call to the **Done** method of the **IBTTransportBatch** interface will block the message until the required resources are released to the system.</span></span>  
  
## <a name="plan-for-asynchronous-receive-and-send"></a><span data-ttu-id="1d522-163">Plan para la recepción y el envío asíncronos</span><span class="sxs-lookup"><span data-stu-id="1d522-163">Plan for Asynchronous Receive and Send</span></span>  
 <span data-ttu-id="1d522-164">Las API de mensajería de BizTalk Server ofrecen una excelente compatibilidad para la programación asíncrona.</span><span class="sxs-lookup"><span data-stu-id="1d522-164">The BizTalk Server messaging APIs have rich support for asynchronous programming.</span></span> <span data-ttu-id="1d522-165">Si desea escribir un adaptador escalable, planee el uso del modelo asíncrono desde el inicio, ya que el modelo asíncrono proporciona una mejor simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="1d522-165">If you want to write a scalable adapter, plan on using the asynchronous model from the start because the asynchronous model provides better concurrency.</span></span>  
  
 <span data-ttu-id="1d522-166">En el lado de recepción, cuando un adaptador envía un lote de mensajes para el motor de mensajería de BizTalk (mediante una llamada a **Ibttransportbatch**), el motor de mensajería pone en cola el trabajo con su grupo de subprocesos interno y vuelve inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="1d522-166">On the receive side, when an adapter submits a batch of messages to the BizTalk Messaging Engine (by calling **IBTTransportBatch::Done**), the Messaging Engine queues up the work using its internal thread pool and returns immediately.</span></span> <span data-ttu-id="1d522-167">El motor procesa los mensajes en un subproceso independiente, dejando libre al adaptador para que lea más mensajes desde su origen y los envíe sin esperar a que finalice el procesamiento del mensaje anterior.</span><span class="sxs-lookup"><span data-stu-id="1d522-167">The engine processes the messages on a separate thread, leaving the adapter free to read more messages from its source and submit them without waiting for the previous message processing to complete.</span></span>  
  
 <span data-ttu-id="1d522-168">En el caso del envío, el adaptador puede ser asíncrono o sincrónico.</span><span class="sxs-lookup"><span data-stu-id="1d522-168">On the send side, your adapter can be either asynchronous or synchronous.</span></span> <span data-ttu-id="1d522-169">Sin embargo, si el protocolo es compatible con operaciones asíncronas, debe usar esta compatibilidad para escribir un adaptador escalable.</span><span class="sxs-lookup"><span data-stu-id="1d522-169">However, if your protocol supports asynchronous operations, you should use this support to write a scalable adapter.</span></span> <span data-ttu-id="1d522-170">Por ejemplo, los adaptadores de envío de archivo y de HTTP son completamente asíncronos y llevan a cabo muy pocas operaciones de sincronía y bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1d522-170">For example, File and HTTP send adapters are fully asynchronous and they perform very few blocking/synchronous operations.</span></span>  
  
 <span data-ttu-id="1d522-171">Las operaciones asíncronas garantizan que el motor de mensajería y el adaptador continúan realizando sus respectivos trabajos en paralelo y que no se esperan para realizar el procesamiento normal de mensajes.</span><span class="sxs-lookup"><span data-stu-id="1d522-171">Asynchronous operations ensure that both the Messaging Engine and your adapter will continue to do their respective work in parallel and not wait on each other for normal message processing.</span></span>  
  
## <a name="use-batching-to-improve-performance"></a><span data-ttu-id="1d522-172">Usar procesamiento por lotes para mejorar el rendimiento</span><span class="sxs-lookup"><span data-stu-id="1d522-172">Use Batching to Improve Performance</span></span>  
 <span data-ttu-id="1d522-173">El procesamiento por lotes es el mejor punto de partida para escribir un adaptador escalable.</span><span class="sxs-lookup"><span data-stu-id="1d522-173">Batching is the best starting point for writing a scalable adapter.</span></span> <span data-ttu-id="1d522-174">Esto ocurre para los adaptadores de envío y de recepción.</span><span class="sxs-lookup"><span data-stu-id="1d522-174">This is true for both send-side and receive-side adapters.</span></span> <span data-ttu-id="1d522-175">Cada lote pasa a través de una transacción de base de datos en BizTalk Server, incluso cuando el adaptador es no transaccional.</span><span class="sxs-lookup"><span data-stu-id="1d522-175">Every batch goes through a database transaction within BizTalk Server even if your adapter is nontransactional.</span></span> <span data-ttu-id="1d522-176">Puesto que hay un retraso fijo con cada transacción, debe tratar de minimizar el número de transacciones mediante la combinación de varias operaciones en un solo lote.</span><span class="sxs-lookup"><span data-stu-id="1d522-176">Because there is a fixed delay associated with each transaction, you should try to minimize the number of transactions by combining more than one operation into a single batch.</span></span>  
  
## <a name="do-not-starve-the-net-thread-pool"></a><span data-ttu-id="1d522-177">No privar al grupo de subprocesos .NET</span><span class="sxs-lookup"><span data-stu-id="1d522-177">Do Not Starve the .NET Thread Pool</span></span>  
 <span data-ttu-id="1d522-178">La escritura de adaptadores de BizTalk constituye un ejercicio al escribir código de tiempo de ejecución .NET; la escritura de código de tiempo de ejecución .NET constituye, de forma invariable, un ejercicio de la programación asíncrona.</span><span class="sxs-lookup"><span data-stu-id="1d522-178">Writing BizTalk adapters is an exercise in writing .NET runtime code; writing .NET runtime code is invariably an exercise in asynchronous programming.</span></span>  
  
 <span data-ttu-id="1d522-179">La privación de grupos de subprocesos .NET supone un riesgo para toda programación asíncrona en .NET; es especialmente importante que el programador de adaptador de BizTalk evite dicho riesgo.</span><span class="sxs-lookup"><span data-stu-id="1d522-179">Starving the .NET thread pool is a risk to all asynchronous programming in .NET, and it is particularly important for the BizTalk adapter programmer to avoid.</span></span>  
  
 <span data-ttu-id="1d522-180">El grupo de subprocesos .NET es un recurso limitado pero ampliamente compartido.</span><span class="sxs-lookup"><span data-stu-id="1d522-180">The .NET thread pool is a limited but widely shared resource.</span></span> <span data-ttu-id="1d522-181">Es fácil escribir código que use uno de los subprocesos del grupo de subprocesos .NET y lo conserve durante un largo período de tiempo, lo que bloquea la ejecución de otros elementos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1d522-181">It is easy to write code that uses one of the .NET thread pool threads and holds onto it for long time, blocking other work items from being executed.</span></span>  
  
 <span data-ttu-id="1d522-182">Siempre que use **BeginInvoke** o utilizar un temporizador, se utiliza un subproceso de grupo de subprocesos. NET.</span><span class="sxs-lookup"><span data-stu-id="1d522-182">Whenever you use **BeginInvoke** or use a timer, you are using a .NET thread pool thread.</span></span> <span data-ttu-id="1d522-183">Si tiene varios elementos de trabajo para realizar (por ejemplo, copiar mensajes externos a MQSeries en BizTalk Server), debe ejecutar un elemento de trabajo (un lote de mensajes en BizTalk Server) y, a continuación, colocarlo en cola en el grupo de subprocesos si hay más trabajo que realizar.</span><span class="sxs-lookup"><span data-stu-id="1d522-183">If you have multiple pieces of work to do (for example copying messages out of MQSeries into BizTalk Server), you should execute one work item (one batch of messages into BizTalk Server) and then requeue in the thread pool if there is more work to do.</span></span> <span data-ttu-id="1d522-184">No lo coloque en un `while` bucle en el subproceso.</span><span class="sxs-lookup"><span data-stu-id="1d522-184">Never sit in a `while` loop on the thread.</span></span>  
  
 <span data-ttu-id="1d522-185">En términos concretos, esto significa reemplazar `while` bucles con repetidas llamadas a **BeginInvoke**.</span><span class="sxs-lookup"><span data-stu-id="1d522-185">In concrete terms this means replacing `while` loops with repeated calls to **BeginInvoke**.</span></span> <span data-ttu-id="1d522-186">Este cambio sencillo puede mejorar de forma considerable la respuesta y la capacidad para escalar toda la implementación de forma horizontal.</span><span class="sxs-lookup"><span data-stu-id="1d522-186">This simple change can dramatically improve the responsiveness and scale-out ability for the whole implementation.</span></span>  
  
## <a name="choose-the-right-measurement-when-limiting-batch-size"></a><span data-ttu-id="1d522-187">Seleccionar la medición correcta al limitar el tamaño del lote</span><span class="sxs-lookup"><span data-stu-id="1d522-187">Choose the Right Measurement When Limiting Batch Size</span></span>  
 <span data-ttu-id="1d522-188">Si envía mensajes al servidor BizTalk Server en lotes, no limite el tamaño del lote basándose solo en el número de mensajes.</span><span class="sxs-lookup"><span data-stu-id="1d522-188">If you are submitting messages to BizTalk Server in batches, do not limit the batch size based only on the message count.</span></span> <span data-ttu-id="1d522-189">Tenga en cuenta lo que ocurre cuando se ha configurado un adaptador procesar por lotes basándose únicamente en el número de mensajes: si el tamaño del lote es dos y el adaptador obtiene cuatro mensajes de tamaño 4 KB, 8 KB, 1 MB y 5MB respectivamente, el primer lote será de 12 KB de tamaño , y el segundo lote será de 6 MB de tamaño.</span><span class="sxs-lookup"><span data-stu-id="1d522-189">Consider what happens when an adapter has been configured to batch based only on message count: If the batch size is two and the adapter gets four messages of size 4 KB, 8 KB, 1 MB, and 5MB respectively, the first batch will be of size 12 KB, and the second batch will be of size 6 MB.</span></span>  
  
 <span data-ttu-id="1d522-190">Puesto que el motor de mensajería de BizTalk procesa todos los mensajes en un solo lote de forma secuencial, el segundo lote de este ejemplo se procesará mucho más lento que el primero.</span><span class="sxs-lookup"><span data-stu-id="1d522-190">Because the BizTalk Messaging Engine processes all messages in a single batch sequentially, the second batch in this example will be processed much more slowly than the first batch.</span></span> <span data-ttu-id="1d522-191">De este modo, se reduce con eficacia el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1d522-191">This is effectively reducing throughput.</span></span> <span data-ttu-id="1d522-192">Un mejor modo de controlar este problema es llevar a cabo el procesamiento por lotes basándose en el número de mensajes y en los bytes totales del lote (es decir, el tamaño del lote en bytes).</span><span class="sxs-lookup"><span data-stu-id="1d522-192">A better way to handle this problem is to batch based on both message count and total bytes in the batch (that is, batch size in bytes).</span></span> <span data-ttu-id="1d522-193">No hay un número mágico de bytes totales.</span><span class="sxs-lookup"><span data-stu-id="1d522-193">There is no magic number for total bytes.</span></span> <span data-ttu-id="1d522-194">Sin embargo, en un escenario de procesamiento normal, si el tamaño del lote supera 1 MB, empezará a observar una simultaneidad y un rendimiento pobres.</span><span class="sxs-lookup"><span data-stu-id="1d522-194">However, in a normal processing scenario, if the batch size exceeds 1 MB, you will start seeing poor concurrency and throughput.</span></span>  
  
 <span data-ttu-id="1d522-195">Por lo general, los adaptadores son independientes con respecto a los mensajes y desconocen el tamaño de los mensajes en el entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="1d522-195">Generally adapters are message agnostic and they do not know the size of the messages in the production environment.</span></span> <span data-ttu-id="1d522-196">Es probable que el tamaño de los mensajes entrantes varíe de forma significativa.</span><span class="sxs-lookup"><span data-stu-id="1d522-196">The sizes of the incoming messages are likely to vary significantly.</span></span> <span data-ttu-id="1d522-197">Debido a ello, use siempre el número de mensajes y los bytes totales para generar el lote.</span><span class="sxs-lookup"><span data-stu-id="1d522-197">Because of this, always use message count and total bytes to build the batch.</span></span>