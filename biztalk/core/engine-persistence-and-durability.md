---
title: Motor de persistencia y durabilidad | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 13f9f3f1a02ddfe84a963704476e867783f31042
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22242596"
---
# <a name="engine-persistence-and-durability"></a><span data-ttu-id="76dac-102">Persistencia y durabilidad del motor</span><span class="sxs-lookup"><span data-stu-id="76dac-102">Engine Persistence and Durability</span></span>
<span data-ttu-id="76dac-103">En esta sección se explica cómo BizTalk Server integra de forma confiable procesos empresariales de acoplamiento flexible al guardar el estado de los procesos en el disco a través de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="76dac-103">This section explains how BizTalk Server reliably integrates loosely coupled business processes by persisting process state to disk via SQL Server.</span></span> <span data-ttu-id="76dac-104">Al guardar el estado en los momentos oportunos y utilizar transacciones, el sistema garantiza que no se pierda ningún estado de los procesos aunque se produzcan errores de hardware o software.</span><span class="sxs-lookup"><span data-stu-id="76dac-104">By persisting state at appropriate times, leveraging transactions, the system guarantees that no process state is lost even in the event of a hardware or software outage.</span></span> <span data-ttu-id="76dac-105">A esto se le denomina durabilidad del sistema.</span><span class="sxs-lookup"><span data-stu-id="76dac-105">This is referred to as system durability.</span></span>  
  
## <a name="loosely-coupled-business-process-management"></a><span data-ttu-id="76dac-106">Administración de procesos empresariales de acoplamiento flexible</span><span class="sxs-lookup"><span data-stu-id="76dac-106">Loosely Coupled Business Process Management</span></span>  
 <span data-ttu-id="76dac-107">Para integrar los sistemas existentes con el fin de ejecutar un único proceso empresarial lógico, es necesario administrar el estado de los procesos fuera de los sistemas existentes.</span><span class="sxs-lookup"><span data-stu-id="76dac-107">Integrating existing systems to perform a single logical business process requires management of process state outside of the existing systems.</span></span> <span data-ttu-id="76dac-108">El estado de los procesos empresariales, ya sean de larga o corta duración, se debe mantener de forma independiente para evitar que se produzca una explosión de las rutas de comunicación personalizadas como resultado del acoplamiento de los sistemas.</span><span class="sxs-lookup"><span data-stu-id="76dac-108">Whether the business process is long running or short lived, process state must be maintained independently in order to avoid the explosion of custom communications paths that result from tightly coupling systems together.</span></span>  
  
 <span data-ttu-id="76dac-109">Es evidente que el estado de una instancia de proceso empresarial en ejecución debe ser de confianza si el proceso empresarial cumple una función crucial.</span><span class="sxs-lookup"><span data-stu-id="76dac-109">Clearly, the state of a running business process instance must be reliable if the business process is mission critical.</span></span> <span data-ttu-id="76dac-110">Para garantizar la confiabilidad y durabilidad de los procesos empresariales, BizTalk utiliza transacciones de SQL Server para guardar el estado de los procesos y los datos empresariales en una base de datos del disco denominada base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="76dac-110">To assure that business processes are reliable and durable, BizTalk leverages SQL Server transactions to persist process state and business data to disk in a database known as the MessageBox database.</span></span> <span data-ttu-id="76dac-111">Para obtener más información acerca de la base de datos de cuadro de mensajes, vea [la base de datos de cuadro de mensajes](../core/the-messagebox-database.md).</span><span class="sxs-lookup"><span data-stu-id="76dac-111">For more information about the MessageBox database, see [The MessageBox Database](../core/the-messagebox-database.md).</span></span>  
  
 <span data-ttu-id="76dac-112">Todos los mensajes y todas las instancias de procesos empresariales de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] (por ejemplo, las instancias de orquestación), excepto las más triviales, se guardan en la base de datos de cuadro de mensajes al menos una vez durante el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="76dac-112">Every message and all but the most trivial business process instances (for example, orchestration instances) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are persisted in the MessageBox database at least once during processing.</span></span>  
  
## <a name="persistence-and-sustainability"></a><span data-ttu-id="76dac-113">Persistencia y sostenibilidad</span><span class="sxs-lookup"><span data-stu-id="76dac-113">Persistence and Sustainability</span></span>  
 <span data-ttu-id="76dac-114">El hecho de que BizTalk Server guarda todos los mensajes y la mayoría de las orquestaciones tiene un efecto directo en la sostenibilidad como se indicó en [¿qué es rendimiento sostenible?](../core/what-is-sustainable-performance.md)</span><span class="sxs-lookup"><span data-stu-id="76dac-114">The fact that BizTalk Server persists all messages and most orchestrations has a direct affect on sustainability as noted in [What Is Sustainable Performance?](../core/what-is-sustainable-performance.md)</span></span> <span data-ttu-id="76dac-115">Conforme lleguen mensajes en la base de datos de cuadro de mensajes, son enrutados a los suscriptores de espera (por ejemplo, orquestaciones y enviar puertos) y en cola o publicados en tablas SQL de cuadro de mensajes debe esperar para que suscriptores que toman y procesarlos.</span><span class="sxs-lookup"><span data-stu-id="76dac-115">As messages arrive in the MessageBox database, they are routed to waiting subscribers (for example, orchestrations and send ports) and en-queued, or published, into messagebox SQL tables to wait for subscribers to pick them up and process them.</span></span> <span data-ttu-id="76dac-116">Algunos de los mensajes que llegan activan nuevas instancias de suscriptor.</span><span class="sxs-lookup"><span data-stu-id="76dac-116">Some of the arriving messages activate new subscriber instances.</span></span> <span data-ttu-id="76dac-117">Otros mensajes llegan y se enrutan, a través de correlación, a una instancia de un suscriptor que ya está en ejecución y que lo está esperando, como una orquestación correlacionada.</span><span class="sxs-lookup"><span data-stu-id="76dac-117">Other messages arrive and are routed, via correlation, to a waiting instance of an already running subscriber such as a correlated orchestration.</span></span>  
  
 <span data-ttu-id="76dac-118">Para que las orquestaciones correlacionadas continúen el procesamiento, los mensajes correlacionados que llegan no deben estar bloqueados.</span><span class="sxs-lookup"><span data-stu-id="76dac-118">In order for correlated orchestrations to continue processing, arriving correlated messages must remain un-blocked.</span></span> <span data-ttu-id="76dac-119">Para facilitar esto, BizTalk trata de garantizar que se siguen recibiendo los mensajes (tanto de activación como de correlación), incluso si hay una elevada carga, de modo que los suscriptores que esperan los mensajes correlacionados puedan finalizar y dejar espacio para la ejecución de más procesos.</span><span class="sxs-lookup"><span data-stu-id="76dac-119">To facilitate this, BizTalk does its best to make sure messages (both activating and correlated) continue to be received, even under high load, so that subscribers waiting for correlated messages can finish and make room for more processes to run.</span></span> <span data-ttu-id="76dac-120">Esto significa que es posible recibir mensajes más rápido de lo que se pueden procesar y quitar de la base de datos de cuadro de mensajes, con lo que se crea un registro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="76dac-120">This means it is possible to receive messages faster than they can be processed and removed from the MessageBox database, thus building up a message backlog.</span></span> <span data-ttu-id="76dac-121">Al tratarse de una tecnología de almacenamiento y reenvío, es lógico que BizTalk proporcione este tipo de almacenamiento en búfer. Sin embargo, se pueden producir problemas si la velocidad de recepción es constantemente más rápida que la velocidad de procesamiento de forma indefinida, con la consiguiente creación de un registro de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="76dac-121">Being a store-and-forward technology, it is natural for BizTalk to provide this type of buffering, however, it can result in problems if the receive rate is consistently faster than the process rate indefinitely, resulting in a large backlog.</span></span>  
  
 <span data-ttu-id="76dac-122">Cada mensaje recibido o creado en BizTalk Server es inmutable;</span><span class="sxs-lookup"><span data-stu-id="76dac-122">Every message that is received by, or created within, BizTalk Server is immutable.</span></span> <span data-ttu-id="76dac-123">es decir, su contenido no cambia una vez recibido o creado.</span><span class="sxs-lookup"><span data-stu-id="76dac-123">That is, once it has been received or created, its content cannot be changed.</span></span> <span data-ttu-id="76dac-124">Además, los mensajes recibidos pueden tener varios suscriptores.</span><span class="sxs-lookup"><span data-stu-id="76dac-124">In addition, received messages may have multiple subscribers.</span></span> <span data-ttu-id="76dac-125">Cada suscriptor de un mensaje concreto hace referencia a la misma copia única de dicho mensaje.</span><span class="sxs-lookup"><span data-stu-id="76dac-125">Each subscriber of a particular message references the same, single copy of that message.</span></span> <span data-ttu-id="76dac-126">Aunque con este enfoque se reduce al mínimo el almacenamiento, es necesario almacenar un contador de referencia (ref-count) para cada mensaje, así como realizar un mantenimiento periódico para eliminar los mensajes cuyo contador de referencia sea igual a 0.</span><span class="sxs-lookup"><span data-stu-id="76dac-126">While this approach minimizes storage, a ref-count must be kept for each message and maintenance must be performed periodically to get rid of those messages that have a ref count of 0.</span></span>  
  
 <span data-ttu-id="76dac-127">Si se permite un registro suficientemente grande en la base de datos de cuadro de mensajes, se retrasarán los procesos de mantenimiento de la base de datos (implementados como un conjunto de trabajos del Agente SQL Server para cada base de datos de cuadro de mensajes) y, en caso de que no se puedan poner al día, probablemente se producirán problemas tales como espacio insuficiente en el disco.</span><span class="sxs-lookup"><span data-stu-id="76dac-127">If a large enough backlog is allowed to build up in the MessageBox database, the maintenance processes for the database (implemented as a set of SQL Jobs for each MessageBox database) will fall behind and, if not given an opportunity to catch up, will eventually cause issues such as running out of disk space.</span></span> <span data-ttu-id="76dac-128">Para evitar esta situación, BizTalk Server proporciona un mecanismo de limitación que reduce la velocidad de recepción de mensajes cuando el registro de la base de datos de cuadro de mensajes alcanza un determinado nivel configurado por el usuario.</span><span class="sxs-lookup"><span data-stu-id="76dac-128">To avoid this situation, BizTalk Server provides a throttling mechanism that slows down the message receive rate when the MessageBox database backlog gets to some user-configurable level.</span></span> <span data-ttu-id="76dac-129">Para obtener más información acerca de la limitación, consulte [optimizar recursos a través de Host de límite de uso](../core/optimizing-resource-usage-through-host-throttling.md).</span><span class="sxs-lookup"><span data-stu-id="76dac-129">For more information about throttling, see [Optimizing Resource Usage Through Host Throttling](../core/optimizing-resource-usage-through-host-throttling.md).</span></span>  
  
 <span data-ttu-id="76dac-130">Considerando todas las actividades y los procesos que contribuyen a la sostenibilidad, la medida principal de sostenibilidad a lo largo del tiempo es que no se permita de forma indefinida el crecimiento del registro.</span><span class="sxs-lookup"><span data-stu-id="76dac-130">Given all of the activities and processes that contribute to sustainability, the primary measure of sustainability over time is that a backlog is not allowed to grow indefinitely.</span></span> <span data-ttu-id="76dac-131">Es decir, que exista un equilibrio a lo largo del tiempo entre los niveles de rendimiento máximo y mínimo para que la base de datos de cuadro de mensajes pueda mantener un registro medio que sea constante y se pueda administrar.</span><span class="sxs-lookup"><span data-stu-id="76dac-131">In other words, over time, there must be a balance between the high and low peak throughput levels so that the MessageBox database is able to maintain a constant and manageable average backlog.</span></span> <span data-ttu-id="76dac-132">La medida principal de registro es la profundidad de la tabla de cola de impresión, que se expone como un contador de rendimiento de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] denominado BizTalk:Cuadro de mensajes:Contadores generales:Tamaño de cola de impresión.</span><span class="sxs-lookup"><span data-stu-id="76dac-132">The primary measure of backlog is the depth of the spool table, which is exposed as a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance counter called BizTalk:Message Box:General Counters:Spool Size.</span></span> <span data-ttu-id="76dac-133">Para obtener más información acerca de este contador de rendimiento, consulte [contadores de rendimiento del cuadro de mensaje](../core/message-box-performance-counters.md).</span><span class="sxs-lookup"><span data-stu-id="76dac-133">For more information about this performance counter, see [Message Box Performance Counters](../core/message-box-performance-counters.md).</span></span>  
  
 <span data-ttu-id="76dac-134">Para obtener más información acerca de cómo usar el tamaño de cola de impresión y otros contadores para determinar el rendimiento máximo que puede admitir un sistema, consulte [medir el rendimiento máximo sostenible motor](../core/measuring-maximum-sustainable-engine-throughput.md).</span><span class="sxs-lookup"><span data-stu-id="76dac-134">For more information on how to use the spool size and other counters to determine the maximum throughput a system can sustain, see [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md).</span></span>  
  
## <a name="recommendations"></a><span data-ttu-id="76dac-135">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="76dac-135">Recommendations</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="76dac-136"> guarda todos los mensajes y la mayoría de las orquestaciones y, en caso de que no se controle, puede crear un registro de mensajes que puede producir problemas tales como espacio insuficiente en el disco.</span><span class="sxs-lookup"><span data-stu-id="76dac-136"> persists all messages and most orchestrations and can, left un-checked, develop a backlog of messages that can result in issues such as running out of disk space.</span></span> <span data-ttu-id="76dac-137">La medida principal de registro es la profundidad de la tabla de cola de impresión del cuadro de mensajes, que se expone como un contador de rendimiento denominado: BizTalk cuadro: General contadores: tamaño cola de impresión.</span><span class="sxs-lookup"><span data-stu-id="76dac-137">The primary measure of backlog is the depth of the messagebox spool table, which is exposed as a performance counter called: BizTalk:Message Box:General Counters:Spool Size.</span></span>  
  
 <span data-ttu-id="76dac-138">Con el fin de lograr un rendimiento sostenible, el tamaño de cola de impresión debe admitir un rendimiento medio estable a lo largo del tiempo.</span><span class="sxs-lookup"><span data-stu-id="76dac-138">When thinking about sustainable throughput, the spool size must sustain a stable average over time.</span></span> <span data-ttu-id="76dac-139">Es decir, la cola de impresión no puede seguir creciendo sin control de manera indefinida.</span><span class="sxs-lookup"><span data-stu-id="76dac-139">That is, the spool cannot continue to grow un-checked indefinitely.</span></span> <span data-ttu-id="76dac-140">En [medir el rendimiento máximo sostenible motor](../core/measuring-maximum-sustainable-engine-throughput.md), este comportamiento se describe con más detalle y se proporciona un método para determinar el rendimiento máximo que puede admitir un sistema que utiliza el tamaño de cola de impresión y otro rendimiento indicadores.</span><span class="sxs-lookup"><span data-stu-id="76dac-140">In [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md), this behavior is discussed in more detail and a method of determining the maximum throughput a system can sustain is provided which leverages the spool size and other performance indicators.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="76dac-141">Vea también</span><span class="sxs-lookup"><span data-stu-id="76dac-141">See Also</span></span>  
 <span data-ttu-id="76dac-142">[Medir el rendimiento máximo sostenible del motor](../core/measuring-maximum-sustainable-engine-throughput.md) </span><span class="sxs-lookup"><span data-stu-id="76dac-142">[Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md) </span></span>  
 <span data-ttu-id="76dac-143">[¿Qué es rendimiento sostenible?](../core/what-is-sustainable-performance.md) </span><span class="sxs-lookup"><span data-stu-id="76dac-143">[What Is Sustainable Performance?](../core/what-is-sustainable-performance.md) </span></span>  
 <span data-ttu-id="76dac-144">[Trucos y sugerencias de rendimiento](../core/performance-tips-and-tricks.md) </span><span class="sxs-lookup"><span data-stu-id="76dac-144">[Performance Tips and Tricks](../core/performance-tips-and-tricks.md) </span></span>  
 [<span data-ttu-id="76dac-145">Contadores de rendimiento del cuadro de mensaje</span><span class="sxs-lookup"><span data-stu-id="76dac-145">Message Box Performance Counters</span></span>](../core/message-box-performance-counters.md)