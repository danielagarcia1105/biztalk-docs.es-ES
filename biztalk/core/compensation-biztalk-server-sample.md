---
title: Compensación (ejemplo de BizTalk Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- orchestrations, examples
- examples, orchestrations
- compensations, examples
- examples, compensations
- compensations, orchestrations
ms.assetid: 9d10c7be-6a4c-44cc-bf29-78ecdf147bd1
caps.latest.revision: 32
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e8a2ba919a6d4ee5b84da8a9911604aff95a02e4
ms.sourcegitcommit: c3070a7a3f332857357f056dc632829b43869c17
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/14/2018
ms.locfileid: "51630361"
---
# <a name="compensation-biztalk-server-sample"></a><span data-ttu-id="f9ce4-102">Compensación (ejemplo de BizTalk Server)</span><span class="sxs-lookup"><span data-stu-id="f9ce4-102">Compensation (BizTalk Server Sample)</span></span>
<span data-ttu-id="f9ce4-103">El ejemplo compensación muestra cómo usar el **compensar** forma de una orquestación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-103">The Compensation sample demonstrates how to use the **Compensate** shape in an orchestration.</span></span>  
  
## <a name="what-this-sample-does"></a><span data-ttu-id="f9ce4-104">Descripción del ejemplo</span><span class="sxs-lookup"><span data-stu-id="f9ce4-104">What This Sample Does</span></span>  
 <span data-ttu-id="f9ce4-105">Este ejemplo muestra cómo compensar la transacción que ya se ha confirmado en la orquestación mediante la siguiente secuencia de pasos:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-105">This sample demonstrates how to compensate the transaction that has already been committed in the orchestration using the following sequence of steps:</span></span>  
  
1.  <span data-ttu-id="f9ce4-106">Especifique los datos del cliente en el formulario de InfoPath y envíelos a una orquestación que se haya expuesto como servicio Web.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-106">Enter the customer data in the InfoPath form and submit the data to an orchestration that has been exposed as a Web service.</span></span>  
  
2.  <span data-ttu-id="f9ce4-107">La orquestación tiene dos acciones paralelas.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-107">The orchestration has two parallel actions.</span></span> <span data-ttu-id="f9ce4-108">Una devuelve una confirmación al formulario de InfoPath y la otra actualiza las bases de datos Northwind y BTSCompensationSampleMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-108">One returns an acknowledgment to the InfoPath form and the other updates the Northwind and BTSCompensationSampleMailingList databases.</span></span>  
  
3.  <span data-ttu-id="f9ce4-109">En la segunda acción, la orquestación asigna el mensaje entrante en un formato de mensaje de aplicación de cliente relación management (CRM) y, a continuación, actualiza el **clientes** tabla en la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-109">In the second action, the orchestration maps the incoming message to a customer relationship management (CRM) application message format and then updates the **Customers** table in the Northwind database.</span></span> <span data-ttu-id="f9ce4-110">A continuación, se actualiza la tabla Lista de correo de la base de datos BTSCompensationSampleMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-110">After this, the Mailing List table in the BTSCompensationSampleMailingList database is updated.</span></span>  
  
4.  <span data-ttu-id="f9ce4-111">Si alguna de las actualizaciones no se lleva a cabo correctamente, los cambios que se realicen en la base de datos Northwind se compensan llamando a un ensamblado externo para volver a escribir los datos originales del cliente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-111">If either update fails, the changes made to the Northwind database are compensated by calling an external assembly to write the original customer data back to the database.</span></span>  
  
## <a name="how-this-sample-is-designed-and-why"></a><span data-ttu-id="f9ce4-112">Cómo se ha diseñado este ejemplo y por qué</span><span class="sxs-lookup"><span data-stu-id="f9ce4-112">How This Sample is Designed and Why</span></span>  
 <span data-ttu-id="f9ce4-113">Un **ámbito** forma se usa principalmente para la ejecución transaccional y control de excepciones, incluida la compensación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-113">A **Scope** shape is primarily used for transactional execution and exception handling, including compensation.</span></span> <span data-ttu-id="f9ce4-114">Un ámbito consta de dos bloques.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-114">A scope consists of two blocks.</span></span> <span data-ttu-id="f9ce4-115">El primer bloque es el bloque de contexto y el segundo bloque puede ser uno o más bloques de compensación o control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-115">The first block is the context block and the second block can be one or more exception-handling or compensation blocks.</span></span> <span data-ttu-id="f9ce4-116">Esto es similar a la instrucción try-catch del lenguaje de programación .NET.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-116">This is similar to the try-catch statement in the .NET programming language.</span></span> <span data-ttu-id="f9ce4-117">En la orquestación UpdateContact.odx, tienen lugar dos acciones paralelas.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-117">In the UpdateContact.odx orchestration, there are two parallel actions.</span></span> <span data-ttu-id="f9ce4-118">En la rama lateral derecha, el bloque try es la **ámbito** forma denominada actualizar sistemas de servidor, que tiene el tipo de una transacción de larga ejecución y un identificador de transacción Upd_Backend.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-118">At the right-side branch, the try block is the **Scope** shape named Updated Backend Systems, which has a Long-Running transaction type and an Upd_Backend transaction identifier.</span></span> <span data-ttu-id="f9ce4-119">Cuanto más se desciende en el flujo, hay un bloque catch que detecta la excepción general e inicia la compensación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-119">Further down in the flow, there is a catch block that catches the general exception and initiates the compensation.</span></span>  
  
 <span data-ttu-id="f9ce4-120">Para obtener más información sobre la **ámbito** forma, vea [ámbitos](../core/scopes.md).</span><span class="sxs-lookup"><span data-stu-id="f9ce4-120">For more information about the **Scope** shape, see [Scopes](../core/scopes.md).</span></span> <span data-ttu-id="f9ce4-121">Consulte también [cómo configurar la forma ámbito](../core/how-to-configure-the-scope-shape.md).</span><span class="sxs-lookup"><span data-stu-id="f9ce4-121">Also see [How to Configure the Scope Shape](../core/how-to-configure-the-scope-shape.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f9ce4-122">La orquestación debe ser una transacción de larga ejecución para establecer el tipo de transacción en atómica o larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-122">The orchestration must itself be a long-running transaction for you to set the transaction type to Atomic or Long-Running.</span></span>  
  
 <span data-ttu-id="f9ce4-123">En el bloque try, hay dos ámbitos denominados **actualizar CRM** y **actualizar correo**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-123">In the try block, there are two scopes named **Update CRM** and **Update Mailing**.</span></span> <span data-ttu-id="f9ce4-124">Estos dos ámbitos son transacciones atómicas.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-124">Both of these scopes are atomic transactions.</span></span> <span data-ttu-id="f9ce4-125">En el ámbito Actualizar CRM hay bloque try y un bloque de compensación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-125">In the Update CRM scope, there is a try block and a compensation block.</span></span> <span data-ttu-id="f9ce4-126">El bloque try actualiza la base de datos Northwind mediante una llamada de método a un ensamblado externo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-126">The try block updates the Northwind database through a method call to an external assembly.</span></span> <span data-ttu-id="f9ce4-127">En el bloque de compensación tiene lugar la acción de compensación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-127">The compensation block is where the compensation action takes place.</span></span> <span data-ttu-id="f9ce4-128">Cuando se produce una excepción en el ámbito Actualización de sistemas de servidor, el código de la forma Deshacer expresión CRM vuelve a actualizar el registro y lo devuelve a su estado original.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-128">When an exception happens in the Update Backend Systems scope, the code in Undo CRM Expression Shape updates the record back to its original state.</span></span> <span data-ttu-id="f9ce4-129">Esto desencadena la **compensar** forma en el bloque excepción de filtrado.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-129">This is triggered by the **Compensate** shape in the Catch Exception block.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f9ce4-130">Las transacciones atómicas garantizan que todas las actualizaciones parciales se revertirán automáticamente si se produce un error durante la actualización de la transacción, y los efectos de la transacción se borrarán (excepto los efectos de cualquier llamada .NET que se haga en la transacción).</span><span class="sxs-lookup"><span data-stu-id="f9ce4-130">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f9ce4-131">Una transacción de larga ejecución se considera confirmada cuando se ha completado la última instrucción contenida en ella.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-131">A long-running transaction is considered committed when the last statement in it has completed.</span></span> <span data-ttu-id="f9ce4-132">No se produce ninguna reversión automática del estado en caso de una anulación de transacción.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-132">There is no automatic rollback of state in case of a transaction abort.</span></span> <span data-ttu-id="f9ce4-133">Estos se puede conseguir mediante la programación de los controladores de excepción y compensación que se muestran en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-133">You can achieve this programmatically through the exception and compensation handlers demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="f9ce4-134">En el bloque catch, hay una **retraso** forma establecida durante diez segundos.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-134">In the catch block, there is one **Delay** shape set for ten seconds.</span></span> <span data-ttu-id="f9ce4-135">Esto retrasa la acción de compensación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-135">This delays the compensation action.</span></span> <span data-ttu-id="f9ce4-136">También hay un **compensar** forma que inicia la acción de compensación en la transacción Upd_Backend.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-136">There is also a **Compensate** shape that initiates the compensation action in the Upd_Backend transaction.</span></span>  
  
 <span data-ttu-id="f9ce4-137">Ocurre lo siguiente cuando la orquestación recibe el mensaje de entrada:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-137">The following happens after the orchestration receives the input message:</span></span>  
  
1.  <span data-ttu-id="f9ce4-138">El ensamblado UpdateCrm actualiza una fila de la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-138">The UpdateCrm assembly updates a row in the Northwind database.</span></span>  
  
2.  <span data-ttu-id="f9ce4-139">El ensamblado UpdateMailingList actualiza un registro coincidente de la base de datos BTSCompensationSampleMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-139">The UpdateMailingList assembly updates a matching record in the BTSCompensationSampleMailingList database.</span></span>  
  
3.  <span data-ttu-id="f9ce4-140">En caso de que se produzca un error al actualizar la base de datos Northwind, se genera una excepción y la orquestación sale del proceso.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-140">In the event of a failure while updating the Northwind database, an exception is raised and the orchestration exits the process.</span></span>  
  
4.  <span data-ttu-id="f9ce4-141">En caso de que se produzca un error durante la actualización de la base de datos BTSCompensationSampleMailingList, se genera una excepción y se produce un retraso de diez segundos antes de volver a escribir los datos originales del cliente en la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-141">In the event of a failure while updating the BTSCompensationSampleMailingList database, an exception is raised and a ten-second delay takes place before rewriting the original customer data back to the Northwind database.</span></span>  
  
## <a name="where-to-find-this-sample"></a><span data-ttu-id="f9ce4-142">Ubicación del ejemplo</span><span class="sxs-lookup"><span data-stu-id="f9ce4-142">Where to Find This Sample</span></span>  
 <span data-ttu-id="f9ce4-143">\<*Ejemplos de la ruta de acceso*\>\Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="f9ce4-143">\<*Samples Path*\>\Orchestrations\Compensation\\</span></span>  
  
 <span data-ttu-id="f9ce4-144">En la tabla siguiente se enumeran los archivos del ejemplo y se describe su propósito.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-144">The following table shows the files in this sample and describes their purpose.</span></span>  
  
|<span data-ttu-id="f9ce4-145">Archivos</span><span class="sxs-lookup"><span data-stu-id="f9ce4-145">File(s)</span></span>|<span data-ttu-id="f9ce4-146">Descripción</span><span class="sxs-lookup"><span data-stu-id="f9ce4-146">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="f9ce4-147">Cleanup.bat</span><span class="sxs-lookup"><span data-stu-id="f9ce4-147">Cleanup.bat</span></span>|<span data-ttu-id="f9ce4-148">Archivo por lotes utilizado para desinstalar el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-148">Batch file used to uninstall the sample.</span></span>|  
|<span data-ttu-id="f9ce4-149">CompensationOrchestration.btproj</span><span class="sxs-lookup"><span data-stu-id="f9ce4-149">CompensationOrchestration.btproj</span></span>|<span data-ttu-id="f9ce4-150">Proyecto de orquestación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-150">Orchestration project.</span></span>|  
|<span data-ttu-id="f9ce4-151">CompensationSample.sln</span><span class="sxs-lookup"><span data-stu-id="f9ce4-151">CompensationSample.sln</span></span>|<span data-ttu-id="f9ce4-152">Solución de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-152">Sample solution.</span></span>|  
|<span data-ttu-id="f9ce4-153">CompensationSampleBinding.xml</span><span class="sxs-lookup"><span data-stu-id="f9ce4-153">CompensationSampleBinding.xml</span></span>|<span data-ttu-id="f9ce4-154">Enlazar datos de la orquestación (utilizado durante la instalación).</span><span class="sxs-lookup"><span data-stu-id="f9ce4-154">Binding data for the orchestration (used during installation).</span></span>|  
|<span data-ttu-id="f9ce4-155">ContactInfo.xsd</span><span class="sxs-lookup"><span data-stu-id="f9ce4-155">ContactInfo.xsd</span></span>|<span data-ttu-id="f9ce4-156">Esquema de mensaje de información de contacto.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-156">Contact information message schema.</span></span>|  
|<span data-ttu-id="f9ce4-157">ContactInfo.xsx</span><span class="sxs-lookup"><span data-stu-id="f9ce4-157">ContactInfo.xsx</span></span>|<span data-ttu-id="f9ce4-158">Archivo de diseño del Diseñador de orquestaciones.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-158">Orchestration Designer layout file.</span></span>|  
|<span data-ttu-id="f9ce4-159">CreateSQLDataStore.sql</span><span class="sxs-lookup"><span data-stu-id="f9ce4-159">CreateSQLDataStore.sql</span></span>|<span data-ttu-id="f9ce4-160">Secuencia de comandos SQL para crear y rellenar la base de datos de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-160">SQL script to create and populate the sample database.</span></span>|  
|<span data-ttu-id="f9ce4-161">CrmSchema.xsd</span><span class="sxs-lookup"><span data-stu-id="f9ce4-161">CrmSchema.xsd</span></span>|<span data-ttu-id="f9ce4-162">Esquema de mensaje de actualización de CRM.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-162">CRM update message schema.</span></span>|  
|<span data-ttu-id="f9ce4-163">MailingListSchema.xsd</span><span class="sxs-lookup"><span data-stu-id="f9ce4-163">MailingListSchema.xsd</span></span>|<span data-ttu-id="f9ce4-164">Esquema de actualización de mensajes de lista de correo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-164">Mailing list message update schema.</span></span>|  
|<span data-ttu-id="f9ce4-165">RemoveVirDir.vbs</span><span class="sxs-lookup"><span data-stu-id="f9ce4-165">RemoveVirDir.vbs</span></span>|<span data-ttu-id="f9ce4-166">Secuencia de comandos de Microsoft Visual Basic Scripting Edition (VBScript) para eliminar directorios virtuales y físicos de servicio Web (utilizados durante la desinstalación).</span><span class="sxs-lookup"><span data-stu-id="f9ce4-166">Microsoft Visual Basic Scripting Edition (VBScript) script to remove Web service virtual and physical directories (used during uninstallation).</span></span>|  
|<span data-ttu-id="f9ce4-167">Request2Crm.btm</span><span class="sxs-lookup"><span data-stu-id="f9ce4-167">Request2Crm.btm</span></span>|<span data-ttu-id="f9ce4-168">Asignación de mensajes para traducir de una solicitud (información de contacto) al mensaje de actualización de CRM.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-168">Message map to translate from request (contact info) to CRM update message.</span></span>|  
|<span data-ttu-id="f9ce4-169">Request2MailingList.btm</span><span class="sxs-lookup"><span data-stu-id="f9ce4-169">Request2MailingList.btm</span></span>|<span data-ttu-id="f9ce4-170">Asignación de mensajes para traducir de una solicitud (información de contacto) al mensaje de lista de correo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-170">Message map to translate from request (contact info) to mailing list message.</span></span>|  
|<span data-ttu-id="f9ce4-171">Setup.bat</span><span class="sxs-lookup"><span data-stu-id="f9ce4-171">Setup.bat</span></span>|<span data-ttu-id="f9ce4-172">Archivo por lotes para instalar este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-172">Batch file to install this sample.</span></span>|  
|<span data-ttu-id="f9ce4-173">UpdateContact.odx</span><span class="sxs-lookup"><span data-stu-id="f9ce4-173">UpdateContact.odx</span></span>|<span data-ttu-id="f9ce4-174">Archivo de orquestación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-174">Orchestration file.</span></span>|  
|<span data-ttu-id="f9ce4-175">UpdateRequest2UpdateResponse.btm</span><span class="sxs-lookup"><span data-stu-id="f9ce4-175">UpdateRequest2UpdateResponse.btm</span></span>|<span data-ttu-id="f9ce4-176">Asignación de mensajes para traducir de una solicitud (información de contacto) al mensaje de respuesta.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-176">Message map to translate from request (contact info) to a response message.</span></span>|  
|<span data-ttu-id="f9ce4-177">UpdateResponse.xsd</span><span class="sxs-lookup"><span data-stu-id="f9ce4-177">UpdateResponse.xsd</span></span>|<span data-ttu-id="f9ce4-178">Esquema de mensajes de respuesta.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-178">Response message schema.</span></span>|  
|<span data-ttu-id="f9ce4-179">InfoPath\Información de contacto Update.xsn</span><span class="sxs-lookup"><span data-stu-id="f9ce4-179">InfoPath\Contact Info Update.xsn</span></span>|<span data-ttu-id="f9ce4-180">Archivo de Microsoft InfoPath utilizado para enviar formularios al servicio web de la orquestación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-180">Microsoft InfoPath file used to submit forms to the orchestration Web service.</span></span>|  
|<span data-ttu-id="f9ce4-181">UpdateCrm\AssemblyInfo.cs</span><span class="sxs-lookup"><span data-stu-id="f9ce4-181">UpdateCrm\AssemblyInfo.cs</span></span>|<span data-ttu-id="f9ce4-182">Archivo de origen de información del ensambladoUpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-182">Assembly information source file for the UpdateCrm assembly.</span></span> <span data-ttu-id="f9ce4-183">(El ensamblado UpdateCrm actualiza la base de datos Northwind.)</span><span class="sxs-lookup"><span data-stu-id="f9ce4-183">(The UpdateCrm assembly updates the Northwind database.)</span></span>|  
|<span data-ttu-id="f9ce4-184">UpdateCrm\UpdateCrm.cs</span><span class="sxs-lookup"><span data-stu-id="f9ce4-184">UpdateCrm\UpdateCrm.cs</span></span>|<span data-ttu-id="f9ce4-185">Código de origen principal del ensamblado UpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-185">Main source code for the UpdateCrm assembly.</span></span>|  
|<span data-ttu-id="f9ce4-186">UpdateCrm\UpdateCRM.csproj</span><span class="sxs-lookup"><span data-stu-id="f9ce4-186">UpdateCrm\UpdateCRM.csproj</span></span>|<span data-ttu-id="f9ce4-187">Archivo de proyecto UpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-187">UpdateCrm project file.</span></span>|  
|<span data-ttu-id="f9ce4-188">UpdateMailingList\AssemblyInfo.cs</span><span class="sxs-lookup"><span data-stu-id="f9ce4-188">UpdateMailingList\AssemblyInfo.cs</span></span>|<span data-ttu-id="f9ce4-189">Archivo de origen de información del ensamblado UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-189">Assembly information source file for the UpdateMailingList assembly.</span></span> <span data-ttu-id="f9ce4-190">(El ensamblado UpdateMailingList actualiza la base de datos de ejemplo.)</span><span class="sxs-lookup"><span data-stu-id="f9ce4-190">(The UpdateMailingList assembly updates the sample database.)</span></span>|  
|<span data-ttu-id="f9ce4-191">UpdateMailingList\UpdateMailingList.cs</span><span class="sxs-lookup"><span data-stu-id="f9ce4-191">UpdateMailingList\UpdateMailingList.cs</span></span>|<span data-ttu-id="f9ce4-192">Código de origen principal del ensamblado UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-192">Main source code for the UpdateMailingList assembly.</span></span>|  
|<span data-ttu-id="f9ce4-193">UpdateMailingList\UpdateMailingList.csproj</span><span class="sxs-lookup"><span data-stu-id="f9ce4-193">UpdateMailingList\UpdateMailingList.csproj</span></span>|<span data-ttu-id="f9ce4-194">Archivo de proyecto UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-194">UpdateMailingList project file.</span></span>|  
  
## <a name="building-and-initializing-this-sample"></a><span data-ttu-id="f9ce4-195">Crear e inicializar este ejemplo</span><span class="sxs-lookup"><span data-stu-id="f9ce4-195">Building and Initializing This Sample</span></span>  
  
#### <a name="to-build-and-initialize-the-compensation-sample"></a><span data-ttu-id="f9ce4-196">Para crear e iniciar el ejemplo Compensación</span><span class="sxs-lookup"><span data-stu-id="f9ce4-196">To build and initialize the Compensation sample</span></span>  
  
1. <span data-ttu-id="f9ce4-197">En una ventana de comandos de [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], desplácese a la siguiente carpeta:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-197">In a [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] command window, navigate to the following folder:</span></span>  
  
    <span data-ttu-id="f9ce4-198">\<*Ejemplos de la ruta de acceso*\>\Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="f9ce4-198">\<*Samples Path*\>\Orchestrations\Compensation\\</span></span>  
  
2. <span data-ttu-id="f9ce4-199">Ejecute el archivo Setup.bat, que realiza las acciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-199">Run Setup.bat, which performs the following actions:</span></span>  
  
   -   <span data-ttu-id="f9ce4-200">Generar e implementar el ensamblado de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-200">Build and deploy the sample assembly.</span></span>  
  
   -   <span data-ttu-id="f9ce4-201">Cuando se inicie el Asistente para publicación servicios web de BizTalk, realice las siguientes acciones de forma manual:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-201">When the BizTalk Web Services Publishing Wizard launches, do the following manually:</span></span>  
  
   1.  <span data-ttu-id="f9ce4-202">En el **éste es el Asistente para publicar servicios Web de BizTalk** página, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-202">On the **Welcome to the BizTalk Web Services Publishing Wizard** page, click **Next**.</span></span>  
  
   2.  <span data-ttu-id="f9ce4-203">En el **crear servicio Web** página, seleccione **publicar orquestaciones de BizTalk como servicios web**y, a continuación, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-203">On the **Create Web Service** page, select **Publish BizTalk orchestration as web services**, and then click **Next**.</span></span>  
  
   3.  <span data-ttu-id="f9ce4-204">En el **ensamblado de BizTalk** página, busque y seleccione \< *ruta de ejemplos*\>\Orchestrations\Compensation\bin\Release\CompensationOrchestration.dll y, a continuación, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-204">On the **BizTalk Assembly** page, browse and select \<*Samples Path*\>\Orchestrations\Compensation\bin\Release\CompensationOrchestration.dll, and then click **Next**.</span></span>  
  
   4.  <span data-ttu-id="f9ce4-205">En el **orquestaciones y puertos** página, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-205">On the **Orchestrations and Ports** page, click **Next**.</span></span>  
  
   5.  <span data-ttu-id="f9ce4-206">En el **propiedades del servicio Web** página **espacio de nombres de destino del servicio web**, tipo `http://Microsoft.BizTalk.Samples.Compensation/`y, a continuación, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-206">On the **Web Service Properties** page, in **Target namespace of web service**, type `http://Microsoft.BizTalk.Samples.Compensation/`, and then click **Next**.</span></span>  
  
   6.  <span data-ttu-id="f9ce4-207">En el **proyecto de servicio Web** página **ubicación**, tipo `http://localhost/CompensationOrchestrationWebServiceProxy`.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-207">On the **Web Service Project** page, in **Location**, type `http://localhost/CompensationOrchestrationWebServiceProxy`.</span></span>  
  
   7.  <span data-ttu-id="f9ce4-208">Seleccione el **permitir acceso anónimo al servicio web** casilla de verificación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-208">Select the **Allow anonymous access to web service** check box.</span></span>  
  
   8.  <span data-ttu-id="f9ce4-209">Seleccione el **ubicación de recepción de BizTalk crea en la siguiente aplicación** casilla de verificación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-209">Select the **Create BizTalk receive location in the following application** check box.</span></span>  
  
   9. <span data-ttu-id="f9ce4-210">En el **ubicación de recepción de BizTalk crea en la siguiente aplicación** menú desplegable, seleccione **BizTalk Application 1** desde la lista desplegable y, a continuación, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-210">In the **Create BizTalk receive location in the following application** drop-down menu, select **BizTalk Application 1** from the drop-down list, and then click **Next**.</span></span>  
  
   10. <span data-ttu-id="f9ce4-211">En el **resumen del proyecto de servicio Web** página, haga clic en **crear**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-211">On the **Web Service Project Summary** page, click **Create**.</span></span>  
  
   11. <span data-ttu-id="f9ce4-212">En el **completar el Asistente para publicar servicios Web de BizTalk** página, haga clic en **finalizar**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-212">On the **Completing the BizTalk Web Services Publishing Wizard** page, click **Finish**.</span></span>  
  
3. <span data-ttu-id="f9ce4-213">El programa de instalación crea y enlaza puertos, crea la base de datos de servidor del ejemplo y agrega ensamblados de C# a la caché de ensamblados global.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-213">Setup creates and binds ports, creates the back-end database for the sample, and adds C# assemblies to the global assembly cache.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="f9ce4-214">Antes de intentar ejecutar este ejemplo, debe confirmar que [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] no ha informado de ningún error durante el proceso de generación e inicialización.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-214">You should confirm that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] did not report any errors during the build and initialization process before attempting to run this sample.</span></span>  
  
## <a name="running-this-sample"></a><span data-ttu-id="f9ce4-215">Ejecución del ejemplo</span><span class="sxs-lookup"><span data-stu-id="f9ce4-215">Running This Sample</span></span>  
 <span data-ttu-id="f9ce4-216">Después de generar e inicializar este ejemplo, tenga en cuenta lo siguiente antes de ejecutarlo:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-216">After you build and initialize this sample, consider the following before you run it:</span></span>  
  
- <span data-ttu-id="f9ce4-217">Si ejecuta este ejemplo en [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] o [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], deberá crear un grupo de aplicaciones de IIS y establecer su identidad en una cuenta que sea miembro del grupo de Windows de usuarios de la aplicación BizTalk.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-217">If you are running this sample on [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] or [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], you must create an IIS application pool and set its identity to an account that is a member of the BizTalk Application Users Windows group.</span></span> <span data-ttu-id="f9ce4-218">También debe actualizar el directorio virtual del servicio de orquestación Web para ejecutarlo dentro de este grupo de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-218">You also need to update the orchestration Web service virtual directory to run within this application pool.</span></span>  
  
- <span data-ttu-id="f9ce4-219">Agregue una cuenta ASPNET al grupo de usuarios de hosts aislados de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-219">Add the ASPNET account to the BizTalk Isolated Host Users group.</span></span>  
  
- <span data-ttu-id="f9ce4-220">Conceder el permiso de db_owner de grupo de usuarios de la aplicación de BizTalk para el **BTSCompensationSampleMailingList** y **Northwind** bases de datos.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-220">Give the BizTalk Application Users group db_owner permission to the **BTSCompensationSampleMailingList** and **Northwind** databases.</span></span>  
  
- <span data-ttu-id="f9ce4-221">Si [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] no está instalado en la ubicación predeterminada (BizTalk Server de unidad: \Program Files\Microsoft \<versión\>\\), debe publicar el formulario Contact Info Update.xsn antes de usarlo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-221">If [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is not installed in the default location (drive:\Program Files\Microsoft BizTalk Server \<version\>\\), you must publish the Contact Info Update.xsn form before using it.</span></span> <span data-ttu-id="f9ce4-222">Para ello, realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-222">To do so, do the following.</span></span>  
  
  #### <a name="to-publish-the-infopath-form"></a><span data-ttu-id="f9ce4-223">Para publicar el formulario de InfoPath</span><span class="sxs-lookup"><span data-stu-id="f9ce4-223">To publish the InfoPath form</span></span>  
  
  1.  <span data-ttu-id="f9ce4-224">En Internet Explorer, en el **herramientas** menú, haga clic en **opciones de Internet**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-224">In Internet Explorer, on the **Tools** menu, click **Internet Options**.</span></span>  
  
  2.  <span data-ttu-id="f9ce4-225">En el **seguridad** , haga clic **Internet**y, a continuación, haga clic en **nivel personalizado**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-225">On the **Security** tab, click **Internet**, and then click **Custom Level**.</span></span>  
  
  3.  <span data-ttu-id="f9ce4-226">En el **varios** sección, asegúrese de que el **tener acceso a orígenes de datos entre dominios** está habilitada y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-226">In the **Miscellaneous** section, ensure that the **Access data sources across domains** setting is enabled, and then click **OK**.</span></span> <span data-ttu-id="f9ce4-227">Esta configuración es necesaria para que se ejecute el código de las secuencias de comandos de la solución de interfaz de usuario de InfoPath.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-227">This setting is required for the InfoPath user interface solution scripting code to run.</span></span>  
  
  4.  <span data-ttu-id="f9ce4-228">En el Explorador de Windows, vaya a \< *ruta de ejemplos*\>\Orchestrations\Compensation\InfoPath, haga clic en **Contact Info Update.xsn** y, a continuación, haga clic en  **Diseño**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-228">In Windows Explorer, navigate to \<*Samples Path*\>\Orchestrations\Compensation\InfoPath, right-click **Contact Info Update.xsn** and then click **Design**.</span></span>  
  
  5.  <span data-ttu-id="f9ce4-229">La solución de actualización de la información de contacto de InfoPath se abre en modo de diseño.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-229">The InfoPath Contact Info Update solution opens in design mode.</span></span>  
  
  6.  <span data-ttu-id="f9ce4-230">En la aplicación de la actualización de información de contacto de InfoPath, en el **archivo** menú, haga clic en **publicar**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-230">In the InfoPath Contact Info Update application, on the **File** menu, click **Publish**.</span></span>  
  
  7.  <span data-ttu-id="f9ce4-231">Aparece el Asistente de publicación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-231">The Publish Wizard appears.</span></span>  
  
  8.  <span data-ttu-id="f9ce4-232">Seleccione **a una carpeta compartida en este equipo o en una red** y publicar la solución en la ruta de acceso \< *ruta de ejemplos*\>\Orchestrations\Compensation\InfoPath\Contact Info Update.xsn.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-232">Select **To a shared folder on this computer or on a network** and publish the solution to the path \<*Samples Path*\>\Orchestrations\Compensation\InfoPath\Contact Info Update.xsn.</span></span>  
  
  9. <span data-ttu-id="f9ce4-233">Cierre el modo de diseño de InfoPath.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-233">Close the design mode InfoPath.</span></span>  
  
- <span data-ttu-id="f9ce4-234">Está listo para ejecutar este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-234">You are ready to run this sample.</span></span>  
  
  #### <a name="to-run-the-compensation-sample"></a><span data-ttu-id="f9ce4-235">Para ejecutar el ejemplo Compensación</span><span class="sxs-lookup"><span data-stu-id="f9ce4-235">To run the Compensation sample</span></span>  
  
  1.  <span data-ttu-id="f9ce4-236">Haga doble clic en **Contact Info Update.xsn** para abrirlo en InfoPath.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-236">Double-click **Contact Info Update.xsn** to open it in InfoPath.</span></span>  
  
  2.  <span data-ttu-id="f9ce4-237">Rellene el formulario de una cuenta que exista en las dos bases de datos.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-237">Fill out the form for an account that exists in both databases.</span></span> <span data-ttu-id="f9ce4-238">Por ejemplo, utilice un Id. de cuenta existente "ALFKI" desde la tabla Northwind Customers.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-238">For example, use an existing account ID "ALFKI" from the Northwind Customers table.</span></span>  
  
  3.  <span data-ttu-id="f9ce4-239">En el **archivo** menú, seleccione **enviar**y haga clic en **enviar**.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-239">On the **File** menu, select **Submit**, and click **Submit**.</span></span>  
  
  4.  <span data-ttu-id="f9ce4-240">El documento de respuesta debe aparecer en el \< *ruta de ejemplos*\>\Orchestrations\Compensation\Out carpeta y Northwind y las bases de datos BTSCompensationSampleMailingList deberían actualizarse con los nuevos datos del formulario de InfoPath.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-240">The response document should appear in the \<*Samples Path*\>\Orchestrations\Compensation\Out folder, and both the Northwind and the BTSCompensationSampleMailingList databases should be updated with the new data from the InfoPath form.</span></span>  
  
      > [!NOTE]
      >  <span data-ttu-id="f9ce4-241">Puede desasociar la base de datos BTSCompensationSampleMailingList o ponerla fuera de conexión para probar la acción de compensación que lleva a cabo la orquestación.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-241">You can detach the BTSCompensationSampleMailingList database or take it offline to test the compensation action that the orchestration performs.</span></span> <span data-ttu-id="f9ce4-242">Tenga en cuenta que el registro se actualiza en la base de datos Northwind en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-242">Observe that the record is updated in the Northwind database first.</span></span> <span data-ttu-id="f9ce4-243">A continuación, cuando la orquestación intenta actualizar la base de datos BTSCompensationSampleMailingList, porque se ha desasociado la base de datos, se produce un error al intentar llevar a cabo la actualización.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-243">Then, when the orchestration tries to update the BTSCompensationSampleMailingList database, because that database is detached, the update fails.</span></span> <span data-ttu-id="f9ce4-244">Por tanto, se genera una excepción y se produce un retraso de diez segundos antes de que se ejecute la acción de compensación para volver a escribir los datos originales del cliente en la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-244">Therefore, an exception is raised and there is a ten-second delay before the compensation action takes place to write the original customer data back to the Northwind database.</span></span>  
  
      > [!NOTE]
      >  <span data-ttu-id="f9ce4-245">Es posible que aparezca el mensaje "Error de inicio de sesión del usuario [APPPOOL de IIS\DefaultAppPool]".</span><span class="sxs-lookup"><span data-stu-id="f9ce4-245">You may get a "Login failed for user 'IIS APPPOOL\DefaultAppPool' error.</span></span> <span data-ttu-id="f9ce4-246">Esto puede deberse al error de validación en el acceso al servidor basado en autorización token.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-246">It might be because of the token-based server access validation failure.</span></span> <span data-ttu-id="f9ce4-247">Para resolver este error, cree un nuevo grupo de aplicaciones y use la cuenta de administrador en él.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-247">To resolve this error, create a new application pool and use the administrator account in it.</span></span>  
  
## <a name="uninstalling-this-sample"></a><span data-ttu-id="f9ce4-248">Desinstalar este ejemplo</span><span class="sxs-lookup"><span data-stu-id="f9ce4-248">Uninstalling This Sample</span></span>  
  
#### <a name="to-uninstall-the-compensation-sample"></a><span data-ttu-id="f9ce4-249">Para desinstalar el ejemplo Compensación</span><span class="sxs-lookup"><span data-stu-id="f9ce4-249">To uninstall the Compensation sample</span></span>  
  
1. <span data-ttu-id="f9ce4-250">En una ventana de comandos de [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], desplácese a la siguiente carpeta:</span><span class="sxs-lookup"><span data-stu-id="f9ce4-250">In a [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] command window, navigate to the following folder:</span></span>  
  
    <span data-ttu-id="f9ce4-251">\<*Ejemplos de la ruta de acceso*\>\Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="f9ce4-251">\<*Samples Path*\>\Orchestrations\Compensation\\</span></span>  
  
2. <span data-ttu-id="f9ce4-252">Ejecute Cleanup.bat.</span><span class="sxs-lookup"><span data-stu-id="f9ce4-252">Run Cleanup.bat.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f9ce4-253">Vea también</span><span class="sxs-lookup"><span data-stu-id="f9ce4-253">See Also</span></span>  
 [<span data-ttu-id="f9ce4-254">Orquestaciones (carpetas de ejemplos de BizTalk Server)</span><span class="sxs-lookup"><span data-stu-id="f9ce4-254">Orchestrations (BizTalk Server Samples Folder)</span></span>](../core/orchestrations-biztalk-server-samples-folder.md)
