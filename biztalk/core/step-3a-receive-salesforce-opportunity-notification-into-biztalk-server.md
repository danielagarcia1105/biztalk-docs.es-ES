---
title: "Paso 3a: recibir una notificación de oportunidad de Salesforce en BizTalk Server | Documentos de Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: be9de6e3-6bd9-4275-b2fb-0a756c51aabf
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 76ab28e8e70c0b8a222f6772a763a93252f2c413
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="step-3a-receive-salesforce-opportunity-notification-into-biztalk-server"></a><span data-ttu-id="df8f7-102">Paso 3a: recibir una notificación de oportunidad de Salesforce en BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="df8f7-102">Step 3a: Receive Salesforce Opportunity Notification into BizTalk Server</span></span>
<span data-ttu-id="df8f7-103">En este paso, comenzamos creando un servidor [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="df8f7-103">In this step, we start creating a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="df8f7-104">Debemos incluir primero el esquema para el mensaje de notificación de oportunidades que obtendremos de Salesforce y después comenzaremos a crear una orquestación para procesar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="df8f7-104">We should first include the message schema for the opportunities notification message that we’ll get from Salesforce and then start creating an orchestration to process the message.</span></span>  
  
### <a name="to-include-the-salesforce-opportunities-notification-schema"></a><span data-ttu-id="df8f7-105">Para incluir el esquema de notificación de oportunidades de Salesforce</span><span class="sxs-lookup"><span data-stu-id="df8f7-105">To include the Salesforce opportunities notification schema</span></span>  
  
1.  <span data-ttu-id="df8f7-106">Inicie sesión en el portal Salesforce.com.</span><span class="sxs-lookup"><span data-stu-id="df8f7-106">Login to the Salesforce.com portal.</span></span> <span data-ttu-id="df8f7-107">En el portal de Salesforce, haga clic en el nombre de inicio de sesión en la esquina superior derecha de la página y, a continuación, haga clic en **el programa de instalación**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-107">On the Salesforce portal, click your login name at the top right corner of the page, and then click **Setup**.</span></span>  
  
2.  <span data-ttu-id="df8f7-108">En el panel izquierdo, bajo **el programa de instalación de la aplicación**, expanda **crear**, expanda **flujo de trabajo y aprobaciones**y, a continuación, haga clic en **reglas de flujo de trabajo**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-108">In the left pane, under **App Setup**, expand **Create**, expand **Workflow & Approvals**, and then click **Workflow Rules**.</span></span>  
  
3.  <span data-ttu-id="df8f7-109">En el **todas las reglas de flujo de trabajo** página, haga clic en el **oportunidad cerrada** flujo de trabajo que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="df8f7-109">In the **All Workflow Rules** page, click the **Closed Opportunity** workflow that you created earlier.</span></span>  
  
4.  <span data-ttu-id="df8f7-110">En el **oportunidad cerrada** página de la regla de flujo de trabajo, haga clic en **NewOp1** acción de flujo de trabajo de mensaje saliente.</span><span class="sxs-lookup"><span data-stu-id="df8f7-110">In the **Closed Opportunity** workflow rule page, click **NewOp1** outbound message workflow action.</span></span>  
  
5.  <span data-ttu-id="df8f7-111">En el **NewOp1** acción de flujo de trabajo de mensaje saliente de página, haga clic en el vínculo **clic de WSDL**, haga clic en **Guardar destino como**y, a continuación, especifique la ubicación donde desea guardar el WSDL.</span><span class="sxs-lookup"><span data-stu-id="df8f7-111">In the **NewOp1** outbound message workflow action page, right-click the link **Click for WSDL**, click **Save target as**, and then specify the location where you want to save the WSDL.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="df8f7-112">Debe guardar el archivo con la extensión .wsdl.</span><span class="sxs-lookup"><span data-stu-id="df8f7-112">You must save the file with a .wsdl extension.</span></span>  
  
6.  <span data-ttu-id="df8f7-113">Crear un servidor [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] en [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="df8f7-113">Create a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)].</span></span> <span data-ttu-id="df8f7-114">Para este tutorial, daremos el nombre del proyecto como `BtsSalesforceIntegration`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-114">For this tutorial, let us name the project as `BtsSalesforceIntegration`.</span></span>  
  
7.  <span data-ttu-id="df8f7-115">Haga clic en el [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] en el Explorador de soluciones, seleccione **agregar**y, a continuación, haga clic en **agregar elementos generados**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-115">Right-click the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project in the Solution Explorer, point to **Add**, and then click **Add Generated Items**.</span></span>  
  
8.  <span data-ttu-id="df8f7-116">En el **agregar elementos generados** cuadro de diálogo, haga clic en **consumir servicio WCF**y, a continuación, haga clic en **agregar** para iniciar el **consumición de servicio de WCF de BizTalk**asistente.</span><span class="sxs-lookup"><span data-stu-id="df8f7-116">In the **Add Generated Items** dialog box, click **Consume WCF Service**, and then click **Add** to launch the **BizTalk WCF Service Consuming** wizard.</span></span> <span data-ttu-id="df8f7-117">En la página de bienvenida, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-117">On the welcome page, click **Next**.</span></span>  
  
9. <span data-ttu-id="df8f7-118">En el **origen de metadatos** página, seleccione la **archivos de metadatos (WSDL y XSD)** opción y, a continuación, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-118">On the **Metadata Source** page, select the **Metadata Files (WSDL and XSD)** option, and then click **Next**.</span></span>  
  
10. <span data-ttu-id="df8f7-119">En el **archivos de metadatos** página, haga clic en **agregar**y, a continuación, navegue hasta la ubicación donde guardó el archivo WSDL descargado desde el portal de Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-119">On the **Metadata Files** page, click **Add**, and then navigate to the location where you saved the WSDL file downloaded from the Salesforce portal.</span></span> <span data-ttu-id="df8f7-120">Seleccione el archivo WSDL y, a continuación, haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-120">Select the WSDL file and then click **Next**.</span></span>  
  
11. <span data-ttu-id="df8f7-121">En la página siguiente, establezca el espacio de nombres como `NotificationService` y, a continuación, haga clic en **importación**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-121">In the next page, set the namespace as `NotificationService` and then click **Import**.</span></span> <span data-ttu-id="df8f7-122">El asistente agrega los archivos de esquema y una orquestación al proyecto [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="df8f7-122">The wizard adds the schema files and an orchestration to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project.</span></span> <span data-ttu-id="df8f7-123">El esquema de mensaje para recibir notificaciones de oportunidades de Salesforce es **NotificationService_soap_sforce_com_2005_09_outbound.xsd**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-123">The message schema for receiving opportunity notifications from Salesforce is **NotificationService_soap_sforce_com_2005_09_outbound.xsd**.</span></span>  
  
### <a name="to-create-an-orchestration-to-receive-the-notification-message"></a><span data-ttu-id="df8f7-124">Para crear una orquestación para recibir el mensaje de notificación</span><span class="sxs-lookup"><span data-stu-id="df8f7-124">To create an orchestration to receive the notification message</span></span>  
  
1.  <span data-ttu-id="df8f7-125">Después de completar la **consumición de servicio de WCF de BizTalk** asistente, una orquestación (**NotificationService.odx**, en este ejemplo) se agrega a la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] proyecto.</span><span class="sxs-lookup"><span data-stu-id="df8f7-125">After you complete the **BizTalk WCF Service Consuming** wizard, an orchestration (**NotificationService.odx**, in this example) is added to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project.</span></span>  
  
2.  <span data-ttu-id="df8f7-126">Abra el archivo de orquestación y, en la vista Orquestación, agregue dos variables de mensaje nuevas.</span><span class="sxs-lookup"><span data-stu-id="df8f7-126">Open the orchestration file and in the Orchestration view, add two new message variables.</span></span> <span data-ttu-id="df8f7-127">Denomínelos `NotificationMessage` y `NotificationAck`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-127">Name them `NotificationMessage` and `NotificationAck`.</span></span> <span data-ttu-id="df8f7-128">Establezca el tipo de mensaje para estas variables de mensaje como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="df8f7-128">Set the message type for these message variables as follows:</span></span>  
  
    1.  <span data-ttu-id="df8f7-129">Establecer **NotificationMessage** a *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notifications*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-129">Set **NotificationMessage** to *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notifications*.</span></span> <span data-ttu-id="df8f7-130">Esta variable de mensaje representa el mensaje de notificación de oportunidad recibido de Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-130">This message variable represents the opportunity notification message received from Salesforce.</span></span>  
  
    2.  <span data-ttu-id="df8f7-131">Establecer **NotificationAck** a *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notificationsResponse*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-131">Set **NotificationAck** to *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notificationsResponse*.</span></span> <span data-ttu-id="df8f7-132">Esta variable de mensaje representa el mensaje de confirmación de notificación de oportunidad enviado a Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-132">This message variable represents the opportunity notification acknowledgement message sent back to Salesforce.</span></span>  
  
3.  <span data-ttu-id="df8f7-133">Agregar una forma Recepción a la orquestación.</span><span class="sxs-lookup"><span data-stu-id="df8f7-133">Add a receive shape to the orchestration.</span></span> <span data-ttu-id="df8f7-134">Establezca las siguientes propiedades en la forma:</span><span class="sxs-lookup"><span data-stu-id="df8f7-134">Set the following properties on the shape:</span></span>  
  
    1.  <span data-ttu-id="df8f7-135">Establecer **activar** a **True**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-135">Set **Activate** to **True**.</span></span>  
  
    2.  <span data-ttu-id="df8f7-136">Establecer **nombre** a *ReceiveNotificationMessage*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-136">Set **Name** to *ReceiveNotificationMessage*.</span></span>  
  
    3.  <span data-ttu-id="df8f7-137">Establecer **mensaje** a *NotificationMessage*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-137">Set **Message** to *NotificationMessage*.</span></span>  
  
4.  <span data-ttu-id="df8f7-138">Agregue una forma Construir mensaje después de la forma Recepción.</span><span class="sxs-lookup"><span data-stu-id="df8f7-138">Add a Construct Message shape after the Receive shape.</span></span> <span data-ttu-id="df8f7-139">Nombre de la forma de mensaje `ConstructNotificationResponse` y establezca el **mensajes construidos** propiedad `NotificationAck`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-139">Name the message shape as `ConstructNotificationResponse` and set the **Messages Constructed** property to `NotificationAck`.</span></span> <span data-ttu-id="df8f7-140">Como parte de la forma Construir mensaje, crearemos también una asignación para generar un mensaje de confirmación de notificación para enviarlo a Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-140">As part of the construct message, we’ll also create a map to generate a notification acknowledgement message to be sent back to Salesforce.</span></span>  
  
    1.  <span data-ttu-id="df8f7-141">Dentro de la forma Construir mensaje, agregue una forma Transformación.</span><span class="sxs-lookup"><span data-stu-id="df8f7-141">Within the Construct Message shape, add a Transform shape.</span></span> <span data-ttu-id="df8f7-142">Haga doble clic en la forma transformación y en el cuadro de diálogo Configuración de transformación, seleccione la **nueva asignación** opción.</span><span class="sxs-lookup"><span data-stu-id="df8f7-142">Double-click the Transform shape and in the Transform Configuration dialog box, select the **New Map** option.</span></span>  
  
    2.  <span data-ttu-id="df8f7-143">Especifique el nombre de asignación `BtsSalesforceIntegration.MapNotificationResponse`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-143">Specify the map name as `BtsSalesforceIntegration.MapNotificationResponse`.</span></span>  
  
    3.  <span data-ttu-id="df8f7-144">Establezca el origen **NotificationMessage** y el destino **NotificationAck**.</span><span class="sxs-lookup"><span data-stu-id="df8f7-144">Set Source as **NotificationMessage** and Destination as **NotificationAck**.</span></span>  
  
    4.  <span data-ttu-id="df8f7-145">Asegúrese de que la casilla de verificación **iniciar el asignador de BizTalk al hacer clic en Aceptar,** está seleccionada.</span><span class="sxs-lookup"><span data-stu-id="df8f7-145">Make sure the check box **When I click OK, launch the BizTalk Mapper** is selected.</span></span>  
  
    5.  <span data-ttu-id="df8f7-146">En **MapNotificationResponse.btm**, vamos a crear una respuesta de notificación para enviar a Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-146">In **MapNotificationResponse.btm**, we’ll create a notification response to be sent back to Salesforce.</span></span> <span data-ttu-id="df8f7-147">Cada vez que Salesforce envía una notificación, espera una confirmación de vuelta.</span><span class="sxs-lookup"><span data-stu-id="df8f7-147">Every time Salesforce sends a notification, it expects an acknowledgement in return.</span></span> <span data-ttu-id="df8f7-148">El esquema del mensaje de respuesta de notificación muestra que la **confirmación** elemento de la respuesta es de tipo booleano.</span><span class="sxs-lookup"><span data-stu-id="df8f7-148">The schema of the notification response message shows that the **Ack** element in the response is of type Boolean.</span></span> <span data-ttu-id="df8f7-149">Por lo tanto, en la asignación, debe quitar un **Value Mapping** functoid y establezca sus dos valores de entrada (condición y resultado) a `true`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-149">So, in the map, you must drop a **Value Mapping** functoid and set its two input values (Condition and Result) to `true`.</span></span> <span data-ttu-id="df8f7-150">Haga clic en **Aceptar** para guardar el functoid.</span><span class="sxs-lookup"><span data-stu-id="df8f7-150">Click **OK** to save the functoid.</span></span>  
  
    6.  <span data-ttu-id="df8f7-151">Conectar el **Value Mapping** functoid para el **confirmación** elemento del esquema de destino.</span><span class="sxs-lookup"><span data-stu-id="df8f7-151">Connect the **Value Mapping** functoid to the **Ack** element in the destination schema.</span></span>  
  
5.  <span data-ttu-id="df8f7-152">En la orquestación, después de la forma Construir mensaje, agregue una forma Envío que se usará para enviar la confirmación a Salesforce.</span><span class="sxs-lookup"><span data-stu-id="df8f7-152">In the orchestration, after the Construct Message shape, add a Send shape that will be used to send the acknowledgement back to Salesforce.</span></span>  
  
    -   <span data-ttu-id="df8f7-153">Establecer **nombre** a *SendNotificationAck*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-153">Set **Name** to *SendNotificationAck*.</span></span>  
  
    -   <span data-ttu-id="df8f7-154">Establecer **mensaje** a *NotificationAck*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-154">Set **Message** to *NotificationAck*.</span></span>  
  
6.  <span data-ttu-id="df8f7-155">En la orquestación, agregue un puerto para recibir el mensaje de notificación de Salesforce y enviar la confirmación en respuesta.</span><span class="sxs-lookup"><span data-stu-id="df8f7-155">In the orchestration, add a port to receive Salesforce notification message and send the acknowledgement in response.</span></span> <span data-ttu-id="df8f7-156">En el Asistente para configuración de puertos, seleccione las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="df8f7-156">In the Port Configuration wizard, select the following options:</span></span>  
  
    -   <span data-ttu-id="df8f7-157">Especifique el nombre de puerto `SalesforceNotificationPort`.</span><span class="sxs-lookup"><span data-stu-id="df8f7-157">Specify the port name as `SalesforceNotificationPort`.</span></span>  
  
    -   <span data-ttu-id="df8f7-158">Seleccione la opción Crear un nuevo tipo de puerto.</span><span class="sxs-lookup"><span data-stu-id="df8f7-158">Select the option to create a new port type.</span></span>  
  
    -   <span data-ttu-id="df8f7-159">Establecer **patrón de comunicación** a *solicitud-respuesta*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-159">Set **Communication Pattern** to *Request-Response*.</span></span>  
  
    -   <span data-ttu-id="df8f7-160">Establecer **dirección de puerto de comunicación** a *podrá recibir una solicitud y enviaré una respuesta* y establecer **enlace de puerto** a *especificar posterior*.</span><span class="sxs-lookup"><span data-stu-id="df8f7-160">Set **Port direction of communication** to *I’ll be receiving a request and sending a response* and set **Port binding** to *Specify later*.</span></span>  
  
     <span data-ttu-id="df8f7-161">Conectar el **solicitar** operación del puerto a la forma recepción (*ReceiveNotificationMessage*) y la **respuesta** operación del puerto de la forma envío (*SendNotificationAck*).</span><span class="sxs-lookup"><span data-stu-id="df8f7-161">Connect the **Request** operation of port to the Receive shape (*ReceiveNotificationMessage*) and the **Response** operation of the port to the Send shape (*SendNotificationAck*).</span></span> <span data-ttu-id="df8f7-162">La siguiente captura de pantalla muestra la parte de la orquestación que recibe una notificación de oportunidad de Salesforce y envía una confirmación de vuelta:</span><span class="sxs-lookup"><span data-stu-id="df8f7-162">The following screenshot depicts the part of the orchestration that receives an opportunity notification from Salesforce and sends an acknowledgement back:</span></span>  
  
     <span data-ttu-id="df8f7-163">![Recibir una notificación de oportunidad y enviar respuesta](../core/media/bts-sf-recvnotificationorch.jpg "BTS_SF_RecvNotificationOrch")</span><span class="sxs-lookup"><span data-stu-id="df8f7-163">![Receive opportunity notification and send response](../core/media/bts-sf-recvnotificationorch.jpg "BTS_SF_RecvNotificationOrch")</span></span>  
  
 <span data-ttu-id="df8f7-164">Por ahora, hemos configurado la solución donde se recibe una notificación de oportunidad de Salesforce y se envía una confirmación de vuelta.</span><span class="sxs-lookup"><span data-stu-id="df8f7-164">By now, we have set up the solution where an opportunity notification is received from Salesforce and an acknowledgement is sent back.</span></span> <span data-ttu-id="df8f7-165">En los temas siguientes, ampliaremos esta solución para comenzar a procesar la notificación de oportunidad con el fin de obtener más detalles acerca del tipo de oportunidad de venta disponible.</span><span class="sxs-lookup"><span data-stu-id="df8f7-165">In the subsequent topics, we’ll build on this solution to start processing the opportunity notification to get more details about the kind of sales opportunity available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="df8f7-166">Vea también</span><span class="sxs-lookup"><span data-stu-id="df8f7-166">See Also</span></span>  
 [<span data-ttu-id="df8f7-167">Paso 3: Crear la solución de BizTalk Server en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="df8f7-167">Step 3: Create the BizTalk Server Solution in Visual Studio</span></span>](../core/step-3-create-the-biztalk-server-solution-in-visual-studio.md)