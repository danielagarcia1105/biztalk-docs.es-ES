---
title: Archivar y purgar la base de datos de seguimiento de BizTalk | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- Tracking database, purging
- BizTalk Server, maintaining
- archiving [Tracking database]
- purging
- Tracking database, maintaining
- Tracking database, archiving
- maintaining, Tracking database
- maintaining, BizTalk Server
ms.assetid: 7014cf31-86e8-4829-8055-056442329009
caps.latest.revision: "37"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e8fc75f5218ec7a189d28c7120cf23a3047c1752
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="archiving-and-purging-the-biztalk-tracking-database"></a><span data-ttu-id="ea9ec-102">Archivar y purgar la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-102">Archiving and Purging the BizTalk Tracking Database</span></span>
<span data-ttu-id="ea9ec-103">Puesto que BizTalk Server procesa cada vez más datos en el sistema, el tamaño de la base de datos de seguimiento de BizTalk (BizTalkDTADb) continúa aumentando.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-103">As BizTalk Server processes more and more data on your system, the BizTalk Tracking (BizTalkDTADb) database continues to grow in size.</span></span> <span data-ttu-id="ea9ec-104">Un crecimiento descontrolado reduce el rendimiento del sistema y puede dar lugar a errores en el Servicio de descodificación de datos de seguimiento (TDDS).</span><span class="sxs-lookup"><span data-stu-id="ea9ec-104">Unchecked growth decreases system performance and may generate errors in the Tracking Data Decode Service (TDDS).</span></span> <span data-ttu-id="ea9ec-105">Además de los datos de seguimiento general, se pueden acumular también los mensajes controlados en la base de datos de cuadro de mensajes, lo que daría lugar a un rendimiento pobre del disco.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-105">In addition to general tracking data, tracked messages can also accumulate in the MessageBox database, causing poor disk performance.</span></span>  
  
 <span data-ttu-id="ea9ec-106">Si bien algunas versiones anteriores de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] incluían scripts de ejemplo para archivar los mensajes controlados y purgar la base de datos de seguimiento de BizTalk, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] automatiza ambos procesos mediante el trabajo de archivo y purga de DTA.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-106">While previous versions of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] included sample scripts for archiving tracked messages and purging the BizTalk Tracking database, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] automates both processes using the DTA Purge and Archive job.</span></span> <span data-ttu-id="ea9ec-107">Archivar y purgar los datos de la base de datos de seguimiento de BizTalk permite mantener el sistema en buen estado y tener los datos de seguimiento archivados para usarlos en el futuro.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-107">By archiving and purging data from the BizTalk Tracking database, you can maintain a healthy system, as well as keep your tracking data archived for future use.</span></span> <span data-ttu-id="ea9ec-108">Puesto que los archivos de la base de datos de seguimiento de BizTalk se acumulan con el tiempo y consumen espacio en disco, se recomienda moverlos con regularidad a un recurso de almacenamiento secundario.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-108">Because BizTalk Tracking database archives accumulate over time and consume disk space, it is a good idea to move the BizTalk Tracking database archives to secondary storage on a regular basis.</span></span>  
  
 <span data-ttu-id="ea9ec-109">Cuando se purgan datos de la base de datos de seguimiento de BizTalk, el trabajo DTA Purge and Archive purga distintos tipos de información de seguimiento, como, por ejemplo, datos de seguimiento del motor de reglas, información de eventos de orquestación, así como de instancia de servicio y de mensaje.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-109">When you purge data from the BizTalk Tracking database, the DTA Purge and Archive job purges different types of tracking information such as message and service instance information, orchestration event information, and rules engine tracking data.</span></span>  
  
 <span data-ttu-id="ea9ec-110">La antigüedad de un registro de datos de seguimiento se basa en la hora en la que se insertaron los datos en la base de datos de seguimiento de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-110">The age of a tracking data record is based on the time the tracking data was inserted into the BizTalk Tracking database.</span></span> <span data-ttu-id="ea9ec-111">El trabajo DTA Purge and Archive utiliza la marca de tiempo para comprobar continuamente si el registro es anterior a la ventana de actividad de datos.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-111">The DTA Purge and Archive job uses the time stamp to continuously verify whether the record is older than the live window of data.</span></span> <span data-ttu-id="ea9ec-112">Después de cada período de ventana de actividad, la base de datos de seguimiento de BizTalk se archiva y se crea un archivo de almacenamiento nuevo.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-112">After every live window period, the BizTalk Tracking database is archived and a new archive file is created.</span></span> <span data-ttu-id="ea9ec-113">Todos los datos de seguimiento completados que sean anteriores al período de ventana activa se purgan en cada intervalo de trabajo del Agente SQL Server especificado por la programación de trabajo.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-113">At each SQL Server Agent job interval specified by the job schedule, all completed tracking data older than the live window period is purged.</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="ea9ec-114"> usa los conceptos de purga condicional y purga incondicional.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-114"> uses the concept of a soft purge and a hard purge.</span></span> <span data-ttu-id="ea9ec-115">La purga condicional se utiliza para purgar instancias completadas, mientras que la purga incondicional se utiliza únicamente para purgar instancias que no se han completado.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-115">The soft purge is used to purge completed instances, while the hard purge is only used to purge incomplete instances.</span></span>  
  
 <span data-ttu-id="ea9ec-116">**Purga condicional**</span><span class="sxs-lookup"><span data-stu-id="ea9ec-116">**Soft purge**</span></span>  
  
 <span data-ttu-id="ea9ec-117">En el trabajo de archivo y purga de DTA, la suma de los parámetros LiveHours y LiveDays es la ventana de actividad de los datos que desea mantener en el entorno de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ea9ec-117">In the DTA Archive and Purge job, the sum of the LiveHours and LiveDays parameters is the live window of data you want to maintain in your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="ea9ec-118">Se purgan todos los datos asociados con una instancia completada anterior a esta ventana de actividad de datos.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-118">All data associated with a completed instance older than this live window of data is purged.</span></span> <span data-ttu-id="ea9ec-119">De forma predeterminada, el trabajo DTA Archive and Purge no se encuentra habilitado.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-119">By default, the DTA Archive and Purge job is not enabled.</span></span> <span data-ttu-id="ea9ec-120">Primero, es preciso configurar el trabajo y habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-120">You must first configure and then enable the job.</span></span>  
  
 <span data-ttu-id="ea9ec-121">Por ejemplo, puede configurar el trabajo DTA Purge and Archive para que se ejecute cada 20 minutos y establece la actividad = 1 y LiveDays = 0.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-121">For example, you can configure the DTA Purge and Archive job to run every 20 minutes, and set LiveHours=1 and LiveDays=0.</span></span> <span data-ttu-id="ea9ec-122">La primera vez que este trabajo de agente SQL Server ejecuta (T0), toma una copia de seguridad de la base de datos de seguimiento mediante la creación de un archivo y se guarda una entrada en la base de datos con esta marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-122">The first time this SQL Server Agent job runs (T0), it takes a backup of the tracking database by creating an archive and an entry is saved in the database with this timestamp.</span></span> <span data-ttu-id="ea9ec-123">Un archivo correcto resulta necesario para purgar datos de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-123">A successful archive is necessary in order to purge tracking data.</span></span> <span data-ttu-id="ea9ec-124">Si el archivo se ha realizado correctamente, se purgan todos los datos asociados con las instancias que se completaron hace más de una hora.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-124">If the archive was successful, then all the data associated with the instances that completed over an hour ago is purged.</span></span> <span data-ttu-id="ea9ec-125">Cada vez que se ejecuta el trabajo, se purgan los datos completados hace más de una hora.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-125">Each time the job runs, completed data over one hour old is purged.</span></span> <span data-ttu-id="ea9ec-126">En la tercera ejecución (después de una hora), se crea un nuevo archivo que contiene los datos de todas las instancias que se insertaron en la base de datos de seguimiento durante el último período de una hora.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-126">On the 3rd run (after one hour), a new archive is created that contains the data for all instances that were inserted into the tracking database in the last one hour segment.</span></span>  
  
 <span data-ttu-id="ea9ec-127">A continuación, se especifica el modo en el que tendrá que configurarse el paso Archive and Purge del trabajo DTA Purge and Archive para que coincida con el ejemplo anterior:</span><span class="sxs-lookup"><span data-stu-id="ea9ec-127">Here is how you would configure the Archive and Purge step in the DTA Purge and Archive job to match the example above:</span></span>  
  
```  
exec dtasp_BackupAndPurgeTrackingDatabase  
1, --@nLiveHours 1,   
0, --@nLiveDays   
1, --@nHardDeleteDays   
‘\\server\backup’, --@nvcFolder   
null, --@nvcValidatingServer   
0 --@fForceBackup Soft purge process  
```  
  
 <span data-ttu-id="ea9ec-128">La marca de tiempo de la última copia de seguridad se almacena en la base de datos de seguimiento de BizTalk y garantiza que los datos tan sólo se purgan si se encuentran en el archivo anterior.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-128">The time stamp of the last backup is stored in the BizTalk Tracking database and ensures that data is only purged if it is in the previous archive.</span></span> <span data-ttu-id="ea9ec-129">Para obtener mayor confiabilidad, los archivos se superponen durante, aproximadamente, 10 minutos.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-129">For additional reliability, archives are overlapped by approximately 10 minutes.</span></span> <span data-ttu-id="ea9ec-130">En la siguiente ilustración, basada en el ejemplo anterior, se muestra el proceso de purga condicional.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-130">The following figure, based on the example above, shows the soft purge process.</span></span> <span data-ttu-id="ea9ec-131">Tenga en cuenta que las tareas de archivo y purga no siempre ocurren al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-131">Note that the archiving and purging tasks do not necessarily happen at the same time.</span></span>  
  
 <span data-ttu-id="ea9ec-132">**Proceso de purga condicional**</span><span class="sxs-lookup"><span data-stu-id="ea9ec-132">**Soft purge process**</span></span>  
  
 <span data-ttu-id="ea9ec-133">![Proceso de purga condicional](../core/media/archivingandpurging.gif "archivingandpurging")</span><span class="sxs-lookup"><span data-stu-id="ea9ec-133">![Soft purge process](../core/media/archivingandpurging.gif "archivingandpurging")</span></span>  
  
 <span data-ttu-id="ea9ec-134">**Purga incondicional**</span><span class="sxs-lookup"><span data-stu-id="ea9ec-134">**Hard purge**</span></span>  
  
 <span data-ttu-id="ea9ec-135">Puesto que la purga condicional tan sólo purga los datos asociados con instancias completadas, si tuviera un alto número de instancias en bucle cuya ejecución se produjese de manera indefinida, la base de datos de seguimiento crecería y estas instancias nunca se podrían purgar.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-135">Because the soft purge only purges data associated with completed instances, if you have many looping instances that run indefinitely, then your tracking database would grow and these instances would never be purged.</span></span> <span data-ttu-id="ea9ec-136">La fecha de la purga incondicional permite que se purgue toda la información anterior al intervalo especificado, a excepción de la información que indica la existencia de un servicio.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-136">The hard purge date allows all information older than the specified interval to be purged except for information indicating a service's existence.</span></span> <span data-ttu-id="ea9ec-137">Establecer la purga incondicional utilizando la  **@nHardDeleteDays**  parámetro en el archivo y la depuración paso a paso en el trabajo de purga de DTA Archive and.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-137">You set the hard purge using the **@nHardDeleteDays** parameter in the Archive and Purge step in the DTA Archive and Purge job.</span></span> <span data-ttu-id="ea9ec-138">La configuración de purga incondicional debe ser siempre superior a la configuración de purga condicional.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-138">The hard purge setting should always be greater than your soft purge setting.</span></span> <span data-ttu-id="ea9ec-139">En otras palabras,  **@nHardDeleteDays**  debe ser mayor que la suma de  **@nLiveHours**  y  **@nLiveDays** .</span><span class="sxs-lookup"><span data-stu-id="ea9ec-139">In other words, **@nHardDeleteDays** should be greater than the sum of **@nLiveHours** and **@nLiveDays**.</span></span>  
  
 <span data-ttu-id="ea9ec-140">Archivar y purgar incluye las características que se describen en la siguiente tabla:</span><span class="sxs-lookup"><span data-stu-id="ea9ec-140">Archiving and purging includes the features described in the following table:</span></span>  
  
|<span data-ttu-id="ea9ec-141">Característica</span><span class="sxs-lookup"><span data-stu-id="ea9ec-141">Feature</span></span>|<span data-ttu-id="ea9ec-142">Description</span><span class="sxs-lookup"><span data-stu-id="ea9ec-142">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="ea9ec-143">Purga incondicional</span><span class="sxs-lookup"><span data-stu-id="ea9ec-143">Hard purge</span></span>|<span data-ttu-id="ea9ec-144">Permite configurar un intervalo de tiempo para purgar la información de instancias no completadas anteriores a la fecha especificada.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-144">Enables you to configure a time interval to purge information for incomplete instances older than a specified date.</span></span>|  
|<span data-ttu-id="ea9ec-145">Copiar mensajes controlados en la base de datos de seguimiento</span><span class="sxs-lookup"><span data-stu-id="ea9ec-145">Copying tracked messages to tracking database</span></span>|<span data-ttu-id="ea9ec-146">La opción CopyTrackedMessageToDTA permite copiar directamente mensajes de los que se ha efectuado un seguimiento de los servidores de cuadro de mensajes a la base de datos de seguimiento de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-146">Using the CopyTrackedMessageToDTA option, you can directly copy tracked messages from the MessageBox servers to your BizTalk Tracking database.</span></span> <span data-ttu-id="ea9ec-147">Esto resulta necesario para purgar datos mediante el trabajo DTA Purge and Archive.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-147">This is required in order to purge data using the DTA Purge and Archive job.</span></span>|  
|<span data-ttu-id="ea9ec-148">Validación de archivos</span><span class="sxs-lookup"><span data-stu-id="ea9ec-148">Archive validation</span></span>|<span data-ttu-id="ea9ec-149">Permite configurar de forma opcional un servidor de base de datos secundario para validar los archivos conforme se crean.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-149">Enables you to optionally set up a secondary database server to validate the archives as they are created.</span></span>|  
|<span data-ttu-id="ea9ec-150">Compatibilidad de seguimiento con varias versiones de base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-150">Tracking support for multiple BizTalk Tracking database versions</span></span>|<span data-ttu-id="ea9ec-151">Permite usar la compatibilidad de seguimiento con archivos de bases de datos de [!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)] y [!INCLUDE[btsBizTalkServer2006](../includes/btsbiztalkserver2006-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ea9ec-151">Enables you to use tracking support with [!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)] and [!INCLUDE[btsBizTalkServer2006](../includes/btsbiztalkserver2006-md.md)] database archives.</span></span>|  
|<span data-ttu-id="ea9ec-152">Reducción de datos de seguimiento</span><span class="sxs-lookup"><span data-stu-id="ea9ec-152">Reduction of tracking data</span></span>|<span data-ttu-id="ea9ec-153">Reduce notablemente la cantidad de datos de seguimiento almacenados sin reducir la información de seguimiento generada.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-153">Substantially reduces the amount of tracking data stored without reducing any tracking information generated.</span></span> <span data-ttu-id="ea9ec-154">Esto da lugar a un crecimiento más lento de la base de datos de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-154">This results in slower growth of the tracking database.</span></span>|  
|<span data-ttu-id="ea9ec-155">Operaciones de seguimiento más rápidas, importante optimización de los esquemas de base de datos</span><span class="sxs-lookup"><span data-stu-id="ea9ec-155">Faster tracking operations, significant optimization in database schemas</span></span>|<span data-ttu-id="ea9ec-156">Permite usar tareas de seguimiento para buscar mensajes e instancias de servicio en bases de datos de gran tamaño; esta característica se ha optimizado notablemente.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-156">Enables you to use tracking tasks for finding messages and service instances on large databases; this feature has been significantly optimized.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="ea9ec-157">Si están surgiendo problemas de rendimiento que se solucionan de manera momentánea mediante la purga de la base de datos de seguimiento de BizTalk, y desea configurar BizTalk para que no recopile más información de seguimiento, considere la posibilidad de desactivar el seguimiento global.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-157">If you are having performance issues that are momentarily addressed by purging the BizTalk tracking database, and you want to configure BizTalk to no longer collect tracking information, you may want to consider turning off global tracking.</span></span> <span data-ttu-id="ea9ec-158">Para obtener información acerca de la desactivación del seguimiento global, vea Cómo desactivar el seguimiento global.</span><span class="sxs-lookup"><span data-stu-id="ea9ec-158">For information about turning off global tracking, see How to Turn Off Global Tracking.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="ea9ec-159">En esta sección</span><span class="sxs-lookup"><span data-stu-id="ea9ec-159">In This Section</span></span>  
  
-   [<span data-ttu-id="ea9ec-160">Lista de comprobación: Archivar y purgar la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-160">Checklist: Archiving and Purging the BizTalk Tracking Database</span></span>](../core/checklist-archiving-and-purging-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="ea9ec-161">Cómo configurar la función BTS_BACKUP_USERS para archivar y purgar datos de la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-161">How to Configure the BTS_BACKUP_USERS Role for Archiving and Purging Data from the BizTalk Tracking Database</span></span>](../core/configure-bts_backup_users-role-to-archive-and-purge-from-tracking-database.md)  
  
-   [<span data-ttu-id="ea9ec-162">Cómo configurar el trabajo DTA Purge and Archive</span><span class="sxs-lookup"><span data-stu-id="ea9ec-162">How to Configure the DTA Purge and Archive Job</span></span>](../core/how-to-configure-the-dta-purge-and-archive-job.md)  
  
-   [<span data-ttu-id="ea9ec-163">Cómo purgar datos de la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-163">How to Purge Data from the BizTalk Tracking Database</span></span>](../core/how-to-purge-data-from-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="ea9ec-164">Cómo purgar datos manualmente desde la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-164">How to Manually Purge Data from the BizTalk Tracking Database</span></span>](../core/how-to-manually-purge-data-from-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="ea9ec-165">Cómo habilitar la validación automática de archivos</span><span class="sxs-lookup"><span data-stu-id="ea9ec-165">How to Enable Automatic Archive Validation</span></span>](../core/how-to-enable-automatic-archive-validation.md)  
  
-   [<span data-ttu-id="ea9ec-166">Cómo copiar mensajes controlados en la base de datos de seguimiento de BizTalk</span><span class="sxs-lookup"><span data-stu-id="ea9ec-166">How to Copy Tracked Messages into the BizTalk Tracking Database</span></span>](../core/how-to-copy-tracked-messages-into-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="ea9ec-167">Mejorar el rendimiento del proceso de archivo y purgado</span><span class="sxs-lookup"><span data-stu-id="ea9ec-167">Improving the Performance of the Archiving and Purging Process</span></span>](../core/improving-the-performance-of-the-archiving-and-purging-process.md)  
  
-   [<span data-ttu-id="ea9ec-168">Cómo desactivar el seguimiento Global</span><span class="sxs-lookup"><span data-stu-id="ea9ec-168">How to Turn Off Global Tracking</span></span>](../core/how-to-turn-off-global-tracking.md)