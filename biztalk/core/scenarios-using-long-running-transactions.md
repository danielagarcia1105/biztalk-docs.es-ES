---
title: Escenarios de uso de transacciones de larga ejecución | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- transactions, long-running
- long-running transactions, timeouts
- transactions, examples
- long-running transactions, examples
- long-running compensations
- examples, long-running transactions
- examples, custom compensations
ms.assetid: 76b3e0f8-44dc-419e-a73a-c2908b1d8795
caps.latest.revision: 3
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 05ac14bc6e333f963dda7cb9b33d1ebf371c0546
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22269924"
---
# <a name="scenarios-using-long-running-transactions"></a><span data-ttu-id="8ecc7-102">Escenarios que usan transacciones de larga ejecución</span><span class="sxs-lookup"><span data-stu-id="8ecc7-102">Scenarios Using Long-Running Transactions</span></span>
<span data-ttu-id="8ecc7-103">En los escenarios siguientes se describe el uso de transacciones de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-103">The following scenarios describe the use of long running transactions.</span></span>  
  
## <a name="scenario-1-using-long-running-transactions-with-timeouts"></a><span data-ttu-id="8ecc7-104">Escenario 1: Uso de transacciones de larga ejecución con tiempos de espera</span><span class="sxs-lookup"><span data-stu-id="8ecc7-104">Scenario 1: Using Long Running Transactions with Timeouts</span></span>  
 <span data-ttu-id="8ecc7-105">Ámbitos de larga ejecución se puede asociar con un tiempo de espera, que es el tiempo lógico en el que se debe completar el trabajo de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-105">Long running scopes can be associated with a timeout, which is a logical time within which the long-running work must complete.</span></span> <span data-ttu-id="8ecc7-106">Si el ámbito no se completa dentro del tiempo especificado, una excepción predefinida del sistema **TimeoutException** se genera.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-106">If the scope does not complete within the specified time, a pre-defined system exception **TimeoutException** is raised.</span></span>  
  
 <span data-ttu-id="8ecc7-107">Puede crear procesos de larga ejecución si marca la orquestación completa como de larga ejecución, o bien tiene un ámbito de larga ejecución externo anidado a cualquier otro ámbito.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-107">You can create long running processes by either marking the entire orchestration as long running or having an outer long running scope nest any other scopes.</span></span> <span data-ttu-id="8ecc7-108">En el primer escenario, se ejecuta un controlador de excepción proporcionado por el sistema, mientras que en el último se pueden asociar controladores de excepción específicos al ámbito externo.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-108">In the former scenario, a system-provided exception handler runs, whereas the latter allows associating specific exception handlers to the outer scope.</span></span> <span data-ttu-id="8ecc7-109">El controlador de excepción predeterminado proporcionado por el sistema ejecutará el controlador de compensación de los ámbitos transaccionales anidados y completados de forma correcta, si hay alguno, en orden inverso a la finalización.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-109">The default system-provided exception handler will run the compensation handler for each of the successfully completed nested transactional scopes, if any, in reverse order of their completion.</span></span> <span data-ttu-id="8ecc7-110">Puede conseguir el mismo resultado mediante la auto compensación si usa la forma Compensar en el controlador de excepción para una transacción de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-110">You can achieve the same through self compensating by using the Compensate shape in the exception handler for a long running transaction.</span></span>  
  
 <span data-ttu-id="8ecc7-111">La siguiente orquestación es una representación de cómo asociar tiempos de espera a transacciones de larga ejecución.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-111">The following orchestration is a representation of how to associate timeouts with long running transactions.</span></span>  
  
 <span data-ttu-id="8ecc7-112">**Transacciones de ejecución larga con tiempos de espera**</span><span class="sxs-lookup"><span data-stu-id="8ecc7-112">**Long running transactions with timeouts**</span></span>  
  
 <span data-ttu-id="8ecc7-113">![Transacciones de larga ejecución con tiempos de espera](../core/media/bts-trans-orch-fig7.gif "BTS_Trans_Orch_Fig7")</span><span class="sxs-lookup"><span data-stu-id="8ecc7-113">![Long running transactions with timeouts](../core/media/bts-trans-orch-fig7.gif "BTS_Trans_Orch_Fig7")</span></span>  
  
 <span data-ttu-id="8ecc7-114">Algunas veces, puede ser necesario establecer una conexión con sistemas heredados que funcionan en forma de lotes.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-114">Sometimes you may need to interface with legacy systems that operate in a batch fashion.</span></span> <span data-ttu-id="8ecc7-115">Este escenario muestra un pedido que se ha recibido y enviado al sistema heredado.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-115">This scenario shows a purchase order being received and sent to the legacy system.</span></span> <span data-ttu-id="8ecc7-116">El sistema heredado procesa el pedido y devuelve una confirmación de pedido.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-116">The legacy system processes the purchase order and sends back a purchase order acknowledgement.</span></span> <span data-ttu-id="8ecc7-117">La operación de envío inicializa un conjunto de correlaciones mediante el número de pedido y la operación de recepción sigue a ese conjunto de correlaciones.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-117">The send operation initializes a correlation set using the purchase order number and the receive operation follows that correlation set.</span></span> <span data-ttu-id="8ecc7-118">La operación de recepción se encuentra también en un ámbito de larga ejecución con un valor de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-118">The receive operation is also in a long running scope with a timeout value.</span></span>  
  
 <span data-ttu-id="8ecc7-119">El motor de orquestaciones deshidratará la instancia de orquestación que espera la recepción.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-119">The orchestration engine will dehydrate the orchestration instance waiting for the receive.</span></span> <span data-ttu-id="8ecc7-120">La correlación asegurará que se invoca la misma instancia de orquestación cuando se recibe el mensaje.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-120">The correlation will ensure that the same orchestration instance is invoked after the message is received.</span></span> <span data-ttu-id="8ecc7-121">Si la confirmación de pedido de compra no llega en el intervalo de tiempo especificado por los valores de tiempo de espera, una **TimeoutException** se iniciará.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-121">If the purchase order acknowledgement does not arrive within the time interval specified by the timeout values, a **TimeoutException** will be thrown.</span></span>  
  
## <a name="scenario-2-using-long-running-transactions-with-custom-compensation"></a><span data-ttu-id="8ecc7-122">Escenario 2: Uso de transacciones de larga ejecución con compensación personalizada</span><span class="sxs-lookup"><span data-stu-id="8ecc7-122">Scenario 2: Using Long Running Transactions with Custom Compensation</span></span>  
 <span data-ttu-id="8ecc7-123">Las siguientes orquestaciones demuestran cómo asociar e invocar compensaciones personalizadas asociadas a orquestaciones completas.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-123">The following orchestrations demonstrate how to associate and invoke custom compensations associated with entire orchestrations.</span></span> <span data-ttu-id="8ecc7-124">Este escenario inserta un cliente nuevo y los detalles del pedido para el cliente.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-124">This scenario inserts a new customer and inserts order details for the customer.</span></span> <span data-ttu-id="8ecc7-125">La lógica de la orquestación indica que si se produce un error en la inserción del pedido, debería deshacer la inserción del cliente.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-125">The logic of the orchestration dictates that if the order insert fails, you should roll back the customer insert.</span></span> <span data-ttu-id="8ecc7-126">La inserción del cliente puede hacerla un sistema heredado y, por lo tanto, mostrarse en una orquestación a la que se puede llamar diferente.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-126">The customer insert could be done by a legacy system, and is therefore, demonstrated in a separate callable orchestration.</span></span> <span data-ttu-id="8ecc7-127">La orquestación de llamada tiene el **personalizado** propiedad establecida de la compensación, que proporciona una hoja independiente para realizar el proceso de compensación.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-127">The called orchestration has the **Custom** property set for compensation, which provides a separate sheet to do the compensation process.</span></span> <span data-ttu-id="8ecc7-128">La compensación consiste en eliminar el cliente que se acaba de insertar.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-128">The compensation is to delete the newly inserted customer.</span></span>  
  
 <span data-ttu-id="8ecc7-129">La orquestación de llamada tiene un ámbito de larga ejecución para realizar la inserción del pedido.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-129">The calling orchestration has a long running scope to do the order insert.</span></span> <span data-ttu-id="8ecc7-130">Este ámbito se anida en un ámbito de larga ejecución externo.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-130">This scope is nested within an outer long running scope.</span></span> <span data-ttu-id="8ecc7-131">El ámbito externo tiene un controlador de excepción asociado para detectar cualquier excepción.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-131">The outer scope has an exception handler associated to catch any exceptions.</span></span> <span data-ttu-id="8ecc7-132">El controlador usa la forma Compensar para invocar la excepción personalizada asociada a la orquestación de llamada y deshacer, de este modo, cualquier cambio que se pueda haber producido en la llamada a la orquestación.</span><span class="sxs-lookup"><span data-stu-id="8ecc7-132">The handler uses the Compensate shape to invoke the custom exception associated with the called orchestration to roll back any changes that might have occurred in the call to the orchestration.</span></span>  
  
 <span data-ttu-id="8ecc7-133">**Transacciones de larga ejecución con compensación personalizada**</span><span class="sxs-lookup"><span data-stu-id="8ecc7-133">**Long running transactions with custom compensation**</span></span>  
  
 <span data-ttu-id="8ecc7-134">![Transacciones de larga ejecución con compensación personalizada](../core/media/bts-trans-orch-fig8.gif "BTS_Trans_Orch_Fig8")</span><span class="sxs-lookup"><span data-stu-id="8ecc7-134">![Long running transactions with custom compensation](../core/media/bts-trans-orch-fig8.gif "BTS_Trans_Orch_Fig8")</span></span>  
  
 <span data-ttu-id="8ecc7-135">**Orquestación llamada (principal)**</span><span class="sxs-lookup"><span data-stu-id="8ecc7-135">**Called orchestration (main)**</span></span>  
  
 <span data-ttu-id="8ecc7-136">![Llamado orquestación &#40; main &#41; ] (../core/media/bts-trans-orch-fig9.gif "BTS_Trans_Orch_Fig9")</span><span class="sxs-lookup"><span data-stu-id="8ecc7-136">![Called orchestration &#40;main&#41;](../core/media/bts-trans-orch-fig9.gif "BTS_Trans_Orch_Fig9")</span></span>  
  
 <span data-ttu-id="8ecc7-137">**Orquestación llamada (compensación)**</span><span class="sxs-lookup"><span data-stu-id="8ecc7-137">**Called orchestration (compensation)**</span></span>  
  
 <span data-ttu-id="8ecc7-138">![Llamado orquestación &#40; compensación &#41; ] (../core/media/bts-trans-orch-fig10.gif "BTS_Trans_Orch_Fig10")</span><span class="sxs-lookup"><span data-stu-id="8ecc7-138">![Called orchestration &#40;compensation&#41;](../core/media/bts-trans-orch-fig10.gif "BTS_Trans_Orch_Fig10")</span></span>