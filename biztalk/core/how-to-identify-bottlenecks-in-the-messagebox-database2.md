---
title: Cómo identificar cuellos de botella en la base de datos2 del cuadro de mensajes | Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 10b2eb1e-541c-457d-9735-ac6fb069b209
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ffc04f31544a48f0ab25338c95beefaf14d5097c
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/27/2018
ms.locfileid: "37010629"
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a><span data-ttu-id="67f57-102">Cómo identificar cuellos de botella en la base de datos de cuadro de mensajes</span><span class="sxs-lookup"><span data-stu-id="67f57-102">How to Identify Bottlenecks in the MessageBox Database</span></span>
<span data-ttu-id="67f57-103">Para identificar cuellos de botella en la base de datos de cuadro de mensajes, en primer lugar debe asegurarse de que se haya iniciado el servicio del Agente de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="67f57-103">To identify bottlenecks in the MessageBox database, first ensure that the SQL-Server-Agent Service is started.</span></span> <span data-ttu-id="67f57-104">Cambie el estado de inicio del servicio de manual a automático, de modo que el servicio se reinicie automáticamente aunque se reinicie el servidor.</span><span class="sxs-lookup"><span data-stu-id="67f57-104">Change the Service startup state from Manual to Auto so that even if the server is restarted, the service will automatically restart.</span></span>  
  
 <span data-ttu-id="67f57-105">De manera predeterminada, el servicio de BizTalk se limita si las tablas Spool, TrackingData o ApplicationQ aumentan de tamaño.</span><span class="sxs-lookup"><span data-stu-id="67f57-105">By default the BizTalk service will throttle if the Spool, TrackingData or ApplicationQ tables grow.</span></span> <span data-ttu-id="67f57-106">Los trabajos del Agente de SQL purgan estas tablas, de manera que, si éste no se ejecuta, la cola de impresión aumentará de tamaño y provocará una limitación para proteger la base de datos contra presiones adicionales.</span><span class="sxs-lookup"><span data-stu-id="67f57-106">These tables are pruned by SQL-Agent jobs, which, if not running will cause the Spool to grow causing throttling to kick in protecting the database from additional pressure.</span></span> <span data-ttu-id="67f57-107">Compruebe el estado de los siguientes contadores de rendimiento:</span><span class="sxs-lookup"><span data-stu-id="67f57-107">Check the status of the following performance counters:</span></span>  
  
- <span data-ttu-id="67f57-108">BizTalk:Agente de mensaje (nombre de host) Estado de limitación de entrega de mensajes</span><span class="sxs-lookup"><span data-stu-id="67f57-108">BizTalk:Message Agent (Host Name) Message Delivery Throttling State</span></span>  
  
- <span data-ttu-id="67f57-109">BizTalk:Agente de mensaje (nombre de host) Estado de limitación de publicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="67f57-109">BizTalk:Message Agent (Host Name) Message Publishing Throttling State</span></span>  
  
  <span data-ttu-id="67f57-110">Un valor de 0 indica que no se está produciendo ninguna limitación.</span><span class="sxs-lookup"><span data-stu-id="67f57-110">A value of 0 indicates no throttling is occurring.</span></span> <span data-ttu-id="67f57-111">El valor 6 indica que el sistema se está limitando a causa del crecimiento de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="67f57-111">A value of 6 is indicative the system is throttling due to database growth.</span></span> <span data-ttu-id="67f57-112">Vea la documentación para obtener información sobre cómo interpretar los demás valores de estos contadores.</span><span class="sxs-lookup"><span data-stu-id="67f57-112">Please refer to the documentation on how to interpret other values of these counters.</span></span>  
  
## <a name="spool-table-growth"></a><span data-ttu-id="67f57-113">Crecimiento de la tabla Spool</span><span class="sxs-lookup"><span data-stu-id="67f57-113">Spool Table Growth</span></span>  
 <span data-ttu-id="67f57-114">La tabla Spool puede empezar a crecer por distintos motivos.</span><span class="sxs-lookup"><span data-stu-id="67f57-114">The Spool can start growing for multiple reasons.</span></span> <span data-ttu-id="67f57-115">Uno de estos motivos es que aumenten de tamaño las colas de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="67f57-115">One reason for Spool growth is if the application queues are growing.</span></span> <span data-ttu-id="67f57-116">Éstas, a su vez, pueden crecer por diversas razones, como cuellos de botella o contención de recursos en niveles inferiores.</span><span class="sxs-lookup"><span data-stu-id="67f57-116">They could grow due to various reasons like downstream bottlenecks and/or resource contention.</span></span>  
  
 <span data-ttu-id="67f57-117">Si las colas de aplicaciones son pequeñas y el tamaño de la tabla Spool se mantiene elevado, compruebe que los trabajos de purga estén funcionando al ritmo preciso.</span><span class="sxs-lookup"><span data-stu-id="67f57-117">If the application queues are small and the Spool is still large, verify that the purge jobs are keeping up.</span></span> <span data-ttu-id="67f57-118">Asegúrese de que el servicio de Agente de SQL Server esté en ejecución y, a continuación, compruebe que los siguientes trabajos se estén realizando correctamente:</span><span class="sxs-lookup"><span data-stu-id="67f57-118">Ensure that the SQL-Agent Service is running and then verify that the following jobs are successfully completing:</span></span>  
  
- <span data-ttu-id="67f57-119">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="67f57-119">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span></span>  
  
- <span data-ttu-id="67f57-120">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="67f57-120">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span></span>  
  
  <span data-ttu-id="67f57-121">Si la tabla MessageZeroSum es grande, indica que los mensajes se han procesado (DeQueue se ha ejecutado correctamente y ha eliminado los datos de las tablas de colas de aplicaciones) y las filas se han marcado para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="67f57-121">If the MessageZeroSum table is large it indicates that the messages have been processed (DeQueue has successfully completed and deleted data from the Application Queue tables) and the rows have been flagged for deletion.</span></span> <span data-ttu-id="67f57-122">Sin embargo, los trabajos de purga no pueden eliminar los datos a la velocidad necesaria.</span><span class="sxs-lookup"><span data-stu-id="67f57-122">However, the purge jobs are unable to keep up with deleting the data.</span></span> <span data-ttu-id="67f57-123">Un motivo de ello puede ser que el equipo de SQL Server esté experimentando una contención grave de la CPU, lo que afecta a la capacidad de los trabajos de purga para funcionar al ritmo apropiado a causa de la privación de la CPU.</span><span class="sxs-lookup"><span data-stu-id="67f57-123">One reason for this is if the SQL-Server machine is experiencing severe CPU contention, impacting the ability of the purge jobs to keep up due to CPU starvation.</span></span>  
  
## <a name="application-queue-table-growth"></a><span data-ttu-id="67f57-124">Crecimiento de la tabla de colas de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="67f57-124">Application Queue Table Growth</span></span>  
 <span data-ttu-id="67f57-125">Las colas de aplicaciones alojan datos de transición en curso que, una vez procesados, son eliminados por DeQueue.</span><span class="sxs-lookup"><span data-stu-id="67f57-125">Application queues host in-flight transition data that, once processed, are cleaned up by DeQueue.</span></span>  
  
 <span data-ttu-id="67f57-126">Después de procesar estos mensajes, se puede borrar el contenido de la tabla Spool (que contiene referencias a estas filas).</span><span class="sxs-lookup"><span data-stu-id="67f57-126">After these messages are processed the Spool (holding references to these rows) can be cleaned.</span></span>  
  
 <span data-ttu-id="67f57-127">Por ejemplo, la cola RxHostQ publica datos en la cola PxHostQ de la orquestación que, a su vez, publica datos en la cola TxHostQ de envío, y cada uno de ellas hace referencia a una fila de la tabla Spool.</span><span class="sxs-lookup"><span data-stu-id="67f57-127">For example, the RxHostQ publishes data to the orchestration PxHostQ which in turn publishes data to the sending TxHostQ each referencing a row in the Spool table.</span></span> <span data-ttu-id="67f57-128">Una vez procesados correctamente los mensajes correspondientes a una cola HostQ concreta a través del sistema, DeQueue elimina estas filas.</span><span class="sxs-lookup"><span data-stu-id="67f57-128">After the messages for a particular HostQ have successfully processed through the system these rows are deleted by DeQueue.</span></span> <span data-ttu-id="67f57-129">Una vez eliminadas las filas, los trabajos de purga pueden borrar el contenido de la tabla Spool (a la que estas filas ya no hacen referencia).</span><span class="sxs-lookup"><span data-stu-id="67f57-129">After these rows are deleted, the Spool (which is no longer referenced by these rows) can then be cleaned by the purge jobs.</span></span>  
  
 <span data-ttu-id="67f57-130">El crecimiento de la cola de aplicaciones ApplicationQ indica que las instancias de host responsables de purgarla no consiguen mantener el ritmo de entrada; es decir, la velocidad a la que se publican los mensajes en una cola de aplicación concreta.</span><span class="sxs-lookup"><span data-stu-id="67f57-130">Application Queue growth indicates that the Host Instances responsible for draining the Application Queue are unable to keep up with the incoming rate, that is, the rate at which messages are being published to the particular application queue.</span></span>  
  
 <span data-ttu-id="67f57-131">Por ejemplo, la cola de aplicación de orquestación (PxHostQ) puede aumentar de tamaño porque el servidor responsable de procesar las orquestaciones está enlazado a la CPU y no puede procesar más rápidamente.</span><span class="sxs-lookup"><span data-stu-id="67f57-131">For example, the orchestration application queue (PxHostQ) may grow because the server responsible for processing orchestrations is CPU bound and unable to process any faster.</span></span> <span data-ttu-id="67f57-132">No obstante, si el servidor de recepción es rápido, podría publicar a más velocidad de la que el servidor es capaz procesar, lo que da como resultado el crecimiento de la cola de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="67f57-132">However, if the receiving server is fast it may publish faster than what the orchestration server can process leading to the application queue growth.</span></span>  
  
 <span data-ttu-id="67f57-133">Otra razón de que aumente el tamaño de la cola de orquestaciones puede ser la contención de memoria, que hace que se creen en la memoria muchas instancias de orquestaciones de larga ejecución, lo que provoca una inundación de la memoria. Esto, indirectamente, hace que la limitación reduzca el grupo de subprocesos hasta que disminuya la presión ejercida sobre la memoria.</span><span class="sxs-lookup"><span data-stu-id="67f57-133">Another reason for orchestration queue growth could be due to memory contention whereby numerous long running orchestration instances are all concurrently instantiated in memory, causing memory bloat indirectly causing throttling to shrink the thread pool until memory pressure is relieved.</span></span> <span data-ttu-id="67f57-134">Una razón por la que puede crecer la cola de aplicaciones de envío es que el sistema de nivel inferior no pueda recibir mensajes (de salida desde BizTalk) con la suficiente rapidez.</span><span class="sxs-lookup"><span data-stu-id="67f57-134">One reason why the send application queue may grow is if the downstream system is unable to receive (outgoing from BizTalk) messages fast enough.</span></span> <span data-ttu-id="67f57-135">En este caso, los mensajes siguen residiendo en el sistema de BizTalk, lo que provoca el crecimiento de la cola de aplicaciones. Esto, en definitiva, provocará una limitación que, a su vez, dará lugar a una reducción de la velocidad de recepción que afectará al rendimiento global del sistema.</span><span class="sxs-lookup"><span data-stu-id="67f57-135">Thus the messages will continue to reside within the BizTalk system causing Application queue growth which will ultimately cause throttling to kick in reducing the receiving rate impacting the overall throughput of the system.</span></span>  
  
## <a name="trackingdata-table-growth"></a><span data-ttu-id="67f57-136">Crecimiento de la tabla TrackingData</span><span class="sxs-lookup"><span data-stu-id="67f57-136">TrackingData Table Growth</span></span>  
 <span data-ttu-id="67f57-137">La tabla TrackingData de la base de datos de cuadro de mensajes es una tabla de transición en la que los interceptores escriben datos de seguimiento para el seguimiento de instancias de mensajes y servicios, y el seguimiento de BAM.</span><span class="sxs-lookup"><span data-stu-id="67f57-137">The TrackingData table in the MessageBox database is a transition table into which interceptors write tracking data for both message and service instance tracking and BAM tracking.</span></span> <span data-ttu-id="67f57-138">Si el seguimiento está deshabilitado, esta tabla debe estar vacía.</span><span class="sxs-lookup"><span data-stu-id="67f57-138">If tracking is disabled, this table should be empty.</span></span> <span data-ttu-id="67f57-139">De manera predeterminada, el seguimiento de instancias de mensajes y servicios está habilitado para los eventos de entrada y salida de las canalizaciones y orquestaciones.</span><span class="sxs-lookup"><span data-stu-id="67f57-139">By default message and service instance tracking is enabled for the pipelines and orchestrations In/Out events.</span></span>  
  
 <span data-ttu-id="67f57-140">Si está habilitado el seguimiento de partes de mensaje, asegúrese de que esté en ejecución el servidor del cuadro de mensajes (es decir, el host donde se activó "Permitir seguimiento de host").</span><span class="sxs-lookup"><span data-stu-id="67f57-140">If Message Body Tracking is enabled, ensure that the MessageBox server (that is, the host with "allow host tracking") is running.</span></span> <span data-ttu-id="67f57-141">Reducirá el cuello de botella, ya que transfiere datos de la tabla TrackingData de la base de datos de cuadro de mensajes a las tablas BizTalkDTADb.</span><span class="sxs-lookup"><span data-stu-id="67f57-141">It will reduce a bottleneck as it moves data from TrackingData table in the MessageBox database to the BizTalkDTADb tables.</span></span>  
  
 <span data-ttu-id="67f57-142">Es posible realizar el seguimiento de los eventos personalizados si se habilita el seguimiento de instancias de mensajes y servicios, por ejemplo, en las propiedades promocionadas y el seguimiento de partes de mensaje.</span><span class="sxs-lookup"><span data-stu-id="67f57-142">It is possible to track custom events by enabling custom message and service instance  tracking, for example, on promoted properties and message body tracking.</span></span> <span data-ttu-id="67f57-143">Además de los datos de seguimiento, en esta tabla también se escriben los datos de BAM.</span><span class="sxs-lookup"><span data-stu-id="67f57-143">In addition to tracking data, BAM data is also written to this table.</span></span> <span data-ttu-id="67f57-144">Es responsabilidad de TDDS (el host en que está habilitado el seguimiento) transferir estos datos de la base de datos de cuadro de mensajes a las bases de datos BizTalkDTADb y BAMPrimaryImport, y, una vez transferidos correctamente, eliminarlos.</span><span class="sxs-lookup"><span data-stu-id="67f57-144">It is the responsibility of TDDS (the host on which tracking is enabled) to move this data from the MessageBox database to the BizTalkDTADb and BAMPrimaryImport databases, and then once successfully moved, delete this data.</span></span> <span data-ttu-id="67f57-145">Los datos de seguimiento de partes de mensaje los mueve por separado el trabajo TrackedMessages_Copy_BizTalkMsgBoxDb del Agente de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="67f57-145">Message body tracking data is moved separately by a SQL-Agent job TrackedMessages_Copy_BizTalkMsgBoxDb.</span></span>  
  
 <span data-ttu-id="67f57-146">Si TDDS no puede mantener el ritmo al que los interceptores escriben datos en la tabla TrackingData, esta tabla crece y provoca una limitación, lo que en definitiva afecta al rendimiento sostenible.</span><span class="sxs-lookup"><span data-stu-id="67f57-146">If TDDS is unable to keep up with the rate at which the interceptors are writing data to the TrackingData table, this table will grow, causing throttling to kick in, ultimately impacting sustainable throughput.</span></span> <span data-ttu-id="67f57-147">Para aliviar este problema, asegúrese de que haya al menos 1 host en ejecución con el seguimiento habilitado.</span><span class="sxs-lookup"><span data-stu-id="67f57-147">To alleviate this problem, ensure that at least 1 host is running with tracking enabled.</span></span>  
  
 <span data-ttu-id="67f57-148">Si los datos siguen acumulándose, compruebe la base de datos BizTalkDTADb para asegurarse de que no crezca sin control.</span><span class="sxs-lookup"><span data-stu-id="67f57-148">If the data still builds up, verify the BizTalkDTADb database to ensure that the database is not growing out of control.</span></span> <span data-ttu-id="67f57-149">Asegúrese asimismo de que se esté ejecutando el trabajo de archivo y purga, y de consigue hacerlo a la velocidad a la que llegan los datos.</span><span class="sxs-lookup"><span data-stu-id="67f57-149">Ensure that the archiving and purging job is running and is able to keep up with the rate at which data is arriving.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="67f57-150">El trabajo de purga no puede eliminar datos de las tablas de BizTalkDTADb hasta que éstos se han archivado.</span><span class="sxs-lookup"><span data-stu-id="67f57-150">The purge job is unable to delete data from the BizTalkDTADb tables until this data has been archived.</span></span>  
  
 <span data-ttu-id="67f57-151">Compruebe que la tabla TrackingData no crece.</span><span class="sxs-lookup"><span data-stu-id="67f57-151">Verify that the TrackingData table is not growing.</span></span> <span data-ttu-id="67f57-152">Asegúrese de que el seguimiento esté habilitado (TDDS) al menos en una instancia de host que esté en ejecución.</span><span class="sxs-lookup"><span data-stu-id="67f57-152">Ensure that at least 1 host instance that is running has tracking enabled (TDDS).</span></span> <span data-ttu-id="67f57-153">Si el tamaño de la base de datos BizTalkDTADb es excesivo, puede afectar de manera negativa a la capacidad de TDDS para transferir los datos desde la base de datos de cuadro de mensajes a la base de datos BizTalkDTADb.</span><span class="sxs-lookup"><span data-stu-id="67f57-153">If the BizTalkDTADb database has grown too large, it can have a negative impact on the ability of TDDS to move data from the MessageBox database to the BizTalkDTADb database.</span></span>  
  
 <span data-ttu-id="67f57-154">El crecimiento de la tabla TrackingData puede provocar una limitación, lo que afectará al rendimiento sostenible en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="67f57-154">Growth in the TrackingData table can cause throttling to kick in, impacting sustainable runtime throughput.</span></span>