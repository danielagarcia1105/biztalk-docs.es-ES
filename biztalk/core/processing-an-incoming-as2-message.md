---
title: Procesar un mensaje AS2 entrante | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 998ff334-71e2-4686-b2b7-44940a0ebed1
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b221ea3697180c27e347250570b0e96105a50f08
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="processing-an-incoming-as2-message"></a><span data-ttu-id="d2997-102">Procesar un mensaje AS2 entrante</span><span class="sxs-lookup"><span data-stu-id="d2997-102">Processing an Incoming AS2 Message</span></span>
<span data-ttu-id="d2997-103">La canalización de recepción AS2 procesa un mensaje entrante a través de AS2.</span><span class="sxs-lookup"><span data-stu-id="d2997-103">The AS2 receive pipelines process an incoming message over AS2.</span></span> <span data-ttu-id="d2997-104">La canalización de recepción AS2EdiReceive procesa un mensaje con codificación EDI mediante el Desensamblador EDI.</span><span class="sxs-lookup"><span data-stu-id="d2997-104">The AS2EdiReceive receive pipeline processes an EDI-encoded message, using the EDI Disassembler.</span></span> <span data-ttu-id="d2997-105">La canalización de recepción AS2Receive procesa un mensaje sin codificación EDI mediante el Desensamblador de AS2.</span><span class="sxs-lookup"><span data-stu-id="d2997-105">The AS2Receive receive pipeline processes a non-EDI-encoded message, using the AS2 Disassembler.</span></span> <span data-ttu-id="d2997-106">Las dos canalizaciones procesan la carga del mensaje AS2 y generan un MDN de forma distinta; sin embargo, ambas canalizaciones de recepción utilizan el descodificador AS2 para procesar el mensaje AS2.</span><span class="sxs-lookup"><span data-stu-id="d2997-106">The two pipelines process the payload of the AS2 message and generate an MDN differently; however, both receive pipelines use the AS2 Decoder to process the AS2 message.</span></span>  
  
 <span data-ttu-id="d2997-107">Si AS2EdiReceivePipeline procesa un mensaje AS2 con una carga EDI, completa el procesamiento de AS2 del mensaje recibido antes de llevar a cabo el procesamiento de EDI.</span><span class="sxs-lookup"><span data-stu-id="d2997-107">When the AS2EdiReceivePipeline processes an AS2 message with an EDI payload, it completes the AS2 processing of the received message before performing the EDI processing.</span></span> <span data-ttu-id="d2997-108">Cuando la canalización genera una confirmación de EDI para la carga EDI de un mensaje AS2, debe devolver la confirmación de EDI de forma asíncrona porque la respuesta de AS2 cierra la conexión.</span><span class="sxs-lookup"><span data-stu-id="d2997-108">When the pipeline generates an EDI acknowledgment for the EDI payload of an AS2 message, it must return the EDI acknowledgment asynchronously, because the connection is closed by the AS2 response.</span></span>  
  
## <a name="the-receive-port"></a><span data-ttu-id="d2997-109">El puerto de recepción</span><span class="sxs-lookup"><span data-stu-id="d2997-109">The Receive Port</span></span>  
 <span data-ttu-id="d2997-110">Se usa un puerto de recepción HTTP para recibir un mensaje AS2 con una carga EDI o que no sea EDI.</span><span class="sxs-lookup"><span data-stu-id="d2997-110">An HTTP receive port is used to receive an AS2 message with an EDI or non-EDI payload.</span></span> <span data-ttu-id="d2997-111">Si el MDN se va a devolver de forma sincrónica, el puerto de recepción debe ser un puerto de recepción de solicitud-respuesta.</span><span class="sxs-lookup"><span data-stu-id="d2997-111">If an MDN must be returned synchronously, then the receive port must be a request-response port.</span></span>  
  
 <span data-ttu-id="d2997-112">Un MDN puede devolverse de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="d2997-112">An MDN can be returned synchronously or asynchronously.</span></span> <span data-ttu-id="d2997-113">Esto viene determinado por el encabezado Disposition-notification-to del mensaje AS2, a menos que la **usar la configuración de acuerdo para validación y MDN en lugar del encabezado de mensaje** propiedad está seleccionada en la ficha de acuerdo AS2 unidireccional del  **Propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="d2997-113">This is determined by the Disposition-notification-to header of the AS2 message, unless the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="d2997-114">Si la propiedad está seleccionada, la forma en que se devuelve el MDN se determina por la **solicitar MDN asíncrono** propiedad en el **configuración de MDN de remitente** página de la ficha de acuerdo AS2 unidireccional de la  **Propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="d2997-114">If the property is selected, the way the MDN is returned is determined by the **Request asynchronous MDN** property in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="d2997-115">Para obtener más información, consulte [mensajes AS2](../core/as2-messages.md) y [mensajes MDN](../core/mdn-messages.md).</span><span class="sxs-lookup"><span data-stu-id="d2997-115">For more information, see [AS2 Messages](../core/as2-messages.md) and [MDN Messages](../core/mdn-messages.md).</span></span>  
  
 <span data-ttu-id="d2997-116">Si el MDN se devuelve de forma sincrónica, el MDN se devolverá a través del puerto de envío de la ubicación de recepción bidireccional.</span><span class="sxs-lookup"><span data-stu-id="d2997-116">If the MDN will be returned synchronously, the MDN is returned over the send port of the two-way receive location.</span></span> <span data-ttu-id="d2997-117">Este MDN sirve como respuesta HTTP, por ejemplo, un valor 200OK que indica una recepción correcta del mensaje.</span><span class="sxs-lookup"><span data-stu-id="d2997-117">This MDN serves as the HTTP response, for example, a 200OK indicating successful reception of the message.</span></span>  
  
 <span data-ttu-id="d2997-118">Si el MDN se va a devolver de forma asíncrona, deberá hacerse a través de un puerto de envío independiente.</span><span class="sxs-lookup"><span data-stu-id="d2997-118">If the MDN will be returned asynchronously, the MDN must be returned over a separate send port.</span></span> <span data-ttu-id="d2997-119">Si se usa un puerto de envío dinámico, el MDN se enviará a la dirección incluida en el encabezado Disposition-notification-to.</span><span class="sxs-lookup"><span data-stu-id="d2997-119">If a dynamic send port is used, the MDN will be sent to the address contained in Disposition-notification-to header.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d2997-120">El puerto de recepción bidireccional que se va a utilizar para recibir mensajes AS2 no debe utilizarse para recibir mensajes MDN.</span><span class="sxs-lookup"><span data-stu-id="d2997-120">The two-way receive port used to receive AS2 messages should not be used to receive MDN messages.</span></span> <span data-ttu-id="d2997-121">Los mensajes MDN deben recibirse en un puerto de recepción unidireccional.</span><span class="sxs-lookup"><span data-stu-id="d2997-121">MDN messages should be received on a static one-way receive port.</span></span> <span data-ttu-id="d2997-122">El empleo de un puerto de recepción de solicitud-respuesta para un MDN devuelto de forma asíncrona evitaría que un mensaje 200OK se devolviese en respuesta al MDN entrante, lo que generaría reintentos innecesarios de la transmisión MDN.</span><span class="sxs-lookup"><span data-stu-id="d2997-122">Using a request/response receive port for an MDN returned asynchronously would prevent a 200OK message from being returned in response to the incoming MDN, thereby causing unnecessary retries of the MDN transmission.</span></span>  
  
## <a name="how-the-as2-receive-pipelines-work"></a><span data-ttu-id="d2997-123">Cómo funcionan las canalizaciones de recepción de AS2</span><span class="sxs-lookup"><span data-stu-id="d2997-123">How the AS2 Receive Pipelines Work</span></span>  
 <span data-ttu-id="d2997-124">Los pasos que usan las canalizaciones de recepción de AS2 en el procesamiento de un mensaje entrante de AS2 son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="d2997-124">The steps that the AS2 receive pipelines performs in processing an incoming AS2 message are as follows:</span></span>  
  
-   <span data-ttu-id="d2997-125">Determina la entidad remitente mediante la correspondencia de AS2-de valor en el encabezado de AS2 del mensaje con el valor para AS2-de lista en la **identificadores** página de la ficha de acuerdo AS2 unidireccional de la **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="d2997-125">Determines the sending party by matching the AS2-From value in the AS2 header of the message with the value for AS2-From list in the **Identifiers** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="d2997-126">Si ese proceso no se lleva a cabo correctamente, intenta determinar la entidad de envío haciendo coincidir la propiedad de contexto AS2-From que se haya establecido para el mensaje entrante con el nombre de una entidad.</span><span class="sxs-lookup"><span data-stu-id="d2997-126">If that fails, attempts to determine the sending party by matching the AS2-From context property that is set for the incoming message with the name of a party.</span></span> <span data-ttu-id="d2997-127">Si se encuentra una coincidencia y el **usar la configuración de acuerdo para validación y MDN en lugar del encabezado de mensaje** propiedad está seleccionada en la ficha de acuerdo AS2 unidireccional de la **propiedades del acuerdo de** cuadro de diálogo, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] usará las propiedades de AS2 asociadas con el acuerdo para la entidad para procesar el mensaje AS2.</span><span class="sxs-lookup"><span data-stu-id="d2997-127">If a match is found, and the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will use the AS2 properties associated with the agreement for the party for processing the AS2 message.</span></span> <span data-ttu-id="d2997-128">Si la propiedad no está seleccionada, la canalización de recepción utilizará las etiquetas del encabezado de AS2 en el mensaje entrante.</span><span class="sxs-lookup"><span data-stu-id="d2997-128">If the property is not selected, the receive pipeline will use the AS2 header tags in the incoming message.</span></span> <span data-ttu-id="d2997-129">Si no se encuentra el acuerdo, la canalización anula el procesamiento, suspende el mensaje y genera una excepción.</span><span class="sxs-lookup"><span data-stu-id="d2997-129">If the agreement is not found, the pipeline aborts processing, suspends the message, and raises an exception.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d2997-130">El **usar la configuración de acuerdo para validación y MDN en lugar del encabezado de mensaje** propiedad le permite validar que un mensaje entrante tiene propiedades de firma, cifrado y compresión (si las propiedades se especifican en el acuerdo en el **validación** ficha del acuerdo unidireccional) y si no es así, suspender el mensaje y generar un error.</span><span class="sxs-lookup"><span data-stu-id="d2997-130">The **Use agreement settings for validation and MDN instead of message header** property allows you to validate that an incoming message has signing, encryption, and compression properties (if those properties are specified in the agreement in the **Validation** tab of the one-way agreement), and if not, to suspend the message and post an error.</span></span> <span data-ttu-id="d2997-131">Estos cambios deben negociarse con el acuerdo para la entidad remitente.</span><span class="sxs-lookup"><span data-stu-id="d2997-131">These changes must be negotiated with the agreement for the sending party.</span></span> <span data-ttu-id="d2997-132">Para obtener más información, consulte [configurar propiedades de AS2](../core/configuring-as2-properties.md).</span><span class="sxs-lookup"><span data-stu-id="d2997-132">For more information see [Configuring AS2 Properties](../core/configuring-as2-properties.md).</span></span>  
  
-   <span data-ttu-id="d2997-133">Si el acuerdo para la entidad remitente se ha determinado, pero se genera un error cuando la canalización de recepción intenta procesar el mensaje AS2, la canalización definirá la propiedad de contexto MessageDestination en el mensaje AS2 como SuspendQueue.</span><span class="sxs-lookup"><span data-stu-id="d2997-133">If the agreement for the sending party is determined, but an error arises when the receive pipeline attempts to process the AS2 message, the pipeline will set the context property MessageDestination on the AS2 message to SuspendQueue.</span></span> <span data-ttu-id="d2997-134">La canalización de recepción suspenderá el mensaje en el cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="d2997-134">The receive pipeline will then suspend the message in the MessageBox.</span></span> <span data-ttu-id="d2997-135">La canalización de recepción también definirá la propiedad de contexto `EdiIntAS.IsAS2FailedMessage` como True.</span><span class="sxs-lookup"><span data-stu-id="d2997-135">The receive pipeline will also set the `EdiIntAS.IsAS2FailedMessage` context property to True.</span></span> <span data-ttu-id="d2997-136">Si se habilita un MDN estableciendo **solicitar MDN** en el **configuración de MDN de remitente** página de la ficha de acuerdo AS2 unidireccional de la **propiedades del acuerdo** le de cuadro de diálogo, la canalización a continuación, devolver el MDN adecuado al remitente.</span><span class="sxs-lookup"><span data-stu-id="d2997-136">If an MDN is enabled by setting **Request MDN** in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box, the pipeline will then return the appropriate MDN to the sender.</span></span> <span data-ttu-id="d2997-137">La canalización siempre intentará devolver un MDN si se solicita.</span><span class="sxs-lookup"><span data-stu-id="d2997-137">The pipeline will always attempt to return an MDN if it is requested.</span></span>  
  
-   <span data-ttu-id="d2997-138">Determina si el mensaje es un duplicado, si la **comprobar mensajes duplicados dentro de** opción está seleccionada en el **validación** página de la ficha de acuerdo AS2 unidireccional de la **acuerdo Propiedades** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="d2997-138">Determines if the message is a duplicate, if the **Check for duplicate messages within** option is selected in the **Validation** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="d2997-139">La detección de mensajes duplicados se lleva a cabo haciendo coincidir los valores AS2-From, AS2-To y Message-ID del mensaje entrante con los valores existentes en los mensajes recibidos con anterioridad.</span><span class="sxs-lookup"><span data-stu-id="d2997-139">Duplicate message detection is accomplished by matching the AS2-From, AS2-To, and Message-ID values on the inbound message to values on messages previously received.</span></span> <span data-ttu-id="d2997-140">Si coinciden los tres valores, la canalización de recepción establecerá el valor de la propiedad de contexto `EdiIntAs.IsAS2MessageDuplicate` en true.</span><span class="sxs-lookup"><span data-stu-id="d2997-140">If all three values match, the receive pipeline will set the value of the `EdiIntAs.IsAS2MessageDuplicate` context property to true.</span></span> <span data-ttu-id="d2997-141">Si el **suspender mensajes duplicados** también se selecciona la opción en la **validación** página, se suspenderá el mensaje y registra un error.</span><span class="sxs-lookup"><span data-stu-id="d2997-141">If the **Suspend duplicate messages** option is also selected on the **Validation** page, the message will be suspended and an error logged.</span></span>  
  
-   <span data-ttu-id="d2997-142">Recupera el nombre de archivo, si lo hubiera, de cada archivo de datos adjuntos y lo promueve en las propiedades de contexto.</span><span class="sxs-lookup"><span data-stu-id="d2997-142">Retrieves the file name, if any, of each attachment and promotes this to the context properties.</span></span>  
  
-   <span data-ttu-id="d2997-143">Realiza una copia del mensaje (en su formato correspondiente) y la almacena en la base de datos de recepción sin repudio, si esta opción está habilitada en las propiedades de acuerdo AS2 unidireccional.</span><span class="sxs-lookup"><span data-stu-id="d2997-143">Makes a copy of the message (in wire format), and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="d2997-144">Lleva a cabo el procesamiento MIME, que incluye la comprobación de la firma y el descifrado del mensaje (basándose en las etiquetas del encabezado).</span><span class="sxs-lookup"><span data-stu-id="d2997-144">Performs MIME processing, including verifying the signature and decrypting the message (based upon the header tags).</span></span>  
  
-   <span data-ttu-id="d2997-145">Descomprime el mensaje recibido si estaba comprimido.</span><span class="sxs-lookup"><span data-stu-id="d2997-145">Decompresses the received message, if it was compressed.</span></span>  
  
-   <span data-ttu-id="d2997-146">Genera una respuesta HTTP anexa al MDN en modo de solicitud-respuesta sincrónico, o enviada como respuesta independiente en modo asíncrono.</span><span class="sxs-lookup"><span data-stu-id="d2997-146">Generates an HTTP response, appended to the MDN in synchronous request-response mode, or sent as a standalone response in asynchronous mode.</span></span>  
  
-   <span data-ttu-id="d2997-147">Genera una respuesta MDN si se solicita.</span><span class="sxs-lookup"><span data-stu-id="d2997-147">Generates an MDN response, if requested.</span></span> <span data-ttu-id="d2997-148">La canalización generará un MDN basándose en las propiedades del acuerdo, si la **usar la configuración de acuerdo para validación y MDN en lugar del encabezado de mensaje** propiedad está establecida, o de propiedades de contexto, si no se establece esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="d2997-148">The pipeline will generate an MDN based upon agreement properties, if the **Use agreement settings for validation and MDN instead of message header** property is set, or from context properties, if that property is not set.</span></span> <span data-ttu-id="d2997-149">Si los parámetros de configuración y los encabezados en el mensaje entrante son incoherentes, la canalización generará un MDN negativo.</span><span class="sxs-lookup"><span data-stu-id="d2997-149">If the configuration settings and the headers in the incoming message are inconsistent, the pipeline will generate a negative MDN.</span></span>  
  
-   <span data-ttu-id="d2997-150">El Desensamblador EDI de la canalización de recepción AS2EdiReceive genera una confirmación de EDI si el mensaje tenía codificación EDI y se había habilitado una confirmación.</span><span class="sxs-lookup"><span data-stu-id="d2997-150">The EDI Disassembler in the AS2EdiReceive receive pipeline generates an EDI acknowledgment, if the message was EDI-encoded and an acknowledgment was enabled.</span></span> <span data-ttu-id="d2997-151">La canalización enrutará la confirmación de EDI al cuadro de mensajes, desde donde un puerto de envío dinámico la seleccionará o la enviará de forma asíncrona.</span><span class="sxs-lookup"><span data-stu-id="d2997-151">The pipeline will route the EDI acknowledgment to the MessageBox, from which a dynamic send port will pick it up and send it out asynchronously.</span></span> <span data-ttu-id="d2997-152">Las confirmaciones de EDI siempre se envían de forma asíncrona a través del transporte AS2 porque tanto las respuestas de MDN como de HTTP se envían de forma sincrónica.</span><span class="sxs-lookup"><span data-stu-id="d2997-152">EDI acknowledgments are always sent out asynchronously over AS2 transport, because either an MDN or an HTTP response is sent out synchronously.</span></span>  
  
-   <span data-ttu-id="d2997-153">Realiza una copia del MDN y la almacena en la base de datos de recepción sin repudio, si esta opción está habilitada en las propiedades de acuerdo AS2 unidireccional.</span><span class="sxs-lookup"><span data-stu-id="d2997-153">Makes a copy of the MDN, and stores it in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="d2997-154">Realiza una copia del mensaje descodificado y la almacena en la base de datos de recepción sin repudio, si esta opción está habilitada en las propiedades de acuerdo AS2 unidireccional.</span><span class="sxs-lookup"><span data-stu-id="d2997-154">Makes a copy of the decoded message, and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
 <span data-ttu-id="d2997-155">Si se produce un error de AS2, no se llevará a cabo más procesamiento en el mensaje recibido.</span><span class="sxs-lookup"><span data-stu-id="d2997-155">If an AS2 error occurs, no further processing will occur on the received message.</span></span> <span data-ttu-id="d2997-156">Sin embargo, la canalización de recepción generará una respuesta de MDN.</span><span class="sxs-lookup"><span data-stu-id="d2997-156">However, the receive pipeline will still generate an MDN response.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d2997-157">Vea también</span><span class="sxs-lookup"><span data-stu-id="d2997-157">See Also</span></span>  
 <span data-ttu-id="d2997-158">[Cómo BizTalk Server recibe mensajes AS2](../core/how-biztalk-server-receives-as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="d2997-158">[How BizTalk Server Receives AS2 Messages](../core/how-biztalk-server-receives-as2-messages.md) </span></span>  
 <span data-ttu-id="d2997-159">[Mensajes de AS2](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="d2997-159">[AS2 Messages](../core/as2-messages.md) </span></span>  
 [<span data-ttu-id="d2997-160">Mensajes MDN</span><span class="sxs-lookup"><span data-stu-id="d2997-160">MDN Messages</span></span>](../core/mdn-messages.md)