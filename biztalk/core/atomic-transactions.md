---
title: "Las transacciones atómicas | Documentos de Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- atomic transactions
- scopes, examples
- transactions, orchestrations
- orchestrations, transactions
- transactions, isolation levels
- transactions, ACID concept
- transactions, examples
- transactions, atomic
- scopes, transactions
- scopes
ms.assetid: 5030e1fd-943f-42bc-9296-4f315bd5f733
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bc07f379c1f7aa1c846b2c20c19cbfb3393e8174
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="atomic-transactions"></a><span data-ttu-id="f259c-102">Transacciones atómicas</span><span class="sxs-lookup"><span data-stu-id="f259c-102">Atomic Transactions</span></span>
<span data-ttu-id="f259c-103">Las orquestaciones de BizTalk pueden diseñarse para ejecutar elementos discretos de trabajo, siguiendo el clásico concepto "ACID" de una transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-103">BizTalk orchestrations can be designed to run discrete pieces of work, following the classic 'ACID' concept of a transaction.</span></span> <span data-ttu-id="f259c-104">Estas unidades discretas o atómicas de trabajo, cuando se ejecutan, llevan el proceso empresarial de un estado coherente a un estado nuevo, coherente y duradero que se aísla de otras unidades de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f259c-104">These discrete or atomic units of work, when performed, move the business process from one consistent state to a new, consistent and durable state that is isolated from other units of work.</span></span> <span data-ttu-id="f259c-105">Esto normalmente se realiza mediante la **ámbito** construcción que encapsula las unidades de trabajo con la semántica transaccional.</span><span class="sxs-lookup"><span data-stu-id="f259c-105">This is typically done by using the **Scope** construct that encapsulates the units of work with the transactional semantics.</span></span> <span data-ttu-id="f259c-106">También se puede definir la orquestación completa como una transacción atómica sin el uso de ámbitos.</span><span class="sxs-lookup"><span data-stu-id="f259c-106">The entire orchestration can also be defined as an atomic transaction without the use of scopes.</span></span> <span data-ttu-id="f259c-107">No obstante, los ámbitos no pueden marcarse como transaccionales a menos que la propia orquestación se marque como transacción atómica o de larga duración.</span><span class="sxs-lookup"><span data-stu-id="f259c-107">The scopes, however, cannot be marked as transactional unless the orchestration itself is marked as a long running or atomic transaction type.</span></span> <span data-ttu-id="f259c-108">Las transacciones atómicas garantizan que todas las actualizaciones parciales se revertirán automáticamente si se produce un error durante la actualización de la transacción, y los efectos de la transacción se borrarán (excepto los efectos de cualquier llamada .NET que se haga en la transacción).</span><span class="sxs-lookup"><span data-stu-id="f259c-108">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span> <span data-ttu-id="f259c-109">Las transacciones atómicas en orquestaciones de BizTalk se parecen a las transacciones del coordinador de transacciones distribuidas (DTC) en que suelen ser de corta duración y tener los cuatro atributos "ACID" (atomicidad, coherencia, aislamiento y durabilidad):</span><span class="sxs-lookup"><span data-stu-id="f259c-109">Atomic transactions in BizTalk orchestrations are similar to distributed transaction coordinator (DTC) transactions in that they are generally short-lived and have the four "ACID" attributes (atomicity, consistency, isolation, and durability):</span></span>  
  
-   <span data-ttu-id="f259c-110">**Atomicidad**</span><span class="sxs-lookup"><span data-stu-id="f259c-110">**Atomicity**</span></span>  
  
     <span data-ttu-id="f259c-111">Una transacción representa una unidad atómica de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f259c-111">A transaction represents an atomic unit of work.</span></span> <span data-ttu-id="f259c-112">En una transacción se realizan todas las modificaciones o ninguna de ellas.</span><span class="sxs-lookup"><span data-stu-id="f259c-112">Either all modifications within a transaction are performed, or none of the modifications are performed.</span></span>  
  
-   <span data-ttu-id="f259c-113">**Coherencia**</span><span class="sxs-lookup"><span data-stu-id="f259c-113">**Consistency**</span></span>  
  
     <span data-ttu-id="f259c-114">Cuando se confirma, una transacción debe preservar la integridad de los datos dentro del sistema.</span><span class="sxs-lookup"><span data-stu-id="f259c-114">When committed, a transaction must preserve the integrity of the data within the system.</span></span> <span data-ttu-id="f259c-115">Si una transacción realiza una modificación de datos en una base de datos que era coherente internamente antes de que se iniciase la transacción, debe seguir siéndolo una vez confirmada ésta.</span><span class="sxs-lookup"><span data-stu-id="f259c-115">If a transaction performs a data modification on a database that was internally consistent before the transaction started, the database must still be internally consistent when the transaction is committed.</span></span> <span data-ttu-id="f259c-116">El programador de la aplicación es el principal responsable de garantizar esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="f259c-116">Ensuring this property is largely the responsibility of the application developer.</span></span>  
  
-   <span data-ttu-id="f259c-117">**Aislamiento**</span><span class="sxs-lookup"><span data-stu-id="f259c-117">**Isolation**</span></span>  
  
     <span data-ttu-id="f259c-118">Las modificaciones realizadas por transacciones simultáneas se deben aisladas de las modificaciones realizadas por otras transacciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="f259c-118">Modifications made by concurrent transactions must be isolated from the modifications made by other concurrent transactions.</span></span> <span data-ttu-id="f259c-119">Las transacciones aisladas que se ejecutan simultáneamente realizan modificaciones que conservan la coherencia interna de la base de datos, del mismo modo que si se tratara de transacciones ejecutadas en serie.</span><span class="sxs-lookup"><span data-stu-id="f259c-119">Isolated transactions that run concurrently perform modifications that preserve internal database consistency exactly as they would if the transactions were run serially.</span></span>  
  
-   <span data-ttu-id="f259c-120">**Durabilidad**</span><span class="sxs-lookup"><span data-stu-id="f259c-120">**Durability**</span></span>  
  
     <span data-ttu-id="f259c-121">Una vez confirmada una transacción, todas las modificaciones permanecen en el sistema de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f259c-121">After a transaction is committed, all modifications are permanently in place in the system by default.</span></span> <span data-ttu-id="f259c-122">Las modificaciones persisten aunque se produzca un error del sistema.</span><span class="sxs-lookup"><span data-stu-id="f259c-122">The modifications persist even if a system failure occurs.</span></span>  
  
 <span data-ttu-id="f259c-123">Las transacciones atómicas utilizadas en orquestaciones de BizTalk admiten los siguientes niveles de aislamiento:</span><span class="sxs-lookup"><span data-stu-id="f259c-123">The following isolation levels are supported by the atomic transactions used in BizTalk Orchestrations:</span></span>  
  
-   <span data-ttu-id="f259c-124">**Lectura confirmada**</span><span class="sxs-lookup"><span data-stu-id="f259c-124">**Read Committed**</span></span>  
  
     <span data-ttu-id="f259c-125">Los bloqueos compartidos se mantienen durante la lectura de los datos para evitar lecturas no actualizadas, pero los datos pueden cambiarse antes del fin de la transacción, lo que daría lugar a lecturas no repetibles o a datos ficticios.</span><span class="sxs-lookup"><span data-stu-id="f259c-125">Shared locks are held while the data is being read to avoid dirty reads, but the data can be changed before the end of the transaction, resulting in non-repeatable reads or phantom data.</span></span>  
  
-   <span data-ttu-id="f259c-126">**Lectura repetible**</span><span class="sxs-lookup"><span data-stu-id="f259c-126">**Repeatable Read**</span></span>  
  
     <span data-ttu-id="f259c-127">Se colocan bloqueos en todos los datos utilizados en una consulta, lo que impide que otros usuarios actualicen los datos.</span><span class="sxs-lookup"><span data-stu-id="f259c-127">Locks are placed on all data that is used in a query, preventing other users from updating the data.</span></span> <span data-ttu-id="f259c-128">De este modo, se evitan lecturas no repetibles, pero todavía pueden aparecer filas ficticias.</span><span class="sxs-lookup"><span data-stu-id="f259c-128">This prevents non-repeatable reads, but phantom rows are still possible.</span></span>  
  
-   <span data-ttu-id="f259c-129">**Serializable**</span><span class="sxs-lookup"><span data-stu-id="f259c-129">**Serializable**</span></span>  
  
     <span data-ttu-id="f259c-130">Se coloca un bloqueo de intervalo que impide que otros usuarios actualicen o inserten filas en la base de datos hasta que no se complete la transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-130">A range lock is placed preventing other users from updating or inserting rows into the database until the transaction is complete.</span></span>  
  
 <span data-ttu-id="f259c-131">BizTalk Server garantiza que el estado cambia en una transacción atómica, como las modificaciones a las variables, mensajes y objetos, son visibles fuera del ámbito de la transacción atómica únicamente al confirmarse la transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-131">BizTalk Server ensures that state changes within an atomic transaction—such as modifications to variables, messages, and objects—are visible outside the scope of the atomic transaction only upon commitment of the transaction.</span></span> <span data-ttu-id="f259c-132">Los cambios de estado intermedios se aíslan de otras partes de una orquestación.</span><span class="sxs-lookup"><span data-stu-id="f259c-132">The intermediate state changes are isolated from other parts of an orchestration.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f259c-133">Si una transacción atómica contiene una **recepción** forma, un **enviar** forma, o un **Iniciar orquestación** forma, las acciones correspondientes no llevará a cabo hasta que el transacción se ha confirmado.</span><span class="sxs-lookup"><span data-stu-id="f259c-133">If an atomic transaction contains a **Receive** shape, a **Send** shape, or a **Start Orchestration** shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="f259c-134">Si necesita todas las propiedades ACID en los datos, por ejemplo, cuando los datos deben aislarse de otras transacciones, debe utilizar transacciones atómicas exclusivamente.</span><span class="sxs-lookup"><span data-stu-id="f259c-134">If you require full ACID properties on the data—for example, when the data must be isolated from other transactions—you must use atomic transactions exclusively.</span></span>  
  
 <span data-ttu-id="f259c-135">Cuando se producen errores en una transacción atómica, todos los estados se restablecen como si la instancia de orquestación nunca hubiese entrado en el ámbito.</span><span class="sxs-lookup"><span data-stu-id="f259c-135">When an atomic transaction fails, all states are reset as if the orchestration instance never entered the scope.</span></span> <span data-ttu-id="f259c-136">La regla que BizTalk aplica a transacciones atómicas es que todas las variables (no solo las locales para el ámbito) participen en la transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-136">The rule BizTalk has for atomic transactions is that all variables (not just local to the scope) participate in the transaction.</span></span> <span data-ttu-id="f259c-137">Todas las variables y mensajes no serializables utilizados en una transacción atómica deben declararse como locales para el ámbito; en caso contrario, el compilador mostrará el error que indica que la variable en cuestión no está marcada como serializable.</span><span class="sxs-lookup"><span data-stu-id="f259c-137">All non-serializable variables and messages used in an atomic transaction should be declared local to the scope; otherwise, the compiler will give the "variable….is not marked as serializable" error.</span></span> <span data-ttu-id="f259c-138">Se presupone que todos los ámbitos atómicos están "sincronizados" y el compilador de orquestaciones mostrará una advertencia sobre uso redundante si, en efecto, se utiliza la palabra clave "synchronized" para ámbitos atómicos.</span><span class="sxs-lookup"><span data-stu-id="f259c-138">All atomic scopes are assumed to be "synchronized" and the orchestration compiler will provide a warning for redundant usage, if indeed the synchronized keyword is used for atomic scopes.</span></span> <span data-ttu-id="f259c-139">La sincronización de los datos compartidos va desde el inicio del ámbito hasta la correcta finalización de éste (incluida la persistencia de estado al final del ámbito), o bien hasta la finalización del controlador de excepción (en caso de que se produzcan errores).</span><span class="sxs-lookup"><span data-stu-id="f259c-139">The synchronization for the shared data extends from the beginning of the scope until the successful completion of the scope (including the state persistence at the end of the scope) or to the completion of the exception handler (in case of errors).</span></span> <span data-ttu-id="f259c-140">El dominio de sincronización no se extiende al controlador de compensación.</span><span class="sxs-lookup"><span data-stu-id="f259c-140">The synchronization domain does not extend to the compensation handler.</span></span>  
  
 <span data-ttu-id="f259c-141">Las transacciones atómicas pueden asociarse a valores de tiempo de espera, momento a partir del cual la orquestación detendrá la transacción y la instancia se suspenderá.</span><span class="sxs-lookup"><span data-stu-id="f259c-141">Atomic transactions can be associated with timeout values at which point the orchestration will stop the transaction and the instance will be suspended.</span></span> <span data-ttu-id="f259c-142">Si una transacción atómica contiene una forma Recepción, una forma Envío o una forma Iniciar orquestación, las acciones correspondientes no se llevarán a cabo hasta que no se haya confirmado la transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-142">If an atomic transaction contains a Receive shape, a Send shape, or a Start Orchestration shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="f259c-143">Una transacción atómica se reintenta cuando el usuario lanza deliberadamente una **RetryTransactionException** o si un **PersistenceException** se genera en el momento en que la transacción atómica intenta confirmar.</span><span class="sxs-lookup"><span data-stu-id="f259c-143">An atomic transaction retries when the user deliberately throws a **RetryTransactionException** or if a **PersistenceException** is raised at the time that the atomic transaction tries to commit.</span></span> <span data-ttu-id="f259c-144">Esto último ocurriría si, por ejemplo, la transacción atómica formase parte de una transacción DTC distribuida y algún otro participante en dicha transacción la detuviese.</span><span class="sxs-lookup"><span data-stu-id="f259c-144">The latter could happen if for instance, the atomic transaction was part of a distributed DTC transaction and some other participant in that transaction stopped the transaction.</span></span> <span data-ttu-id="f259c-145">Del mismo modo, si se han producido problemas de conectividad de base de datos en el momento cuando la transacción se intenta confirmar, también habrá un **PersistenceException** genera.</span><span class="sxs-lookup"><span data-stu-id="f259c-145">Likewise, if there were database connectivity problems at the time when the transaction was trying to commit, there would also be a **PersistenceException** raised.</span></span> <span data-ttu-id="f259c-146">Si esto ocurre para un ámbito atómico que tiene **vuelva a intentar = True**, a continuación, volverá a intentar hasta 21 veces.</span><span class="sxs-lookup"><span data-stu-id="f259c-146">If this happens for an atomic scope that has **Retry=True**, then it will retry up to 21 times.</span></span> <span data-ttu-id="f259c-147">El intervalo predeterminado entre cada reintento es de dos segundos (pero se puede modificar).</span><span class="sxs-lookup"><span data-stu-id="f259c-147">The delay between each retry is two seconds by default (but that is modifiable).</span></span> <span data-ttu-id="f259c-148">Una vez concluidos los 21 reintentos, si sigue sin poder confirmarse la transacción, se suspenderá la instancia de toda la orquestación.</span><span class="sxs-lookup"><span data-stu-id="f259c-148">After 21 retries are exhausted, if the transaction is still unable to commit, the whole orchestration instance is suspended.</span></span> <span data-ttu-id="f259c-149">Se puede reanudar manualmente y volverá a comenzar, con un contador nuevo, desde el principio del ámbito atómico infractor.</span><span class="sxs-lookup"><span data-stu-id="f259c-149">It can be manually resumed and it will start over again, with a fresh counter, from the beginning of the offending atomic scope.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f259c-150">Solo el **RetryTransactionException** y **PersistenceException** puede provocar un ámbito atómico volver a intentar.</span><span class="sxs-lookup"><span data-stu-id="f259c-150">Only the **RetryTransactionException** and **PersistenceException** can cause an atomic scope to retry.</span></span> <span data-ttu-id="f259c-151">Cualquier otra excepción que se produce en un ámbito atómico no puede provocar que se vuelva a intentar, incluso si la **vuelva a intentar** propiedad está establecida en **True**.</span><span class="sxs-lookup"><span data-stu-id="f259c-151">Any other exception raised in an atomic scope cannot cause it to retry, even if the **Retry** property is set to **True**.</span></span> <span data-ttu-id="f259c-152">El retraso predeterminado de dos segundos entre dos reintentos consecutivos puede reemplazarse mediante una propiedad pública en **RetryTransactionException** (si es la excepción que se usa para hacer que los reintentos).</span><span class="sxs-lookup"><span data-stu-id="f259c-152">The two-second default delay between each two consecutive retries can be overridden by using a public property on **RetryTransactionException** (if that is the exception that is being used to cause the retries).</span></span>  
  
 <span data-ttu-id="f259c-153">Los ámbitos atómicos tienen restricciones relativas a la anidación de otras transacciones que no se pueden anidar transacciones ni incluir **Catch - Exception** bloques.</span><span class="sxs-lookup"><span data-stu-id="f259c-153">The atomic scopes have restrictions on nesting other transactions that cannot nest other transactions or include **Catch - Exception** blocks.</span></span>  
  
## <a name="dtc-transactions"></a><span data-ttu-id="f259c-154">Transacciones DTC</span><span class="sxs-lookup"><span data-stu-id="f259c-154">DTC transactions</span></span>  
 <span data-ttu-id="f259c-155">Aunque las transacciones atómicas se comportan como transacciones DTC, no equivalen explícitamente a transacciones DTC de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f259c-155">While atomic transactions behave like DTC transactions, they are not explicitly DTC transactions by default.</span></span> <span data-ttu-id="f259c-156">Puede convertirlas explícitamente en transacciones DTC, siempre que los objetos utilizados en la transacción sean objetos COM+ derivados de System.EnterpriseServices.ServicedComponents, y que los niveles de aislamiento coincidan entre los componentes de la transacción.</span><span class="sxs-lookup"><span data-stu-id="f259c-156">You can explicitly make them DTC transactions, provided that any objects being used in the transaction are COM+ objects derived from System.EnterpriseServices.ServicedComponents, and that isolation levels agree between transaction components.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f259c-157">Una transacción atómica no puede contener cualquier otra transacción ni controladores de excepción.</span><span class="sxs-lookup"><span data-stu-id="f259c-157">An atomic transaction cannot contain any other transactions within it, nor can it contain exception handlers.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f259c-158">Una transacción atómica no puede contener envío coincidente y acciones de recepción, es decir, un par de solicitud-respuesta o un envío y recepción que utilizan el mismo conjunto de correlación.</span><span class="sxs-lookup"><span data-stu-id="f259c-158">An atomic transaction cannot contain matching send and receive actions—that is, a request-response pair or a send and receive that use the same correlation set.</span></span>  
  
## <a name="non-serializable-objects"></a><span data-ttu-id="f259c-159">Objetos no serializables</span><span class="sxs-lookup"><span data-stu-id="f259c-159">Non-serializable objects</span></span>  
 <span data-ttu-id="f259c-160">Si desea utilizar un objeto no serializable dentro de una orquestación, debe utilizarlo únicamente dentro de una transacción atómica.</span><span class="sxs-lookup"><span data-stu-id="f259c-160">If you want to use a non-serializable object within an orchestration, you must use it only within an atomic transaction.</span></span> <span data-ttu-id="f259c-161">Cualquier uso de un objeto de este tipo fuera de una transacción atómica supone un riesgo en lo que a pérdida de datos se refiere cuando el motor guarda la orquestación.</span><span class="sxs-lookup"><span data-stu-id="f259c-161">Any use of such an object outside of an atomic transaction risks data loss whenever the orchestration is persisted by the engine.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="f259c-162">Cada ámbito atómico representa un punto de persistencia y esto significa que el estado de la orquestación se guarda en la base de datos en cada punto de persistencia.</span><span class="sxs-lookup"><span data-stu-id="f259c-162">Each Atomic scope represents a persistence point and what that means is the state of the orchestration is saved to the database at each persistence point.</span></span> <span data-ttu-id="f259c-163">El uso extensivo del ámbito atómico aumentará la latencia de la orquestación.</span><span class="sxs-lookup"><span data-stu-id="f259c-163">Extensive use of Atomic scope will increase the latency in the orchestration.</span></span> <span data-ttu-id="f259c-164">En lugar de utilizar un ámbito atómico para crear objetos no serializables, puede utilizar llamadas a métodos estáticos que no requieren ámbitos atómicos, lo que elimina la necesidad de puntos de persistencia.</span><span class="sxs-lookup"><span data-stu-id="f259c-164">Instead of using Atomic scope for the purpose of creating non-serializable objects, you can use Static method calls which they don not require Atomic scopes, thus eliminating the need for the persistence points.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f259c-165">Vea también</span><span class="sxs-lookup"><span data-stu-id="f259c-165">See Also</span></span>  
 <span data-ttu-id="f259c-166">[Escenarios de uso de transacciones atómicas](../core/scenarios-using-atomic-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="f259c-166">[Scenarios Using Atomic Transactions](../core/scenarios-using-atomic-transactions.md) </span></span>  
 [<span data-ttu-id="f259c-167">Transacciones de larga ejecución</span><span class="sxs-lookup"><span data-stu-id="f259c-167">Long-Running Transactions</span></span>](../core/long-running-transactions.md)