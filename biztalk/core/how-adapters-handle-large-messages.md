---
title: Cómo controlan los mensajes de gran tamaño en adaptadores | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: c48671fd-b6cf-4507-92b4-35a4cd135714
caps.latest.revision: 15
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: fccfd1e988dc1395f14d6eb92a980ede184d0e0f
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22247020"
---
# <a name="how-adapters-handle-large-messages"></a><span data-ttu-id="1f116-102">Cómo controlan los mensajes de gran tamaño en adaptadores</span><span class="sxs-lookup"><span data-stu-id="1f116-102">How Adapters Handle Large Messages</span></span>
<span data-ttu-id="1f116-103">El motor de mensajería de BizTalk puede procesar mensajes muy grandes; no imponen restricción alguna al tamaño máximo de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="1f116-103">The BizTalk Messaging Engine can process very large messages and imposes no restriction on the maximum size of a message.</span></span> <span data-ttu-id="1f116-104">Sin embargo, debería considerar la limitación del tamaño de los mensajes para mantener una administración de recursos y un rendimiento óptimos.</span><span class="sxs-lookup"><span data-stu-id="1f116-104">However, you should consider limits to message size to maintain optimum performance and resource management.</span></span> <span data-ttu-id="1f116-105">A medida que aumenta el tamaño de los mensajes, disminuye el número de mensajes procesados por segundo.</span><span class="sxs-lookup"><span data-stu-id="1f116-105">As message size increases the number of messages processed per second decreases.</span></span> <span data-ttu-id="1f116-106">Tenga en cuenta el tamaño promedio de mensaje, el tipo de mensaje y el número de mensajes que [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] procesa para diseñar el escenario y planear la capacidad.</span><span class="sxs-lookup"><span data-stu-id="1f116-106">Consider the average message size, message type, and number of messages being processed by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] when designing your scenario and planning for capacity.</span></span>  
  
## <a name="stream-based-processing"></a><span data-ttu-id="1f116-107">Procesamiento basado en secuencias</span><span class="sxs-lookup"><span data-stu-id="1f116-107">Stream-Based Processing</span></span>  
 <span data-ttu-id="1f116-108">Es importante tener en cuenta el control de mensajes de gran tamaño al desarrollar adaptadores.</span><span class="sxs-lookup"><span data-stu-id="1f116-108">It is important to keep large message handling in mind when developing adapters.</span></span> <span data-ttu-id="1f116-109">No es nada aconsejable cargar la totalidad de la secuencia de datos en memoria independientemente de su tamaño, puesto que, con ello, podría detenerse el proceso de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="1f116-109">Loading the entire data stream into memory regardless of its size is strongly discouraged because this could potentially stop the BizTalk Server process.</span></span> <span data-ttu-id="1f116-110">Dependiendo del número y el tamaño de los mensajes que procesa el motor en un momento dado, una memoria virtual baja podría constituir un problema.</span><span class="sxs-lookup"><span data-stu-id="1f116-110">Depending on the size and number of messages that the engine is processing at any given time, low virtual memory could become a problem.</span></span> <span data-ttu-id="1f116-111">En lugar de ello, los mensajes deberían procesarse por secuencias del modo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1f116-111">Instead, messages should be processed in a streaming fashion as follows:</span></span>  
  
-   <span data-ttu-id="1f116-112">**Los mensajes entrantes.**</span><span class="sxs-lookup"><span data-stu-id="1f116-112">**Inbound messages.**</span></span> <span data-ttu-id="1f116-113">En lo que respecta a los mensajes de entrada, el adaptador de recepción adjunta la secuencia de red al mensaje de BizTalk, dejando al motor de mensajería de BizTalk la “extracción” de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1f116-113">For inbound messages the network stream is attached to the BizTalk message by the receive adapter leaving the "pulling" of the stream to the BizTalk Messaging Engine.</span></span>  
  
-   <span data-ttu-id="1f116-114">**Mensajes salientes.**</span><span class="sxs-lookup"><span data-stu-id="1f116-114">**Outbound messages.**</span></span> <span data-ttu-id="1f116-115">En cuanto a los mensajes de salida, el adaptador es el responsable de la extracción de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1f116-115">For outbound messages the adapter is responsible for pulling the stream.</span></span> <span data-ttu-id="1f116-116">Con ello, se extrae eficazmente la secuencia desde la base de datos de cuadro de mensajes y a través de la canalización de envío.</span><span class="sxs-lookup"><span data-stu-id="1f116-116">This effectively pulls the stream from the MessageBox database and though the send pipeline.</span></span> <span data-ttu-id="1f116-117">El adaptador debería enviar los datos por secuencias por la red.</span><span class="sxs-lookup"><span data-stu-id="1f116-117">The adapter should send the data over the wire in a streaming fashion.</span></span>  
  
 <span data-ttu-id="1f116-118">La siguiente ilustración muestra el procesamiento basado en secuencias en el lado de recepción del motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="1f116-118">The following figure shows stream-based processing on the receive side of the Messaging Engine.</span></span>  
  
 ![](../core/media/streambasedprocessing.gif "Streambasedprocessing")  
  
 <span data-ttu-id="1f116-119">Cuando un adaptador envía un mensaje al motor, debería adjuntar su secuencia de datos al mensaje de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="1f116-119">When an adapter submits a message to the engine it should attach its data stream to the BizTalk message.</span></span> <span data-ttu-id="1f116-120">En el caso de algunos adaptadores, esto puede significar la implementación de una secuencia de red.</span><span class="sxs-lookup"><span data-stu-id="1f116-120">For some adapters this may mean implementing a network stream.</span></span> <span data-ttu-id="1f116-121">Cuando se envía el mensaje, el motor ejecuta la canalización de recepción.</span><span class="sxs-lookup"><span data-stu-id="1f116-121">When the message is submitted, the engine executes the receive pipeline.</span></span> <span data-ttu-id="1f116-122">Durante la ejecución de la canalización, los componentes de canalización que quieran cambiar los datos clonan el mensaje, con lo que se conecta la secuencia del nuevo mensaje a la secuencia del mensaje anterior.</span><span class="sxs-lookup"><span data-stu-id="1f116-122">During pipeline execution, the pipeline components that want to change the data clone the message, wiring up the stream from the new message to the stream on the previous message.</span></span> <span data-ttu-id="1f116-123">Después de haber ejecutado la canalización, el motor de mensajería extrae un mensaje de la canalización y ejecuta un bucle leyendo la secuencia del mensaje.</span><span class="sxs-lookup"><span data-stu-id="1f116-123">After the pipeline has been executed, the Messaging Engine takes a message out of the pipeline and executes a loop reading the stream on that message.</span></span> <span data-ttu-id="1f116-124">Esta lectura de la secuencia invoca una lectura de la secuencia anterior que, a su vez, invoca una lectura de la secuencia anterior, y así sucesivamente hacia atrás hasta llegar a la secuencia de red.</span><span class="sxs-lookup"><span data-stu-id="1f116-124">This reading of the stream invokes a read on the previous stream, which in turn invokes a read on the previous stream, and so on back to the network stream.</span></span> <span data-ttu-id="1f116-125">El motor vacía los datos periódicamente en el cuadro de mensajes para mantener un modelo de memoria con el volumen adecuado.</span><span class="sxs-lookup"><span data-stu-id="1f116-125">The engine periodically flushes the data to the MessageBox to maintain a flat memory model.</span></span>  
  
 <span data-ttu-id="1f116-126">**Sugerencia de solución de problemas:** en el lado de envío, el adaptador es responsable de leer la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1f116-126">**Troubleshooting Tip:** On the send side, the adapter is responsible for reading the stream.</span></span> <span data-ttu-id="1f116-127">Si el adaptador de envío desea leer alguna propiedad de contexto de mensaje promocionada o escrita en la canalización de envío, puede que esta propiedad no se escriba hasta que se lea la totalidad de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1f116-127">If the send adapter wants to read any message context properties that are promoted or written in the send pipeline, these properties may not be written until the entire stream is read.</span></span> <span data-ttu-id="1f116-128">Únicamente al efectuarse por completo la lectura de la secuencia, puede asegurarse el adaptador de que todos los componentes de canalización han terminado su ejecución.</span><span class="sxs-lookup"><span data-stu-id="1f116-128">Only when the stream has been completely read can the adapter be sure that all of the pipeline components have finished executing.</span></span>  
  
## <a name="locating-a-specific-byte-in-the-stream"></a><span data-ttu-id="1f116-129">Localizar un byte específico en la secuencia</span><span class="sxs-lookup"><span data-stu-id="1f116-129">Locating a Specific Byte in the Stream</span></span>  
 <span data-ttu-id="1f116-130">Hay escenarios en los que un adaptador puede tener que localizar el inicio de la secuencia para controlar mensajes con errores que deben suspenderse.</span><span class="sxs-lookup"><span data-stu-id="1f116-130">There are scenarios in which an adapter may need to locate the stream back to the beginning to handle failed messages that need to be suspended.</span></span> <span data-ttu-id="1f116-131">Un ejemplo de ello es un adaptador de HTTP que recibe datos mediante la codificación fragmentada a fin de enviar el mensaje de respuesta en un par de petición-respuesta.</span><span class="sxs-lookup"><span data-stu-id="1f116-131">An example of this is an HTTP adapter that is receiving data using chunked encoding to submit the response message in a solicit-response pair.</span></span>  
  
 <span data-ttu-id="1f116-132">Sin embargo, es posible que en muchos escenarios no pueda efectuar un seguimiento de la secuencia de datos.</span><span class="sxs-lookup"><span data-stu-id="1f116-132">However, in many scenarios you may not be able to trace the data stream.</span></span> <span data-ttu-id="1f116-133">Por ejemplo, considere un adaptador de HTTP que recibe datos mediante codificación fragmentada.</span><span class="sxs-lookup"><span data-stu-id="1f116-133">For example, consider an HTTP adapter receiving data using chunked encoding.</span></span> <span data-ttu-id="1f116-134">Para que la secuencia de datos que es preciso diseñar para encontrar los mensajes con errores, el adaptador tendría que almacenar los datos en caché a medida que se leen, bien en la memoria, bien en disco.</span><span class="sxs-lookup"><span data-stu-id="1f116-134">For the data stream to be designed so you can find the messages that failed, the adapter would need to cache the data as it is read, either in memory or onto disk.</span></span> <span data-ttu-id="1f116-135">Obviamente, esto no resulta óptimo y requiere recursos adicionales.</span><span class="sxs-lookup"><span data-stu-id="1f116-135">Clearly this is not optimal and requires additional resources.</span></span> <span data-ttu-id="1f116-136">Además, muchos de los componentes de canalización predeterminados funcionan por secuencias progresivas.</span><span class="sxs-lookup"><span data-stu-id="1f116-136">Further, many of the out-of-the-box pipeline components operate in a forward-only streaming fashion.</span></span> <span data-ttu-id="1f116-137">En estos escenarios de BaseAdapter en SDK utiliza una clase auxiliar denominada **VirtualStream**.</span><span class="sxs-lookup"><span data-stu-id="1f116-137">For these scenarios the BaseAdapter in the SDK uses a helper class called **VirtualStream**.</span></span> <span data-ttu-id="1f116-138">El archivo que contiene esta funcionalidad se denomina VirtualStream.cs.</span><span class="sxs-lookup"><span data-stu-id="1f116-138">The file that contains this functionality is named VirtualStream.cs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1f116-139">El archivo VirtualStream.cs se encuentra en dos ubicaciones en los ejemplos de SDK: SDK\Samples\Pipelines\ArbitraryXPathPropertyHandler y SDK\Samples\Pipelines\SchemaResolverComponent\SchemaResolverFlatFileDasm.</span><span class="sxs-lookup"><span data-stu-id="1f116-139">The VirtualStream.cs file is located in two locations under the Pipelines SDK Samples—SDK\Samples\Pipelines\ArbitraryXPathPropertyHandler and SDK\Samples\Pipelines\SchemaResolverComponent\SchemaResolverFlatFileDasm.</span></span>  
  
 <span data-ttu-id="1f116-140">La idea que subyace a una secuencia virtual es el almacenamiento en caché de los datos de la secuencia en una secuencia de memoria hasta que alcance un umbral, superado el cual los datos se desbordan en una ubicación segura del disco.</span><span class="sxs-lookup"><span data-stu-id="1f116-140">The idea behind a virtual stream is that the data in the stream is cached in a memory stream until it reaches a threshold, over which the data is overflowed to a secure location on disk.</span></span> <span data-ttu-id="1f116-141">El archivo de disco se elimina automáticamente después de que se cierre la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1f116-141">After the stream is closed the disk file is automatically deleted.</span></span> <span data-ttu-id="1f116-142">Las secuencias progresivas pueden diseñarse de esta forma.</span><span class="sxs-lookup"><span data-stu-id="1f116-142">Forward-only streams can be designed in this way.</span></span>