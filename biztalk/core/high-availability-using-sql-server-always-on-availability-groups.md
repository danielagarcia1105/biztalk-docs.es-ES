---
title: Alta disponibilidad mediante SQL Server grupos de disponibilidad AlwaysOn | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 4511a578-77d2-49ee-99bd-f0406ad625d0
caps.latest.revision: "10"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: db9b066b6d1f2334e14e4829d61ec6b84830c4c1
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="high-availability-using-sql-server-always-on-availability-groups"></a><span data-ttu-id="e03d6-102">Alta disponibilidad mediante SQL Server grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e03d6-102">High Availability using SQL Server Always On Availability Groups</span></span>
<span data-ttu-id="e03d6-103">Configurar alta disponibilidad mediante el uso de grupos de disponibilidad AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-103">Configure high availability using SQL Server AlwaysOn availability groups.</span></span>

> [!TIP] 
<span data-ttu-id="e03d6-104">[Configurar BizTalk Server 2016 mediante la disponibilidad de grupos de laboratorio](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) proporciona una guía paso a paso escrita por un ingeniero de campo de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e03d6-104">[Setting up BizTalk Server 2016 using availability groups LAB](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) provides a step-by-step guide written by a Microsoft field engineer.</span></span> <span data-ttu-id="e03d6-105">Esta se basa en un entorno de laboratorio e incluye algunas observaciones.</span><span class="sxs-lookup"><span data-stu-id="e03d6-105">It is based on a lab environment, and includes some observations.</span></span> <span data-ttu-id="e03d6-106">Mira esto.</span><span class="sxs-lookup"><span data-stu-id="e03d6-106">Check it out.</span></span>  

> [!IMPORTANT]
> * <span data-ttu-id="e03d6-107">Grupos de disponibilidad AlwaysOn está disponible a partir de SQL Server 2016.</span><span class="sxs-lookup"><span data-stu-id="e03d6-107">Always On Availability Groups is available starting with SQL Server 2016.</span></span> <span data-ttu-id="e03d6-108">Si está utilizando una versión anterior de SQL Server, este tema no se aplica a usted.</span><span class="sxs-lookup"><span data-stu-id="e03d6-108">If you are using a previous SQL Server version, this topic does not apply to you.</span></span> 
> * <span data-ttu-id="e03d6-109">BizTalk Server 2016 admite el modo de confirmación sincrónica; no se admite el modo de confirmación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="e03d6-109">BizTalk Server 2016 supports synchronous-commit mode; asynchronous-commit mode is not supported.</span></span> <span data-ttu-id="e03d6-110">Recuperación ante desastres, se recomienda configurar el trabajo de copia de seguridad de BizTalk Server y usar el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="e03d6-110">For disaster recovery, it is recommended to configure the Backup BizTalk Server job, and use log shipping.</span></span> <span data-ttu-id="e03d6-111">Vea [copia de seguridad y restaurar bases de datos de servidor de BizTalk](../core/backing-up-and-restoring-biztalk-server-databases.md) para obtener detalles específicos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-111">See [Backing Up and Restoring BizTalk Server Databases](../core/backing-up-and-restoring-biztalk-server-databases.md) for specific details.</span></span>
> 
>    <span data-ttu-id="e03d6-112">[Modos de disponibilidad](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) se detallan las opciones de confirmación con grupos de disponibilidad AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e03d6-112">[Availability Modes](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) details the commit options with Always On Availability Groups.</span></span> 


## <a name="background-and-history"></a><span data-ttu-id="e03d6-113">Segundo plano y el historial</span><span class="sxs-lookup"><span data-stu-id="e03d6-113">Background and history</span></span>

<span data-ttu-id="e03d6-114">BizTalk Server se basa principalmente en SQL Server para la persistencia de datos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-114">BizTalk Server relies heavily on SQL Server for data persistence.</span></span> <span data-ttu-id="e03d6-115">Otros componentes y hosts de BizTalk Server tienen funciones específicas al integrar aplicaciones empresariales diferentes, por ejemplo, recibir, procesar o enrutar mensajes.</span><span class="sxs-lookup"><span data-stu-id="e03d6-115">Other components and hosts in BizTalk Server have specific roles when integrating disparate business applications, such as receiving, processing, or routing messages.</span></span> <span data-ttu-id="e03d6-116">El equipo de base de datos captura este trabajo y lo almacena en el disco.</span><span class="sxs-lookup"><span data-stu-id="e03d6-116">The database computer captures this work, and persists it to disk.</span></span> 

<span data-ttu-id="e03d6-117">BizTalk utiliza clústeres de conmutación por error de SQL Server y el trasvase de registros para proporcionar alta disponibilidad, copia de seguridad y restauración y recuperación ante desastres para sus bases de datos local.</span><span class="sxs-lookup"><span data-stu-id="e03d6-117">BizTalk uses SQL Server Failover Clustering and Log Shipping to provide high availability, backup and restore, and disaster recovery for its on-premises databases.</span></span> <span data-ttu-id="e03d6-118">En IaaS de Azure (máquinas virtuales de Azure), las versiones anteriores de SQL Server no son compatibles con instancias de clúster de conmutación por error (no hay compatibilidad MSDTC).</span><span class="sxs-lookup"><span data-stu-id="e03d6-118">In Azure IaaS (Azure virtual machines), previous versions of SQL Server do not support Failover Cluster Instances (no MSDTC support).</span></span> <span data-ttu-id="e03d6-119">Como resultado, BizTalk no tenía una solución de alta disponibilidad al utilizar máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-119">As a result, BizTalk did not have a HA solution when using Azure VMs.</span></span>

<span data-ttu-id="e03d6-120">A partir de SQL Server 2016, grupos de disponibilidad AlwaysOn de SQL Server es compatible con MSDTC para local y usar máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-120">Starting with SQL Server 2016, SQL Server AlwaysOn Availability Groups supports MSDTC for on-premises and using Azure VMs.</span></span> <span data-ttu-id="e03d6-121">Como resultado, la característica de SQL Server 2016 AlwaysOn se admite para las bases de datos de BizTalk en local o en escenarios de IaaS de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-121">As a result, the SQL Server 2016 AlwaysOn feature is supported for BizTalk databases on-premises or in Azure IaaS scenarios.</span></span> 

## <a name="sql-server-2016-alwayson-availability-groups"></a><span data-ttu-id="e03d6-122">Grupos de disponibilidad AlwaysOn de SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="e03d6-122">SQL Server 2016 AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="e03d6-123">La implementación de grupos de disponibilidad AlwaysOn requiere un clúster de clústeres de conmutación por error de servidor de Windows (WSFC).</span><span class="sxs-lookup"><span data-stu-id="e03d6-123">Deploying AlwaysOn Availability Groups requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="e03d6-124">Cada réplica de disponibilidad de un determinado grupo de disponibilidad debe residir en otro nodo del mismo clúster de WSFC.</span><span class="sxs-lookup"><span data-stu-id="e03d6-124">Each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="e03d6-125">Por cada grupo de disponibilidad que cree, se creará un grupo de recursos de WSFC.</span><span class="sxs-lookup"><span data-stu-id="e03d6-125">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="e03d6-126">El clúster de WSFC supervisa este grupo de recursos para evaluar el estado de la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="e03d6-126">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  

<span data-ttu-id="e03d6-127">En la ilustración siguiente se muestra un grupo de disponibilidad que contiene solo una réplica principal y cuatro réplicas secundarias.</span><span class="sxs-lookup"><span data-stu-id="e03d6-127">The following illustration shows an availability group that contains one primary replica and four secondary replicas.</span></span>  
 
 ![SQLAG_PrimaryReplica](../core/media/sqlag-primaryreplica.png)

<span data-ttu-id="e03d6-129">Los clientes pueden conectarse a la réplica principal de un grupo de disponibilidad determinado mediante un agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-129">Clients can connect to the primary replica of a given availability group using an availability group listener.</span></span> <span data-ttu-id="e03d6-130">Un agente de escucha del grupo de disponibilidad proporciona un conjunto de recursos que están conectados a un grupo de disponibilidad determinado para dirigir las conexiones de cliente a la réplica de disponibilidad adecuada.</span><span class="sxs-lookup"><span data-stu-id="e03d6-130">An availability group listener provides a set of resources that are attached to a given availability group to direct client connections to the appropriate availability replica.</span></span> 

>[!IMPORTANT]
> <span data-ttu-id="e03d6-131">SQL Server 2016 admite MSDTC con grupos de disponibilidad AlwaysOn (AG) en Windows Server 2016 y Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="e03d6-131">SQL Server 2016 supports MSDTC with AlwaysOn Availability Groups (AG) on Windows Server 2016 and Windows Server 2012 R2.</span></span> <span data-ttu-id="e03d6-132">**Windows Server 2012 R2** requiere el [3090973](https://support.microsoft.com/kb/3090973) revisión de Windows esté instalado.</span><span class="sxs-lookup"><span data-stu-id="e03d6-132">**Windows Server 2012 R2** requires  the [3090973](https://support.microsoft.com/kb/3090973) Windows hotfix  to be installed.</span></span> 
> <span data-ttu-id="e03d6-133">**Windows Server 2016** requiere que el [clave del registro de RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) habilitarse.</span><span class="sxs-lookup"><span data-stu-id="e03d6-133">**Windows Server 2016** requires that the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) be enabled.</span></span>

<span data-ttu-id="e03d6-134">SQL Server no es compatible con MSDTC con AlwaysOn AG para cualquier versión anterior a 2016.</span><span class="sxs-lookup"><span data-stu-id="e03d6-134">SQL Server does not support MSDTC with AlwaysOn AG for any versions prior to 2016.</span></span>  

<span data-ttu-id="e03d6-135">MSDTC entre bases de datos en la misma instancia de SQL Server no es compatible con grupos de disponibilidad AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-135">MSDTC between databases on same SQL Server instance is not supported with SQL Server AlwaysOn Availability Groups.</span></span> <span data-ttu-id="e03d6-136">Esto significa que no hay dos bases de datos de BizTalk en una transacción distribuida se pueden hospedar en la misma instancia SQL server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-136">This means that no two BizTalk databases in a distributed transaction can be hosted on the same SQL server instance.</span></span> <span data-ttu-id="e03d6-137">Para mantener la coherencia transaccional, deben hospedar bases de datos de BizTalk participan en transacciones distribuidas en varias instancias SQL server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-137">For transactional consistency, BizTalk databases participating in distributed transaction should be hosted on different SQL server instances.</span></span> <span data-ttu-id="e03d6-138">Tenga en cuenta que no importa si las instancias de SQL se encuentran en el mismo equipo o en equipos diferentes.</span><span class="sxs-lookup"><span data-stu-id="e03d6-138">Note that it does not matter whether SQL instances are on the same computer, or different computers.</span></span>  


## <a name="providing-high-availability-for-biztalk-databases-using-alwayson-availability-groups"></a><span data-ttu-id="e03d6-139">Proporcionar alta disponibilidad de bases de datos de BizTalk mediante grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e03d6-139">Providing high availability for BizTalk databases using AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="e03d6-140">En la configuración básica de BizTalk Server, un mínimo de 9 bases de datos se crean incluidas reglas y BAM bases de datos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-140">In the basic configuration of BizTalk Server, a minimum of 9 databases are created including Rules and BAM databases.</span></span> <span data-ttu-id="e03d6-141">Debido a MSDTC limitación con grupos de disponibilidad se ha mencionado anteriormente, una configuración como siguiente no garantiza la coherencia transaccional.</span><span class="sxs-lookup"><span data-stu-id="e03d6-141">Due to the MSDTC limitation with Availability Groups mentioned previously, a configuration such as following does not ensure transactional consistency.</span></span> 

![SQLAG_NoTrans](../core/media/sqlag-notrans.gif)
 
<span data-ttu-id="e03d6-143">Se recomienda que las bases de datos de BizTalk Server se agrupan en las siguientes cuatro instancias de SQL Server:</span><span class="sxs-lookup"><span data-stu-id="e03d6-143">We recommend that the BizTalk Server databases are grouped into the following four SQL Server instances:</span></span>
 
| <span data-ttu-id="e03d6-144">Instancia</span><span class="sxs-lookup"><span data-stu-id="e03d6-144">Instance</span></span> |<span data-ttu-id="e03d6-145">Rol</span><span class="sxs-lookup"><span data-stu-id="e03d6-145">Role</span></span> |<span data-ttu-id="e03d6-146">Bases de datos de BizTalk en ese grupo</span><span class="sxs-lookup"><span data-stu-id="e03d6-146">BizTalk Databases in that group</span></span>  |
|--- | --- | ---|
|<span data-ttu-id="e03d6-147">1</span><span class="sxs-lookup"><span data-stu-id="e03d6-147">1</span></span> |<span data-ttu-id="e03d6-148">Autenticación</span><span class="sxs-lookup"><span data-stu-id="e03d6-148">Authentication</span></span> |<span data-ttu-id="e03d6-149">SSODB</span><span class="sxs-lookup"><span data-stu-id="e03d6-149">SSODB</span></span>|
|<span data-ttu-id="e03d6-150">2</span><span class="sxs-lookup"><span data-stu-id="e03d6-150">2</span></span> |<span data-ttu-id="e03d6-151">Administración</span><span class="sxs-lookup"><span data-stu-id="e03d6-151">Management</span></span> |<span data-ttu-id="e03d6-152">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-152">BizTalkMgmtDb</span></span>| 
|<span data-ttu-id="e03d6-153">3</span><span class="sxs-lookup"><span data-stu-id="e03d6-153">3</span></span> |<span data-ttu-id="e03d6-154">Tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="e03d6-154">Runtime</span></span> |<span data-ttu-id="e03d6-155">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-155">BizTalkMsgBoxDb</span></span><br/> <span data-ttu-id="e03d6-156">BizTalkRulesEngineDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-156">BizTalkRulesEngineDb</span></span><br/> <span data-ttu-id="e03d6-157">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="e03d6-157">BAMPrimaryImport</span></span><br/><span data-ttu-id="e03d6-158">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="e03d6-158">BAMStarSchema</span></span> <br/><span data-ttu-id="e03d6-159">BAMAlertsApplication</span><span class="sxs-lookup"><span data-stu-id="e03d6-159">BAMAlertsApplication</span></span> |
|<span data-ttu-id="e03d6-160">4</span><span class="sxs-lookup"><span data-stu-id="e03d6-160">4</span></span> |<span data-ttu-id="e03d6-161">Seguimiento</span><span class="sxs-lookup"><span data-stu-id="e03d6-161">Tracking</span></span> |<span data-ttu-id="e03d6-162">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="e03d6-162">BizTalkDTADb</span></span>| 
 
<span data-ttu-id="e03d6-163">En un escenario de cuadro de mensajes de escala horizontal (una configuración con más de un cuadro de mensajes), hay más de una base de datos de cuadro de mensajes, y cada base de datos de cuadro de mensajes debe estar en su propia instancia de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-163">In a scaled-out MessageBox scenario (a configuration with more than one MessageBox), there is more than one MessageBox database, and each MessageBox database must be on its own SQL Server instance.</span></span> 

<span data-ttu-id="e03d6-164">BizTalk Server también depende de SQL Server Analysis Services y SQL Server Integration Services para el análisis de BAM y archivado.</span><span class="sxs-lookup"><span data-stu-id="e03d6-164">BizTalk Server also depends on SQL Server Analysis Services and SQL Server Integration Services for BAM Analysis and Archiving.</span></span> <span data-ttu-id="e03d6-165">SQL Server no proporciona una solución de alta disponibilidad para los servicios de integración o de Analysis Services en IaaS de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-165">SQL Server does not provide a high availability solution for Integration Services or Analysis Services in Azure IaaS.</span></span> <span data-ttu-id="e03d6-166">Por lo tanto, se recomienda usar otra instancia de SQL Server independiente para las bases de datos BAMArchive y BAMAnalysis Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="e03d6-166">It is therefore recommended to use another standalone SQL Server instance for the BAMArchive and BAMAnalysis Analysis Services databases.</span></span> <span data-ttu-id="e03d6-167">Para las instalaciones locales, instancia de clústeres de conmutación por error de SQL puede utilizarse para establecer una configuración de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-167">For on-premises installations, SQL Failover Clustering Instance can be used for setting up a high availability configuration.</span></span> 

<span data-ttu-id="e03d6-168">Esta configuración se ilustra a continuación y se recomienda para las bases de datos de BizTalk en grupos de disponibilidad:</span><span class="sxs-lookup"><span data-stu-id="e03d6-168">This configuration is illustrated below, and recommended for BizTalk Databases in Availability Groups:</span></span>  

![SQLAG_Recommended](../core/media/sqlag-recommended.png)
 
<span data-ttu-id="e03d6-170">Junto con las bases de datos de SQL Server, configuración de BizTalk Server crea también los inicios de sesión de seguridad de SQL Server y trabajos del Agente SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-170">Along with SQL Server databases, BizTalk Server configuration also creates SQL Server security logins and SQL Agent Jobs.</span></span> <span data-ttu-id="e03d6-171">Grupos de disponibilidad AlwaysOn solo proporcionan la capacidad para administrar bases de datos dentro de un grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-171">AlwaysOn Availability Groups only provide the ability to manage databases inside an Availability Group.</span></span> <span data-ttu-id="e03d6-172">Los inicios de sesión y trabajos del Agente SQL de BizTalk que se crean y se actualizan/administran manualmente en todas las réplicas de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-172">Logins and SQL Agent Jobs for BizTalk need to be created and updated/managed manually on all the availability replicas.</span></span>  

<span data-ttu-id="e03d6-173">La siguiente lista de inicios de sesión de seguridad de SQL Server están asociados con BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-173">The following list of SQL Server security logins are associated with BizTalk Server.</span></span> <span data-ttu-id="e03d6-174">Puede que tenga más inicios de sesión creados para las aplicaciones de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-174">You may have additional logins created for your BizTalk Server applications.</span></span> <span data-ttu-id="e03d6-175">Si es así, debe replicarlos en cada instancia de SQL Server que hospeda una réplica de bases de datos de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-175">If so, you need to replicate them on every instance of SQL Server hosting a replica of BizTalk databases.</span></span> 

1. <span data-ttu-id="e03d6-176">Usuarios de aplicación de BizTalk (uno o más correspondiente a cada Host en proceso)</span><span class="sxs-lookup"><span data-stu-id="e03d6-176">BizTalk Application Users (one or more corresponding to each in-proc Host)</span></span> 
2. <span data-ttu-id="e03d6-177">Usuarios de hosts aislados de BizTalk (uno o más correspondiente a cada Host aislado)</span><span class="sxs-lookup"><span data-stu-id="e03d6-177">BizTalk Isolated Host Users (one or more corresponding to each Isolated Host)</span></span> 
3. <span data-ttu-id="e03d6-178">Administradores de servidor BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-178">BizTalk Server Administrators</span></span> 
4. <span data-ttu-id="e03d6-179">Operadores B2B de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-179">BizTalk Server B2B Operators</span></span> 
5. <span data-ttu-id="e03d6-180">Operadores de servidor BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-180">BizTalk Server Operators</span></span> 
6. <span data-ttu-id="e03d6-181">Administradores de SSO</span><span class="sxs-lookup"><span data-stu-id="e03d6-181">SSO Administrators</span></span> 
7. <span data-ttu-id="e03d6-182">Usuario de alertas BAM</span><span class="sxs-lookup"><span data-stu-id="e03d6-182">BAM Alerts User</span></span> 
8. <span data-ttu-id="e03d6-183">Usuario de servicio web de administración de BAM</span><span class="sxs-lookup"><span data-stu-id="e03d6-183">BAM Management Web Service User</span></span> 
9. <span data-ttu-id="e03d6-184">Cuenta de servicio de actualización de motor de reglas</span><span class="sxs-lookup"><span data-stu-id="e03d6-184">Rule Engine Update Service Account</span></span> 

<span data-ttu-id="e03d6-185">Si ha creado hosts adicionales o creará hosts adicionales más tarde, habrá nuevos inicios de sesión SQL creados como parte de este proceso.</span><span class="sxs-lookup"><span data-stu-id="e03d6-185">If you have created additional hosts or will create additional hosts later, there will be new SQL logins created as part of this process.</span></span> <span data-ttu-id="e03d6-186">Debe asegurarse de que crear manualmente estos inicios de sesión SQL en las réplicas correspondientes.</span><span class="sxs-lookup"><span data-stu-id="e03d6-186">You must make sure to create these SQL logins manually on the corresponding replicas.</span></span>

<span data-ttu-id="e03d6-187">Los siguientes trabajos del Agente SQL Server están asociados a BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-187">The following SQL Server Agent jobs are associated with BizTalk Server.</span></span> <span data-ttu-id="e03d6-188">Los trabajos instalados en cada servidor son diferentes según las características instaladas y configuradas.</span><span class="sxs-lookup"><span data-stu-id="e03d6-188">The jobs installed on each server are different depending on which features are installed and configured.</span></span> <span data-ttu-id="e03d6-189">La mayoría de estos trabajos se crea durante la configuración de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-189">Most of these jobs are created during BizTalk Server configuration.</span></span> <span data-ttu-id="e03d6-190">Algunos se crean al configurar el envío de registro.</span><span class="sxs-lookup"><span data-stu-id="e03d6-190">Several are created when configuring log shipping.</span></span> <span data-ttu-id="e03d6-191">Estos trabajos deben replicarse en cada instancia de réplica de hospedaje de SQL Server de su base de datos de BizTalk correspondiente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-191">These jobs need to be replicated on each instance of SQL Server hosting replica of their corresponding BizTalk database.</span></span> <span data-ttu-id="e03d6-192">Esto debe realizarse manualmente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-192">This must be performed manually.</span></span> 

- <span data-ttu-id="e03d6-193">Trabajos de BizTalkMgmtDb:</span><span class="sxs-lookup"><span data-stu-id="e03d6-193">BizTalkMgmtDb jobs:</span></span> 
    - <span data-ttu-id="e03d6-194">Copia de seguridad de BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="e03d6-194">Backup BizTalk Server (BizTalkMgmtDb)</span></span> 
    - <span data-ttu-id="e03d6-195">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-195">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span></span> 
    - <span data-ttu-id="e03d6-196">Supervisar el servidor BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="e03d6-196">Monitor BizTalk Server (BizTalkMgmtDb)</span></span> 
- <span data-ttu-id="e03d6-197">Trabajos de BizTalkMsgBoxDb:</span><span class="sxs-lookup"><span data-stu-id="e03d6-197">BizTalkMsgBoxDb jobs:</span></span> 
    - <span data-ttu-id="e03d6-198">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-198">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e03d6-199">MessageBox_Message_Cleanup_BizTalkMsgBoxDb MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-199">MessageBox_Message_Cleanup_BizTalkMsgBoxDb MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e03d6-200">MessageBox_UpdateStats_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-200">MessageBox_UpdateStats_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e03d6-201">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-201">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e03d6-202">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-202">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e03d6-203">TrackedMessages_Copy_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-203">TrackedMessages_Copy_BizTalkMsgBoxDb</span></span> 
- <span data-ttu-id="e03d6-204">Trabajos en msgboxes adicionales</span><span class="sxs-lookup"><span data-stu-id="e03d6-204">Jobs on additional msgboxes</span></span>
- <span data-ttu-id="e03d6-205">Trabajo de BizTalkDTADb:</span><span class="sxs-lookup"><span data-stu-id="e03d6-205">BizTalkDTADb job:</span></span> 
    - <span data-ttu-id="e03d6-206">DTA Purge and Archive (BizTalkDTADb)</span><span class="sxs-lookup"><span data-stu-id="e03d6-206">DTA Purge and Archive (BizTalkDTADb)</span></span> 
- <span data-ttu-id="e03d6-207">Trabajo de BizTalkRulesEngineDb:</span><span class="sxs-lookup"><span data-stu-id="e03d6-207">BizTalkRulesEngineDb job:</span></span> 
    - <span data-ttu-id="e03d6-208">Rules_Database_Cleanup_BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="e03d6-208">Rules_Database_Cleanup_BizTalkRuleEngineDb</span></span> 
- <span data-ttu-id="e03d6-209">Trabajo de BAMAlertsApplication:</span><span class="sxs-lookup"><span data-stu-id="e03d6-209">BAMAlertsApplication job:</span></span> 
    - <span data-ttu-id="e03d6-210">0 o más DelAlertHistJob</span><span class="sxs-lookup"><span data-stu-id="e03d6-210">0 or more DelAlertHistJob</span></span> 

<span data-ttu-id="e03d6-211">A diferencia de instancias de clústeres de conmutación por error de SQL Server, en grupos de disponibilidad todas las réplicas están activas, ejecución y disponibles.</span><span class="sxs-lookup"><span data-stu-id="e03d6-211">Unlike SQL Failover Clustering Instances, in Availability Groups all replicas are active, running, and available.</span></span> <span data-ttu-id="e03d6-212">Cuando los trabajos del Agente SQL se duplican en cada réplica para conmutación por error, se ejecutan en la réplica correspondiente, independientemente de si está actualmente en el rol principal o secundaria.</span><span class="sxs-lookup"><span data-stu-id="e03d6-212">When SQL Agent jobs are duplicated on each replica for failover, they run against the corresponding replica, irrespective of whether it is currently in primary role or secondary role.</span></span> <span data-ttu-id="e03d6-213">Para asegurarse de que estos trabajos se ejecutan solo en la réplica principal actual, cada paso en cada trabajo debe incluirse dentro de un bloque IF, tal como se muestra:</span><span class="sxs-lookup"><span data-stu-id="e03d6-213">To make sure these jobs are executed only on the current primary replica, every step in every job must be enclosed within an IF block, as shown:</span></span> 

    IF (sys.fn_hadr_is_primary_replica(‘dbname’) = 1)  
    BEGIN  
    …  
    END
  
<span data-ttu-id="e03d6-214">Reemplace `‘dbname’` con el nombre de base de datos correspondiente en la que el trabajo está configurado para ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="e03d6-214">Replace `‘dbname’` with the corresponding database name against which the job is configured to run.</span></span> <span data-ttu-id="e03d6-215">En el ejemplo siguiente se muestra este cambio para TrackedMessages_Copy_BizTalkMsgBoxDb en BizTalkMsgBoxDb:</span><span class="sxs-lookup"><span data-stu-id="e03d6-215">The following example shows this change for TrackedMessages_Copy_BizTalkMsgBoxDb on BizTalkMsgBoxDb:</span></span> 
 
 ![SQLAG_AgentJob](../core/media/sqlag-agentjob.gif)

### <a name="configure-biztalk-server-when-availability-groups-are-already-set-up"></a><span data-ttu-id="e03d6-217">Configurar BizTalk Server cuando ya se configuran los grupos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e03d6-217">Configure BizTalk Server when Availability Groups are already set up</span></span>

1. <span data-ttu-id="e03d6-218">Compruebe los requisitos de sistema operativo:</span><span class="sxs-lookup"><span data-stu-id="e03d6-218">Check your OS requirements:</span></span> 
* <span data-ttu-id="e03d6-219">En todos los **Windows Server 2012 R2** los equipos, instalar el [3090973 revisión MSDTC](https://support.microsoft.com/kb/3090973) (abre un artículo de KB)</span><span class="sxs-lookup"><span data-stu-id="e03d6-219">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
* <span data-ttu-id="e03d6-220">En todos los **Windows Server 2016** equipos, habilite la [clave del registro de RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) (abre un artículo de KB)</span><span class="sxs-lookup"><span data-stu-id="e03d6-220">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
2. <span data-ttu-id="e03d6-221">Asegúrese de que tiene al menos cuatro instancias diferentes de SQL que hospedará las bases de datos de BizTalk distintos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-221">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="e03d6-222">Las réplicas secundarias también se deben configurar en distintas instancias SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-222">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="e03d6-223">Esto da como resultado un mínimo de 8 instancias SQL (1 principal y 1 réplica secundaria para cada uno de las 4 instancias) y un mínimo de 4 grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-223">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="e03d6-224">Vea la ilustración anterior para esta configuración de grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-224">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="e03d6-225">Asegúrese de que los grupos de disponibilidad se crean con el **por el soporte de DTC de base de datos** opción como no se pueden cambiar más adelante.</span><span class="sxs-lookup"><span data-stu-id="e03d6-225">Make sure Availability Groups are created with the **Per Database DTC Support** option as this cannot be changed later.</span></span> 
3. <span data-ttu-id="e03d6-226">Al configurar BizTalk Server y especificar el nombre del servidor SQL, utilice el nombre de agente de escucha del grupo de disponibilidad en lugar del nombre real del equipo.</span><span class="sxs-lookup"><span data-stu-id="e03d6-226">When configuring BizTalk Server and specifying the SQL server name, use the Availability Group’s listener name instead of the actual machine name.</span></span> <span data-ttu-id="e03d6-227">Esto crea las bases de datos de BizTalk, los inicios de sesión y trabajos del Agente SQL en la réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="e03d6-227">This creates the BizTalk databases, logins, and SQL Agent jobs on the current primary replica.</span></span> 
4. <span data-ttu-id="e03d6-228">Detener el procesamiento de BizTalk (instancias de Host, servicio de SSO, IIS, servicio de actualización de motor de reglas, BAMAlerts Service etc.) y detener los trabajos del Agente SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-228">Stop BizTalk processing (Host Instances, SSO Service, IIS, Rules Engine Update Service, BAMAlerts Service, and so on), and stop the SQL Agent Jobs.</span></span> 
5. <span data-ttu-id="e03d6-229">Ahora agregue las bases de datos de BIzTalk a los respectivos grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-229">Now add BIzTalk databases to the respective Availability Groups.</span></span> 
6. <span data-ttu-id="e03d6-230">Incluir cuerpo de pasos de trabajo del Agente SQL en `IF` bloque (mencionado anteriormente) para asegurarse de que ejecute solo si el destino es la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="e03d6-230">Enclose body of SQL Agent job steps within `IF` block (mentioned previously) to make sure they run only if the target is the primary replica.</span></span> 
7. <span data-ttu-id="e03d6-231">Script para los inicios de sesión y trabajos del Agente SQL para replicarlas en réplica correspondiente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-231">Script Logins and SQL Agent Jobs to replicate them on corresponding replica.</span></span> 
8. <span data-ttu-id="e03d6-232">Replicar SQL DBMail perfil y cuenta para las alertas de BAM en instancias correspondientes de SQL que hospeda la réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="e03d6-232">Replicate SQL DBMail Profile and Account for BAM Alerts on corresponding SQL instances hosting the secondary replica.</span></span> 
9. <span data-ttu-id="e03d6-233">Si va a agregar una base de datos de cuadro de mensaje adicional o implementar una nueva actividad/vista de BAM posterior, a continuación, nueva trabajos SQL se crean para nuevas bases de datos de cuadro de mensaje o la base de datos de alertas de BAM en la réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="e03d6-233">If you are adding an additional message box database or deploying a new BAM activity/view later, then new SQL jobs are created for new message box databases or BAM Alerts database on the current primary replica.</span></span> <span data-ttu-id="e03d6-234">Asegúrese de editar en la réplica principal y crearlos manualmente en las réplicas secundarias correspondientes.</span><span class="sxs-lookup"><span data-stu-id="e03d6-234">Make sure to edit it on primary replica, and then create them manually on the corresponding secondary replicas.</span></span> 

<span data-ttu-id="e03d6-235">Esta configuración también se puede realizar con las instancias de SQL que hospeda la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="e03d6-235">This configuration can also be done using the SQL Instances hosting the primary replica.</span></span> <span data-ttu-id="e03d6-236">En este caso, después de la configuración de BizTalk, ejecute el `UpdateDatabase.vbs` y `UpdateRegistry.vbs` las secuencias de comandos en los equipos de BizTalk después de los pasos anteriores.</span><span class="sxs-lookup"><span data-stu-id="e03d6-236">In this case, after the BizTalk configuration, run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines after the above steps.</span></span> <span data-ttu-id="e03d6-237">Esto se explica con más detalle en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-237">This is discussed in more detail in the next section.</span></span>  
 
### <a name="move-biztalk-server-databases-of-an-existing-biztalk-system-to-availability-groups"></a><span data-ttu-id="e03d6-238">Mover bases de datos de BizTalk Server de un sistema de BizTalk existente a grupos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e03d6-238">Move BizTalk Server databases of an existing BizTalk system to Availability Groups</span></span>

1. <span data-ttu-id="e03d6-239">Compruebe los requisitos de sistema operativo:</span><span class="sxs-lookup"><span data-stu-id="e03d6-239">Check your OS requirements:</span></span> 
* <span data-ttu-id="e03d6-240">En todos los **Windows Server 2012 R2** los equipos, instalar el [3090973 revisión MSDTC](https://support.microsoft.com/kb/3090973) (abre un artículo de KB)</span><span class="sxs-lookup"><span data-stu-id="e03d6-240">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
* <span data-ttu-id="e03d6-241">En todos los **Windows Server 2016** equipos, habilite la [clave del registro de RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) (abre un artículo de KB)</span><span class="sxs-lookup"><span data-stu-id="e03d6-241">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
2. <span data-ttu-id="e03d6-242">Asegúrese de que tiene al menos cuatro instancias diferentes de SQL que hospedará las bases de datos de BizTalk distintos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-242">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="e03d6-243">Las réplicas secundarias también se deben configurar en distintas instancias SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-243">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="e03d6-244">Esto da como resultado un mínimo de 8 instancias SQL (1 principal y 1 réplica secundaria para cada uno de las 4 instancias) y un mínimo de 4 grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-244">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="e03d6-245">Vea la ilustración anterior para esta configuración de grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-245">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="e03d6-246">Asegúrese de que los grupos de disponibilidad se crean con **por el soporte de DTC de base de datos** opción como no se pueden cambiar más adelante.</span><span class="sxs-lookup"><span data-stu-id="e03d6-246">Make sure Availability Groups are created with **Per Database DTC Support** option as this cannot be changed later.</span></span>  
3. <span data-ttu-id="e03d6-247">Detener el procesamiento de BizTalk y trabajos del Agente SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-247">Stop BizTalk processing and SQL Agent Jobs.</span></span> 
4. <span data-ttu-id="e03d6-248">Realizar copia de seguridad completa de todas las bases de datos de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-248">Perform full backup of all BizTalk Databases.</span></span> 
5. <span data-ttu-id="e03d6-249">Restaurar bases de datos de BizTalk en las instancias SQL actualmente en el rol principal del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-249">Restore BizTalk databases on the SQL instances currently in the primary role in the Availability Group.</span></span> 
6. <span data-ttu-id="e03d6-250">Secuencia de comandos de los inicios de sesión y el Agente SQL trabajos en instancias de SQL correspondientes actualmente en el rol principal del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-250">Script Logins and SQL Agent jobs on corresponding SQL Instances currently in the primary role in the Availability Group.</span></span>  
7. <span data-ttu-id="e03d6-251">Ejecute el `UpdateDatabase.vbs` y `UpdateRegistry.vbs` las secuencias de comandos en los equipos de BizTalk siguiendo estos pasos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-251">Run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines using the following steps.</span></span> <span data-ttu-id="e03d6-252">Escriba el agente de escucha del grupo de disponibilidad como el nuevo nombre del servidor en el xml de información de actualización de la entrada.</span><span class="sxs-lookup"><span data-stu-id="e03d6-252">Enter the Availability Group Listener as the new server name in the input update info xml.</span></span>  
    1. <span data-ttu-id="e03d6-253">Detenga todos los servicios de SSO empresarial y servicios de BizTalk en BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-253">Stop all BizTalk services and Enterprise SSO services on BizTalk Server.</span></span> <span data-ttu-id="e03d6-254">Detener servicio Agente SQL en SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-254">Stop SQL Agent Service on SQL Server.</span></span> 
    2. <span data-ttu-id="e03d6-255">En BizTalk Server, edite SampleUpdateInfo.xml en la siguiente carpeta:</span><span class="sxs-lookup"><span data-stu-id="e03d6-255">On BizTalk Server, edit SampleUpdateInfo.xml in the following folder:</span></span> 
 
        <span data-ttu-id="e03d6-256">equipo de 32 bits:`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-256">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="e03d6-257">equipo de 64 bits:`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-257">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span>
 
            1. Replace "SourceServer" with the source server name (old SQL Server hosting old databases).  
            2. Replace "DestinationServer" with the name of the destination server, which should be the availability group listener name.  
            3. If you have the BAMAnalysis, BAM databases or RuleEngineDB, uncomment the appropriate sections. 

    3. <span data-ttu-id="e03d6-258">Abra un símbolo del sistema y vaya a:</span><span class="sxs-lookup"><span data-stu-id="e03d6-258">Open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="e03d6-259">equipo de 32 bits:`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-259">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e03d6-260">equipo de 64 bits:`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-260">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e03d6-261">En el símbolo del sistema, ejecute:</span><span class="sxs-lookup"><span data-stu-id="e03d6-261">At the command prompt, run:</span></span>  
    `cscript UpdateDatabase.vbs SampleUpdateInfo.xml`  
 
        <span data-ttu-id="e03d6-262">Ejecutar UpdateDatabase.vbs en un solo servidor en el grupo de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-262">Run UpdateDatabase.vbs on only one server in the BizTalk group.</span></span> 

    4. <span data-ttu-id="e03d6-263">Copie el archivo SampleUpdateInfo.xml editado en la carpeta siguiente en cada equipo de servidor BizTalk Server de este grupo de BizTalk:</span><span class="sxs-lookup"><span data-stu-id="e03d6-263">Copy the edited SampleUpdateInfo.xml file to the following folder on every BizTalk Server computer in this BizTalk group:</span></span> 
 
        <span data-ttu-id="e03d6-264">equipo de 32 bits:`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-264">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e03d6-265">equipo de 64 bits:`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-265">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
    5. <span data-ttu-id="e03d6-266">En cada equipo en el grupo de BizTalk Server, abra un símbolo del sistema y vaya a:</span><span class="sxs-lookup"><span data-stu-id="e03d6-266">On each computer in the BizTalk Server group, open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="e03d6-267">equipo de 32 bits:`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-267">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="e03d6-268">equipo de 64 bits:`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e03d6-268">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e03d6-269">En el símbolo del sistema, ejecute:</span><span class="sxs-lookup"><span data-stu-id="e03d6-269">At the command prompt, run:</span></span>  
    `cscript UpdateRegistry.vbs SampleUpdateInfo.xml` 
 
        <span data-ttu-id="e03d6-270">Ejecute UpdateRegistry.vbs en todos los servidores del grupo de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-270">Run UpdateRegistry.vbs on every server in the BizTalk group.</span></span> 
 
8. <span data-ttu-id="e03d6-271">Ahora puede mover las bases de datos a sus respectivos grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-271">Now move the databases to their respective Availability Groups.</span></span> 
9. <span data-ttu-id="e03d6-272">Replicar el perfil de DBMail de SQL y la cuenta para las alertas de BAM en la instrucción SQL instancias hospeda la réplica de la base de datos de BAMAlerts.</span><span class="sxs-lookup"><span data-stu-id="e03d6-272">Replicate the SQL DBMail Profile and Account for BAM Alerts on the SQL instances hosting the replica of the BAMAlerts database.</span></span> 
10. <span data-ttu-id="e03d6-273">Ponga el cuerpo de pasos de trabajo del Agente SQL dentro de un bloque IF para asegurarse de que ejecute solo si el destino es el principal.</span><span class="sxs-lookup"><span data-stu-id="e03d6-273">Enclose the body of SQL Agent job steps within an IF block to make sure they run only if the target is the primary.</span></span> 
11. <span data-ttu-id="e03d6-274">Script para los inicios de sesión y trabajos del Agente SQL para replicarlas en la réplica correspondiente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-274">Script Logins and SQL Agent Jobs to replicate them on the corresponding replica.</span></span> <span data-ttu-id="e03d6-275">La secuencia de comandos UpdateDatabase también actualiza el nombre del servidor en los trabajos de Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb y TrackedMessages_Copy_BizTalkMsgBoxDb.</span><span class="sxs-lookup"><span data-stu-id="e03d6-275">The UpdateDatabase script also updates the server name in the Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb and TrackedMessages_Copy_BizTalkMsgBoxDb jobs.</span></span> <span data-ttu-id="e03d6-276">Secuencia de comandos por lo que los trabajos del Agente SQL sólo después de ejecutar el script UpdateDatabase.</span><span class="sxs-lookup"><span data-stu-id="e03d6-276">So script the SQL Agent Jobs only after running the UpdateDatabase script.</span></span> 

## <a name="requirements"></a><span data-ttu-id="e03d6-277">Requisitos</span><span class="sxs-lookup"><span data-stu-id="e03d6-277">Requirements</span></span> 
* <span data-ttu-id="e03d6-278">BizTalk Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="e03d6-278">BizTalk Server 2016 Enterprise</span></span>
* <span data-ttu-id="e03d6-279">Corporativo de SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="e03d6-279">SQL Server 2016 Enterprise</span></span>
* <span data-ttu-id="e03d6-280">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="e03d6-280">Windows Server 2012 R2</span></span>
* <span data-ttu-id="e03d6-281">Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="e03d6-281">Windows Server 2016</span></span> 

### <a name="availability-group-listener-configured-with-non-default-port-1433"></a><span data-ttu-id="e03d6-282">Agente de escucha de grupo de disponibilidad configurado tiene un valor no predeterminado (1433) de puerto</span><span class="sxs-lookup"><span data-stu-id="e03d6-282">Availability Group Listener configured with non-default port (1433)</span></span> 
<span data-ttu-id="e03d6-283">Usar SQL alias en máquinas de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-283">Use SQL alias on BizTalk Server machines.</span></span> 

### <a name="supporting-availability-group-multi-subnet-failovers"></a><span data-ttu-id="e03d6-284">Compatibilidad con clústeres de conmutación por error de varias subredes de grupo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e03d6-284">Supporting Availability Group Multi-Subnet Failovers</span></span> 
<span data-ttu-id="e03d6-285">BizTalk Server utiliza OLE DB de Microsoft para las conexiones de base de datos, que no admite la **MultiSubnetFailover** opción de conexión.</span><span class="sxs-lookup"><span data-stu-id="e03d6-285">BizTalk Server uses Microsoft OLE DB for database connections, which does not support the **MultiSubnetFailover** connection option.</span></span> <span data-ttu-id="e03d6-286">BizTalk Server no admite el `MultiSubnetFailover (=TRUE)` opción de conexión y esto pueden provocar el mayor tiempo de recuperación durante la conmutación por error de múltiples subredes.</span><span class="sxs-lookup"><span data-stu-id="e03d6-286">BizTalk Server does not support the `MultiSubnetFailover (=TRUE)` connection option, and this may cause higher recovery time during multi-subnet failover.</span></span> 

### <a name="read-only-routing"></a><span data-ttu-id="e03d6-287">Enrutamiento de solo lectura</span><span class="sxs-lookup"><span data-stu-id="e03d6-287">Read-Only Routing</span></span> 
<span data-ttu-id="e03d6-288">Enrutamiento de solo lectura se refiere a la capacidad de SQL Server para enrutar las conexiones entrantes de un agente de escucha del grupo de disponibilidad a una réplica secundaria que está configurada para permitir las cargas de trabajo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e03d6-288">Read-only routing refers to the ability of SQL Server to route incoming connections for an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> 

<span data-ttu-id="e03d6-289">BizTalk no usa enrutamiento de solo lectura para cualquiera de las conexiones a sus bases de datos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-289">BizTalk does not use Read-Only Routing for any of the connections to its databases.</span></span> <span data-ttu-id="e03d6-290">Esto significa que la opción "Secundaria legible" en las réplicas de disponibilidad del grupo de disponibilidad no tiene ningún efecto en las conexiones de base de datos de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-290">This means the “Readable Secondary” option on Availability Replicas in the availability group does not have any impact on BizTalk database connections.</span></span> 

### <a name="behavior-of-biztalk-server-host-instances-during-sql-server-failover"></a><span data-ttu-id="e03d6-291">Comportamiento de las instancias de host de BizTalk Server durante la conmutación por error de SQL Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-291">Behavior of BizTalk Server Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="e03d6-292">Si el grupo de disponibilidad de SQL Server produce una conmutación por error, las bases de datos de BizTalk Server en el grupo de disponibilidad están disponibles temporalmente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-292">If the SQL Server availability group experiences a failover, the BizTalk Server databases on the availability group are temporarily unavailable.</span></span> 

#### <a name="behavior-of-in-process-host-instances-during-sql-server-failover"></a><span data-ttu-id="e03d6-293">Comportamiento de las instancias de host de tipo En curso durante la conmutación por error de SQL Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-293">Behavior of In-Process Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="e03d6-294">Si no están disponibles las bases de datos de BizTalk Server, una instancia en curso de un host de BizTalk Server se recicla hasta que se restaure la conexión a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-294">If the BizTalk Server databases are unavailable, then an in-process instance of a BizTalk Server host is recycled until the connection to the SQL Server is restored.</span></span> <span data-ttu-id="e03d6-295">Una vez que se restaure la conexión a las bases de datos de SQL Server, el procesamiento de documentos se reanuda normalmente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-295">Once the connection to the SQL Server databases is restored, document processing resumes normally.</span></span>
 
#### <a name="behavior-of-isolated-host-instances-during-sql-server-failover"></a><span data-ttu-id="e03d6-296">Comportamiento de las instancias de host aisladas durante la conmutación por error de SQL Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-296">Behavior of Isolated Host Instances During SQL Server Failover</span></span> 
<span data-ttu-id="e03d6-297">Si las bases de datos de BizTalk Server no están disponibles, a continuación, detiene la instancia aislada de un host de BizTalk Server y se genera un error similar al siguiente en el registro de aplicación de BizTalk Server:</span><span class="sxs-lookup"><span data-stu-id="e03d6-297">If the BizTalk Server databases are unavailable, then an isolated instance of a BizTalk Server host pauses, and an error similar to the following is generated in the BizTalk Server Application log:</span></span> 

    All receive locations are being temporarily disabled because either the MessageBox or Configuration database is not available. When these databases become available, the receive locations will be automatically enabled.
 
<span data-ttu-id="e03d6-298">Una vez que se restaure la conexión a las bases de datos de SQL Server, se escribe un mensaje informativo similar al siguiente en el registro de aplicación de BizTalk Server y, a continuación, reanuda el procesamiento de documentos con normalidad:</span><span class="sxs-lookup"><span data-stu-id="e03d6-298">Once the connection to the SQL Server databases is restored, an informational message similar to the following is written to the BizTalk Server Application log, and then document processing resumes normally:</span></span> 

    All receive locations are being enabled because both the MessageBox and Configuration databases are back online.

#### <a name="biztalk-server-log-shipping-for-disaster-recovery"></a><span data-ttu-id="e03d6-299">El servidor BizTalk Server trasvase de registros para recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="e03d6-299">BizTalk Server Log Shipping for Disaster Recovery</span></span> 
<span data-ttu-id="e03d6-300">BizTalk Server incorpora capacidades en espera de base de datos mediante el uso de la base de datos de trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="e03d6-300">BizTalk Server implements database standby capabilities through the use of database log shipping.</span></span> <span data-ttu-id="e03d6-301">Se produce un error en BizTalk Server trasvase de registros automatiza la copia de seguridad y restauración de bases de datos y sus archivos de registro de transacciones, lo que permite un servidor en espera reanudar el procesamiento de base de datos en caso de que el servidor de base de datos de producción.</span><span class="sxs-lookup"><span data-stu-id="e03d6-301">BizTalk Server log shipping automates the backup and restore of databases and their transaction log files, allowing a standby server to resume database processing in the event that the production database server fails.</span></span> 

<span data-ttu-id="e03d6-302">**Bases de datos secundarias en el grupo de disponibilidad no son copias de seguridad.**</span><span class="sxs-lookup"><span data-stu-id="e03d6-302">**Secondary databases in availability group are not backups.**</span></span> <span data-ttu-id="e03d6-303">Continuar con copias de seguridad de bases de datos de BizTalk y sus registros de transacciones con los trabajos de trasvase de registros de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-303">Continue to backup BizTalk databases and their transaction logs using BizTalk Server Log Shipping jobs.</span></span> <span data-ttu-id="e03d6-304">La manera en que se implementa el trasvase de registros de BizTalk garantiza que siempre se realizan copias de seguridad en la réplica principal actual de cada base de datos.</span><span class="sxs-lookup"><span data-stu-id="e03d6-304">The way BizTalk Log Shipping is implemented ensures that backups are always performed against the current primary replica of every database.</span></span> <span data-ttu-id="e03d6-305">El valor de preferencia de copia de seguridad en el grupo de disponibilidad no se respeta los trabajos de trasvase de registros de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="e03d6-305">The backup preference setting on the availability group is not honored by the BizTalk Server Log Shipping jobs.</span></span> 

<span data-ttu-id="e03d6-306">Si va a agregar otras bases de datos de BizTalk para el trabajo de copia de seguridad de bases de datos de BizTalk, asegúrese de utilizar el nombre de agente de escucha de grupo de disponibilidad como el servidor de base de datos para ellos al configurar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-306">If you are adding other BizTalk databases to the BizTalk Databases Backup job, be sure to use the Availability Group Listener name as the database server for them when setting up the Backup.</span></span>  
 
## <a name="references"></a><span data-ttu-id="e03d6-307">Referencias</span><span class="sxs-lookup"><span data-stu-id="e03d6-307">References</span></span> 
 
* [<span data-ttu-id="e03d6-308">Proporcionar una alta disponibilidad para bases de datos de servidor BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-308">Providing High Availability for BizTalk Server Databases</span></span>](../core/providing-high-availability-for-biztalk-server-databases.md)  
* [<span data-ttu-id="e03d6-309">Soporte de software de servidor de Microsoft para máquinas virtuales de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="e03d6-309">Microsoft server software support for Microsoft Azure virtual machines</span></span>](https://support.microsoft.com/kb/2721672)  
* [<span data-ttu-id="e03d6-310">Creación de reflejo, servicio de instantáneas de volumen y AlwaysOn de base de datos de SQL Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-310">SQL Server database mirroring, Volume Shadow Copy service and AlwaysOn</span></span>](../core/sql-server-database-mirroring-volume-shadow-copy-service-and-alwayson.md)  
* [<span data-ttu-id="e03d6-311">Información general de los grupos de disponibilidad AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e03d6-311">Overview of AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ff877884.aspx)  
* [<span data-ttu-id="e03d6-312">Compatibilidad para las transacciones entre bases de datos para la creación de reflejo de base de datos o grupos de disponibilidad AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e03d6-312">Cross-Database Transactions Support For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ms366279.aspx)  
* [<span data-ttu-id="e03d6-313">No se puede llamar Reenlist cuando SQL Server recibe el resultado de la transacción de MSDTC en Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="e03d6-313">Reenlist can't be called when SQL Server receives transaction outcome from MSDTC in Windows Server 2012 R2</span></span>](https://support.microsoft.com/kb/3090973)  
* [<span data-ttu-id="e03d6-314">Realizar una copia de seguridad y una restauración de las bases de datos de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-314">Backing Up and Restoring BizTalk Server Databases</span></span>](../core/backing-up-and-restoring-biztalk-server-databases.md)  
* [<span data-ttu-id="e03d6-315">Cómo mover las bases de datos de servidor BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="e03d6-315">How to Move the BizTalk Server Databases</span></span>](../core/how-to-move-the-biztalk-server-databases.md)  
* [<span data-ttu-id="e03d6-316">Cómo restaurar las bases de datos</span><span class="sxs-lookup"><span data-stu-id="e03d6-316">How to Restore Your Databases</span></span>](../core/how-to-restore-your-databases.md)   
* [<span data-ttu-id="e03d6-317">Tiempos de espera de conexión en el grupo de disponibilidad de varias subredes</span><span class="sxs-lookup"><span data-stu-id="e03d6-317">Connection Timeouts in Multi-subnet Availability Group</span></span>](https://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/)  
 
## <a name="known-limitations"></a><span data-ttu-id="e03d6-318">Limitaciones conocidas</span><span class="sxs-lookup"><span data-stu-id="e03d6-318">Known limitations</span></span> 

<span data-ttu-id="e03d6-319">Estas limitaciones son para BizTalk Server, SQL Server AlwaysOn disponibilidad el grupo y máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-319">These limitations are for BizTalk Server, SQL Server AlwaysOn Availability Group, and Azure Virtual Machines.</span></span> <span data-ttu-id="e03d6-320">Estas limitaciones pueden o no se pueden obtener solucionadas en el futuro.</span><span class="sxs-lookup"><span data-stu-id="e03d6-320">These limitations may or may not get addressed in future.</span></span> 

* <span data-ttu-id="e03d6-321">No se administran los inicios de sesión, trabajos del Agente SQL, el perfil de correo electrónico de base de datos de SQL y las cuentas dentro de grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-321">Logins, SQL Agent Jobs, the SQL DB Mail profile, and accounts are not managed within Availability Groups.</span></span> <span data-ttu-id="e03d6-322">Esto requiere una modificación manual de trabajos para asegurarse de que se ejecutan en la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="e03d6-322">This requires manual modification in Jobs to make sure they run against the primary replica.</span></span> 
* <span data-ttu-id="e03d6-323">SQL Server Analysis Services y SQL Server Integration Services no participar en grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-323">SQL Server Analysis Services and SQL Server Integration Services do not participate in Availability Groups.</span></span> <span data-ttu-id="e03d6-324">Sin esta compatibilidad de SQL Server, no hay ninguna solución de alta disponibilidad para estas máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e03d6-324">Without this support from SQL Server, there is no HA solution for these in Azure Virtual Machines.</span></span> <span data-ttu-id="e03d6-325">Capacidades BAM de BizTalk Server dependen de estos servicios.</span><span class="sxs-lookup"><span data-stu-id="e03d6-325">BizTalk Server’s BAM capabilities are dependent on these services.</span></span> 
* <span data-ttu-id="e03d6-326">Grupos de disponibilidad no es compatible con MSDTC entre bases de datos en la misma instancia SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-326">Availability Groups does not support MSDTC between databases on the same SQL instance.</span></span> <span data-ttu-id="e03d6-327">Por lo tanto, un mínimo 8 instancias SQL necesarios para configurar BizTalk.</span><span class="sxs-lookup"><span data-stu-id="e03d6-327">Therefore, a minimum 8 SQL instances are required to configure BizTalk.</span></span> 
* <span data-ttu-id="e03d6-328">Para solucionar MSDTC limitaciones con grupos de disponibilidad, las bases de datos de BizTalk pueden configurarse con un mínimo de dos servidores que hospedan cuatro instancias SQL.</span><span class="sxs-lookup"><span data-stu-id="e03d6-328">To address MSDTC limitations with Availability Groups, BizTalk databases can be configured using a minimum of two servers hosting four SQL instances each.</span></span> <span data-ttu-id="e03d6-329">Sin embargo, en Azure máquinas virtuales, ILB no admiten varias direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="e03d6-329">However, in Azure Virtual Machines, ILB does not support multiple IP addresses.</span></span> <span data-ttu-id="e03d6-330">Esto obliga a crear cada instancia de SQL en un servidor independiente.</span><span class="sxs-lookup"><span data-stu-id="e03d6-330">This forces us to create each instance of SQL on a separate server.</span></span> 
* <span data-ttu-id="e03d6-331">BizTalk Server no puede usar enrutamiento de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e03d6-331">BizTalk Server cannot use Read-Only Routing.</span></span> 
* <span data-ttu-id="e03d6-332">BizTalk Server no establece la `MultiSubnetFailover` propiedad de conexión.</span><span class="sxs-lookup"><span data-stu-id="e03d6-332">BizTalk Server does not set the `MultiSubnetFailover` connection property.</span></span> 
* <span data-ttu-id="e03d6-333">Trabajos de copia de seguridad de BizTalk mediante el trasvase de registros siempre tendrán como destino la réplica principal, independientemente de la preferencia de copia de seguridad definida en el grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e03d6-333">BizTalk Backup Jobs using Log Shipping will always target the primary replica irrespective of the backup preference set on the Availability Group.</span></span> 
 