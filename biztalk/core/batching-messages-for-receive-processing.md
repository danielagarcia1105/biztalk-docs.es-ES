---
title: Procesamiento de recepción de mensajes por lotes para | Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 32bf0b70-e9d1-4fab-9c74-160e51390700
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 21ce691f51d6c389073c98dadc9ce0f5dfb68504
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/27/2018
ms.locfileid: "36971061"
---
# <a name="batching-messages-for-receive-processing"></a><span data-ttu-id="6f674-102">Procesar mensajes por lotes para el procesamiento de recepción</span><span class="sxs-lookup"><span data-stu-id="6f674-102">Batching Messages for Receive Processing</span></span>
## <a name="batch-callbacks"></a><span data-ttu-id="6f674-103">Devoluciones de llamada por lotes</span><span class="sxs-lookup"><span data-stu-id="6f674-103">Batch Callbacks</span></span>  
 <span data-ttu-id="6f674-104">Los lotes que los adaptadores de recepción envían al motor de mensajería se procesan de forma asíncrona.</span><span class="sxs-lookup"><span data-stu-id="6f674-104">Batches submitted by receive adapters to the Messaging Engine are processed asynchronously.</span></span> <span data-ttu-id="6f674-105">En consecuencia, los adaptadores necesitan un mecanismo para asociar una devolución de llamada a algún estado de adaptador con el fin de que se les pueda notificar sobre las acciones concluidas correctamente o con errores, así como llevar a cabo cualquier acción de limpieza que sea necesaria.</span><span class="sxs-lookup"><span data-stu-id="6f674-105">Therefore the adapter needs a mechanism to tie a callback to some state in the adapter so it can be notified of success or failure and perform any necessary cleanup actions.</span></span> <span data-ttu-id="6f674-106">La semántica de devolución de llamada es flexible para que los adaptadores puedan utilizar uno de los tres enfoques siguientes o una combinación de éstos.</span><span class="sxs-lookup"><span data-stu-id="6f674-106">The callback semantics are flexible such that adapters can use one or a combination of three approaches.</span></span> <span data-ttu-id="6f674-107">Los enfoques son:</span><span class="sxs-lookup"><span data-stu-id="6f674-107">These are:</span></span>  
  
- <span data-ttu-id="6f674-108">Todas las devoluciones de llamada se realizan en la misma instancia de objeto que implementa **IBTBatchCallBack**.</span><span class="sxs-lookup"><span data-stu-id="6f674-108">All callbacks are made on the same object instance that implements **IBTBatchCallBack**.</span></span>  
  
- <span data-ttu-id="6f674-109">La cookie pasada al motor al solicitar un nuevo lote se utiliza para correlacionar la devolución de llamada con el estado de los adaptadores.</span><span class="sxs-lookup"><span data-stu-id="6f674-109">The cookie passed into the engine when requesting a new batch is used to correlate the callback to the state in the adapters.</span></span>  
  
- <span data-ttu-id="6f674-110">Hay un objeto de devolución de llamada distinto para cada lote que implementa **IBTBatchCallBack**.</span><span class="sxs-lookup"><span data-stu-id="6f674-110">There is a different callback object for each batch that implements **IBTBatchCallBack**.</span></span> <span data-ttu-id="6f674-111">En este caso, cada objeto mantiene su propio estado privado.</span><span class="sxs-lookup"><span data-stu-id="6f674-111">Here each object holds its own private state.</span></span>  
  
  <span data-ttu-id="6f674-112">Cuando se haya procesado el lote, el adaptador se denomina volver en su implementación de **IBTBatchCallBack.BatchComplete**.</span><span class="sxs-lookup"><span data-stu-id="6f674-112">When the batch has been processed, the adapter is called back on its implementation of **IBTBatchCallBack.BatchComplete**.</span></span> <span data-ttu-id="6f674-113">El primer parámetro, el estado HRESULT, indica el estado general del lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-113">The overall status of the batch is indicated by the first parameter, the HRESULT status.</span></span> <span data-ttu-id="6f674-114">Si este valor es igual o superior a cero, el lote se ha procesado correctamente, en el sentido de que el motor tiene la propiedad de los datos y el adaptador puede eliminarlos de la red.</span><span class="sxs-lookup"><span data-stu-id="6f674-114">If this value is greater than or equal to zero, then the batch was successful in the sense that the engine has ownership of the data and the adapter is free to delete that data from the wire.</span></span> <span data-ttu-id="6f674-115">Un estado negativo indica que el lote no se pudo: ninguna de las operaciones del lote se efectuó correctamente y el adaptador es responsable de controlar el error.</span><span class="sxs-lookup"><span data-stu-id="6f674-115">A negative status indicates that the batch failed: None of the operations in the batch were successful and the adapter is responsible for handling the failure.</span></span>  
  
  <span data-ttu-id="6f674-116">Si se producen errores en el lote, el adaptador necesita saber qué elemento de qué operación causó esos errores.</span><span class="sxs-lookup"><span data-stu-id="6f674-116">If the batch failed, then the adapter needs to know which item in which operation failed.</span></span> <span data-ttu-id="6f674-117">Por ejemplo, suponga que el adaptador lee 20 archivos de disco y los envía a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] mediante un único lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-117">For example, suppose that the adapter was reading 20 files from disk and submitting them into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] using a single batch.</span></span> <span data-ttu-id="6f674-118">Si el décimo archivo está dañado, el adaptador necesitará suspender ese archivo y volver a enviar los otros 19.</span><span class="sxs-lookup"><span data-stu-id="6f674-118">If the tenth file was corrupted, the adapter would need to suspend that one file and resubmit the remaining 19.</span></span> <span data-ttu-id="6f674-119">Esta información está disponible para el adaptador en los parámetros segundo y tercero:`opCount` (número de operaciones) de tipo corto y `operationStatus`, que es de tipo BTBatchOperationStatus [].</span><span class="sxs-lookup"><span data-stu-id="6f674-119">This information is available to the adapter in the second and third parameters—`opCount` (operation count) of type short and `operationStatus`, which is of type BTBatchOperationStatus[].</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6f674-120">En un objeto de lote único, nunca debe enviar un mensaje más de una vez.</span><span class="sxs-lookup"><span data-stu-id="6f674-120">On a single batch object you should never submit a message more than once.</span></span> <span data-ttu-id="6f674-121">Si se envía el mismo objeto de mensaje varias veces en el mismo lote, se producirán errores en el motor.</span><span class="sxs-lookup"><span data-stu-id="6f674-121">Submitting the same message object more than once on the same batch will result in engine errors.</span></span>  
  
 <span data-ttu-id="6f674-122">El número de operaciones indica cuántos tipos de operaciones que se encontraban en el lote (el tamaño de la **BTBatchOperationStatus** matriz).</span><span class="sxs-lookup"><span data-stu-id="6f674-122">The operation count indicates how many types of operations were in the batch (the size of the **BTBatchOperationStatus** array).</span></span> <span data-ttu-id="6f674-123">Cada uno de los elementos de la matriz de estados de operaciones corresponde a un tipo de operación dado.</span><span class="sxs-lookup"><span data-stu-id="6f674-123">Each element in the operation status array corresponds to a given operation type.</span></span> <span data-ttu-id="6f674-124">Mediante el uso de la **BTBatchOperationStatus** matriz, el adaptador puede determinar qué elemento de una operación determinada no se pudo examinando el **BTBatchOperationStatus.MessageStatus** matriz para HRESULT negativo valores de error.</span><span class="sxs-lookup"><span data-stu-id="6f674-124">By using the **BTBatchOperationStatus** array, the adapter can determine which item in a given operation failed by looking at the **BTBatchOperationStatus.MessageStatus** array for negative HRESULT values signifying failure.</span></span> <span data-ttu-id="6f674-125">En el escenario anterior, el adaptador crea un nuevo lote con el envío de 19 mensajes y la suspensión de 1 mensaje.</span><span class="sxs-lookup"><span data-stu-id="6f674-125">In the scenario above, the adapter creates a new batch containing 19 message submits and one message suspend.</span></span>  
  
 <span data-ttu-id="6f674-126">El fragmento de código siguiente muestra cómo un adaptador efectúa una solicitud de un nuevo lote desde el motor a través del proxy de transporte y envía un mensaje único al motor mediante el enfoque de cookies.</span><span class="sxs-lookup"><span data-stu-id="6f674-126">The following code fragment shows how an adapter requests a new batch from the engine through its transport proxy and submits a single message into the engine using the cookie approach.</span></span> <span data-ttu-id="6f674-127">El motor de mensajería llama a la **BatchComplete** enviado de método como la devolución de llamada por lotes cuando se haya completado el procesamiento de todo el lote de mensajes.</span><span class="sxs-lookup"><span data-stu-id="6f674-127">The Messaging Engine calls the **BatchComplete** method as the batch callback when it has completed processing the entire batch of submitted messages.</span></span>  
  
```  
using Microsoft.BizTalk.TransportProxy.Interop;  
using Microsoft.BizTalk.Message.Interop;  
  
public class MyAdapter :   
                  IBTTransport,   
                  IBTTransportConfig,   
                  IBTTransportControl,  
                  IPersistPropertyBag,   
                  IBaseComponent,  
                  IBTBatchCallBack  
{  
      private IBTTransportProxy _tp;  
  
      public void BatchComplete(      
            Int32                         status,   
            Int16                         opCount,   
            BTBatchOperationStatus[]      operationStatus,   
            System.Object                 callbackCookie)  
      {  
            // Use cookie to correlate callback with work done,  
            // in this example the batch is to submit a single  
            // file the name of which will be in the  
            // callbackCookie  
            string fileName = (string)callbackCookie;  
            if ( status >= 0 )  
                  // DeleteFile from disc  
                  File.Delete(fileName);          
            else  
                  // Rename file to fileName.bad  
                  File.Move(fileName, fileName + ".bad");  
      }  
  
      private void SubmitMessage(  
            IBaseMessage                  msg,   
            string                        fileName)  
      {  
            // Note: Pass in the filename as the cookie  
            IBTTransportBatch batch =   
                  _tp.GetBatch(this, (object)fileName);  
  
            // Add msg to batch for submitting   
            batch.SubmitMessage(msg);   
  
            // Process this batch  
            batch.Done(null);  
      }  
}  
```  
  
 <span data-ttu-id="6f674-128">El [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SDK incluye ejemplos para los siguientes adaptadores: archivo, HTTP, MSMQ y el adaptador transaccional.</span><span class="sxs-lookup"><span data-stu-id="6f674-128">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SDK includes samples for the following adapters: File, HTTP, MSMQ, and the Transactional Adapter.</span></span> <span data-ttu-id="6f674-129">Todos estos adaptadores se crean sobre un bloque de creación común denominado BaseAdapter.</span><span class="sxs-lookup"><span data-stu-id="6f674-129">All of these adapters are built on top of a common building block called the BaseAdapter.</span></span> <span data-ttu-id="6f674-130">La versión 1.0.1 de BaseAdapter incluye todo el código relevante para analizar el estado de la operación y volver a crear un nuevo lote para su envío.</span><span class="sxs-lookup"><span data-stu-id="6f674-130">Version 1.0.1 of the BaseAdapter includes all of the relevant code to parse the operation status and rebuild a new batch to submit.</span></span>  
  
## <a name="race-condition"></a><span data-ttu-id="6f674-131">Condición de carrera</span><span class="sxs-lookup"><span data-stu-id="6f674-131">Race Condition</span></span>  
 <span data-ttu-id="6f674-132">Las dos tareas de resolución de errores y decisión del resultado final de un lote enviado parecen bastante sencillas, pero en realidad se basan en información procedente de varios subprocesos:</span><span class="sxs-lookup"><span data-stu-id="6f674-132">The two tasks of resolving errors and deciding the final outcome of a submitted batch seem simple enough, but in fact they rely on information from different threads:</span></span>  
  
- <span data-ttu-id="6f674-133">El adaptador procesa los errores basándose en información pasada [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] para el adaptador **BatchComplete** método de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="6f674-133">The adapter processes errors based on information passed by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to the adapter's **BatchComplete** callback method.</span></span> <span data-ttu-id="6f674-134">Esta devolución de llamada se ejecuta en el subproceso del adaptador.</span><span class="sxs-lookup"><span data-stu-id="6f674-134">This callback executes on the adapter's thread.</span></span>  
  
- <span data-ttu-id="6f674-135">**DTCCommitConfirm** es un método en el **IBTDTCCommitConfirm** objeto.</span><span class="sxs-lookup"><span data-stu-id="6f674-135">**DTCCommitConfirm** is a method on the **IBTDTCCommitConfirm** object.</span></span> <span data-ttu-id="6f674-136">Una instancia de la **IBTDTCCommitConfirm** objeto devuelto por el lote **ibttransportbatch:: Done** llamar.</span><span class="sxs-lookup"><span data-stu-id="6f674-136">An instance of the **IBTDTCCommitConfirm** object is returned by the batch **IBTTransportBatch::Done** call.</span></span> <span data-ttu-id="6f674-137">Esta instancia está en el mismo subproceso que la **ibttransportbatch:: Done** llamar, que es diferente del subproceso de devolución de llamada del adaptador.</span><span class="sxs-lookup"><span data-stu-id="6f674-137">This instance is on the same thread as the **IBTTransportBatch::Done** call, which is different from the adapter's callback thread.</span></span>  
  
  <span data-ttu-id="6f674-138">Para todas las llamadas que el adaptador efectúa a **ibttransportbatch:: Done** el motor de mensajería realiza la llamada correspondiente al método de devolución de llamada **BatchComplete** en un subproceso independiente para informar del resultado de la envío del lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-138">For every call that the adapter makes to **IBTTransportBatch::Done** the Messaging Engine makes a corresponding call to the callback method **BatchComplete** in a separate thread to report the result of the batch submission.</span></span> <span data-ttu-id="6f674-139">En **BatchComplete** el adaptador debe confirmar o revertir la transacción en función de si el lote superado o no superado.</span><span class="sxs-lookup"><span data-stu-id="6f674-139">In **BatchComplete** the adapter needs to commit or roll back the transaction based on whether the batch passed or failed.</span></span> <span data-ttu-id="6f674-140">En cualquier caso, el adaptador debe llamar a **DTCCommitConfirm** para informar del estado de la transacción.</span><span class="sxs-lookup"><span data-stu-id="6f674-140">In either case, the adapter should then call **DTCCommitConfirm** to report the status of the transaction.</span></span>  
  
  <span data-ttu-id="6f674-141">Una posible condición de carrera se produce porque la implementación del adaptador de **BatchComplete** puede asumir que el **IBTDTCCommitConfirm** objeto devuelto por **ibttransportbatch:: Done** siempre está disponible cuando **BatchComplete** ejecuta.</span><span class="sxs-lookup"><span data-stu-id="6f674-141">A possible race condition exists because the adapter’s implementation of **BatchComplete** can assume that the **IBTDTCCommitConfirm** object returned by **IBTTransportBatch::Done** is always available when **BatchComplete** executes.</span></span> <span data-ttu-id="6f674-142">Sin embargo, **BatchComplete** puede llamarse en un subproceso independiente del motor de mensajería, incluso antes **ibttransportbatch:: Done** devuelve.</span><span class="sxs-lookup"><span data-stu-id="6f674-142">However, **BatchComplete** can be called in a separate Messaging Engine thread, even before **IBTTransportBatch::Done** returns.</span></span> <span data-ttu-id="6f674-143">Es posible que cuando el adaptador intente obtener acceso a la **IBTDTCCommitConfirm** objeto como parte de la **BatchComplete** implementación, hay una infracción de acceso porque el subproceso de llamada ya no existe.</span><span class="sxs-lookup"><span data-stu-id="6f674-143">It is possible that when the adapter tries to access the **IBTDTCCommitConfirm** object as a part of the **BatchComplete** implementation, there is an access violation because that calling thread no longer exists.</span></span> <span data-ttu-id="6f674-144">Para evitar este problema, ponga en práctica lo que se especifica a continuación.</span><span class="sxs-lookup"><span data-stu-id="6f674-144">Use the following solution to avoid this condition.</span></span>  
  
  <span data-ttu-id="6f674-145">En el siguiente ejemplo, el problema se soluciona con el uso de un evento.</span><span class="sxs-lookup"><span data-stu-id="6f674-145">In the following example, the problem is solved by using an event.</span></span> <span data-ttu-id="6f674-146">En este caso, se tiene acceso al puntero de la interfaz mediante una propiedad que utiliza el evento.</span><span class="sxs-lookup"><span data-stu-id="6f674-146">Here the interface pointer is accessed through a property that uses the event.</span></span> <span data-ttu-id="6f674-147">get siempre espera a que set finalice para comenzar.</span><span class="sxs-lookup"><span data-stu-id="6f674-147">The get always waits for the set to complete before proceeding.</span></span>  
  
```  
protected IBTDTCCommitConfirm CommitConfirm  
{  
      set  
      {  
            this.commitConfirm = value;  
            this.commitConfirmEvent.Set();  
      }  
      get  
      {  
            this.commitConfirmEvent.WaitOne();  
            return this.commitConfirm;  
      }  
}  
protected IBTDTCCommitConfirm commitConfirm = null;  
private ManualResetEvent commitConfirmEvent = new ManualResetEvent(false);  
```  
  
## <a name="batch-status-codes"></a><span data-ttu-id="6f674-148">Códigos de estado de lotes</span><span class="sxs-lookup"><span data-stu-id="6f674-148">Batch Status Codes</span></span>  
 <span data-ttu-id="6f674-149">El código de estado de lote general indica el resultado del lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-149">The overall batch status code indicates the outcome of the batch.</span></span> <span data-ttu-id="6f674-150">El estado de la operación ofrece el código de estado de envío de los elementos de mensajes individuales.</span><span class="sxs-lookup"><span data-stu-id="6f674-150">The operation status gives the submission status code for individual message items.</span></span> <span data-ttu-id="6f674-151">El error de los lotes puede producirse por varias razones.</span><span class="sxs-lookup"><span data-stu-id="6f674-151">Batches can fail for various reasons.</span></span> <span data-ttu-id="6f674-152">Es posible que se produzca un error relacionado con la seguridad o que el mensaje se haya enviado cuando el motor se estaba cerrando.</span><span class="sxs-lookup"><span data-stu-id="6f674-152">There might be a security-related failure, or the message might have been submitted when the engine was shutting down.</span></span> <span data-ttu-id="6f674-153">(Por lo general, cuando el motor se cierra, no se acepta ningún trabajo nuevo, aunque se permite finalizar el trabajo que esté en curso.) En la tabla siguiente se indican algunos valores HRESULT comunes devueltos en el estado del lote o de la operación.</span><span class="sxs-lookup"><span data-stu-id="6f674-153">(Typically when the engine shuts down it does not accept any new work but does allow in-process work to be completed.) The following table indicates some common HRESULT values that are returned either in the batch status or the operation status.</span></span> <span data-ttu-id="6f674-154">También se indica si se trata de códigos correctos o con errores.</span><span class="sxs-lookup"><span data-stu-id="6f674-154">It also indicates whether these are success or failure codes.</span></span> <span data-ttu-id="6f674-155">El tratamiento adecuado de estos códigos se describe más detalladamente en [cómo controlar errores de los adaptadores](../core/how-to-handle-adapter-failures.md).</span><span class="sxs-lookup"><span data-stu-id="6f674-155">The proper handling of these codes is described more fully in [How to Handle Adapter Failures](../core/how-to-handle-adapter-failures.md).</span></span>  
  
|<span data-ttu-id="6f674-156">Código (definido en la clase BTTransportProxy)</span><span class="sxs-lookup"><span data-stu-id="6f674-156">Code (defined in the class BTTransportProxy)</span></span>|<span data-ttu-id="6f674-157">Código correcto o con errores</span><span class="sxs-lookup"><span data-stu-id="6f674-157">Success/failure code</span></span>|<span data-ttu-id="6f674-158">Descripción</span><span class="sxs-lookup"><span data-stu-id="6f674-158">Description</span></span>|  
|----------------------------------------------------|---------------------------|-----------------|  
|<span data-ttu-id="6f674-159">BTS_S_EPM_SECURITY_CHECK_FAILED</span><span class="sxs-lookup"><span data-stu-id="6f674-159">BTS_S_EPM_SECURITY_CHECK_FAILED</span></span>|<span data-ttu-id="6f674-160">Correcto</span><span class="sxs-lookup"><span data-stu-id="6f674-160">Success</span></span>|<span data-ttu-id="6f674-161">El puerto se configuró para realizar una comprobación de seguridad y eliminar los mensajes con errores de autenticación.</span><span class="sxs-lookup"><span data-stu-id="6f674-161">The port was configured to perform a security check and drop messages that failed authentication.</span></span> <span data-ttu-id="6f674-162">Los adaptadores no deben suspender los lotes que devuelvan este código de estado.</span><span class="sxs-lookup"><span data-stu-id="6f674-162">Adapters should not suspend batches that return this status code.</span></span>|  
|<span data-ttu-id="6f674-163">BTS_S_EPM_MESSAGE_SUSPENDED</span><span class="sxs-lookup"><span data-stu-id="6f674-163">BTS_S_EPM_MESSAGE_SUSPENDED</span></span>|<span data-ttu-id="6f674-164">Correcto</span><span class="sxs-lookup"><span data-stu-id="6f674-164">Success</span></span>|<span data-ttu-id="6f674-165">Indica la suspensión de uno o varios mensajes, además de que el motor tiene la propiedad de los datos.</span><span class="sxs-lookup"><span data-stu-id="6f674-165">Indicates that one or more messages were suspended, and the engine has ownership of the data.</span></span> <span data-ttu-id="6f674-166">Se trata de un código correcto en el que el motor de mensajería ha aceptado el envío del mensaje.</span><span class="sxs-lookup"><span data-stu-id="6f674-166">It is a success code in that the Messaging Engine has accepted the message submission.</span></span>|  
|<span data-ttu-id="6f674-167">E_BTS_URL_DISALLOWED</span><span class="sxs-lookup"><span data-stu-id="6f674-167">E_BTS_URL_DISALLOWED</span></span>|<span data-ttu-id="6f674-168">Failure</span><span class="sxs-lookup"><span data-stu-id="6f674-168">Failure</span></span>|<span data-ttu-id="6f674-169">Se ha enviado un mensaje con un no válido **InboundTransportLocation**.</span><span class="sxs-lookup"><span data-stu-id="6f674-169">A message was submitted with an invalid **InboundTransportLocation**.</span></span>|  
  
## <a name="batch-operations"></a><span data-ttu-id="6f674-170">Operaciones de lotes</span><span class="sxs-lookup"><span data-stu-id="6f674-170">Batch Operations</span></span>  
 <span data-ttu-id="6f674-171">La siguiente tabla describen los métodos de miembro y las operaciones de la **IBTTransportBatch** objeto que el adaptador utiliza para agregar trabajo a un lote dado.</span><span class="sxs-lookup"><span data-stu-id="6f674-171">The following table details the member methods and operations of the **IBTTransportBatch** object that the adapter uses to add work to a given batch.</span></span>  
  
|<span data-ttu-id="6f674-172">Nombre del método</span><span class="sxs-lookup"><span data-stu-id="6f674-172">Method name</span></span>|<span data-ttu-id="6f674-173">Tipo de operación</span><span class="sxs-lookup"><span data-stu-id="6f674-173">Operation type</span></span>|<span data-ttu-id="6f674-174">Descripción</span><span class="sxs-lookup"><span data-stu-id="6f674-174">Description</span></span>|  
|-----------------|--------------------|-----------------|  
|<span data-ttu-id="6f674-175">**SubmitMessage**</span><span class="sxs-lookup"><span data-stu-id="6f674-175">**SubmitMessage**</span></span>|<span data-ttu-id="6f674-176">Enviar</span><span class="sxs-lookup"><span data-stu-id="6f674-176">Submit</span></span>|<span data-ttu-id="6f674-177">Envía un mensaje al motor.</span><span class="sxs-lookup"><span data-stu-id="6f674-177">Submits a message into the engine.</span></span>|  
|<span data-ttu-id="6f674-178">**SubmitResponseMessage**</span><span class="sxs-lookup"><span data-stu-id="6f674-178">**SubmitResponseMessage**</span></span>|<span data-ttu-id="6f674-179">Enviar</span><span class="sxs-lookup"><span data-stu-id="6f674-179">Submit</span></span>|<span data-ttu-id="6f674-180">Envía un mensaje de respuesta al motor.</span><span class="sxs-lookup"><span data-stu-id="6f674-180">Submits a response message into the engine.</span></span> <span data-ttu-id="6f674-181">Se trata del mensaje de respuesta de un par petición-respuesta.</span><span class="sxs-lookup"><span data-stu-id="6f674-181">This is the response message in a solicit-response pair.</span></span>|  
|<span data-ttu-id="6f674-182">**DeleteMessage**</span><span class="sxs-lookup"><span data-stu-id="6f674-182">**DeleteMessage**</span></span>|<span data-ttu-id="6f674-183">DELETE</span><span class="sxs-lookup"><span data-stu-id="6f674-183">Delete</span></span>|<span data-ttu-id="6f674-184">Elimina un mensaje transmitido correctamente por un adaptador a través de la red mediante un envío de no bloqueo.</span><span class="sxs-lookup"><span data-stu-id="6f674-184">Deletes a message that an adapter has successfully transmitted over the wire using a non-blocking send.</span></span> <span data-ttu-id="6f674-185">Los adaptadores que utilizan envíos de bloqueo no es necesario llamar a este método porque el motor de mensajería lo eliminará en nombre del adaptador si el adaptador devuelve `true` desde **TransmitMesssage**.</span><span class="sxs-lookup"><span data-stu-id="6f674-185">Adapters that use blocking sends do not need to call this method because the Messaging Engine will delete it on the adapter's behalf if the adapter returns `true` from **TransmitMesssage**.</span></span>|  
|<span data-ttu-id="6f674-186">**MoveToSuspendQ**</span><span class="sxs-lookup"><span data-stu-id="6f674-186">**MoveToSuspendQ**</span></span>|<span data-ttu-id="6f674-187">MoveToSuspendQ</span><span class="sxs-lookup"><span data-stu-id="6f674-187">MoveToSuspendQ</span></span>|<span data-ttu-id="6f674-188">Mueve los mensajes a la cola de suspensión.</span><span class="sxs-lookup"><span data-stu-id="6f674-188">Moves a message into the Suspended queue.</span></span>|  
|<span data-ttu-id="6f674-189">**Volver a enviar**</span><span class="sxs-lookup"><span data-stu-id="6f674-189">**Resubmit**</span></span>|<span data-ttu-id="6f674-190">Resubmit</span><span class="sxs-lookup"><span data-stu-id="6f674-190">Resubmit</span></span>|<span data-ttu-id="6f674-191">Solicita que se vuelva a intentar transmitir un mensaje en un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="6f674-191">Requests that a message should be retried for transmission at a later time.</span></span> <span data-ttu-id="6f674-192">Por lo general, se llama cuando se han producido errores en un intento de transmisión.</span><span class="sxs-lookup"><span data-stu-id="6f674-192">This is typically called after a transmission attempt has failed.</span></span>|  
|<span data-ttu-id="6f674-193">**MoveToNextTransport**</span><span class="sxs-lookup"><span data-stu-id="6f674-193">**MoveToNextTransport**</span></span>|<span data-ttu-id="6f674-194">MoveToNextTransport</span><span class="sxs-lookup"><span data-stu-id="6f674-194">MoveToNextTransport</span></span>|<span data-ttu-id="6f674-195">Solicita la transmisión de un mensaje mediante su transporte de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="6f674-195">Requests that a message be transmitted using its backup transport.</span></span> <span data-ttu-id="6f674-196">Por lo general, se llama una vez agotados todos los reintentos.</span><span class="sxs-lookup"><span data-stu-id="6f674-196">Typically called after all retries have been exhausted.</span></span> <span data-ttu-id="6f674-197">Si no hay ningún transporte de copia de seguridad, éste método no se ejecutará correctamente.</span><span class="sxs-lookup"><span data-stu-id="6f674-197">If no backup transport is present this method will fail</span></span>|  
|<span data-ttu-id="6f674-198">**SubmitRequestMessage**</span><span class="sxs-lookup"><span data-stu-id="6f674-198">**SubmitRequestMessage**</span></span>|<span data-ttu-id="6f674-199">SubmitRequest</span><span class="sxs-lookup"><span data-stu-id="6f674-199">SubmitRequest</span></span>|<span data-ttu-id="6f674-200">Envía un mensaje de solicitud.</span><span class="sxs-lookup"><span data-stu-id="6f674-200">Submits a request message.</span></span> <span data-ttu-id="6f674-201">Se trata del mensaje de solicitud de un par solicitud-respuesta.</span><span class="sxs-lookup"><span data-stu-id="6f674-201">This is a request message in a request-response pair.</span></span>|  
|<span data-ttu-id="6f674-202">**CancelRequestForResponse**</span><span class="sxs-lookup"><span data-stu-id="6f674-202">**CancelRequestForResponse**</span></span>|<span data-ttu-id="6f674-203">CancelRequestForResponse</span><span class="sxs-lookup"><span data-stu-id="6f674-203">CancelRequestForResponse</span></span>|<span data-ttu-id="6f674-204">Notifica al motor que el adaptador no desea esperar el mensaje de respuesta de un par solicitud-respuesta.</span><span class="sxs-lookup"><span data-stu-id="6f674-204">Notifies the engine that the adapter no longer wishes to wait for the response message in a request-response pair.</span></span>|  
|<span data-ttu-id="6f674-205">**Desactivar**</span><span class="sxs-lookup"><span data-stu-id="6f674-205">**Clear**</span></span>|<span data-ttu-id="6f674-206">N/D</span><span class="sxs-lookup"><span data-stu-id="6f674-206">NA</span></span>|<span data-ttu-id="6f674-207">Borra todo el trabajo del lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-207">Clears all work from the batch.</span></span>|  
|<span data-ttu-id="6f674-208">**Listo**</span><span class="sxs-lookup"><span data-stu-id="6f674-208">**Done**</span></span>|<span data-ttu-id="6f674-209">N/D</span><span class="sxs-lookup"><span data-stu-id="6f674-209">NA</span></span>|<span data-ttu-id="6f674-210">Envía un lote de mensajes al motor para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="6f674-210">Submits a batch of messages to the engine for processing.</span></span>|  
  
## <a name="batch-management"></a><span data-ttu-id="6f674-211">Administración de lotes</span><span class="sxs-lookup"><span data-stu-id="6f674-211">Batch Management</span></span>  
 <span data-ttu-id="6f674-212">Los lotes se implementan en código nativo en el motor de mensajería.</span><span class="sxs-lookup"><span data-stu-id="6f674-212">Batches are implemented in native code in the Messaging Engine.</span></span> <span data-ttu-id="6f674-213">Por ello, un adaptador escrito en código administrado debe liberar el contenedor al que se puede llamar en tiempo de ejecución (RCW) para el lote después de finalizar con dicho lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-213">For this reason an adapter written in managed code should release the runtime callable wrapper (RCW) for the batch after it has finished with the batch.</span></span> <span data-ttu-id="6f674-214">Esto se hace en el código administrado mediante el **Marshal.ReleaseComObject** API.</span><span class="sxs-lookup"><span data-stu-id="6f674-214">This is done in managed code by using the **Marshal.ReleaseComObject** API.</span></span> <span data-ttu-id="6f674-215">Es importante recordar que la llamada a esta API debe efectuarse en un bucle Mientras hasta que el recuento de referencia devuelto sea igual a cero.</span><span class="sxs-lookup"><span data-stu-id="6f674-215">It is important to remember that this API should be called in a while loop until the returned reference count reaches zero.</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="6f674-216"> procesa los mensajes de forma sincrónica dentro de un lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-216"> processes messages synchronously within a batch.</span></span> <span data-ttu-id="6f674-217">Es posible procesar muchos lotes a la vez, lo que permite optimizar el adaptador al ajustar el tamaño del lote en el dominio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6f674-217">Many batches may be processed concurrently, which may provide an opportunity for some optimization in the adapter by adjusting the batch size in the application domain.</span></span> <span data-ttu-id="6f674-218">Por ejemplo, se pueden procesar todos los archivos de un sitio FTP (hasta que se alcance cierto límite).</span><span class="sxs-lookup"><span data-stu-id="6f674-218">For example, you might process all the files on an FTP site (until some limit is hit).</span></span> <span data-ttu-id="6f674-219">En el caso de SAP, es posible procesar una única secuencia en forma de varios mensajes que posteriormente se envían como un lote.</span><span class="sxs-lookup"><span data-stu-id="6f674-219">In the case of SAP you might process a single stream into a number of messages that are then submitted as a batch.</span></span>  
  
 <span data-ttu-id="6f674-220">El lote que se usa un adaptador para pasar las operaciones a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] corresponden exactamente a la lista de mensajes no es necesario que [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] proporciona al adaptador.</span><span class="sxs-lookup"><span data-stu-id="6f674-220">The batch used by an adapter to pass operations back to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] does not need to exactly correspond to the list of messages that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] gives to the adapter.</span></span> <span data-ttu-id="6f674-221">En otras palabras, al cabo envíos transaccionales, es preciso dividir las operaciones de reenvío **MoveToNextTransport** y **MoveToSuspendQ** en lotes independientes.</span><span class="sxs-lookup"><span data-stu-id="6f674-221">In other words, when doing transactional sends you must split the resubmit operations **MoveToNextTransport** and **MoveToSuspendQ** into separate batches.</span></span> <span data-ttu-id="6f674-222">Muchos adaptadores ordenan un lote de mensajes enviados a varios extremos en listas independientes de mensajes para su procesamiento posterior.</span><span class="sxs-lookup"><span data-stu-id="6f674-222">Many adapters sort a batch of messages that have been submitted for multiple endpoints into separate lists of messages for further processing.</span></span>  
  
 <span data-ttu-id="6f674-223">El punto es que no hay ninguna regla (además de los asociados de la transacción) asociado con el mensaje de procesamiento por lotes en [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6f674-223">The point is that there are no rules (besides those associated with the transaction) associated with message batching in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="6f674-224">Procesamiento por lotes es simplemente una manera específica de la implementación para el adaptador fragmente los mensajes entrantes dentro y fuera de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6f674-224">Batching is simply an implementation-specific way for the adapter to chunk messages into and out of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
 <span data-ttu-id="6f674-225">Un adaptador puede procesar por lotes los mensajes en lotes más pequeñas que [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ha proporcionado en un lote más grande para la respuesta a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6f674-225">An adapter can batch messages from multiple smaller batches that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] has given it into a larger batch for the response to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="6f674-226">Con ello se puede lograr una optimización considerable de los adaptadores transaccionales que utilizan un elevado número de mensajes muy pequeños.</span><span class="sxs-lookup"><span data-stu-id="6f674-226">This might be a significant optimization in transactional adapters that are dealing with large numbers of very small messages.</span></span> <span data-ttu-id="6f674-227">Esto reduce al mínimo la proporción del número total de transacciones por mensaje.</span><span class="sxs-lookup"><span data-stu-id="6f674-227">It minimizes the "total number of transactions per message" ratio.</span></span>  
  
 <span data-ttu-id="6f674-228">Normalmente [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] produce lotes de envío de entre 5 y 10 mensajes.</span><span class="sxs-lookup"><span data-stu-id="6f674-228">Typically [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] produces send-side batches of between 5 and 10 messages.</span></span> <span data-ttu-id="6f674-229">Si se trata de mensajes muy pequeños, un adaptador puede procesar por lotes de hasta 100 mensajes o más antes de enviar un lote transaccional de eliminaciones a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6f674-229">If these are very small messages, an adapter might batch up to 100 messages or more before it submits a transactional batch of deletes back to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="6f674-230">Una optimización de este tipo no es fácil de implementar; es preciso asegurarse de que los mensajes no se bloquean nunca en la memoria del adaptador como resultado de esperar interminablemente a que se alcance un determinado umbral.</span><span class="sxs-lookup"><span data-stu-id="6f674-230">An optimization like this is not easy to implement; you must make sure that messages never get stuck in the adapter memory, waiting endlessly for some threshold to be met.</span></span>  
  
 <span data-ttu-id="6f674-231">La importancia del procesamiento por lotes puede verse en las cifras de rendimiento [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] para los adaptadores de alto rendimiento, como MQSeries.</span><span class="sxs-lookup"><span data-stu-id="6f674-231">The significance of batching can be seen in the performance numbers for [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] for the high-throughput adapters like MQSeries.</span></span> <span data-ttu-id="6f674-232">En estos adaptadores, los mensajes se reciben con al menos el doble de la frecuencia con la que se envían.</span><span class="sxs-lookup"><span data-stu-id="6f674-232">In these adapters, messages are received at least twice as often as they are sent.</span></span> <span data-ttu-id="6f674-233">De forma predeterminada, el adaptador de recepción utiliza lotes de 100 mensajes y el adaptador de envío utiliza el valor predeterminado [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] por lotes que se le asigna.</span><span class="sxs-lookup"><span data-stu-id="6f674-233">By default the receive adapter uses batches of 100 messages and the send adapter uses the default [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] batch it is given.</span></span>  
  
## <a name="transactional-batches"></a><span data-ttu-id="6f674-234">Lotes transaccionales</span><span class="sxs-lookup"><span data-stu-id="6f674-234">Transactional Batches</span></span>  
 <span data-ttu-id="6f674-235">Al escribir un adaptador que crea un objeto de transacción y lo entrega a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], se acepta la responsabilidad para escribir código que realiza lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6f674-235">When you write an adapter that creates a transaction object and hands it to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], you are accepting responsibility for writing code that does the following:</span></span>  
  
- <span data-ttu-id="6f674-236">Decide el resultado final de la operación por lotes: para confirmar o finalizar la transacción.</span><span class="sxs-lookup"><span data-stu-id="6f674-236">Decides the final outcome of the batch operation: to either commit or end the transaction.</span></span> <span data-ttu-id="6f674-237">Esto puede depender de otras ramas transaccionales dentro del ámbito de esta transacción que no son [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] dependientes, como escribir en una cola de Message Queuing (MSMQ) o una operación de base de datos transaccional.</span><span class="sxs-lookup"><span data-stu-id="6f674-237">This may depend upon other transactional branches within the scope of this one transaction that are not [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] dependent, such as writing to an Message Queuing (MSMQ) queue or a transactional database operation.</span></span>  
  
- <span data-ttu-id="6f674-238">Informa a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] del resultado final mediante una llamada a la **IBTDTCCommitConfirm.DTCCommitConfirm** método.</span><span class="sxs-lookup"><span data-stu-id="6f674-238">Informs [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] of the final outcome by calling the **IBTDTCCommitConfirm.DTCCommitConfirm** method.</span></span> <span data-ttu-id="6f674-239">Devolver `true` indica una confirmación de la transacción ha sido correcta; devuelve `false` significa error y revertir la transacción.</span><span class="sxs-lookup"><span data-stu-id="6f674-239">Returning `true` indicates a successful commit of the transaction; returning `false` signifies failure and rollback of the transaction.</span></span>  
  
  <span data-ttu-id="6f674-240">El adaptador debe informar [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] datos de seguimiento sobre el resultado final de la transacción para mantener su texto interno.</span><span class="sxs-lookup"><span data-stu-id="6f674-240">The adapter must inform [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] about the final outcome of the transaction to maintain its internal tracking data.</span></span> <span data-ttu-id="6f674-241">El adaptador informa a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] del resultado mediante una llamada a **DTCCommitConfirm**.</span><span class="sxs-lookup"><span data-stu-id="6f674-241">The adapter informs [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] of the outcome by calling **DTCCommitConfirm**.</span></span> <span data-ttu-id="6f674-242">Si el adaptador no hace esto, se produce una pérdida de memoria considerable y la transacción de Microsoft DTC puede superar el tiempo de espera y presentar errores a pesar de que las operaciones se hayan finalizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="6f674-242">If the adapter does not do this, a significant memory leak occurs and the MSDTC transaction could time out and fail despite its operations completing successfully.</span></span>