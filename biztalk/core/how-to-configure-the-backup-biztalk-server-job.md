---
title: Configurar el trabajo de copia de seguridad de BizTalk Server | Documentos de Microsoft
description: 
ms.custom: 
ms.date: 11/22/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 026622c9-fcb4-4db0-af48-1379feb30372
caps.latest.revision: "42"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f1afb4f28584d65401220761dcee626fe63f913b
ms.sourcegitcommit: f4c0d7bc4b617688c643101a34062db90014851a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/23/2017
---
# <a name="configure-the-backup-biztalk-server-job"></a><span data-ttu-id="4b304-102">Configurar el trabajo de copia de seguridad de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="4b304-102">Configure the Backup BizTalk Server Job</span></span>
<span data-ttu-id="4b304-103">Después de instalar y configurar BizTalk Server, configure la copia de seguridad [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] trabajo de copia de seguridad de los datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-103">After you install and configure BizTalk Server, configure the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job to back up your data.</span></span> 

<span data-ttu-id="4b304-104">**A partir de [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**, puede las bases de datos de copia de seguridad y archivos de registro en una cuenta de almacenamiento de blobs de Azure.</span><span class="sxs-lookup"><span data-stu-id="4b304-104">**Starting with [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**, you can backup your databases and log files to an Azure blob storage account.</span></span> 


## <a name="overview"></a><span data-ttu-id="4b304-105">Información general</span><span class="sxs-lookup"><span data-stu-id="4b304-105">Overview</span></span>
<span data-ttu-id="4b304-106">El **copia de seguridad de BizTalk Server (BizTalkMgmtDb)** trabajo incluye los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="4b304-106">The **Backup BizTalk Server (BizTalkMgmtDb)** job includes the following steps:</span></span>

-   <span data-ttu-id="4b304-107">Paso 1: **opción de compresión de Set**: habilitar o deshabilitar la compresión durante la copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="4b304-107">Step 1 – **Set Compression Option**: Enable or disable compression during backup</span></span>

-   <span data-ttu-id="4b304-108">Paso 2: **BackupFull**: total de ejecuciones de copias de seguridad de base de datos de las bases de datos de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="4b304-108">Step 2 – **BackupFull**: Runs full database backups of the BizTalk Server databases</span></span>

-   <span data-ttu-id="4b304-109">Paso 3: **MarkAndBackUpLog**: realiza una copia de seguridad de los registros de base de datos de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="4b304-109">Step 3 – **MarkAndBackUpLog**: Backs up the BizTalk Server database logs</span></span>

-   <span data-ttu-id="4b304-110">Paso 4: **Borrar historial de copia de seguridad**: elija cuánto tiempo se conserva el historial de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="4b304-110">Step 4 – **Clear Backup History**: Choose how long the backup history is kept</span></span>

<span data-ttu-id="4b304-111">Para configurar este trabajo, debe:</span><span class="sxs-lookup"><span data-stu-id="4b304-111">To configure this job, you'll need to:</span></span>  
  
-   <span data-ttu-id="4b304-112">Identificar los servidores de SQL Server principal y de destino y otras opciones de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="4b304-112">Identify the primary and destination SQL Servers and other backup options</span></span>
  
-   <span data-ttu-id="4b304-113">Elija una cuenta de usuario de Windows para realizar copias de seguridad de las bases de datos y crear un inicio de sesión de SQL Server para esta cuenta</span><span class="sxs-lookup"><span data-stu-id="4b304-113">Choose a Windows user account to back up your databases, and create a SQL Server login for this account</span></span>
  
-   <span data-ttu-id="4b304-114">Asignar los inicios de sesión del servidor SQL Server al rol de base de datos BTS_BACKUP_USERS en las bases de datos de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-114">Map SQL Server logins to the BTS_BACKUP_USERS database role in the BizTalk Server databases</span></span>
  
-   <span data-ttu-id="4b304-115">Asegurarse de que el servicio MSDTC está activo en todos los nodos.</span><span class="sxs-lookup"><span data-stu-id="4b304-115">Ensure MSDTC service is active on all nodes.</span></span> <span data-ttu-id="4b304-116">En caso contrario, agregar un servidor vinculado entre el nodo de origen y el nodo de destino se produce un error.</span><span class="sxs-lookup"><span data-stu-id="4b304-116">Otherwise, adding a linked server between the source node and the destination node fails.</span></span>
  
## <a name="before-you-begin"></a><span data-ttu-id="4b304-117">Antes de empezar</span><span class="sxs-lookup"><span data-stu-id="4b304-117">Before you begin</span></span>  
  
-   <span data-ttu-id="4b304-118">Determinadas operaciones de copia de seguridad y configuración requieren la pertenencia en el rol de SQL Server sysadmin.</span><span class="sxs-lookup"><span data-stu-id="4b304-118">Certain configuration and backup operations require membership in the sysadmin SQL Server role.</span></span> <span data-ttu-id="4b304-119">Para realizar una copia de su [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de datos, inicie sesión en el servidor principal con una cuenta que sea miembro del rol de servidor sysadmin de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-119">To back up your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, sign in the primary server with an account that is a member of the SQL Server sysadmin Server role.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="4b304-120">configuración agrega el rol de base de datos BTS_BACKUP_USERS.</span><span class="sxs-lookup"><span data-stu-id="4b304-120"> configuration adds the BTS_BACKUP_USERS database role.</span></span> <span data-ttu-id="4b304-121">La cuenta de usuario que se usa para hacer copia de seguridad de las bases de datos no requiere permisos de administrador del sistema (rol de SQL Server sysadmin) en todos los servidores de SQL que puede estar implicado en una copia de seguridad, excepto el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="4b304-121">The user account you use to back up your databases does not require System Administrator (sysadmin SQL Server role) permissions on all the SQL Servers that may be involved in a backup, except for the primary server.</span></span>  
  
-   <span data-ttu-id="4b304-122">Decida qué cuenta de inicio de sesión se usa para ejecutar su [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] copias de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-122">Decide which sign in account you use to run your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database backups.</span></span> <span data-ttu-id="4b304-123">Puede usar una cuenta local, y se puede usar más de una cuenta.</span><span class="sxs-lookup"><span data-stu-id="4b304-123">You can use a local account, and you can use more than one account.</span></span> <span data-ttu-id="4b304-124">Pero es generalmente resulta más fácil y más seguro crear una cuenta de usuario de dominio de Windows dedicada específicamente para este propósito.</span><span class="sxs-lookup"><span data-stu-id="4b304-124">But it is generally simpler and more secure to create one dedicated Windows domain user account specifically for this purpose.</span></span> <span data-ttu-id="4b304-125">Debe configurar una cuenta de inicio de sesión de SQL Server para este usuario, y el usuario debe asignarse a un inicio de sesión de SQL Server para todos los servidores SQL Server que participen en el proceso de copia de seguridad, ya sean servidores principales (origen) o secundarios (destino).</span><span class="sxs-lookup"><span data-stu-id="4b304-125">You must configure a SQL Server logon account for this user, and the user must be mapped to a SQL Server login for all of the SQL Servers that participate in the backup process, either as primary (source) or secondary (destination) servers.</span></span> <span data-ttu-id="4b304-126">Asigne este usuario al rol de la base de datos BTS_BACKUP_USERS de BizTalk para cada una de las bases de datos de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de las que quiera realizar copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4b304-126">Assign this user to the BizTalk BTS_BACKUP_USERS database role for each of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases you back up.</span></span>  
  
-   <span data-ttu-id="4b304-127">El trabajo de copia de seguridad de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] no elimina archivos de copia de seguridad obsoletos, por lo que la administración manual de este tipo de archivos resulta necesaria para ahorrar espacio en disco.</span><span class="sxs-lookup"><span data-stu-id="4b304-127">The Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job does not delete outdated backup files, so you need to manually manage those backup files to conserve disk space.</span></span> <span data-ttu-id="4b304-128">Después de crear una nueva copia de seguridad completa de las bases de datos, debería mover los archivos de copia de seguridad obsoletos a un dispositivo de almacenamiento de archivado para recuperar espacio en el disco principal.</span><span class="sxs-lookup"><span data-stu-id="4b304-128">After you have created a new full backup of your databases, you should move the outdated backup files onto an archival storage device to reclaim space on the primary disk.</span></span> <span data-ttu-id="4b304-129">Consulte la [paquetes SSIS](http://www.biztalkbill.com/2015/05/26/ssis-packages-to-help-management-biztalk-server-environments/) para administrar estos archivos.</span><span class="sxs-lookup"><span data-stu-id="4b304-129">See the [SSIS packages](http://www.biztalkbill.com/2015/05/26/ssis-packages-to-help-management-biztalk-server-environments/) to manage these files.</span></span>  
  
-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="4b304-130">no escribe datos de seguimiento directamente en la base de datos de seguimiento de BizTalk; en su lugar se almacena en caché los datos de la base de datos de cuadro de mensajes y, a continuación, se mueve a la base de datos de seguimiento de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="4b304-130"> does not write tracking data directly to the BizTalk Tracking database; rather it caches the data in the MessageBox database, and then moves it to the BizTalk Tracking database.</span></span> <span data-ttu-id="4b304-131">Si se pierden datos de cuadro de mensajes, es posible que también se pierdan algunos datos de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="4b304-131">If MessageBox data loss occurs, some tracking data may also be lost.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="4b304-132">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="4b304-132">Prerequisites</span></span>  
* <span data-ttu-id="4b304-133">Inicie sesión en SQL Server con una cuenta que sea miembro del rol sysadmin de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-133">Sign in to SQL Server using an account that is a member of the sysadmin SQL Server role.</span></span>  
  
* <span data-ttu-id="4b304-134">Configure el servicio de Agente de SQL Server para ejecutarse bajo una cuenta de dominio (recomendado, aunque se pueden usar cuentas locales), con un usuario asignado en cada instancia de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-134">Configure the SQL Server Agent service to run under a domain account (recommended, although local accounts can be used), with a mapped user login on each instance of SQL Server.</span></span>  

* <span data-ttu-id="4b304-135">Para utilizar una cuenta de almacenamiento de blobs de Azure, necesita un [cuenta de almacenamiento de propósito general](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account#create-a-storage-account), un contenedor dentro de su cuenta de almacenamiento blob, un [firma de acceso compartido](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) (SAS) y un [credencial de SQL con las asociaciones de seguridad](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#credential).</span><span class="sxs-lookup"><span data-stu-id="4b304-135">To use an Azure blob storage account, you need a [general purpose storage account](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account#create-a-storage-account), a container within your blob storage account, a [shared access signature](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) (SAS), and a [SQL credential using the SAS](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#credential).</span></span> <span data-ttu-id="4b304-136">Una vez creado, tiene el blob servicio dirección URL del extremo esté listo, que es algo parecido a https://*yourstorageaccount*.blob.core.windows.net/*containername*.</span><span class="sxs-lookup"><span data-stu-id="4b304-136">Once created, have your blob service endpoint URL ready, which is something like https://*yourstorageaccount*.blob.core.windows.net/*containername*.</span></span> 

    > [!TIP]
    > <span data-ttu-id="4b304-137">Si no dispone de una cuenta de almacenamiento configurada con una SAS de blob la [script de PowerShell de SAS](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) puede crear la base de datos y el contenedor.</span><span class="sxs-lookup"><span data-stu-id="4b304-137">If you don't have an existing blob storage account configured with a SAS, then the [SAS PowerShell script](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) can create it, and the container.</span></span> <span data-ttu-id="4b304-138">[Copia de seguridad de SQL Server a URL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url) proporciona una introducción y los pasos específicos.</span><span class="sxs-lookup"><span data-stu-id="4b304-138">[SQL Server Backup to URL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url) provides an overview, and the specific steps.</span></span>
  
## <a name="configure-the-job"></a><span data-ttu-id="4b304-139">Configurar el trabajo</span><span class="sxs-lookup"><span data-stu-id="4b304-139">Configure the job</span></span>  
  
1.  <span data-ttu-id="4b304-140">En el servidor SQL Server que hospeda la base de datos de administración de BizTalk, abra **SQL Server Management Studio**y conectarse a su [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4b304-140">On the SQL Server that hosts the BizTalk Management database, open **SQL Server Management Studio**, and connect to your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span>  
  
2.  <span data-ttu-id="4b304-141">Expanda **Agente SQL Server** y **Trabajos**.</span><span class="sxs-lookup"><span data-stu-id="4b304-141">Expand **SQL Server Agent**, and expand **Jobs**.</span></span>  
  
3.  <span data-ttu-id="4b304-142">Haga clic en **copia de seguridad de BizTalk Server (BizTalkMgmtDb)** y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="4b304-142">Right-click **Backup BizTalk Server (BizTalkMgmtDb)** and select **Properties**.</span></span> <span data-ttu-id="4b304-143">En las propiedades del trabajo, seleccione **pasos**.</span><span class="sxs-lookup"><span data-stu-id="4b304-143">In the job properties, select **Steps**.</span></span>  
  
4.  <span data-ttu-id="4b304-144">Seleccione el **establecer opción de compresión** paso a paso y seleccione **editar**:</span><span class="sxs-lookup"><span data-stu-id="4b304-144">Select the **Set Compression Option** step, and select **Edit**:</span></span>  

    <span data-ttu-id="4b304-145">Llama a este paso la `sp_SetBackupCompression` procedimiento almacenado en la base de datos de administración de BizTalk (BizTalkMgmtDb) para establecer el valor en el `adm_BackupSettings` tabla.</span><span class="sxs-lookup"><span data-stu-id="4b304-145">This step calls the `sp_SetBackupCompression` stored procedure in the BizTalk management database (BizTalkMgmtDb) to set the value on the `adm_BackupSettings` table.</span></span> <span data-ttu-id="4b304-146">El procedimiento almacenado tiene un parámetro:  **@bCompression** .</span><span class="sxs-lookup"><span data-stu-id="4b304-146">The stored procedure has one parameter: **@bCompression**.</span></span> <span data-ttu-id="4b304-147">De forma predeterminada, se establece en **0** (compresión de copia de seguridad está desactivada).</span><span class="sxs-lookup"><span data-stu-id="4b304-147">By default, it is set to **0** (backup compression is off).</span></span> <span data-ttu-id="4b304-148">Para aplicar compresión, cambie el valor a **1**:</span><span class="sxs-lookup"><span data-stu-id="4b304-148">To apply compression, change the value to **1**:</span></span>  
  
    ```  
    exec [dbo].[sp_SetBackupCompression] @bCompression = 1 /*0 - Do not use Compression, 1 - Use Compression */  
    ```  
  
     <span data-ttu-id="4b304-149">Seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-149">Select **OK**.</span></span>  
  
5.  <span data-ttu-id="4b304-150">Seleccione el **BackupFull** paso a paso y seleccione **editar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-150">Select the **BackupFull** step, and select **Edit**.</span></span> <span data-ttu-id="4b304-151">En el **comando** cuadro, actualice los valores de parámetro:</span><span class="sxs-lookup"><span data-stu-id="4b304-151">In the **Command** box, update the parameter values:</span></span>  
  
    1. <span data-ttu-id="4b304-152">**Frecuencia**: el valor predeterminado es **d.** (diariamente;) que es la configuración recomendada.</span><span class="sxs-lookup"><span data-stu-id="4b304-152">**Frequency**: The default is **d** (daily); which is the recommended setting.</span></span> <span data-ttu-id="4b304-153">Otros valores son **h** (cada hora), **w** (semanalmente), **m** (mensualmente), o **y** (anualmente).</span><span class="sxs-lookup"><span data-stu-id="4b304-153">Other values include **h** (hourly), **w** (weekly), **m** (monthly), or **y** (yearly).</span></span>  
  
    2. <span data-ttu-id="4b304-154">**Nombre**: el valor predeterminado es **BTS**.</span><span class="sxs-lookup"><span data-stu-id="4b304-154">**Name**: The default is **BTS**.</span></span> <span data-ttu-id="4b304-155">El nombre se usa como parte del nombre del archivo de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4b304-155">The name is used as part of the backup file name.</span></span>  
  
    3. <span data-ttu-id="4b304-156">**Ubicación de archivos de copia de seguridad**: reemplazar '*\<ruta de acceso de destino >*' con la ruta de acceso completa (la ruta de acceso debe incluir las comillas simples) del equipo y la carpeta donde desea realizar una copia de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] las bases de datos, o la URL del extremo de servicio de blob a una cuenta de almacenamiento de blobs de Azure.</span><span class="sxs-lookup"><span data-stu-id="4b304-156">**Location of backup files**: Replace '*\<destination path>*' with the full path (the path must include the single quotes) to the computer and folder where you want to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, or the blob service endpoint URL to an Azure blob storage account.</span></span>  

        > [!IMPORTANT]
        > - <span data-ttu-id="4b304-157">Si escribe una ruta de acceso local, tendrá que copiar manualmente todos los archivos en la misma carpeta del sistema de destino siempre que la copia de seguridad [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] trabajo crea nuevos archivos.</span><span class="sxs-lookup"><span data-stu-id="4b304-157">If you enter a local path, then you have to manually copy all the files to the same folder on the destination system whenever the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job creates new files.</span></span>  
        >   
        >      <span data-ttu-id="4b304-158">Para usar una ruta de acceso remoto, escriba un recurso compartido UNC como \\ \\  *\<ServerName >*\\*\<SharedDrive >*\\, donde  *\<ServerName >* es el nombre del servidor donde desea que los archivos, y  *\<SharedDrive >* es el nombre de la unidad o carpeta compartida.</span><span class="sxs-lookup"><span data-stu-id="4b304-158">To use a remote path, enter a UNC share such as \\\\*\<ServerName>*\\*\<SharedDrive>*\\, where *\<ServerName>* is the name of the server where you want the files, and *\<SharedDrive>* is name of the shared drive or folder.</span></span>  
        >   
        >      <span data-ttu-id="4b304-159">La creación de copias de seguridad de datos a través de la red está sujeta a posibles problemas de red.</span><span class="sxs-lookup"><span data-stu-id="4b304-159">Backing up data over a network is subject to any network issues.</span></span> <span data-ttu-id="4b304-160">Si usa una ubicación remota, al finalizar el trabajo de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de copia de seguridad, compruebe que la copia de seguridad se haya creado correctamente.</span><span class="sxs-lookup"><span data-stu-id="4b304-160">When using a remote location, verify the backup succeeded when the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job finishes.</span></span>  
        > - <span data-ttu-id="4b304-161">Para evitar una pérdida de datos potencial, configure un disco de copia de seguridad distinto de los discos de registro y de datos de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-161">To avoid potential data loss, configure the backup disk to be a different disk than the database data and log disks.</span></span> <span data-ttu-id="4b304-162">De este modo, podrá acceder a las copias de seguridad en caso de error en el disco de registro o datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-162">This is necessary so you can access the backups if the data or log disk fails.</span></span>  
        > - <span data-ttu-id="4b304-163">Cuando escriba la copia de seguridad en una cuenta de blobs de Azure, el **extremo del servicio Blob** dirección URL y el nombre del contenedor, que se enumeran en las propiedades del servicio blob en el [portal de Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="4b304-163">When backing up to an Azure blob account, enter the **Blob service endpoint** URL and the container name, which are listed in your blob service properties in the [Azure portal](https://portal.azure.com).</span></span>

    4. <span data-ttu-id="4b304-164">Opcional.</span><span class="sxs-lookup"><span data-stu-id="4b304-164">Optional.</span></span> <span data-ttu-id="4b304-165">**Forzar copia de seguridad completa después de los errores de copia de seguridad parciales** (@ForceFullBackupAfterPartialSetFailure): el valor predeterminado es **0**.</span><span class="sxs-lookup"><span data-stu-id="4b304-165">**Force full backup after partial backup failures** (@ForceFullBackupAfterPartialSetFailure): The default is **0**.</span></span> <span data-ttu-id="4b304-166">Si se produce un error en una copia de seguridad del registro, no hay copias de seguridad completas se ejecutó hasta que se alcance el siguiente intervalo de frecuencia de copia de seguridad completa.</span><span class="sxs-lookup"><span data-stu-id="4b304-166">If a log backup fails, no full backups are ran until the next full backup frequency interval is reached.</span></span> <span data-ttu-id="4b304-167">Reemplace por **1** si desea que se ejecutó una copia de seguridad completa cada vez que se produce un error de copia de seguridad del registro.</span><span class="sxs-lookup"><span data-stu-id="4b304-167">Replace with **1** if you want a full backup ran whenever a log backup failure occurs.</span></span>
    
    5. <span data-ttu-id="4b304-168">Opcional.</span><span class="sxs-lookup"><span data-stu-id="4b304-168">Optional.</span></span> <span data-ttu-id="4b304-169">**Hora local para ejecutar el proceso de copia de seguridad** (@BackupHour): el valor predeterminado es **NULL**.</span><span class="sxs-lookup"><span data-stu-id="4b304-169">**Local time hour for the backup process to run** (@BackupHour): The default is **NULL**.</span></span> <span data-ttu-id="4b304-170">El trabajo de copia de seguridad no está asociado a la zona horaria de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] equipo y se ejecuta a medianoche UTC (0000) de tiempo.</span><span class="sxs-lookup"><span data-stu-id="4b304-170">The backup job is not associated with the time zone of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, and runs at midnight UTC time (0000).</span></span> <span data-ttu-id="4b304-171">Si desea que copia de seguridad a una hora concreta en la zona horaria de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] equipo, escriba un valor entero comprendido entre 0 (medianoche) a 23 (11 PM) como hora local.</span><span class="sxs-lookup"><span data-stu-id="4b304-171">If you want to backup at a specific hour in the time zone of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, enter an integer value from 0 (midnight) to 23 (11 PM) as the local time hour.</span></span> 

    6. <span data-ttu-id="4b304-172">Opcional.</span><span class="sxs-lookup"><span data-stu-id="4b304-172">Optional.</span></span> <span data-ttu-id="4b304-173">**Usar la hora local** (@UseLocalTime): indica el procedimiento para usar la hora local.</span><span class="sxs-lookup"><span data-stu-id="4b304-173">**Use local time** (@UseLocalTime): Tells the procedure to use local time.</span></span> <span data-ttu-id="4b304-174">El valor predeterminado es **0**y utiliza 01:34:11.933 de 2007-05-04 de – GETUTCDATE(): hora UTC actual.</span><span class="sxs-lookup"><span data-stu-id="4b304-174">The default value is **0**, and uses current UTC time – GETUTCDATE() – 2007-05-04 01:34:11.933.</span></span> <span data-ttu-id="4b304-175">Si establece en **1**, a continuación, usa la hora local: GETDATE() – 2007-05-03 18:34:11.933</span><span class="sxs-lookup"><span data-stu-id="4b304-175">If set to **1**, then it uses local time – GETDATE() – 2007-05-03 18:34:11.933</span></span>
  
    <span data-ttu-id="4b304-176">En el ejemplo siguiente, copias de seguridad diarias son creados a las 2 a.m. y se almacena en la unidad m:\:</span><span class="sxs-lookup"><span data-stu-id="4b304-176">In the following example, daily backups are created at 2am, and stored in the m:\ drive:</span></span>  
  
    ```  
    exec [dbo].[sp_BackupAllFull_Schedule]   
    'd' /* Frequency */,   
    'BTS' /* Name */,   
    'm:\BizTalkBackups' /* location of backup files */,   
    '0' /* 0 (default) or 1 ForceFullBackupAfterPartialSetFailure */,   
    '2' /* local time hour for the backup process to run */  
    ```  

    <span data-ttu-id="4b304-177">En el ejemplo siguiente, copias de seguridad semanales se creó a medianoche, hora UTC y almacena en su cuenta de blobs de Azure:</span><span class="sxs-lookup"><span data-stu-id="4b304-177">In the following example, weekly backups are created at midnight UTC time, and stored in your Azure blob account:</span></span> 

    ```  
    exec [dbo].[sp_BackupAllFull_Schedule]   
    'w' /* Frequency */,   
    'BTS' /* Name */,   
    'http://yourstorageaccount.blob.core.windows.net/yourcontainer/' /* location of backup files */,   
    '1' /* 0 (default) or 1 ForceFullBackupAfterPartialSetFailure */
    ```  

     <span data-ttu-id="4b304-178">Seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-178">Select **OK**.</span></span>  
  
6.  <span data-ttu-id="4b304-179">Seleccione el **MarkAndBackupLog** paso a paso y seleccione **editar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-179">Select the **MarkAndBackupLog** step, and select **Edit**.</span></span> <span data-ttu-id="4b304-180">En el **comando** cuadro, actualice los valores de parámetro:</span><span class="sxs-lookup"><span data-stu-id="4b304-180">In the **Command** box, update the parameter values:</span></span>  
  
    1.  <span data-ttu-id="4b304-181">**@MarkName**: Esto forma parte de la convención de nomenclatura para archivos de copia de seguridad: <Server Name>  _<Database Name>  **_registro_**< nombre de la marca de registro >_<Timestamp></span><span class="sxs-lookup"><span data-stu-id="4b304-181">**@MarkName**: This is part of the naming convention for backup files: <Server Name>_<Database Name>**_Log_**< Log Mark Name >_<Timestamp></span></span>  
    
    2.  <span data-ttu-id="4b304-182">**@BackupPath**: Ruta de destino completa (incluidas las comillas simples) del equipo y la carpeta para almacenar el [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] registros, o la cuenta de almacenamiento de blobs de Azure y el contenedor de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-182">**@BackupPath**: Full destination path (including single quotes) to the computer and folder to store the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database logs, or the Azure blob storage account and container.</span></span> <span data-ttu-id="4b304-183">El  *\<ruta de acceso de destino >* también puede ser local o una ruta de acceso UNC a otro servidor.</span><span class="sxs-lookup"><span data-stu-id="4b304-183">The *\<destination path>* can also be local or a UNC path to another server.</span></span>  
  
     <span data-ttu-id="4b304-184">El paso MarkAndBackupLog marca los registros para realizar la copia de seguridad y después realiza la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4b304-184">The MarkAndBackupLog step marks the logs for backup, and then backs them up.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="4b304-185">Para evitar **posible pérdida de datos** y **mejora del rendimiento**,  *\<ruta de acceso de destino >* debe establecerse en un equipo diferente, o unidad de disco duro, diferente de la que se usa para almacenar los registros de base de datos original.</span><span class="sxs-lookup"><span data-stu-id="4b304-185">To avoid **potential data loss** and for **performance improvement**, the *\<destination path>* should be set to a different computer, or hard drive, different from what is used to store the original database logs.</span></span>  
  
     <span data-ttu-id="4b304-186">Seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-186">Select **OK**.</span></span>  
  
7.  <span data-ttu-id="4b304-187">Seleccione el **Borrar historial de copia de seguridad** paso a paso y seleccione **editar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-187">Select the **Clear Backup History** step, and select **Edit**.</span></span> <span data-ttu-id="4b304-188">En el **comando** cuadro, actualice los valores de parámetro:</span><span class="sxs-lookup"><span data-stu-id="4b304-188">In the **Command** box, update the parameter values:</span></span>  
  
    1.  <span data-ttu-id="4b304-189">**@DaysToKeep**: Valor predeterminado es **14 días**.</span><span class="sxs-lookup"><span data-stu-id="4b304-189">**@DaysToKeep**: Default value is **14 days**.</span></span> <span data-ttu-id="4b304-190">Determina cuánto tiempo se conserva el historial de copia de seguridad el `Adm_BackupHistory` tabla.</span><span class="sxs-lookup"><span data-stu-id="4b304-190">Determines how long the backup history is kept in the `Adm_BackupHistory` table.</span></span> <span data-ttu-id="4b304-191">Borrar periódicamente el historial de copia de seguridad ayuda a mantener la `Adm_BackupHistory` tabla con un tamaño adecuado.</span><span class="sxs-lookup"><span data-stu-id="4b304-191">Periodically clearing the backup history helps maintain the `Adm_BackupHistory` table to an appropriate size.</span></span> 
    
    2.  <span data-ttu-id="4b304-192">Opcional.</span><span class="sxs-lookup"><span data-stu-id="4b304-192">Optional.</span></span> <span data-ttu-id="4b304-193">**@UseLocalTime**: Indica el procedimiento para usar la hora local.</span><span class="sxs-lookup"><span data-stu-id="4b304-193">**@UseLocalTime**: Tells the procedure to use local time.</span></span> <span data-ttu-id="4b304-194">El valor predeterminado es 0.</span><span class="sxs-lookup"><span data-stu-id="4b304-194">The default value is 0.</span></span> <span data-ttu-id="4b304-195">Usa 01:34:11.933 de 2007-05-04 de – GETUTCDATE(): hora UTC actual.</span><span class="sxs-lookup"><span data-stu-id="4b304-195">It uses current UTC time – GETUTCDATE() – 2007-05-04 01:34:11.933.</span></span> <span data-ttu-id="4b304-196">Si se establece en 1, a continuación, utiliza hora local: GETDATE() – 2007-05-03 18:34:11.933</span><span class="sxs-lookup"><span data-stu-id="4b304-196">If set to 1, then it uses local time – GETDATE() – 2007-05-03 18:34:11.933</span></span>
  
    ```  
    exec [dbo].[sp_DeleteBackupHistory] @DaysToKeep=14, @UseLocalTime =1 
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="4b304-197">Este paso **no** eliminar archivos de copia de seguridad de la ruta de acceso de destino.</span><span class="sxs-lookup"><span data-stu-id="4b304-197">This step **does not** delete backup files from the destination path.</span></span>  
    
     <span data-ttu-id="4b304-198">Seleccione **Aceptar** y cierre todas las ventanas de propiedad.</span><span class="sxs-lookup"><span data-stu-id="4b304-198">Select **OK** and close all property windows.</span></span>  
  
8.  <span data-ttu-id="4b304-199">Opcional.</span><span class="sxs-lookup"><span data-stu-id="4b304-199">Optional.</span></span> <span data-ttu-id="4b304-200">Cambiar la programación de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4b304-200">Change the backup schedule.</span></span> <span data-ttu-id="4b304-201">Vea [cómo programar el trabajo de copia de seguridad de BizTalk Server](../core/how-to-schedule-the-backup-biztalk-server-job.md).</span><span class="sxs-lookup"><span data-stu-id="4b304-201">See [How to Schedule the Backup BizTalk Server Job](../core/how-to-schedule-the-backup-biztalk-server-job.md).</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4b304-202">El trabajo de copia de seguridad de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] se ejecuta la primera vez que lo configura.</span><span class="sxs-lookup"><span data-stu-id="4b304-202">The Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job runs the first time you configure it.</span></span> <span data-ttu-id="4b304-203">De forma predeterminada, en las ejecuciones posteriores, la copia de seguridad [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] trabajo se complete una copia de seguridad completa una vez al día y complete las copias de seguridad de registros cada 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="4b304-203">By default, on subsequent runs, the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job completes a full backup once a day, and completes log backups every 15 minutes.</span></span>  
  
9. <span data-ttu-id="4b304-204">Haga clic en el **copia de seguridad de BizTalk Server** de trabajo y seleccione **habilitar**.</span><span class="sxs-lookup"><span data-stu-id="4b304-204">Right-click the **Backup BizTalk Server** job, and select **Enable**.</span></span> <span data-ttu-id="4b304-205">El estado debería cambiar a **correcto**.</span><span class="sxs-lookup"><span data-stu-id="4b304-205">The status should change to **Success**.</span></span>  

## <a name="execute-backupsetupallprocssql-and-logshippingdestinationlogicsql"></a><span data-ttu-id="4b304-206">Ejecute Backup_Setup_All_Procs.sql y LogShipping_Destination_Logic.sql</span><span class="sxs-lookup"><span data-stu-id="4b304-206">Execute Backup_Setup_All_Procs.sql and LogShipping_Destination_Logic.sql</span></span>

<span data-ttu-id="4b304-207">**[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]Feature Pack 2 (FP2)** utiliza las secuencias de comandos Backup_Setup_All_Procs.sql y LogShipping_Destination_Logic.sql en `\Program Files (x86)\Microsoft BizTalk Server *your version*\Schema`.</span><span class="sxs-lookup"><span data-stu-id="4b304-207">**[!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2 (FP2)** used the Backup_Setup_All_Procs.sql and LogShipping_Destination_Logic.sql scripts in `\Program Files (x86)\Microsoft BizTalk Server *your version*\Schema`.</span></span> 

<span data-ttu-id="4b304-208">Si el trabajo de copia de seguridad de BizTalk Server ya está configurado y que desea cambiar para usar Azure blob (en lugar de un disco), también lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="4b304-208">If your Backup BizTalk Server job is already configured, and you want to switch to using Azure blob (instead of a disk), then also do the following:</span></span> 

1. <span data-ttu-id="4b304-209">En el servidor SQL Server, ejecute el `Backup_Setup_All_Procs.sql` script en todas las bases de datos personalizadas que se está respaldada por el trabajo de copia de seguridad de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-209">On the SQL Server, execute the `Backup_Setup_All_Procs.sql` script against all custom databases that are being backed up by the Backup BizTalk Server job.</span></span> <span data-ttu-id="4b304-210">De forma predeterminada, FP2 actualiza automáticamente las bases de datos de BizTalk; no actualiza las bases de datos personalizados (esas bases de datos en el `adm_OtherBackupDatabases` tabla en BizTalkMgmtDb).</span><span class="sxs-lookup"><span data-stu-id="4b304-210">By default, FP2 automatically updates BizTalk databases; it does not update any custom databases (those databases in the `adm_OtherBackupDatabases` table in BizTalkMgmtDb).</span></span>

    <span data-ttu-id="4b304-211">[Nuevo seguridad de bases de datos personalizadas](how-to-back-up-custom-databases.md) proporciona información detallada sobre las bases de datos personalizados.</span><span class="sxs-lookup"><span data-stu-id="4b304-211">[Back Up Custom Databases](how-to-back-up-custom-databases.md) provides more details on custom databases.</span></span> 

2. <span data-ttu-id="4b304-212">**Si usa [trasvase de registros](log-shipping.md)**, ejecute la secuencia de comandos LogShipping_Destination_Logic.sql del sistema de destino de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4b304-212">**If you use [log shipping](log-shipping.md)**, execute the LogShipping_Destination_Logic.sql script on the destination system within SQL Server.</span></span> <span data-ttu-id="4b304-213">Si no utiliza el trasvase de registros, a continuación, no ejecute este script.</span><span class="sxs-lookup"><span data-stu-id="4b304-213">If you don't use log shipping, then do not execute this script.</span></span>

    <span data-ttu-id="4b304-214">[Configurar el sistema de destino para el trasvase de registros](how-to-configure-the-destination-system-for-log-shipping.md) contiene más detalles sobre el sistema de destino.</span><span class="sxs-lookup"><span data-stu-id="4b304-214">[Configure the Destination System for Log Shipping](how-to-configure-the-destination-system-for-log-shipping.md) provides more details on the destination system.</span></span>

## <a name="spforcefullbackup-stored-procedure"></a><span data-ttu-id="4b304-215">procedimiento almacenado sp_ForceFullBackup</span><span class="sxs-lookup"><span data-stu-id="4b304-215">sp_ForceFullBackup stored procedure</span></span>  
  
<span data-ttu-id="4b304-216">El **sp_ForceFullBackup** procedimiento almacenado en el **BizTalkMgmtDb** base de datos puede utilizarse para ejecutar un "ad-hoc" copia de seguridad completa de los archivos de datos y de registro.</span><span class="sxs-lookup"><span data-stu-id="4b304-216">The **sp_ForceFullBackup** stored procedure in the **BizTalkMgmtDb** database can be used to run an ad-hoc full backup of the data and log files.</span></span> <span data-ttu-id="4b304-217">El procedimiento almacenado actualiza la tabla adm_ForceFullBackup con un valor de 1.</span><span class="sxs-lookup"><span data-stu-id="4b304-217">The stored procedure updates the adm_ForceFullBackup table with a value 1.</span></span> <span data-ttu-id="4b304-218">La próxima vez que se ejecute el trabajo [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de copia de seguridad, se creará un conjunto completo de copias de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4b304-218">The next time the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job is ran, a full database backup set is created.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="4b304-219">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4b304-219">Next Steps</span></span>  
 <span data-ttu-id="4b304-220">[Configurar el sistema de destino de trasvase de registros](../core/how-to-configure-the-destination-system-for-log-shipping.md) </span><span class="sxs-lookup"><span data-stu-id="4b304-220">[Configure the Destination System for Log Shipping](../core/how-to-configure-the-destination-system-for-log-shipping.md) </span></span>  
 [<span data-ttu-id="4b304-221">Programar el trabajo de copia de seguridad de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="4b304-221">Schedule the Backup BizTalk Server Job</span></span>](../core/how-to-schedule-the-backup-biztalk-server-job.md)  
 [<span data-ttu-id="4b304-222">Cuentas de almacenamiento de Azure</span><span class="sxs-lookup"><span data-stu-id="4b304-222">Azure storage accounts</span></span>](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account)  
 [<span data-ttu-id="4b304-223">Copia de seguridad en URL de SQL Server</span><span class="sxs-lookup"><span data-stu-id="4b304-223">SQL Server Backup to URL</span></span>](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url)
