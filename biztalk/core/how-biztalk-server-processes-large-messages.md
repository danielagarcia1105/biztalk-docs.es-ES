---
title: Cómo BizTalk Server procesa los mensajes grandes | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 62c070be-dff5-4349-9e36-dd3a7caf1752
caps.latest.revision: 33
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 26ecae241e1e41fdb67204c7975741a240979c2d
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22249636"
---
# <a name="how-biztalk-server-processes-large-messages"></a><span data-ttu-id="3afe9-102">Cómo procesa BizTalk Server los mensajes de gran tamaño</span><span class="sxs-lookup"><span data-stu-id="3afe9-102">How BizTalk Server Processes Large Messages</span></span>
## <a name="what-is-a-large-message"></a><span data-ttu-id="3afe9-103">¿Qué es un mensaje de gran tamaño?</span><span class="sxs-lookup"><span data-stu-id="3afe9-103">What is a large message?</span></span>  
 <span data-ttu-id="3afe9-104">Desgraciadamente, la respuesta a esta pregunta no está vinculada directamente a un tamaño específico de mensaje sino que depende de los cuellos de botella específicos de su sistema Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3afe9-104">Unfortunately, the answer to this question isn't tied directly to a specific message size, but rather, depends on specific bottlenecks in your Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] system.</span></span> <span data-ttu-id="3afe9-105">Los problemas vinculados a los mensajes de gran tamaño se pueden dividir en las siguientes categorías:</span><span class="sxs-lookup"><span data-stu-id="3afe9-105">The problems associated with large messages can be divided into the following categories:</span></span>  
  
-   <span data-ttu-id="3afe9-106">**Errores de memoria insuficiente** ciertos tipos de procesamiento de mensajes - como la promoción de propiedades -, validaciones y asignaciones, cargan el mensaje completo en la memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-106">**Out of memory errors** Certain types of message processing - such as mapping, validation, and property promotion - load the entire message into memory.</span></span> <span data-ttu-id="3afe9-107">Si el tamaño del mensaje en memoria es superior a los recursos disponibles, se produce un error de memoria insuficiente.</span><span class="sxs-lookup"><span data-stu-id="3afe9-107">If the size of the message in memory exceeds available resources, then an out of memory error occurs.</span></span> <span data-ttu-id="3afe9-108">El umbral de tamaño para los mensajes que quedan dentro de esta categoría es muy inferior al umbral de tamaño para los mensajes que no se cargan en la memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-108">The size threshold for messages that fall into this category is much lower than the size threshold for messages that are not loaded into memory.</span></span> <span data-ttu-id="3afe9-109">Por ejemplo, un archivo sin formato de 10 MB que se analiza en XML y después se asigna, puede crecer en un factor de 10 o más y consumir más de 100 MB de memoria, mientras que un documento XML de 100 MB que no se analiza o asigna podría consumir solo 1 MB de memoria al transmitirlo a la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-109">For example, a 10 MB flat file that is parsed into XML and then mapped may grow by a factor of 10 or more to consume over 100 MB of memory, whereas a 100 MB XML document that is not parsed or mapped may actually only consume 1 MB of memory as it is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="3afe9-110">**Problemas de rendimiento para los mensajes que no se cargan en memoria** mensajes que no tienen que estar cargado en memoria se transmiten a la base de datos de cuadro de mensajes mediante la interfaz .NET XmlReader.</span><span class="sxs-lookup"><span data-stu-id="3afe9-110">**Performance problems for messages that are not loaded into memory** Messages that are not required to be loaded into memory are streamed to the MessageBox database using the .NET XmlReader interface.</span></span> <span data-ttu-id="3afe9-111">Aunque no están sujetos a las limitaciones de tamaño de los mensajes que deben cargarse en memoria, existen algunos factores importantes que afectan al modo en que BizTalk Server procesa los mensajes que se transmiten a la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-111">While they are not subject to the size limitations on messages that must be loaded into memory, there are some important factors that impact how BizTalk Server processes messages that are streamed to the MessageBox database.</span></span>  
  
## <a name="factors-that-affect-the-processing-of-large-messages"></a><span data-ttu-id="3afe9-112">Factores que afectan al procesamiento de mensajes de gran tamaño</span><span class="sxs-lookup"><span data-stu-id="3afe9-112">Factors that affect the processing of large messages</span></span>  
 <span data-ttu-id="3afe9-113">Tanto el tamaño del mensaje original, el formato del mensaje como el tipo de procesamiento afectan al modo en que procesa BizTalk Server los mensajes de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="3afe9-113">The original message size, message format, and type of message processing all affect how BizTalk Server processes large messages.</span></span>  
  
-   <span data-ttu-id="3afe9-114">**Tamaño del mensaje original** el tamaño del mensaje recibido por BizTalk Server es la indicación más visible del tamaño que tendrá el mensaje cuando se procesa por BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="3afe9-114">**Original message size** The size of the message received by BizTalk Server is the most visible indication of how large the message will be when it is processed by BizTalk Server.</span></span> <span data-ttu-id="3afe9-115">El tamaño original de un mensaje tiene un impacto mucho mayor sobre el rendimiento si se carga el mensaje completo en la memoria en vez de transmitirlo a la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-115">The original size of a message has a much greater impact on performance if the entire message is loaded into memory than if the message is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="3afe9-116">**Formato de mensaje** mensajes se reciben en BizTalk Server en uno de dos formatos principales: XML archivos o archivos sin formato.</span><span class="sxs-lookup"><span data-stu-id="3afe9-116">**Message format** Messages are received into BizTalk Server in one of two primary formats: XML files or flat files.</span></span>  
  
    -   <span data-ttu-id="3afe9-117">**Archivos XML** en orden para que BizTalk Server realizar cualquier procesamiento en un mensaje distinto de pasarlo a través de enrutamiento, el mensaje debe estar en el formato de archivo XML.</span><span class="sxs-lookup"><span data-stu-id="3afe9-117">**XML files** In order for BizTalk Server to perform any processing on a message other than pass through routing, the message must be in the XML file format.</span></span> <span data-ttu-id="3afe9-118">Si los archivos que se van a procesar se reciben en formato XML, en su mayoría retendrán su tamaño original.</span><span class="sxs-lookup"><span data-stu-id="3afe9-118">If the files to be processed are received in XML format then they will retain their original size for the most part.</span></span>  
  
    -   <span data-ttu-id="3afe9-119">**Archivos planos** archivos sin formato deben analizarse en un formato XML para que BizTalk Server pueda realizar cualquier procesamiento distinto de pasarlo a través de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="3afe9-119">**Flat files** Flat files must be parsed into an XML format before BizTalk Server can perform any processing other than pass through routing.</span></span> <span data-ttu-id="3afe9-120">Al analizar un archivo sin formato en un archivo XML, el tamaño del archivo puede aumentar considerablemente.</span><span class="sxs-lookup"><span data-stu-id="3afe9-120">Parsing a flat file into an XML file can greatly increase the size of the file.</span></span> <span data-ttu-id="3afe9-121">Los archivos sin formato no contienen etiquetas XML con información descriptiva acerca de sus datos.</span><span class="sxs-lookup"><span data-stu-id="3afe9-121">Flat files do not contain XML tags with descriptive information about their data.</span></span> <span data-ttu-id="3afe9-122">Por otro lado, los archivos XML ajustan todos sus datos en etiquetas XML descriptivas.</span><span class="sxs-lookup"><span data-stu-id="3afe9-122">XML files, on the other hand, wrap all of their data in descriptive XML tags.</span></span> <span data-ttu-id="3afe9-123">En algunos casos, el análisis puede aumentar el tamaño de un archivo sin formato en un factor de 10 o más, en función de cuántos datos descriptivos incluyan las etiquetas XML para el archivo.</span><span class="sxs-lookup"><span data-stu-id="3afe9-123">In some scenarios parsing can increase the size of a flat file by a factor of 10 or more, depending on how much descriptive data is contained in the XML tags for the file.</span></span>  
  
    -   <span data-ttu-id="3afe9-124">**Planos documentos de archivos que se encapsulan en un único nodo de sección CDATA en un documento XML** este tipo de documento es una combinación de XML y archivos sin formato y puede resultar problemático porque BizTalk Server debe cargar el documento de archivo sin formato ajustado completo en memoria antes de procesarlo.</span><span class="sxs-lookup"><span data-stu-id="3afe9-124">**Flat file documents wrapped in a single CDATA section node in an XML document** This type of document is a combination of both XML and flat file and can be problematic because BizTalk Server must load the entire wrapped flat file document into memory before processing it.</span></span>  
  
-   <span data-ttu-id="3afe9-125">**Tipo de procesamiento de mensajes** en BizTalk Server, hay dos tipos de procesamiento de mensajes: enrutamiento solo y asignación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-125">**Type of message processing** In BizTalk Server, there are two types of message processing: Routing only and Mapping.</span></span> <span data-ttu-id="3afe9-126">Las variables de rendimiento vinculadas al tipo de procesamiento de mensajes que se realiza son el tamaño del mensaje y si está cargado en memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-126">The performance variables tied to the type of message processing that is performed are message size and whether the message is loaded into memory.</span></span>  
  
    -   <span data-ttu-id="3afe9-127">**Sólo enrutamiento** si BizTalk Server sólo se utiliza para enrutar mensajes según las propiedades de mensaje en cuestión, a continuación, se transmite el mensaje en la base de datos de cuadro de mensajes mediante la interfaz .NET XmlReader y partes del mensaje no son individualmente carga en memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-127">**Routing only** If BizTalk Server is only used only for routing messages based upon promoted message properties, then the message is streamed into the Messagebox database using the .NET XmlReader interface, and message parts are not individually loaded into memory.</span></span> <span data-ttu-id="3afe9-128">En este caso, los errores de memoria insuficiente no constituyen un problema y la consideración principal es el tiempo necesario para escribir mensajes de gran tamaño (más de 100 MB) en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-128">In this scenario, out of memory errors are not an issue and the primary consideration is the amount of time that is required to write very large messages (over 100 MB) into the Messagebox database.</span></span> <span data-ttu-id="3afe9-129">El equipo de programación de BizTalk Server ha comprobado el procesamiento correcto de mensajes de un tamaño máximo de 1 GB al realizar solo enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="3afe9-129">The BizTalk Server development team has successfully tested the processing of messages up to 1 GB in size when performing routing only.</span></span>  
  
         <span data-ttu-id="3afe9-130">El factor principal que determina el rendimiento en este escenario es la **tamaño del fragmento del mensaje grande** usado para fragmentar los datos en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3afe9-130">The primary factor that determines performance in this scenario is the **Large message fragment size** used to fragment the data into the database.</span></span> <span data-ttu-id="3afe9-131">El **tamaño del fragmento del mensaje grande** es una opción configurable en el **propiedades del grupo de BizTalk** página de configuración y tiene un valor predeterminado de 102400 bytes (100 KB).</span><span class="sxs-lookup"><span data-stu-id="3afe9-131">The **Large message fragment size** is a configurable option on the **BizTalk Group Properties** configuration page and has a default value of 102400 bytes (100 KB).</span></span> <span data-ttu-id="3afe9-132">Al aumentar este valor se reduce el número de acciones de ida y vuelta necesarias para transmitir un mensaje a la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-132">Increasing this value reduces the number of round trips required to stream a message into the MessageBox database.</span></span>  
  
    -   <span data-ttu-id="3afe9-133">**Asignación de** transformar un documento con un mapa puede ser una operación que utilizan mucha memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-133">**Mapping** Transforming a document with a map can be a memory-intensive operation.</span></span> <span data-ttu-id="3afe9-134">Cuando un documento se transforma mediante una asignación, BizTalk Server pasa el mensaje a la clase .Net XSLCompileTransform, que carga la hoja de estilo XSL.</span><span class="sxs-lookup"><span data-stu-id="3afe9-134">When a document is transformed by a map, BizTalk Server passes the message to the .Net XSLCompileTransform class, which loads the XSL style sheet.</span></span> <span data-ttu-id="3afe9-135">Cuando el método Load se complete correctamente, el método Transform se puede llamar simultáneamente desde varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="3afe9-135">After the Load method completes successfully, the Transform method can be called simultaneously from multiple threads.</span></span> <span data-ttu-id="3afe9-136">[Clase XslCompiledTransform](http://go.microsoft.com/fwlink/p/?LinkID=282683) proporciona más información sobre la clase XSLCompiledTransform.</span><span class="sxs-lookup"><span data-stu-id="3afe9-136">[XslCompiledTransform Class](http://go.microsoft.com/fwlink/p/?LinkID=282683) provides more information on the XSLCompiledTransform class.</span></span>  
  
         [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="3afe9-137"> mejora significativamente la administración de memoria para los documentos de gran tamaño mediante la implementación de un umbral de tamaño de mensaje configurable para cargar documentos en memoria durante las transformaciones.</span><span class="sxs-lookup"><span data-stu-id="3afe9-137"> significantly improves memory management for large documents by implementing a configurable message size threshold for loading documents into memory during transforms.</span></span> <span data-ttu-id="3afe9-138">Los mensajes con un tamaño inferior a este umbral se administran en memoria. Los mensajes con un tamaño superior a este umbral se almacenan en el búfer del sistema de archivos para reducir las necesidades de memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-138">Any message with a size below this threshold is handled in memory; any message with a size above this threshold is buffered to the file system to reduce memory requirements.</span></span> <span data-ttu-id="3afe9-139">El tamaño de umbral de mensaje predeterminado es 1 MB.</span><span class="sxs-lookup"><span data-stu-id="3afe9-139">The default message size threshold is 1 MB.</span></span>  
  
## <a name="guidelines-for-processing-large-messages"></a><span data-ttu-id="3afe9-140">Directrices para procesar mensajes de gran tamaño</span><span class="sxs-lookup"><span data-stu-id="3afe9-140">Guidelines for processing large messages</span></span>  
 <span data-ttu-id="3afe9-141">Siga estas directrices para mejorar el rendimiento al procesar mensajes de gran tamaño en BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="3afe9-141">Follow these guidelines to improve performance when processing large messages in BizTalk Server:</span></span>  
  
1.  <span data-ttu-id="3afe9-142">Ajuste el umbral de tamaño de mensajes por encima del cual se almacenan los documentos en el búfer del sistema de archivos durante la asignación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-142">Adjust the message size threshold above which documents are buffered to the file system during mapping.</span></span> <span data-ttu-id="3afe9-143">Para modificar el umbral de tamaño, cree un valor DWORD denominado **TransformThreshold** en la ubicación siguiente en el registro de BizTalk Server:</span><span class="sxs-lookup"><span data-stu-id="3afe9-143">To modify the size threshold, create a DWORD value named **TransformThreshold** at the following location in the BizTalk Server registry:</span></span>  
  
    ```  
    HKLM\Software\Microsoft\BizTalk Server\3.0\Administration\TransformThreshold  
    ```  
  
     <span data-ttu-id="3afe9-144">Tras crear este valor, escriba un valor decimal con el número de bytes para establecer el nuevo umbral.</span><span class="sxs-lookup"><span data-stu-id="3afe9-144">After you have created this value, enter a decimal value with the number of bytes to set the new threshold to.</span></span> <span data-ttu-id="3afe9-145">Por ejemplo, escriba un valor decimal de 2097152 para aumentar el umbral de tamaño de mensaje a 2 MB (el valor predeterminado es 1 MB).</span><span class="sxs-lookup"><span data-stu-id="3afe9-145">For example, enter a decimal value of 2097152 to increase the message size threshold to 2 MB (from the default of 1 MB).</span></span> <span data-ttu-id="3afe9-146">Aumente este valor en los sistemas con una gran cantidad de memoria disponible para mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="3afe9-146">Increase this value on systems with a large amount of available memory to improve throughput.</span></span> <span data-ttu-id="3afe9-147">El almacenamiento de documentos en el búfer del disco conserva memoria con un impacto en el rendimiento global.</span><span class="sxs-lookup"><span data-stu-id="3afe9-147">Buffering documents to disk conserves memory at a cost to overall throughput.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="3afe9-148">De forma predeterminada, los documentos que están almacenados en búfer en el sistema de archivos durante la asignación se escriben en el *% temp %* directorio del equipo de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="3afe9-148">By default, documents that are buffered to the file system during mapping are written to the *%temp%* directory of the BizTalk Server computer.</span></span> <span data-ttu-id="3afe9-149">Cambiar la configuración de la *% temp %* variable de entorno para un disco ajeno al sistema para mejorar el rendimiento al almacenar en búfer los mensajes grandes al sistema de archivos durante la asignación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-149">Change the setting for the *%temp%* environment variable to a non-system disk to improve performance when buffering large messages to the file system during mapping.</span></span>  
  
2.  <span data-ttu-id="3afe9-150">Minimice el uso de asignaciones en orquestaciones:</span><span class="sxs-lookup"><span data-stu-id="3afe9-150">Minimize the use of maps in orchestrations:</span></span>  
  
    -   <span data-ttu-id="3afe9-151">Si usa una asignación para extraer o establecer las propiedades usadas con lógica empresarial en una orquestación, utilice campos distintivos o propiedades promocionadas en su lugar.</span><span class="sxs-lookup"><span data-stu-id="3afe9-151">If you are using a map to extract or set properties used with business logic in an orchestration, use distinguished fields or promoted properties instead.</span></span> <span data-ttu-id="3afe9-152">Al extraer o establecer valores con una asignación, se carga el documento en memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-152">When extracting or setting values with a map the document is loaded into memory.</span></span> <span data-ttu-id="3afe9-153">Al usar campos distintivos o propiedades promocionadas, el motor de orquestaciones obtiene acceso al contexto del mensaje y no carga el documento en memoria.</span><span class="sxs-lookup"><span data-stu-id="3afe9-153">When using distinguished fields or promoted properties, the Orchestration engine accesses the message context and does not load the document into memory.</span></span>  
  
    -   <span data-ttu-id="3afe9-154">Si utiliza una asignación para agregar varios campos a un campo, use campos distintivos o propiedades promocionadas con una variable de orquestación para acumular el conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="3afe9-154">If you are using a map to aggregate several fields into one field, use distinguished fields or promoted properties with an orchestration variable to accumulate the result set.</span></span>  
  
    -   <span data-ttu-id="3afe9-155">No configure una orquestación con varias entradas para formas de transformación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-155">Do not configure an orchestration with multiple inputs to transform shapes.</span></span> <span data-ttu-id="3afe9-156">Una orquestación que contiene varias entradas para formas de transformación no se transmitirá por secuencias al sistema de archivos durante la asignación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-156">An orchestration that contains multiple inputs to transform shapes will not stream to the file system while mapping.</span></span> <span data-ttu-id="3afe9-157">Esta limitación provocará que todo el documento que se asigna se cargue en memoria si el tamaño del documento supera el valor de Registro de TransformThreshold especificado.</span><span class="sxs-lookup"><span data-stu-id="3afe9-157">This limitation will cause the entire document that is being mapped to load into memory if the document size exceeds the specified TransformThreshold registry value.</span></span> <span data-ttu-id="3afe9-158">Una posible solución para este problema sería aplicar las transformaciones en el nivel de puerto de recepción, de manera que la orquestación nunca acepte más de una única entrada para las formas de transformación.</span><span class="sxs-lookup"><span data-stu-id="3afe9-158">One possible workaround to this issue would be to apply transforms at the receive port level so that the orchestration never accepts more than a single input to transform shapes.</span></span>  
  
3.  <span data-ttu-id="3afe9-159">Ajustar la **tamaño del fragmento del mensaje grande** propiedad expuesta en el **propiedades del grupo de BizTalk** página de configuración:</span><span class="sxs-lookup"><span data-stu-id="3afe9-159">Adjust the **Large message fragment size** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
     <span data-ttu-id="3afe9-160">Si el tamaño de memoria de un mensaje recibido supera el número de bytes especificado para **tamaño del fragmento del mensaje grande** , a continuación, el mensaje se divide en fragmentos del tamaño especificado y se escriben los fragmentos en el cuadro de mensajes en la contexto de una transacción del Coordinador de transacciones distribuidas de Microsoft (MSDTC) como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="3afe9-160">If the in-memory size of a received message exceeds the number of bytes specified for **Large message fragment size** then the message is split into fragments of the specified size and the fragments are written into the MessageBox under the context of a Microsoft Distributed Transaction Coordinator (MSDTC) transaction as follows:</span></span>  
  
    1.  <span data-ttu-id="3afe9-161">Si se publica el mensaje entrante bajo el contexto de una transacción MSDTC existente, se usará esta transacción al escribir los fragmentos del mensaje en el Cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-161">If the incoming message is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the message fragments to the MessageBox.</span></span> <span data-ttu-id="3afe9-162">Por ejemplo, si un adaptador transaccional configurado para solicitar transacciones publica el mensaje entrante, se utilizará la transacción existente al escribir los fragmentos del mensaje en el Cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-162">For example if the incoming message is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the message fragments to the MessageBox.</span></span>  
  
    2.  <span data-ttu-id="3afe9-163">Si no se publica el mensaje entrante bajo el contexto de una transacción MSDTC existente, se crea una transacción MSDTC nueva para escribir los fragmentos del mensaje.</span><span class="sxs-lookup"><span data-stu-id="3afe9-163">If the incoming message is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction is created to write the message fragments.</span></span>  
  
    -   <span data-ttu-id="3afe9-164">Aumente el valor de **tamaño del fragmento del mensaje grande** para reducir la frecuencia con la que los mensajes de gran tamaño se fragmentan y reducen la incidencia de creación de transacciones MSDTC asociadas.</span><span class="sxs-lookup"><span data-stu-id="3afe9-164">Increase the value for **Large message fragment size** to reduce the frequency with which large messages are fragmented and reduce the incidence of creating the associated MSDTC transactions.</span></span> <span data-ttu-id="3afe9-165">Esto es necesario porque un uso excesivo de transacciones MSDTC tiene un gran impacto sobre el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="3afe9-165">This should be done because excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="3afe9-166">Tenga en cuenta que, al aumentar este valor, se aumenta también la cantidad de memoria disponible que se utiliza.</span><span class="sxs-lookup"><span data-stu-id="3afe9-166">Note that increasing this value may also increase the amount of available memory that is used.</span></span>  
  
    -   <span data-ttu-id="3afe9-167">Si la escritura de un mensaje en el cuadro de mensajes tarda más del tiempo de espera de transacción MSDTC máximo permitido de 60 minutos, la transacción excede el tiempo de espera, se produce un error, la escritura del mensaje no se lleva a cabo correctamente y se deshace.</span><span class="sxs-lookup"><span data-stu-id="3afe9-167">If it takes longer than the maximum allowable MSDTC transaction timeout of 60 minutes to write a message to the MessageBox, then the transaction times out, an error results, and the attempt to write the message fails and is rolled back.</span></span> <span data-ttu-id="3afe9-168">El **tamaño del fragmento del mensaje grande** valor debe aumentarse lo suficiente para evitar este problema al procesar mensajes muy grandes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-168">The **Large message fragment size** value should be increased enough to avoid this problem when processing very large messages.</span></span> <span data-ttu-id="3afe9-169">En función de la memoria disponible, este valor debe aumentarse hasta un máximo de 1.000.000 bytes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-169">Depending on available memory, this value should be increased up to a maximum value of 1000000 bytes.</span></span>  
  
    -   <span data-ttu-id="3afe9-170">Cada fragmento de mensaje en un mensaje crea uno o más bloqueos de base de datos SQL Server en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-170">Each message fragment in a message creates one or more SQL Server database locks against the MessageBox database.</span></span> <span data-ttu-id="3afe9-171">Si el número de bloqueos es superior a varios cientos de miles, el servidor SQL Server podría empezar a generar errores de bloqueos insuficientes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-171">When the number of locks exceeds several hundred thousand, it is possible that SQL Server will start generating “out of lock” errors.</span></span> <span data-ttu-id="3afe9-172">Si se produce este problema, aumente la **tamaño del fragmento del mensaje grande** para reducir el número de bloqueos de base de datos de SQL Server realizada en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-172">If this problem occurs, increase the **Large message fragment size** to reduce the number of SQL Server database locks made against the MessageBox database.</span></span>  
  
4.  <span data-ttu-id="3afe9-173">Si experimenta errores de bloqueos insuficientes, considere la posibilidad de alojar la base de datos de cuadro de mensajes en una versión de 64 bits de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3afe9-173">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors.</span></span> <span data-ttu-id="3afe9-174">El número de bloqueos disponible es significativamente superior en la versión de 64 bits de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3afe9-174">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
5.  <span data-ttu-id="3afe9-175">Ajustar la **umbral de mensajes grandes** propiedad expuesta en el **propiedades del grupo de BizTalk** página de configuración:</span><span class="sxs-lookup"><span data-stu-id="3afe9-175">Adjust the **Large message threshold** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
     <span data-ttu-id="3afe9-176">Como un mensaje se procesan por lotes, si el tamaño en memoria de un lote de mensajes alcanza el número de bytes especificado para **umbral de mensajes grandes** , la parte del lote de mensajes que se han procesado se escribe en el cuadro de mensajes antes de se procesa el resto del lote de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-176">As a message batch is processed, if the in-memory size of a message batch reaches the number of bytes specified for **Large message threshold** then the portion of the message batch that has been processed is written to the MessageBox before the remainder of the message batch is processed.</span></span> <span data-ttu-id="3afe9-177">Esto se hace bajo el contexto de una transacción MSDTC de la siguiente forma:</span><span class="sxs-lookup"><span data-stu-id="3afe9-177">This is done under the context of an MSDTC transaction as follows:</span></span>  
  
    1.  <span data-ttu-id="3afe9-178">Si se publica el lote de mensajes bajo el contexto de una transacción MSDTC existente, se usará esta transacción al escribir la parte procesada del lote de mensajes en el Cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-178">If the message batch is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the processed portion of the message batch to the MessageBox.</span></span> <span data-ttu-id="3afe9-179">Por ejemplo, si un adaptador transaccional configurado para solicitar transacciones publica el lote de mensajes entrantes, se utilizará la transacción existente al escribir la parte procesada del lote de mensajes en el Cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-179">For example if the incoming message batch is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the processed portion of the message batch to the MessageBox.</span></span>  
  
    2.  <span data-ttu-id="3afe9-180">Si no se publica el lote de mensajes bajo el contexto de una transacción MSDTC existente, debe crearse una transacción MSDTC nueva al escribir las partes del lote de mensajes en el Cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-180">If the message batch is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction must be created to write the portions of the message batch to the MessageBox.</span></span> <span data-ttu-id="3afe9-181">La transacción MSDTC se usa para garantizar que todas las partes de un lote de mensajes específico se escriben correctamente en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-181">The MSDTC transaction is used to ensure that all of the portions of a given message batch are successfully written to the MessageBox database.</span></span>  
  
     <span data-ttu-id="3afe9-182">El **umbral de mensajes grandes** es directamente aplicable a lotes de mensajes, pero dado que un lote de mensajes se puede establecer en un valor de uno, el **umbral de mensajes grandes** también puede ser indirectamente se aplica a los mensajes individuales.</span><span class="sxs-lookup"><span data-stu-id="3afe9-182">The **Large message threshold** setting is directly applicable to message batches but since a message batch can be set to a value of one, the **Large message threshold** setting can also be indirectly applicable to individual messages.</span></span> <span data-ttu-id="3afe9-183">Por ejemplo cuando un lote de mensajes de un mensaje supera el **umbral de mensajes grandes** parámetro la **umbral de mensajes grandes** en vigor se aplica solo a ese único mensaje en el lote.</span><span class="sxs-lookup"><span data-stu-id="3afe9-183">For example when a message batch of one message exceeds the specified **Large message threshold** parameter then the **Large message threshold** in effect applies only to the single message in the batch.</span></span>  
  
    -   <span data-ttu-id="3afe9-184">El **umbral de mensajes grandes** parámetro se debería ajustar para mitigar la creación de transacciones MSDTC utilizadas para distribuir lotes de mensajes en el cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3afe9-184">The **Large message threshold** parameter should be adjusted to mitigate the creation of MSDTC transactions used to apportion message batches to the MessageBox.</span></span> <span data-ttu-id="3afe9-185">Esto es necesario porque el uso excesivo de transacciones MSDTC tiene un gran impacto sobre el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="3afe9-185">This should be done because the excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="3afe9-186">Utilice el siguiente cálculo para determinar el valor mínimo para el **umbral de mensajes grandes** configuración debe ser evitar la creación innecesaria de transacciones de MSDTC:</span><span class="sxs-lookup"><span data-stu-id="3afe9-186">Use the following calculation to determine what the minimum value for the **Large message threshold** setting should be to avoid unnecessarily creating MSDTC transactions:</span></span>  
  
        ```  
        Batch Size * Average size (in bytes) of each message in the batch after being processed by the receive pipeline < Large message threshold  
        ```  
  
         <span data-ttu-id="3afe9-187">Siempre que el tamaño total en bytes de un lote de mensajes no supera el valor especificado para **umbral de mensajes grandes** , no hay ninguna necesidad de BizTalk iniciar una transacción MSDTC para distribuir el lote de mensajes en el cuadro de mensajes base de datos.</span><span class="sxs-lookup"><span data-stu-id="3afe9-187">As long as the total size in bytes of a message batch does not exceed the specified value for **Large message threshold** then there is no need for BizTalk to initiate an MSDTC transaction to apportion the message batch to the MessageBox database.</span></span>