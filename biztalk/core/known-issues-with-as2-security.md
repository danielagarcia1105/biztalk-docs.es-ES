---
title: Problemas conocidos con la seguridad de AS2 | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b291e000-630d-49a1-8e19-f76c4dfee294
caps.latest.revision: "10"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1bb633e092ed568bb3817df7be788364934be446
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="known-issues-with-as2-security"></a><span data-ttu-id="bd4d8-102">Problemas conocidos de la seguridad de AS2</span><span class="sxs-lookup"><span data-stu-id="bd4d8-102">Known Issues with AS2 Security</span></span>
<span data-ttu-id="bd4d8-103">En este tema se describen los problemas conocidos en relación con la seguridad de soluciones AS2 de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="bd4d8-103">This topic describes known issues with the security of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] AS2 solutions.</span></span>  
  
## <a name="the-as2-decoder-will-not-validate-that-a-certificate-is-configured-on-the-host-or-for-the-destination-party"></a><span data-ttu-id="bd4d8-104">El descodificador AS2 no validará que un certificado esté configurado en el host o para la entidad de destino.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-104">The AS2 Decoder Will Not Validate that a Certificate Is Configured on the Host or for the Destination Party</span></span>  
 <span data-ttu-id="bd4d8-105">El descodificador AS2 descifrará un mensaje siempre que el certificado privado de dicho mensaje esté configurado en el almacén de certificados.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-105">The AS2 decoder will decrypt a message as long as the private certificate for that message is configured in the certificate store.</span></span> <span data-ttu-id="bd4d8-106">Sin embargo, el descodificador AS2 no validará que el certificado de descifrado sea el mismo que el certificado configurado en el host.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-106">However, the AS2 decoder will not validate that the decryption certificate is the same as the certificate configured on the host.</span></span> <span data-ttu-id="bd4d8-107">El mensaje recibido se puede cifrar con más de un certificado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-107">The received message can be encrypted with more than one certificate.</span></span>  
  
## <a name="storing-as2-messages-in-wire-format-can-lead-to-a-security-issue"></a><span data-ttu-id="bd4d8-108">El almacenamiento de mensajes AS2 con formato puede derivar en un problema de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-108">Storing AS2 Messages in Wire Format Can Lead to a Security Issue</span></span>  
 <span data-ttu-id="bd4d8-109">Cuando no se usan certificados, no se recomienda el almacenamiento de mensajes AS2 con formato en la base de datos de recepción sin repudio (NRR).</span><span class="sxs-lookup"><span data-stu-id="bd4d8-109">When certificates are not used, storing AS2 messages in wire format in the non-repudiation receipt (NRR) database is not recommended.</span></span> <span data-ttu-id="bd4d8-110">Si se hace, podría producirse un problema de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-110">Doing so could lead to a security issue.</span></span>  
  
## <a name="messages-or-mdns-to-be-stored-in-the-nrr-database-should-be-signed"></a><span data-ttu-id="bd4d8-111">Se deben firmar los mensajes o MDN que se vayan a almacenar en la base de datos NRR.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-111">Messages or MDNs To Be Stored in the NRR Database Should Be Signed</span></span>  
 <span data-ttu-id="bd4d8-112">Para garantizar la recepción sin repudio, debe establecer la autenticación e integridad del mensaje correspondiente.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-112">To guarantee non-repudiation of receipt, you must establish the authentication and integrity of the applicable message.</span></span> <span data-ttu-id="bd4d8-113">La forma recomendada de hacerlo es mediante una firma digital en el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-113">The recommended way of doing so is by using a digital signature on the message.</span></span> <span data-ttu-id="bd4d8-114">Como resultado, si configura las propiedades de la entidad AS2 para almacenar mensajes o MDN en la base de datos sin repudio, debe configurar las propiedades de AS2 para firmar los mensajes o MDN que vaya a almacenar.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-114">As a result, if you configure AS2 party properties to store messages or MDNs in the non-repudiation database, you should configure the AS2 properties to sign the messages or MDNs that you are going to store.</span></span>  
  
## <a name="biztalk-server-will-be-unable-to-decrypt-a-message-saved-in-wire-format-if-the-certificate-is-not-valid"></a><span data-ttu-id="bd4d8-115">BizTalk Server no podrá descifrar un mensaje guardado con formato si el certificado no es válido.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-115">BizTalk Server Will Be Unable to Decrypt a Message Saved in Wire Format If the Certificate Is Not Valid</span></span>  
 <span data-ttu-id="bd4d8-116">**Síntoma**</span><span class="sxs-lookup"><span data-stu-id="bd4d8-116">**Symptom**</span></span>  
  
 <span data-ttu-id="bd4d8-117">BizTalk Server no puede descifrar un mensaje AS2 entrante que se haya guardado con formato en la base de datos sin repudio.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-117">BizTalk Server is unable to decrypt an inbound AS2 message that was saved in wire format in the non-repudiation database.</span></span>  
  
 <span data-ttu-id="bd4d8-118">**Causa posible**</span><span class="sxs-lookup"><span data-stu-id="bd4d8-118">**Possible Cause**</span></span>  
  
 <span data-ttu-id="bd4d8-119">El certificado necesario para descifrar el mensaje ha caducado o se ha revocado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-119">The certificate required to decrypt the message has expired or been revoked.</span></span> <span data-ttu-id="bd4d8-120">Hay más probabilidades de que esto ocurra si ha transcurrido cierto período de tiempo desde que se guardó el mensaje AS2 en la base de datos sin repudio.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-120">This is more likely to occur if a certain period of time has elapsed since the AS2 message was saved in the non-repudiation database.</span></span> <span data-ttu-id="bd4d8-121">Si esto ocurre, es posible que no disponga de acceso inmediato a un certificado válido para el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-121">If this occurs, you may not have immediate access to a valid certificate for the message.</span></span>  
  
 <span data-ttu-id="bd4d8-122">**Resolución**</span><span class="sxs-lookup"><span data-stu-id="bd4d8-122">**Resolution**</span></span>  
  
 <span data-ttu-id="bd4d8-123">Adquiera un certificado válido para descifrar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-123">Acquire a valid certificate for decrypting the message.</span></span>  
  
## <a name="the-inner-envelope-of-a-signed-as2-message-must-not-be-changed-after-the-signature-has-been-calculated"></a><span data-ttu-id="bd4d8-124">El sobre interno de un mensaje AS2 firmado no debe cambiarse después de que se haya calculado la firma.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-124">The inner envelope of a signed AS2 message must not be changed after the signature has been calculated</span></span>  
 <span data-ttu-id="bd4d8-125">Cuando se firma un mensaje AS2, la firma se calcula según los encabezados y la carga del sobre interno.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-125">When an AS2 message is signed, the signature is calculated based on the inner envelope headers and payload.</span></span> <span data-ttu-id="bd4d8-126">Si se modifica el sobre interno tras el cálculo de la firma, ésta se deteriorará.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-126">If the inner envelope is changed after the signature is calculated, the signature will be corrupted.</span></span> <span data-ttu-id="bd4d8-127">Los encabezados de límite, o cualquier elemento fuera de los encabezados de límite, pueden modificarse, pero no se debe cambiar nada que se encuentre dentro de estos encabezados.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-127">The boundary headers, or anything outside the boundary headers, can be changed, but anything within the boundary headers must not be changed.</span></span>  
  
## <a name="use-the-same-logon-for-the-in-process-host-instance-and-the-isolated-host-instance-to-ensure-that-personal-store-is-recognized"></a><span data-ttu-id="bd4d8-128">Usar el mismo inicio de sesión para la instancia de host de tipo En curso y aislado para garantizar que se identifique el almacén personal.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-128">Use the same logon for the in-process host instance and the isolated host instance to ensure that Personal store is recognized</span></span>  
 <span data-ttu-id="bd4d8-129">El almacén de certificados personales sólo estará disponible para el procesamiento de mensajes si el perfil del usuario está cargado para el usuario cuyas credenciales de inicio de sesión están asociadas a la instancia del host.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-129">The Personal certificate store will be available for message processing only if the user profile is loaded for the user whose logon credentials are associated with the host instance.</span></span> <span data-ttu-id="bd4d8-130">El almacén personal se usa para los certificados de firma y descifrado (la clave privada propia del usuario).</span><span class="sxs-lookup"><span data-stu-id="bd4d8-130">The Personal store is used for signing and decryption certificates (the user's own private key).</span></span> <span data-ttu-id="bd4d8-131">El perfil del usuario se carga de forma predeterminada para la instancia del host de tipo En curso; sin embargo, el perfil del usuario no se carga de forma predeterminada para la instancia del host aislado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-131">The user profile is loaded by default for the in-process host instance; however, the user profile is not loaded by default for the isolated host instance.</span></span> <span data-ttu-id="bd4d8-132">Puede hacer que una aplicación cargue el perfil del usuario para el host aislado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-132">You can have an application load the user profile for the isolated host.</span></span> <span data-ttu-id="bd4d8-133">Como alternativa, puede solucionar este problema usando el mismo inicio de sesión para la instancia del host de tipo En curso y la instancia del host aislado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-133">Alternatively, you can work around this issue by using the same logon for the in-process host instance and the isolated host instance.</span></span>  
  
 <span data-ttu-id="bd4d8-134">En lugar de que una aplicación cargue el perfil de usuario, puede crear un servicio vacío para cargar el perfil.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-134">Instead of having an application load the user profile, you can create an empty service to load the profile.</span></span> <span data-ttu-id="bd4d8-135">Para obtener información acerca de cómo crear un servicio vacío, vea [Cómo: crear servicios de Windows](http://go.microsoft.com/fwlink/?LinkId=196492).</span><span class="sxs-lookup"><span data-stu-id="bd4d8-135">For information about creating an empty service, see [How to: Create Windows Services](http://go.microsoft.com/fwlink/?LinkId=196492).</span></span> <span data-ttu-id="bd4d8-136">Después de haber creado el servicio, abra el cuadro de diálogo de administración de equipos, abra el cuadro de diálogo de propiedades para el servicio, haga clic en el **iniciar sesión** ficha, seleccione **esta cuenta**, escriba el nombre de inicio de sesión utilizado para el aislamiento de la instancia de host y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-136">After you have created the service, open the Computer Management dialog box, open the Properties dialog box for the service, click the **Log On** tab, select **This Account**, enter the logon name used for the isolated host instance, and then click **OK**.</span></span> <span data-ttu-id="bd4d8-137">A continuación, puede iniciar manualmente el servicio para cargar el perfil de usuario de ese usuario de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-137">You can then manually start the service to load the user profile for that logon user.</span></span>  
  
## <a name="the-key-usage-attribute-of-a-certificate-must-match-the-certificates-use"></a><span data-ttu-id="bd4d8-138">El atributo Uso de la clave de un certificado debe coincidir con el uso del certificado.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-138">The Key Usage attribute of a certificate must match the certificate's use</span></span>  
 <span data-ttu-id="bd4d8-139">Los certificados usados para el transporte AS2 deben tener los atributos necesarios para su uso previsto.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-139">Certificates used for AS2 transport must have the attributes required for their intended use.</span></span> <span data-ttu-id="bd4d8-140">Para la firma y la verificación de la firma, el atributo Uso de la clave del certificado debe ser Firma digital.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-140">For signing and signature verification, the Key Usage attribute of the certificate must be Digital Signature.</span></span> <span data-ttu-id="bd4d8-141">Para el cifrado y el descifrado, el atributo Uso de la clave del certificado debe ser Cifrado de datos o Cifrado de clave.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-141">For encryption and decryption, the Key Usage attribute of the certificate must be Data Encipherment or Key Encipherment.</span></span> <span data-ttu-id="bd4d8-142">Para verificar el atributo Uso de la clave, haga doble clic en el certificado, haga clic en la ficha Detalles del cuadro de diálogo Certificado y compruebe el campo Uso de la clave.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-142">You can verify the Key Usage attribute by double-clicking the certificate, clicking the Details tab in the Certificate dialog box, and checking the Key Usage field.</span></span>  
  
## <a name="the-certificate-resolution-list-will-be-verified-for-an-outgoing-mdn-if-the-as2-to-property-is-not-set-for-the-party"></a><span data-ttu-id="bd4d8-143">La lista de resolución de certificados se comprobará para un MDN saliente si la propiedad AS2-To no está configurada para la entidad.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-143">The certificate resolution list will be verified for an outgoing MDN if the AS2-To property is not set for the party</span></span>  
 <span data-ttu-id="bd4d8-144">En el acuerdo predeterminado para un MDN saliente, se realiza la verificación de la lista de resolución de certificados.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-144">In the default agreement for an outgoing MDN, the certificate resolution list verification is performed.</span></span> <span data-ttu-id="bd4d8-145">Si no desea que se realice esta verificación, compruebe que está establecida la propiedad AS2-To correcta, de forma que la entidad de recepción pueda resolverse y las propiedades de la entidad puedan determinarse.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-145">If you do not want this verification to be performed, verify that the correct AS2-To party property is set, so the receiving party can be resolved and the party properties can be determined.</span></span> <span data-ttu-id="bd4d8-146">En ese caso, no se usará el acuerdo predeterminado que solicita la verificación de la lista de resolución de certificados.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-146">If so, the default agreement that prompts verification of the certificate resolution list will not be used.</span></span> <span data-ttu-id="bd4d8-147">También deberá deshabilitar la propiedad Comprobar lista de revocaciones de certificados de la página General de las propiedades de entidad AS2.</span><span class="sxs-lookup"><span data-stu-id="bd4d8-147">You will also need to disable the Check Certification Revocation List property on the General page of the AS2 party properties.</span></span>