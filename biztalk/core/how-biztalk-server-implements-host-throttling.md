---
title: Cómo BizTalk Server incorpora la limitación de Host | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- host throttling, rate based throttling
- host throttling, outbound
- host throttling, algorithm
- host throttling, components
- host throttling, inbound
- host throttling, resource based throttling
- host throttling, user controlled throttling
- host throttling, strategies
ms.assetid: 46d3c3de-66b9-4c8a-8369-e68563fc9c40
caps.latest.revision: 27
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1944b61f9710b02f4e6db18a38972849847c532e
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/28/2018
ms.locfileid: "22250660"
---
# <a name="how-biztalk-server-implements-host-throttling"></a>Cómo implementa BizTalk Server la limitación de host
El [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] continuamente, el mecanismo de limitación de host supervisa para una condición de limitación, calcula la gravedad de la condición de limitación y aplica progresivamente la limitación según la gravedad calculada de host. El mecanismo de limitación se ajusta automáticamente y son adecuadas para la mayoría de las opciones de configuración predeterminadas [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] escenarios de procesamiento. [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] limitación de host expone varias opciones configurables que pueden usarse para optimizar la limitación en escenarios concretos. Para obtener información acerca de cómo cambiar estas opciones de configuración, consulte [cómo modificar la configuración del Host](../core/how-to-modify-host-settings.md).  
  
## <a name="components-of-the-host-throttling-algorithm"></a>Componentes del algoritmo de limitación de host  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] usa el siguiente algoritmo al aplicar la limitación de host:  
  
1.  Supervise continuamente los parámetros siguientes para ver si exceden determinados umbrales. Si los valores del parámetro superan el umbral del parámetro, existe una condición de limitación.  
  
    -   Cantidad de memoria en uso (tanto de todo el sistema como de la memoria de proceso del host)  
  
    -   Número de mensajes en curso que se están enviando o procesando (umbral de límite saliente).  
  
    -   Número de subprocesos en uso.  
  
    -   Tamaño de la base de datos, medido según el número de elementos en las tablas de cola para todos los hosts y el número de elementos en las tablas de cola de impresión y de seguimiento.  
  
    -   Número de conexiones simultáneas a la base de datos.  
  
    -   Tasa de publicación de mensajes (entrante) y de entrega o procesamiento (saliente).  
  
2.  Determine la gravedad de la condición de limitación. Las condiciones de limitación se clasifican según su gravedad del siguiente modo (de más grave a menos grave).  
  
    -   La memoria de proceso del host en uso supera el umbral.  
  
    -   El número de mensajes en curso supera el umbral.  
  
    -   El recuento de subprocesos en uso supera el umbral.  
  
    -   El tamaño de la base de datos supera el umbral.  
  
    -   Todas las demás condiciones de limitación.  
  
3.  Aplique progresivamente la limitación en función de la gravedad de las condiciones de limitación. La limitación se aplica más agresivamente conforme aumenta el nivel de gravedad. La limitación progresiva se consigue del siguiente modo:  
  
    -   Se detectan una o más condiciones de limitación y se les asigna una gravedad.  
  
    -   Se emite una instrucción de implementar la limitación basándose en la condición con la gravedad más alta. Dependiendo de la condición de limitación, si el problema persiste, se puede reducir el tamaño de diversos grupos de subprocesos y se puede liberar memoria deshidratando las orquestaciones en ejecución.  
  
    -   Se aplica un retraso en la publicación o en el procesamiento del mensaje en función de si el mensaje es entrante o saliente. El período de retraso es proporcional a la gravedad de la condición de limitación, por lo que las condiciones de limitación de mayor gravedad iniciarán un período de limitación más largo que las condiciones de limitación de menor gravedad. El mecanismo de limitación ajusta este período de retraso hacia arriba y hacia abajo en unos intervalos concretos a medida que cambian las condiciones. El período de retraso actual se expone a través de la **retraso (ms) en la entrega de mensajes** y **retraso en la publicación (ms) del mensaje** contadores de rendimiento asociados con la **BizTalk: agente de**  categoría de objeto de rendimiento. Estos contadores del objeto de rendimiento se documentan en el tema [contadores de rendimiento de limitación de Host](../core/host-throttling-performance-counters.md).  
  
    -   El mecanismo de limitación sigue comprobando si hay una condición de limitación. Si se mitigan las condiciones de limitación, se desbloquean los mensajes acelerados y se permite que funcionen el grupo de subprocesos y otros recursos en un modo no restringido. Si el sistema sigue funcionando sin que se produzcan condiciones de limitación, el período de retraso se reduce en gran medida. Si la condición de limitación persiste, la cantidad de retraso se incrementa proporcionalmente a la gravedad de la condición y los mensajes posteriores estarán sujetos al mayor retraso.  
  
    -   La limitación ya no se implementa cuando el período de retraso ha transcurrido.  
  
## <a name="type-of-throttling-conditions"></a>Tipos de condiciones de limitación  
 Hay tres tipos principales de las condiciones de limitación: basada en tasa, basada en recursos y orquestación.  
  
1.  **Limitación según la velocidad** se divide en dos categorías; entrante (publicado) y saliente (entregado):  
  
    -   Mensajes entrantes (publicados), BizTalk Server limita la publicación de mensajes si el **mensaje tasa entrante de publicación** para el host instancia supera la **tasa saliente de publicación de mensajes\***  especificado **factor de sobrecarga (porcentaje)** valor. El **factor de sobrecarga (porcentaje)** parámetro es configurable en el **configuración de limitación de publicación de mensajes** cuadro de diálogo. La limitación basada en tasa de los mensajes entrantes se realiza principalmente mediante la inducción de un retraso antes de publicar el lote de mensajes en la base de datos de cuadro de mensajes. No se realiza ninguna otra acción para llevar a cabo la limitación basada en tasa en los mensajes entrantes.  
  
    -   Para los mensajes salientes (entregados), BizTalk Server limita la entrega de mensajes si el **tasa entrante de la entrega de mensajes** para el host instancia supera la **tasa saliente de la entrega de mensajes** \*especificado **factor de sobrecarga (porcentaje)** valor. El **factor de sobrecarga (porcentaje)** parámetro es configurable en el **configuración de limitación de procesamiento de mensajes** cuadro de diálogo. La limitación basada en tasa de los mensajes salientes se realiza principalmente mediante la inducción de un retraso antes de quitar los mensajes de la cola en memoria y la entrega de los mensajes al Gestor extremo (EPM) o al motor de orquestaciones para su procesamiento. No se realiza ninguna otra acción para llevar a cabo la limitación basada en tasa en los mensajes salientes.  
  
         Para obtener más información sobre el factor de sobrecarga y otros valores de limitación basada en tasas, consulte [cómo modificar tasa según configuración de la limitación](../core/how-to-modify-rate-based-throttling-settings.md).  
  
2.  **Limitación basada en recursos** supervisa los recursos del sistema como subprocesos, memoria y el tamaño de la base de datos y se puede aplicar a cualquier clase de servicio. Para obtener más información acerca de los valores de limitación basada en recursos, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).  
  
3.  **Limitación de orquestación** puede evitar la deshidratación e indicar cuándo se deben pausar y reanudar las suscripciones. Para obtener más información acerca de los valores de limitación de orquestación, consulte [cómo modificar configuración de la limitación de orquestación](../core/how-to-modify-orchestration-throttling-settings.md).  
  
## <a name="throttling-condition-triggers-actions-and-mitigation-strategies"></a>Desencadenadores de condiciones de limitación, acciones y estrategias de mitigación  
 En esta sección se describen los desencadenadores para diversas condiciones de limitación, las acciones resultantes del mecanismo de limitación y las técnicas que se pueden emplear para mitigar la condición de limitación.  
  
### <a name="inbound-throttling"></a>Limitación de entrada  
 El mecanismo de limitación de BizTalk aplica limitación de entrada al motor de orquestación (XLANG) y a los adaptadores de entrada.  
  
 Use la **estado de limitación de publicación de mensajes** y **duración del estado de la limitación de publicación de mensajes** contadores asociados con **BizTalk:MessageAgent** rendimiento categoría de objetos para medir el estado de limitación actual y la duración de la limitación. Para obtener más información acerca de lo contadores de rendimiento de limitación de host disponible, consulte [contadores de rendimiento de limitación de Host](../core/host-throttling-performance-counters.md).  
  
 La limitación de entrada puede provocar que los mensajes entrantes se registren en el origen. Si la limitación de entrada se aplica a un adaptador de recepción, el adaptador de recepción puede dejar de recibir mensajes hasta que se mitigue la condición de limitación.  
  
|Publicación de mensajes<br /><br /> estado de la limitación|Desencadenador de la condición de limitación |Acciones de limitación realizadas|Estrategia de mitigación|Objeto de rendimiento|Contador de rendimiento|  
|---------------------------------------------|--------------------------------------|------------------------------|-------------------------|------------------------|-------------------------|  
|2|**Tasa entrante de publicación de mensajes** para el host instancia supera la **tasa saliente de publicación de mensajes\***  especificado **factor de sobrecarga (porcentaje)** valor. La base de datos no puede hacer frente a la tasa de publicación.|Bloquea el subproceso de publicación durante un período de tiempo calculado dinámicamente hasta que el **tasa entrante de publicación de mensajes** esté al mismo nivel con el **tasa saliente de publicación de mensajes** \* el especificado **Factor de sobrecarga (porcentaje)** valor.|Utilice contadores de rendimiento para determinar las tasas entrante y saliente de publicación de mensajes. Considere un factor de sobrecarga adecuado para su entorno.<br /><br /> Compruebe que los valores proporcionados para el **duración de la ventana de muestreo** y **número mínimo de muestras** parámetros son adecuados para su escenario.<br /><br /> Para obtener más información acerca de estos parámetros, consulte [cómo modificar tasa según configuración de la limitación](../core/how-to-modify-rate-based-throttling-settings.md).|BizTalk:MessageAgent|Tasa entrante de publicación de mensajes<br /><br /> Tasa saliente de publicación de mensajes|  
|4|La memoria del proceso supera el umbral especificado.<br /><br /> Esto puede suceder si el lote que se va a publicar tiene requisitos de memoria elevados o si hay demasiados subprocesos procesando mensajes|Reduzca el tamaño del grupo de subprocesos utilizado por EPM.<br /><br /> Bloquee los subprocesos de EPM para evitar el procesamiento de nuevos lotes de mensajes.<br /><br /> Si hay un requisito de memoria elevado que almacena los mensajes en un lote para la base de datos, el subproceso de publicación también puede sufrir un retraso progresivo antes de que los mensajes se almacenen en la base de datos.<br /><br /> Tanto si el lote de publicación se bloquea como si no debido a la necesidad de memoria de proceso dependerá de varios factores entre los que se incluye el número de mensajes en el lote o si hay deshidratación o comandos de eliminación de mensajes en el lote.|Considere la posibilidad de reducir la cantidad de carga mediante la reducción del grupo de subprocesos de EPM o del tamaño de los lotes del adaptador.<br /><br /> Si el proceso no consume demasiada memoria, considere la posibilidad de aumentar la **virtual de proceso** umbral para el host.<br /><br /> Para obtener más información acerca de cómo cambiar la **virtual de proceso** valor, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Consumo excesivo de memoria de proceso<br /><br /> Uso de memoria de proceso (MB)<br /><br /> Umbral de uso de memoria de proceso (MB)|  
|6|El tamaño de la cola de mensajes del host, el tamaño de la tabla de cola de impresión o el tamaño de la tabla de seguimiento superan el umbral especificado.<br /><br /> Entre las razones posibles para esta condición se incluyen:<br /><br /> -Los trabajos del Agente SQL utilizan por BizTalk Server para mantener las bases de datos de BizTalk Server no se está ejecutando o se ejecutan con lentitud.<br />-Componentes de nivel inferior no procesa los mensajes de la cola en memoria de manera oportuna.<br />-Número de mensajes suspendidos es alto.<br />-Se ha alcanzado la carga máxima sostenible para el sistema.|Reduzca el tamaño del grupo de subprocesos utilizado por EPM.<br /><br /> Bloquee los subprocesos de EPM para evitar el procesamiento de nuevos lotes de mensajes.<br /><br /> El subproceso de publicación también está sujeto a un retraso progresivo antes que los mensajes se almacenen en la base de datos.|Asegúrese de que los trabajos del Agente SQL utilizados por BizTalk Server para mantener las bases de datos de BizTalk Server se están ejecutando y que no fallan.<br /><br /> Finalice y reanude instancias suspendidas según sea necesario.<br /><br /> Aumente el valor predeterminado para la **recuento en la base de datos del mensaje** umbral teniendo en cuenta los requisitos de espacio de SQL server que aloja las bases de datos de BizTalk.<br /><br /> Si la base de datos tiene el tamaño adecuado para controlar mensajes adicional, considere la posibilidad de aumentar la **multiplicador de cola de impresión** y **multiplicador de datos de seguimiento** valores para permitir más trabajo pendiente en la cola de impresión y tablas de seguimiento.<br /><br /> Para obtener más información acerca de cómo cambiar los valores, vea [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent<br /><br /> BizTalk:Cuadros de mensajes:Contadores generales<br /><br /> BizTalk:Cuadros de mensajes:Contadores de host|Agente de mensaje /Tamaño de base de datos<br /><br /> Cuadro de mensajes:Contadores generales /Tamaño de cola de impresión<br /><br /> Cuadro de mensajes:Contadores generales /Tamaño de datos de seguimiento<br /><br /> Cuadro de mensajes:Contadores de host/Cola de host - Longitud<br /><br /> Cuadro de mensajes:Contadores de host/Cola de host - Mens. Suspendidos - Longitud|  
|8|Las sesiones de base de datos utilizadas por la instancia de host superan el umbral especificado.|Reduzca el tamaño del grupo de subprocesos utilizado por EPM.<br /><br /> Bloquee los subprocesos de EPM para evitar el procesamiento de nuevos lotes de mensajes.<br /><br /> El subproceso de publicación también está sujeto a un retraso progresivo antes que los mensajes se almacenen en la base de datos.|Considere la posibilidad de aumentar la **las conexiones de base de datos** umbral para el host.<br /><br /> Para obtener más información acerca de cómo cambiar este valor, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Sesión de base de datos|  
|9|El recuento de subprocesos del proceso supera el umbral especificado.|Reduzca el tamaño del grupo de subprocesos utilizado por EPM.<br /><br /> Bloquee los subprocesos de EPM para evitar el procesamiento de nuevos lotes de mensajes.<br /><br /> El subproceso de publicación también está sujeto a un retraso progresivo antes que los mensajes se almacenen en la base de datos.|Considere la posibilidad de ajustar los distintos tamaños de grupos de subprocesos para asegurar que el sistema no crea un número grande de subprocesos.<br /><br /> Para obtener más información acerca de cómo modificar los tamaños de grupo de subprocesos, vea [cómo modificar la configuración General](../core/how-to-modify-general-settings.md) y [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Número de subprocesos<br /><br /> Umbral del número de subprocesos|  
|5|La memoria del sistema supera el umbral especificado.|Reduzca el tamaño del grupo de subprocesos utilizado por EPM.<br /><br /> Bloquee los subprocesos de EPM para evitar el procesamiento de nuevos lotes de mensajes.<br /><br /> Si hay un requisito de memoria elevado que almacena los mensajes en un lote para la base de datos, el subproceso de publicación también puede sufrir un retraso progresivo antes de que los mensajes se almacenen en la base de datos.<br /><br /> Tanto si el lote de publicación se bloquea como si no debido a la necesidad de memoria de proceso dependerá de varios factores entre los que se incluye el número de mensajes en el lote o si hay deshidratación o comandos de eliminación de mensajes en el lote.|Considere la posibilidad de reducir la carga mediante la reducción del tamaño predeterminado del grupo de subprocesos de EPM o del tamaño de los lotes del adaptador.<br /><br /> Si el proceso no consume demasiada memoria, considere la posibilidad de aumentar la **Global física** umbral para el host.<br /><br /> Para obtener más información acerca de cómo cambiar la **Global física** umbral, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Uso de memoria física (MB)<br /><br /> Umbral de uso de memoria física (MB)|  
  
### <a name="outbound-throttling"></a>Limitación de salida  
 El mecanismo de limitación de BizTalk aplica limitación de salida al motor de orquestación (XLANG) y a los adaptadores de salida.  
  
 Use la **estado de limitación de entrega de mensajes** y **duración del estado de la limitación de entrega de mensajes** contadores asociados con **BizTalk:MessageAgent** objeto de rendimiento categoría para medir el estado de limitación actual y la duración de la limitación. Para obtener más información sobre el rendimiento de limitación de host disponible vea contadores [contadores de rendimiento de limitación de Host](../core/host-throttling-performance-counters.md).  
  
 La limitación de salida puede provocar una entrega de mensajes retrasada y puede que los mensajes se acumulen en la cola en memoria y provoquen el bloqueo de los subprocesos de eliminación de la cola hasta que se mitigue la condición de limitación. Cuando los subprocesos de eliminación de la cola están bloqueados no se extrae ningún mensaje adicional del cuadro de mensajes hacia la cola en memoria para la entrega saliente.  
  
|Entrega de mensajes<br /><br /> estado de la limitación|Desencadenador de la condición de limitación |Acciones de limitación realizadas|Estrategia de mitigación|Objeto de rendimiento|Contador de rendimiento|  
|-------------------------------------------|--------------------------------------|------------------------------|-------------------------|------------------------|-------------------------|  
|1|**Tasa entrante de la entrega de mensajes** para el host instancia supera la **tasa saliente de la entrega de mensajes \***  especificado **factor de sobrecarga (porcentaje)** valor<br /><br /> Esto puede deberse a una alta complejidad del procesamiento, a adaptadores de salida lentos o a una escasez momentánea de recursos del sistema.|Bloquea el subproceso de entrega durante un período de tiempo calculado dinámicamente hasta que la entrega de mensajes tasa entrante esté al mismo nivel con el **tasa saliente de la entrega de mensajes \***  especificado **velocidad sobrecargar (factor por ciento)** valor.|Utilice contadores de rendimiento para determinar las tasas entrante y saliente de la entrega de mensajes. Tenga en cuenta un adecuado a través de factor de unidad para su entorno.<br /><br /> Compruebe que los valores proporcionados para el **duración de la ventana de muestreo** y **número mínimo de muestras** parámetros son adecuados para su escenario.<br /><br /> Para obtener más información acerca de estos parámetros, consulte [cómo modificar tasa según configuración de la limitación](../core/how-to-modify-rate-based-throttling-settings.md).|BizTalk:MessageAgent|Tasa entrante de la entrega de mensajes<br /><br /> Tasa saliente de publicación de mensajes|  
|4|La memoria del proceso supera el umbral especificado.<br /><br /> Esto puede producirse en escenarios donde el procesamiento requiere un uso intensivo de la memoria, cuando se procesan mensajes grandes o cuando los adaptadores de envío intentan procesar un gran número de mensajes simultáneamente.|Ralentice la entrega de mensajes a los adaptadores o a XLANG.<br /><br /> Reduzca el consumo de memoria del proceso mediante la deshidratación de instancias de servicio y la reducción de caché cuando se puedan aplicar.<br /><br /> Reduzca el tamaño de los grupos de subprocesos utilizados por EPM o por el Agente de mensaje.<br /><br /> Fuerce de manera periódica una recolección de elementos no utilizados (GC) de .NET.|Si el sistema no llega a estar inactivo debido a la limitación basada en memoria del proceso, puede que no se necesite ninguna acción.<br /><br /> Si el **número de mensajes en curso** es alto y el uso de CPU no es excesivo incluso cuando no hay proceso limitación basada en memoria, se pueden requerir ninguna acción adicional.<br /><br /> Si parece que el sistema sobrelimitado, considere la posibilidad de aumentar el valor asociado a la **virtual de proceso** umbral para el host y compruebe que la instancia de host no genera un error de "memoria insuficiente". Si se produce un error de "memoria insuficiente" al aumentar la **virtual de proceso** umbral, considere la posibilidad de reducir los valores para la **tamaño de la cola de mensajes interna** y **mensajesencurso** umbrales. Esta estrategia es especialmente importante en escenarios de procesamiento de mensajes de gran tamaño.<br /><br /> Para obtener más información acerca de estos parámetros, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Consumo excesivo de memoria de proceso<br /><br /> Usage(MB) de memoria de proceso<br /><br /> Umbral de uso de memoria de proceso (MB)<br /><br /> Número de mensajes en curso<br /><br /> Número de instancias activas|  
|3|El número de mensajes en curso entregados a una clase de servicio supera el umbral especificado.<br /><br /> Esto puede deberse a una alta complejidad del procesamiento, a adaptadores de salida lentos o a una escasez momentánea de recursos del sistema.|Ralentice la entrega de mensajes a los adaptadores o a XLANG.<br /><br /> Reduzca el tamaño del grupo de subprocesos utilizado por el Agente de mensaje.|Si se produce sobrelimitación, considere la posibilidad de aumentar el valor asociado a la **mensajes en curso** umbral.<br /><br /> Para obtener más información acerca de este parámetro, vea [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md) **Nota:** al aumentar este valor puede afectar al rendimiento del adaptador de envío negativamente o aumente la cantidad de memoria uso del proceso.|BizTalk:MessageAgent|Número de mensajes en curso<br /><br /> Umbral del número de mensajes en curso|  
|9|El recuento de subprocesos del proceso supera el umbral especificado.|Reducir el tamaño de los grupos de subprocesos utilizados por el EPM o el agente de mensaje|Considere la posibilidad de ajustar los distintos tamaños de grupos de subprocesos para asegurar que el sistema no crea un número grande de subprocesos.<br /><br /> Para obtener más información acerca de cómo modificar los tamaños de grupo de subprocesos, vea [cómo modificar la configuración General](../core/how-to-modify-general-settings.md) y [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Número de subprocesos<br /><br /> Umbral del número de subprocesos|  
|5|La memoria del sistema supera un umbral.|Ralentice la entrega de mensajes a los adaptadores o a XLANG.<br /><br /> Reduzca el consumo de memoria del proceso mediante la deshidratación de instancias de servicio y la reducción de caché cuando se puedan aplicar.<br /><br /> Reduzca el tamaño de los grupos de subprocesos utilizados por EPM o por el Agente de mensaje.|Considere la posibilidad de reducir la carga mediante la reducción del tamaño predeterminado del grupo de subprocesos de EPM o del tamaño de los lotes del adaptador.<br /><br /> Si el proceso no consume demasiada memoria, considere la posibilidad de aumentar la **Global física** umbral para el host.<br /><br /> Para obtener más información acerca de cómo cambiar la **Global física** umbral, consulte [cómo modificar recursos según configuración de la limitación](../core/how-to-modify-resource-based-throttling-settings.md).|BizTalk:MessageAgent|Uso de memoria física (MB)|