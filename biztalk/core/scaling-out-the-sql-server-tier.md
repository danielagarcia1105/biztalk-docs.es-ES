---
title: Escalar horizontalmente el nivel de servidor SQL | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- scaling, MessageBox database
- scaling, scaling out
- SQL Server, scaling
- MessageBox database, scaling
- scaling, strategies
ms.assetid: d5b2ebba-401e-4fde-8818-407fa626043a
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 702c253a0135c1dc4af4cea15a9b47c77792586f
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="scaling-out-the-sql-server-tier"></a><span data-ttu-id="79956-102">Escalar horizontalmente el nivel de SQL Server</span><span class="sxs-lookup"><span data-stu-id="79956-102">Scaling Out the SQL Server Tier</span></span>
<span data-ttu-id="79956-103">Para cada grupo de BizTalk, se agrega una base de datos de cuadro de mensajes principal.</span><span class="sxs-lookup"><span data-stu-id="79956-103">For each BizTalk group, you add one Master MessageBox database.</span></span> <span data-ttu-id="79956-104">Todas las bases de datos de cuadro de mensajes posteriores que se agregan se denominan cuadros de mensajes secundarios.</span><span class="sxs-lookup"><span data-stu-id="79956-104">All the subsequent MessageBox databases that you add are called secondary MessageBoxes.</span></span> <span data-ttu-id="79956-105">El cuadro de mensajes principal controla todas las suscripciones y el enrutamiento de mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-105">The Master MessageBox handles all subscriptions and message routing.</span></span> <span data-ttu-id="79956-106">También puede publicar mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-106">It can also publish messages.</span></span> <span data-ttu-id="79956-107">Las bases de datos de cuadro de mensajes secundario solo publicarán mensajes cuando estén específicamente configuradas para ello.</span><span class="sxs-lookup"><span data-stu-id="79956-107">Secondary MessageBox databases will only publish messages when specifically configured to do so.</span></span>  
  
## <a name="how-to-add-a-secondary-messagebox-database"></a><span data-ttu-id="79956-108">Cómo agregar una base de datos de cuadro de mensajes secundario</span><span class="sxs-lookup"><span data-stu-id="79956-108">How to Add a Secondary MessageBox Database</span></span>  
 <span data-ttu-id="79956-109">Existen dos maneras de agregar bases de datos de cuadro de mensajes secundario:</span><span class="sxs-lookup"><span data-stu-id="79956-109">There are two ways to add secondary MessageBox databases:</span></span>  
  
-   <span data-ttu-id="79956-110">Agregue la base de datos de cuadro de mensajes secundario al mismo servidor físico.</span><span class="sxs-lookup"><span data-stu-id="79956-110">Add the secondary MessageBox database on the same physical server.</span></span>  
  
     <span data-ttu-id="79956-111">Lleve a cabo lo anterior si el servidor físico de cuadro de mensajes existente dispone de recursos de CPU y E/S suficientes y solo se producen en él cuellos de botella por contención de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="79956-111">Do this if the existing MessageBox physical server has enough CPU and I/O resources and is only bottlenecked by lock contention.</span></span> <span data-ttu-id="79956-112">Cree la base de datos de cuadro de mensajes secundario en otras unidades de E/S.</span><span class="sxs-lookup"><span data-stu-id="79956-112">Create the secondary MessageBox database on separate IO drives.</span></span>  
  
     <span data-ttu-id="79956-113">Ventajas:</span><span class="sxs-lookup"><span data-stu-id="79956-113">Advantages:</span></span>  
  
    -   <span data-ttu-id="79956-114">El espacio en cabeza adicional de CPU puede utilizarlo otro cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-114">The extra CPU headroom can be utilized by another message-box</span></span>  
  
    -   <span data-ttu-id="79956-115">Se necesita un menor número de licencias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79956-115">Fewer SQL server licenses are required</span></span>  
  
    -   <span data-ttu-id="79956-116">Se elimina el salto de red.</span><span class="sxs-lookup"><span data-stu-id="79956-116">Network hop is eliminated</span></span>  
  
-   <span data-ttu-id="79956-117">Agregue la base de datos de cuadro de mensajes secundaria a un servidor físico diferente.</span><span class="sxs-lookup"><span data-stu-id="79956-117">Add the secondary MessageBox database on a different physical server</span></span>  
  
     <span data-ttu-id="79956-118">En este caso, utilice un servidor físico exclusivo con su propia E/S como base de datos de cuadro de mensajes adicional.</span><span class="sxs-lookup"><span data-stu-id="79956-118">In this case, use a dedicated physical server with its own IO as the extra MessageBox database.</span></span>  
  
 <span data-ttu-id="79956-119">La ilustración siguiente muestra un escenario donde el nivel de SQL se escala de forma horizontal a tres bases de datos de cuadro de mensajes a partir de una base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-119">The following figure shows a scenario where SQL tier is scaled-out from one MessageBox database to three MessageBoxes databases.</span></span>  
  
 <span data-ttu-id="79956-120">![Escala de MSGBOX](../core/media/scaleoutmsgbox.gif "ScaleOutMSGBOX")</span><span class="sxs-lookup"><span data-stu-id="79956-120">![Scale out MSGBOX](../core/media/scaleoutmsgbox.gif "ScaleOutMSGBOX")</span></span>  
  
## <a name="when-to-scale-out-the-messagebox-database"></a><span data-ttu-id="79956-121">Cuándo es recomendable escalar de forma horizontal a una base de datos de cuadro de mensajes</span><span class="sxs-lookup"><span data-stu-id="79956-121">When to Scale-out the MessageBox database</span></span>  
  
-   <span data-ttu-id="79956-122">En la base de datos de cuadro de mensajes se produce el cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="79956-122">The MessageBox database becomes the bottleneck.</span></span> <span data-ttu-id="79956-123">Estos cuellos de botella pueden ser:</span><span class="sxs-lookup"><span data-stu-id="79956-123">Those bottlenecks can be:</span></span>  
  
    -   <span data-ttu-id="79956-124">**CPU** en el caso de escenarios de orquestación muy caros y complejos, la base de datos de cuadro de mensajes consume muchos recursos de CPU.</span><span class="sxs-lookup"><span data-stu-id="79956-124">**CPU** In case of very expensive and complex orchestration scenarios, the MessageBox database consumes heavy CPU resources.</span></span> <span data-ttu-id="79956-125">La agregación de otra base de datos de cuadro de mensajes de publicación debería contribuir a incrementar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="79956-125">Adding another publishing the MessageBox database should help increase the throughput.</span></span>  
  
    -   <span data-ttu-id="79956-126">**Contención de bloqueo** escenarios complejos formados por varias orquestaciones o instancias de host tienden a crear contenciones de bloqueo en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-126">**Lock Contention** Complex scenarios with multiple host instances or orchestrations tend to create lock contention on the MessageBox database.</span></span> <span data-ttu-id="79956-127">En este caso, la agregación de otra base de datos de cuadro de mensajes de publicación también debería contribuir a incrementar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="79956-127">Again, adding another publishing MessageBox database should help increase the throughput.</span></span>  
  
-   <span data-ttu-id="79956-128">El escalamiento vertical no contribuye a solucionar el cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="79956-128">Scaling up doesn’t address the bottleneck.</span></span> <span data-ttu-id="79956-129">Por ejemplo, si la base de datos de cuadro de mensajes principal se encuentra limitada por la contención de bloqueo, el escalamiento horizontal se convierte en la única posibilidad.</span><span class="sxs-lookup"><span data-stu-id="79956-129">For example, if the Master MessageBox database is lock contention bound, scaling-out is the only option.</span></span>  
  
-   <span data-ttu-id="79956-130">El escalamiento vertical resulta demasiado caro.</span><span class="sxs-lookup"><span data-stu-id="79956-130">Scaling-up is too expensive.</span></span> <span data-ttu-id="79956-131">Por ejemplo, si actualizar el servidor de cuatro procesadores existente a un servidor en 8 direcciones resulta más caro que agregar otro servidor de cuatro procesadores, el escalamiento horizontal se convierte en la opción más adecuada.</span><span class="sxs-lookup"><span data-stu-id="79956-131">For example, if upgrading the existing quad proc server to 8 way server is more expensive than adding another quad proc, scale-out is better option.</span></span>  
  
## <a name="when-you-cant-scale-out-the-sql-tier"></a><span data-ttu-id="79956-132">Cuándo no es recomendable escalar de forma horizontal el nivel de SQL</span><span class="sxs-lookup"><span data-stu-id="79956-132">When You Can’t Scale-out the SQL Tier</span></span>  
 <span data-ttu-id="79956-133">En teoría, el nivel de SQL se debería escalar de forma indefinida siempre que la base de datos de cuadro de mensajes principal no sea el cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="79956-133">In theory, the SQL tier should scale indefinitely as long as the Master MessageBox database is not the bottleneck.</span></span> <span data-ttu-id="79956-134">Para lograrlo, puede convertir la base de datos de cuadro de mensajes principal en una base de datos de no publicación, de manera que solo realice el enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="79956-134">To achieve this, consider making the Master MessageBox database a non-publishing database so it only does routing.</span></span> <span data-ttu-id="79956-135">No obstante, una vez que el cuadro de mensajes principal contenga un cuello de botella producido por contención de bloqueo, ya no podrá escalar el nivel de SQL de forma horizontal.</span><span class="sxs-lookup"><span data-stu-id="79956-135">But, once the Master is bottlenecked by lock contention, you cannot scale out the SQL tier any more.</span></span>  
  
## <a name="scale-out-strategies-and-considerations"></a><span data-ttu-id="79956-136">Estrategias y consideraciones del escalamiento horizontal</span><span class="sxs-lookup"><span data-stu-id="79956-136">Scale-out Strategies and Considerations</span></span>  
  
-   <span data-ttu-id="79956-137">Realice primero un escalamiento vertical de la base de datos de cuadro de mensajes principal y, a continuación, lleve a cabo el escalamiento horizontal.</span><span class="sxs-lookup"><span data-stu-id="79956-137">First scale-up the Master MessageBox database and then scale out.</span></span>  
  
-   <span data-ttu-id="79956-138">Escalamiento horizontal de 1 a 3 bases de datos de SQL en lugar de 1 a 2.</span><span class="sxs-lookup"><span data-stu-id="79956-138">Scaling-out from 1 to 3 SQL MessageBox databases instead of 1 to 2.</span></span> <span data-ttu-id="79956-139">Tenga en cuenta la 1 topología de SQL server que se muestra en la ilustración anterior titulada "4 BizTalk Server, 1 topología de SQL Server" y da por supuesto que el servidor SQL server está limitada por la CPU, en otras palabras, el procesamiento de la CPU es un cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="79956-139">Consider the 1 SQL server topology illustrated in the figure above titled "4 BizTalk Server, 1 SQL Server Topology," and assume that the SQL server is CPU bound, in other words, the CPU processing is a bottleneck.</span></span> <span data-ttu-id="79956-140">Si agrega solo una base de datos de cuadro de mensajes a esta topología, el cuello de botella aún estará en la CPU y la base de datos de cuadro de mensajes secundario se estará utilizando por debajo de sus posibilidades.</span><span class="sxs-lookup"><span data-stu-id="79956-140">If you add only one MessageBox database to this topology, the Master Messagebox will still be CPU bound and the secondary MessageBox database will be under-utilized.</span></span> <span data-ttu-id="79956-141">Por lo tanto, el factor de escala es casi 1.</span><span class="sxs-lookup"><span data-stu-id="79956-141">So, the scaling factor is almost 1.</span></span> <span data-ttu-id="79956-142">Si deshabilita la publicación en la base de datos maestra MessageBox y dedicar la base de datos maestra MessageBox solo para el enrutamiento, la base de datos de cuadro de mensajes secundario realizará la publicación.</span><span class="sxs-lookup"><span data-stu-id="79956-142">If you disable publishing on the Master MessageBox database and dedicate the Master MessageBox database only to do routing, the secondary MessageBox database will do the publishing.</span></span> <span data-ttu-id="79956-143">Esto no ayudará a aumentar el rendimiento global, puesto que la base de datos de cuadro de mensajes secundario es el único editor y en ella se produce el cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="79956-143">This will not help increase overall throughput though since the secondary MessageBox database is the only publisher and still becomes the bottleneck.</span></span> <span data-ttu-id="79956-144">Por consiguiente, la manera más recomendable de realizar el escalamiento horizontal consiste en agregar dos bases de datos de cuadro de mensajes secundario y deshabilitar la publicación en la base de datos de cuadro de mensajes principal.</span><span class="sxs-lookup"><span data-stu-id="79956-144">So, adding 2 secondary MessageBox databases and disabling the publishing on the Master MessageBox database would be the recommended way to scale-out in this scenario.</span></span>  
  
-   <span data-ttu-id="79956-145">La base de datos de cuadro de mensajes principal formará un cuello de botella en última instancia.</span><span class="sxs-lookup"><span data-stu-id="79956-145">The Master MessageBox database will eventually be the bottleneck.</span></span> <span data-ttu-id="79956-146">Por ello, el equipo físico que aloje la base de datos de cuadro de mensajes principal debe ser más grande y más rápido.</span><span class="sxs-lookup"><span data-stu-id="79956-146">So, the physical computer hosting the Master MessageBox database should be faster and bigger.</span></span>  
  
-   <span data-ttu-id="79956-147">Para minimizar el envío de datos a través de la red (y la sobrecarga de DTC consiguiente), considere la posibilidad de colocar varias bases de datos de cuadro de mensajes en el mismo equipo físico con unidades exclusivas.</span><span class="sxs-lookup"><span data-stu-id="79956-147">To minimize sending data over the network (and the associated DTC overhead), consider placing multiple MessageBox databases on the same physical computer with dedicated drives.</span></span> <span data-ttu-id="79956-148">Al mismo tiempo, asegúrese de que en el equipo que contiene las distintas bases de datos no se producen cuellos de botella por estar compartidos los recursos en varias bases de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="79956-148">At the same time, make sure that the computer holding these multiple databases is not bottlenecked as the resources are being shared by multiple MessageBox databases.</span></span>  
  
-   <span data-ttu-id="79956-149">Todas las bases de datos de cuadro de mensajes secundario deben utilizar hardware similar, pues el trabajo se distribuye de manera uniforme entre las bases de datos de cuadro de mensajes de publicación.</span><span class="sxs-lookup"><span data-stu-id="79956-149">All secondary MessageBox databases should use comparable hardware because work is evenly distributed among the publishing MessageBox databases.</span></span>  
  
-   <span data-ttu-id="79956-150">Puesto que el escalamiento horizontal de bases de datos de cuadro de mensajes secundario se realiza siempre que no se produzcan cuellos de botella en la base de datos de cuadro de mensajes principal, estas bases de datos de cuadro de mensajes secundario pueden ejecutarse en equipos que posean una CPU con menos recursos que la base de datos de cuadro de mensajes principal.</span><span class="sxs-lookup"><span data-stu-id="79956-150">Since you can scale out secondary MessageBox databases as long as the master MessageBox database is not bottlenecked, secondary MessageBox databases can run on computers with less CPU resources than is required by the master MessageBox database server.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="79956-151">Vea también</span><span class="sxs-lookup"><span data-stu-id="79956-151">See Also</span></span>  
 <span data-ttu-id="79956-152">[Escalar horizontalmente el nivel de servidor BizTalk Server](../core/scaling-out-the-biztalk-server-tier.md) </span><span class="sxs-lookup"><span data-stu-id="79956-152">[Scaling Out the BizTalk Server Tier](../core/scaling-out-the-biztalk-server-tier.md) </span></span>  
 <span data-ttu-id="79956-153">[Cómo ampliar el nivel de servidor BizTalk Server](../core/scaling-up-the-biztalk-server-tier.md) </span><span class="sxs-lookup"><span data-stu-id="79956-153">[Scaling Up the BizTalk Server Tier](../core/scaling-up-the-biztalk-server-tier.md) </span></span>  
 <span data-ttu-id="79956-154">[Cómo ampliar el nivel de SQL Server](../core/scaling-up-the-sql-server-tier.md) </span><span class="sxs-lookup"><span data-stu-id="79956-154">[Scaling Up the SQL Server Tier](../core/scaling-up-the-sql-server-tier.md) </span></span>  
 <span data-ttu-id="79956-155">[Hosts de recepción escalados](../core/scaled-out-receiving-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="79956-155">[Scaled-Out Receiving Hosts](../core/scaled-out-receiving-hosts.md) </span></span>  
 <span data-ttu-id="79956-156">[Hosts de procesamiento de escala horizontal](../core/scaled-out-processing-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="79956-156">[Scaled-Out Processing Hosts](../core/scaled-out-processing-hosts.md) </span></span>  
 <span data-ttu-id="79956-157">[Hosts de envío de escala horizontal](../core/scaled-out-sending-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="79956-157">[Scaled-Out Sending Hosts](../core/scaled-out-sending-hosts.md) </span></span>  
 <span data-ttu-id="79956-158">[Uso de clúster de Windows Server para proporcionar alta disponibilidad para el servidor BizTalk Server Hosts2](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="79956-158">[Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md) </span></span>  
 <span data-ttu-id="79956-159">[Bases de datos de escala horizontal](../core/scaled-out-databases.md) </span><span class="sxs-lookup"><span data-stu-id="79956-159">[Scaled-Out Databases](../core/scaled-out-databases.md) </span></span>  
 [<span data-ttu-id="79956-160">Agrupación en clústeres las bases de datos de servidor BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="79956-160">Clustering the BizTalk Server Databases</span></span>](../core/clustering-the-biztalk-server-databases1.md)