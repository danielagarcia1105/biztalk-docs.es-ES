---
title: Trabajar con escenarios de convoyes | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1028ab37-7ead-41a6-a186-53e5344d1a28
caps.latest.revision: "19"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 42f1c9931fe91b284c53a05c7868554c622306fb
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
---
# <a name="working-with-convoy-scenarios"></a><span data-ttu-id="970bd-102">Trabajar con escenarios de convoyes</span><span class="sxs-lookup"><span data-stu-id="970bd-102">Working with Convoy Scenarios</span></span>
<span data-ttu-id="970bd-103">A *convoy* existe en cualquier momento que deben estar relacionado con varios mensajes individuales para lograr el resultado requerido.</span><span class="sxs-lookup"><span data-stu-id="970bd-103">A *convoy* exists any time that multiple single messages must be related to achieve the required result.</span></span> <span data-ttu-id="970bd-104">Hay dos tipos principales de convoyes: secuenciales y paralelos.</span><span class="sxs-lookup"><span data-stu-id="970bd-104">There are two main types of convoys: sequential and parallel.</span></span>  
  
 <span data-ttu-id="970bd-105">En algunas condiciones, una instancia de orquestación puede recibir un grupo de mensajes correlacionados al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="970bd-105">Under certain conditions, an orchestration instance might receive a group of correlated messages all at the same time.</span></span> <span data-ttu-id="970bd-106">En esta situación, puede producirse una condición de anticipación, en la que uno de los mensajes del grupo debe inicializar un conjunto de correlaciones en la instancia de orquestación antes de que los demás mensajes puedan correlacionarse a esa misma instancia de orquestación.</span><span class="sxs-lookup"><span data-stu-id="970bd-106">In this situation, a race condition might occur, in which one of the messages in the group must initialize a correlation set in the orchestration instance before the other messages can be correlated to that orchestration instance.</span></span>  
  
 <span data-ttu-id="970bd-107">Para asegurarse de que todos los mensajes correlacionados se reciban en la misma instancia de correlación, BizTalk Server detecta el potencial de esta condición de anticipación y trata todos estos mensajes como un convoy.</span><span class="sxs-lookup"><span data-stu-id="970bd-107">To ensure that all of the correlated messages are received by the same orchestration instance, BizTalk Server detects the potential for such a race condition and treats these messages as a convoy.</span></span> <span data-ttu-id="970bd-108">Al darlos de alta, el motor de tiempo de ejecución crea una suscripción general y la identifica como parte de un convoy.</span><span class="sxs-lookup"><span data-stu-id="970bd-108">At enlistment, the runtime creates a general subscription and identifies it as part of a convoy.</span></span> <span data-ttu-id="970bd-109">Una vez rellenada la suscripción, el motor de mensajería crea una suscripción temporal basada en los valores de las propiedades de correlación predefinidas.</span><span class="sxs-lookup"><span data-stu-id="970bd-109">After filling this subscription, the messaging engine creates a temporary subscription based on the values in the predefined correlation properties.</span></span> <span data-ttu-id="970bd-110">Esta suscripción temporal se denomina un *conjunto de convoy*.</span><span class="sxs-lookup"><span data-stu-id="970bd-110">This temporary subscription is called a *convoy set*.</span></span> <span data-ttu-id="970bd-111">Un conjunto de convoy es un grupo de conjuntos de correlaciones que se usan en un convoy.</span><span class="sxs-lookup"><span data-stu-id="970bd-111">A convoy set is a group of correlation sets that are used in a convoy.</span></span> <span data-ttu-id="970bd-112">Todos los mensajes subsiguientes que coincidan con la suscripción general se evaluarán con respecto al conjunto de convoy, y los que coincidan se enrutarán a un puerto existente.</span><span class="sxs-lookup"><span data-stu-id="970bd-112">All subsequent messages that match the general subscription are evaluated against the convoy set, and those that match are routed to an existing port.</span></span>  
  
## <a name="using-convoys-with-business-processes"></a><span data-ttu-id="970bd-113">Utilizar convoyes con los procesos empresariales</span><span class="sxs-lookup"><span data-stu-id="970bd-113">Using Convoys with Business Processes</span></span>  
 <span data-ttu-id="970bd-114">Tenga en cuenta lo siguiente al utilizar el procesamiento de convoyes con un proceso empresarial:</span><span class="sxs-lookup"><span data-stu-id="970bd-114">Consider the following when using convoy processing with a business process:</span></span>  
  
-   <span data-ttu-id="970bd-115">A *conjunto de correlaciones* es una lista de propiedades con valores específicos que usan para enrutar mensajes a un proceso empresarial específico.</span><span class="sxs-lookup"><span data-stu-id="970bd-115">A *correlation set* is a list of properties with specific values that you use to route messages to a specific business process.</span></span> <span data-ttu-id="970bd-116">El conjunto de correlaciones usado en un **recepción** forma no puede contener más de tres propiedades que se usan para la correlación.</span><span class="sxs-lookup"><span data-stu-id="970bd-116">The correlation set used on a **Receive** shape cannot contain more than three properties used for correlation.</span></span> <span data-ttu-id="970bd-117">Esto se debe a que estos valores se identifican y almacenan en la base de datos, que admite un máximo de tres parámetros.</span><span class="sxs-lookup"><span data-stu-id="970bd-117">This is because these values are identified and stored at the database level, which supports a maximum of three parameters.</span></span>  
  
-   <span data-ttu-id="970bd-118">Los convoyes paralelos y secuenciales pueden coexistir en el mismo proceso empresarial, pero no pueden compartir entre sí ningún conjunto de correlaciones.</span><span class="sxs-lookup"><span data-stu-id="970bd-118">Parallel and sequential convoys can coexist in the same business process, but they cannot share any correlation sets with each other.</span></span> <span data-ttu-id="970bd-119">El motivo es que cada conjunto de correlaciones únicamente puede pertenecer a un convoy.</span><span class="sxs-lookup"><span data-stu-id="970bd-119">This is because each correlation set can belong to only one convoy.</span></span>  
  
-   <span data-ttu-id="970bd-120">BizTalk Server no admite el procesamiento de convoyes cuando se usa el **Iniciar orquestación** forma para pasar una correlación ya inicializada establecida a una nueva orquestación.</span><span class="sxs-lookup"><span data-stu-id="970bd-120">BizTalk Server does not support convoy processing when you use the **Start Orchestration** shape to pass an already-initialized correlation set into a new orchestration.</span></span> <span data-ttu-id="970bd-121">Esto se debe a que los conjuntos de convoyes se controlan en la base de datos, de manera independiente con respecto a las instancias de orquestación que ya estén ejecutándose.</span><span class="sxs-lookup"><span data-stu-id="970bd-121">This is because convoy sets are handled at the database level, independent of already-running orchestration instances.</span></span>  
  
-   <span data-ttu-id="970bd-122">No se puede usar un solo **recepción** forma que se va a inicializar dos o más conjuntos de correlaciones que se utilizarán en convoyes separados.</span><span class="sxs-lookup"><span data-stu-id="970bd-122">You cannot use a single **Receive** shape to initialize two or more correlation sets that will be used in separate convoys.</span></span> <span data-ttu-id="970bd-123">Por ejemplo, supongamos que la recepción r1 inicializa los conjuntos de correlaciones c1 y c2 del primer convoy, la recepción r2 sigue c1 para el segundo convoy, y la recepción r3 sigue c2 para el tercer convoy.</span><span class="sxs-lookup"><span data-stu-id="970bd-123">For example, suppose that receive r1 initializes correlation sets c1 and c2 for the first convoy, receive r2 follows c1 for the second convoy, and receive r3 follows c2 for the third convoy.</span></span> <span data-ttu-id="970bd-124">Los conjuntos de convoyes correspondientes al segundo convoy son c1, r2 y los conjuntos de convoyes correspondientes al tercer convoy son c2, r3, todos ellos inicializados por r1.</span><span class="sxs-lookup"><span data-stu-id="970bd-124">The intended convoy sets for the second convoy are c1, r2 and the intended convoy sets for the third convoy are c2, r3, which are all initialized by r1.</span></span> <span data-ttu-id="970bd-125">En este caso, el motor de orquestaciones no los tratará como convoyes.</span><span class="sxs-lookup"><span data-stu-id="970bd-125">In this case, the orchestration engine will not treat these as convoys.</span></span> <span data-ttu-id="970bd-126">El ejemplo constituye un escenario de convoyes válido si tanto r2 como r3 siguen c1 y c2 (c1, r2, r3 y c2, r2, r3), si ambas siguen sólo c1 (c1, r2, r3), o si ambas siguen sólo c2 (c2, r2, r3).</span><span class="sxs-lookup"><span data-stu-id="970bd-126">The example is a valid convoy scenario if both r2 and r3 follow both c1 and c2 (c1, r2, r3 and c2, r2, r3), both follow c1 only (c1, r2, r3), or both follow c2 only (c2, r2, r3).</span></span>  
  
## <a name="zombies"></a><span data-ttu-id="970bd-127">Zombies</span><span class="sxs-lookup"><span data-stu-id="970bd-127">Zombies</span></span>  
 <span data-ttu-id="970bd-128">El uso de convoyes puede dar lugar a mensajes perdidos denominados zombies.</span><span class="sxs-lookup"><span data-stu-id="970bd-128">The use of convoys can result in "lost" messages called zombies.</span></span> <span data-ttu-id="970bd-129">Cuando una suscripción de recepción sin activación de una orquestación en ejecución coincide con un mensaje de la base de datos de cuadro de mensajes, el cuadro de mensajes entrega el mensaje a la orquestación.</span><span class="sxs-lookup"><span data-stu-id="970bd-129">When a non-activating receive subscription in a running orchestration matches a message in the MessageBox database, then the MessageBox delivers the message to the orchestration.</span></span> <span data-ttu-id="970bd-130">Debido a que el cuadro de mensajes no conoce la lógica empresarial contenida en la orquestación, se limita a entregar a la orquestación todos los mensajes que coinciden con la suscripción.</span><span class="sxs-lookup"><span data-stu-id="970bd-130">Because the MessageBox does not know the business logic inside the orchestration, it simply delivers to the orchestration all the messages that match the subscription.</span></span> <span data-ttu-id="970bd-131">Si cualquiera de estos mensajes se entrega cuando el flujo de ejecución de la orquestación ha pasado las suscripciones de recepción que pueden consumir los mensajes, estos mensajes se convierten en zombies.</span><span class="sxs-lookup"><span data-stu-id="970bd-131">If any of these messages are delivered when the orchestration execution flow has passed the receive subscriptions that can consume the messages, then such messages become zombies.</span></span>  
  
 <span data-ttu-id="970bd-132">Un ejemplo de esta situación que crea zombies es una recepción dentro de un bucle que se repite 17 veces, pero se entregan al bucle 18 mensajes que coinciden con la suscripción de recepción.</span><span class="sxs-lookup"><span data-stu-id="970bd-132">An example of a situation that creates zombies is a receive inside a loop that iterates 17 times, but 18 messages are delivered that match the receive subscription in the loop.</span></span> <span data-ttu-id="970bd-133">(El cuadro de mensajes no conoce que la lógica de la orquestación sólo admite 17 mensajes.) La orquestación no consume el mensaje número 18, porque el flujo de ejecución ya ha salido del bucle.</span><span class="sxs-lookup"><span data-stu-id="970bd-133">(The MessageBox does not know that the orchestration logic only handles 17 messages.) The 18th message delivered is not consumed by the orchestration because execution flow has already exited the loop.</span></span> <span data-ttu-id="970bd-134">La orquestación se completa, pero con mensajes descartados (zombies) que no se pueden reanudar porque la instancia de la orquestación ya se ha completado.</span><span class="sxs-lookup"><span data-stu-id="970bd-134">The orchestration is completed with discarded messages (zombies), which are not resumable because the orchestration instance has already completed.</span></span>  
  
 <span data-ttu-id="970bd-135">Puede administrar los zombies mediante una secuencia de comandos de Instrumental de administración de Windows (WMI) para consultar las instancias cuyo estado es "Suspendido (No reanudable)".</span><span class="sxs-lookup"><span data-stu-id="970bd-135">You can manage zombies by using a Windows Management Instrumentation (WMI) script to query the instances with the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="970bd-136">Además, el motor de mensajería escribe el mensaje de error "Completado con mensajes descartados" en el registro de eventos.</span><span class="sxs-lookup"><span data-stu-id="970bd-136">In addition, the messaging engine writes an error message, "Completed with discarded messages", to the event log.</span></span>  
  
 <span data-ttu-id="970bd-137">Por añadidura, si tiene un convoy secuencial con un ámbito transaccional de larga ejecución y el ámbito tiene una configuración de tiempo de espera, es posible que algunas instancias de orquestación terminen en el estado "Suspendido (No reanudable)".</span><span class="sxs-lookup"><span data-stu-id="970bd-137">Moreover, if you have a sequential convoy with a long-running transactional scope, and the scope has a time-out setting, some orchestration instances may end up in the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="970bd-138">Es probable que observe también que el número de mensajes de salida sumado al número de instancias con el estado "Suspendido (No reanudable)" es inferior al número de mensajes de entrada.</span><span class="sxs-lookup"><span data-stu-id="970bd-138">You may also notice that the number of output messages plus the number of "Suspended-NonResumable" instances is less than the number of input messages.</span></span> <span data-ttu-id="970bd-139">Este comportamiento es así por diseño.</span><span class="sxs-lookup"><span data-stu-id="970bd-139">This behavior is by design.</span></span> <span data-ttu-id="970bd-140">Cuando se produce una excepción de tiempo de espera, el código entra en el controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="970bd-140">When a time-out exception happens, the code goes into the exception handler.</span></span> <span data-ttu-id="970bd-141">BizTalk Server llama al controlador de excepciones para que controle la excepción, lo que incluye los zombies.</span><span class="sxs-lookup"><span data-stu-id="970bd-141">BizTalk Server calls the exception handler to let it handle the exception, including handling the zombies.</span></span> <span data-ttu-id="970bd-142">Puede utilizar un puerto de envío en el controlador de excepciones para enviar zombies a un destino para su revisión y procesamiento ulteriores.</span><span class="sxs-lookup"><span data-stu-id="970bd-142">You can use a send port in the exception handler to send the zombies to a destination for further review and processing.</span></span>  
  
 <span data-ttu-id="970bd-143">Hay otros escenarios que pueden generar zombies además de los convoyes.</span><span class="sxs-lookup"><span data-stu-id="970bd-143">Scenarios other than convoys can also generate zombies.</span></span> <span data-ttu-id="970bd-144">Por ejemplo, supongamos que una instancia de orquestación espera un mensaje de respuesta de un proceso empresarial y que, por algún motivo, recibe dos mensajes de respuesta que coinciden con la suscripción.</span><span class="sxs-lookup"><span data-stu-id="970bd-144">For example, suppose that an orchestration instance is expecting one response message from a business process, and for some reason, it receives two matching subscription response messages.</span></span> <span data-ttu-id="970bd-145">En este caso, el segundo mensaje se convierte en zombie.</span><span class="sxs-lookup"><span data-stu-id="970bd-145">In this case, the second response message becomes a zombie.</span></span> <span data-ttu-id="970bd-146">Otro ejemplo es cuando se tiene un **escuchar** forma con un **recepción** forma en una rama y un **retraso** forma en la otra rama.</span><span class="sxs-lookup"><span data-stu-id="970bd-146">Another example is when you have a **Listen** shape with a **Receive** shape at one branch and a **Delay** shape at the other branch.</span></span> <span data-ttu-id="970bd-147">Si llega un mensaje al mismo tiempo en que se agota el tiempo de espera, el mensaje se convierte en zombie.</span><span class="sxs-lookup"><span data-stu-id="970bd-147">If a message arrives at the same time that the time-out occurs, the message becomes a zombie.</span></span>  
  
 <span data-ttu-id="970bd-148">Para obtener más información sobre cómo administrar zombies, vea **quitar instancias de servicio suspendidas** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span><span class="sxs-lookup"><span data-stu-id="970bd-148">For more information about how to manage zombies, see **Removing Suspended Service Instances** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="970bd-149">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="970bd-149">Next steps</span></span>
 [<span data-ttu-id="970bd-150">Convoyes secuenciales</span><span class="sxs-lookup"><span data-stu-id="970bd-150">Sequential Convoys</span></span>](../core/sequential-convoys.md)  
  
 [<span data-ttu-id="970bd-151">Convoyes paralelos</span><span class="sxs-lookup"><span data-stu-id="970bd-151">Parallel Convoys</span></span>](../core/parallel-convoys.md)  
  
## <a name="see-also"></a><span data-ttu-id="970bd-152">Vea también</span><span class="sxs-lookup"><span data-stu-id="970bd-152">See Also</span></span>  
 [<span data-ttu-id="970bd-153">Usar correlaciones en orquestaciones</span><span class="sxs-lookup"><span data-stu-id="970bd-153">Using Correlations in Orchestrations</span></span>](../core/using-correlations-in-orchestrations.md)