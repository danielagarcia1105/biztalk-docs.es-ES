---
title: Ensamblar un intercambio EDI por lotes | Documentos de Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 18f64595-935e-4d52-9ec2-5edf7c2b9e83
caps.latest.revision: "45"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 8c4274362e5ec8441e203d0b2b97f27e95235fd9
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2017
---
# <a name="assembling-a-batched-edi-interchange"></a><span data-ttu-id="481cb-102">Ensamblar un intercambio EDI por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-102">Assembling a Batched EDI Interchange</span></span>
<span data-ttu-id="481cb-103">Para ensamblar elementos por lotes de conjunto de transacción individual en un intercambio EDI, las funcionalidades EDI y AS2 de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] realizan lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="481cb-103">To assemble individual transaction-set batch elements into an EDI interchange, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] EDI and AS2 does the following:</span></span>  
  
-   <span data-ttu-id="481cb-104">Identifican elementos por lotes para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="481cb-104">Identifies batch elements for batching</span></span>  
  
-   <span data-ttu-id="481cb-105">Validan y almacenan en búfer elementos por lotes individuales tras la recepción.</span><span class="sxs-lookup"><span data-stu-id="481cb-105">Validates and buffers individual batch elements upon receipt</span></span>  
  
-   <span data-ttu-id="481cb-106">Recuperan elementos por lotes específicos y ensamblan un intercambio por lotes cuando se cumplen los criterios de versión.</span><span class="sxs-lookup"><span data-stu-id="481cb-106">Retrieves specific batch elements and assembles a batched interchange when the release criteria is met</span></span>  
  
 <span data-ttu-id="481cb-107">La hora de inicio para la colección de mensajes individuales para obtener acceso a un lote está determinada por los criterios de activación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-107">The start time for collection of individual messages to go into a batch is determined by the batch activation criteria.</span></span> <span data-ttu-id="481cb-108">La hora en el que el lote se libera está determinada por los criterios de versión por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-108">The time at which the batch is released is determined by the batch release criteria.</span></span> <span data-ttu-id="481cb-109">Para obtener más información acerca de estos dos conjuntos de criterios, vea [configurar un lote saliente](../core/configuring-an-outgoing-batch.md).</span><span class="sxs-lookup"><span data-stu-id="481cb-109">For more information about these two sets of criteria, see [Configuring an Outgoing Batch](../core/configuring-an-outgoing-batch.md).</span></span>  
  
## <a name="message-flow-for-outgoing-batched-messages"></a><span data-ttu-id="481cb-110">Flujo de mensajes para mensajes por lotes salientes</span><span class="sxs-lookup"><span data-stu-id="481cb-110">Message Flow for Outgoing Batched Messages</span></span>  
 <span data-ttu-id="481cb-111">Cuando se configura [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] para realizar el procesamiento por lotes de un mensaje saliente, los componentes de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] realizarán las siguiente series de pasos para preparar el mensaje por lotes para el envío.</span><span class="sxs-lookup"><span data-stu-id="481cb-111">When [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is configured to batch an outgoing message, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] components will perform the following series of steps to prepare the batched message for sending.</span></span> <span data-ttu-id="481cb-112">Estas series de pasos describen el caso en el que la canalización EDIReceive con el componente de canalización de BatchMarker procesa los intercambios recibidos que contienen los conjuntos de transacciones que se van a procesar por lotes para el envío.</span><span class="sxs-lookup"><span data-stu-id="481cb-112">This series of steps describes the case in which the EDIReceive pipeline with the BatchMarker pipeline component processes the received interchanges that contain transaction sets to be batched for sending.</span></span>  
  
1.  <span data-ttu-id="481cb-113">El componente de canalización BatchMarker en la canalización EDIReceive determina los mensajes necesarios que se van a procesar a partir de la configuración de filtro por lotes de EDI en las propiedades de entidad.</span><span class="sxs-lookup"><span data-stu-id="481cb-113">The BatchMarker pipeline component in the EDIReceive pipeline determines which messages need to be batched from the EDI batch filter settings in the party properties.</span></span> <span data-ttu-id="481cb-114">(Este es el único componente por lotes que examina la configuración de filtro de lotes y actúa en ellos).</span><span class="sxs-lookup"><span data-stu-id="481cb-114">(This is the only batching component that looks at the batch filter settings and acts upon them.)</span></span>  
  
2.  <span data-ttu-id="481cb-115">Si los valores de filtro de la configuración de un solo lote se suscriben a un mensaje, el componente BatchMarker promocionará la propiedad `EDI.ToBeBatched = True`.</span><span class="sxs-lookup"><span data-stu-id="481cb-115">If the filter settings of only one batch configuration subscribes to a message, the BatchMarker component will promote the property `EDI.ToBeBatched = True`.</span></span> <span data-ttu-id="481cb-116">Esto asegura que la orquestación de procesamiento por lotes recogerá el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-116">This ensures that the batching orchestration will pick up the message.</span></span>  
  
3.  <span data-ttu-id="481cb-117">Si los valores de filtro de la configuración de más de un lote coinciden con el contexto de un mensaje, el componente BatchMarker promociona las propiedades .`EDI.ToBeRouted = True` y establece la propiedad `EDI.BatchIds` en una lista delimitada por espacios que contiene los identificadores de lote coincidentes.</span><span class="sxs-lookup"><span data-stu-id="481cb-117">If the filter settings of more than one batch configuration match the context of a message, the BatchMarker component promotes the properties `EDI.ToBeRouted = True` and sets the `EDI.BatchIds` property to a space delimited list containing the matching batch IDs.</span></span>  <span data-ttu-id="481cb-118">Esto asegura que la orquestación de enrutamiento se suscribirá al mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-118">This ensures that the routing orchestration will subscribe to the message.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-119">Puede promocionar las propiedades de contexto apropiadas en una canalización de recepción personalizada o una orquestación personalizada.</span><span class="sxs-lookup"><span data-stu-id="481cb-119">You can promote the appropriate context properties in a custom receive pipeline or a custom orchestration.</span></span> <span data-ttu-id="481cb-120">La canalización de recepción personalizada puede usar el componente de canalización BatchMarker o puede promocionar las propiedades sin usar el componente de canalización BatchMarker.</span><span class="sxs-lookup"><span data-stu-id="481cb-120">The custom receive pipeline can use the BatchMarker pipeline component, or can promote the properties without using the BatchMarker pipeline component.</span></span>  
  
4.  <span data-ttu-id="481cb-121">La orquestación de enrutamiento recoge cualquier conjunto de transacciones para el que se haya promocionado `EDI.ToBeRouted = True` y `EDI.BatchIds` y, a continuación, crea copias del conjunto de transacciones. De ese modo, se garantiza de que existe una copia de cada identificador de lote incluido en `EDI.BatchIds`.</span><span class="sxs-lookup"><span data-stu-id="481cb-121">The routing orchestration picks up any transaction set for which `EDI.ToBeRouted = True` and `EDI.BatchIds` is promoted, and then creates copies of the transaction set, ensuring that there is a copy for each batch ID contained in `EDI.BatchIds`.</span></span> <span data-ttu-id="481cb-122">La orquestación de enrutamiento establece `EDI.ToBeBatched = True`, y `EDI.BatchId` se establece para el identificador de lote de la configuración de lote coincidente de cada copia del conjunto de transacciones.</span><span class="sxs-lookup"><span data-stu-id="481cb-122">The routing orchestration sets `EDI.ToBeBatched = True` and `EDI.BatchId` is set to the batch ID of the matching batch configuration for each copy of the transaction set.</span></span> <span data-ttu-id="481cb-123">Esto garantiza que los conjuntos de transacciones se recogerán mediante la orquestación por lotes para el procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-123">This ensures that the transaction sets will be picked up by the batching orchestration for batching.</span></span>  
  
5.  <span data-ttu-id="481cb-124">La orquestación por lotes recoge todos los mensajes para los que las siguientes propiedades se han promocionado:</span><span class="sxs-lookup"><span data-stu-id="481cb-124">The batching orchestration picks up all messages for which the following properties have been promoted:</span></span>  
  
    -   <span data-ttu-id="481cb-125">`EDI.ToBeBatched = True` y EDI.BatchId = el identificador del lote asociado con esta instancia de la orquestación de procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-125">`EDI.ToBeBatched = True` and EDI.BatchId = the batch id of the batch associated with this instance of the batching orchestration.</span></span>  
  
    -   <span data-ttu-id="481cb-126">`EDI.ToBeBatched = True` y EDI.BatchName = nombre del lote configurado y EDI.DestinationPartyName = nombre de la entidad que contiene la configuración de lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-126">`EDI.ToBeBatched = True` and EDI.BatchName = the name of the configured batch and EDI.DestinationPartyName = the party name that contains the batch configuration.</span></span>  
  
     <span data-ttu-id="481cb-127">Al procesar los mensajes entrantes mediante la canalización EDIReceive (con el componente de canalización BatchMarker), la orquestación por lotes realizará el procesamiento de los conjuntos de transacciones con codificación EDIFACT o X12.</span><span class="sxs-lookup"><span data-stu-id="481cb-127">When the incoming messages are processed by the EDIReceive pipeline (with the BatchMarker pipeline component), the batching orchestration will batch only X12- or EDIFACT-encoded transaction sets.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-128">Habrá una instancia de la orquestación por lotes por cada configuración de lotes activa, y cada una se suscribe a un identificador de lote concreto.</span><span class="sxs-lookup"><span data-stu-id="481cb-128">There will be one instance of the batching orchestration for each active batch configuration, each subscribing to a specific batch ID.</span></span> <span data-ttu-id="481cb-129">El valor de identificador de lote se establece automáticamente al crear una nueva configuración de lote en el **identificación** sección de la **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el  **Propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-129">The batch ID value is set automatically when creating a new batch configuration in the **Identification** section of the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span>  
  
6.  <span data-ttu-id="481cb-130">La orquestación por lotes valida cada conjunto de transacciones de los que se va realizar el procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-130">The batching orchestration validates each transaction set to be batched.</span></span> <span data-ttu-id="481cb-131">Si se produce un error en la validación del conjunto de transacciones, la propiedad de contexto `EDI.BatchItemValidationFailure` se establece en "True".</span><span class="sxs-lookup"><span data-stu-id="481cb-131">If the transaction set fails validation, it sets the `EDI.BatchItemValidationFailure` context property to "True".</span></span> <span data-ttu-id="481cb-132">El **BatchSuspend** orquestación recoge el mensaje en función de esa propiedad de contexto, registra la información de error y, a continuación, se suspende.</span><span class="sxs-lookup"><span data-stu-id="481cb-132">The **BatchSuspend** orchestration picks up the message based upon that context property, posts error information, and then is suspended.</span></span>  
  
7.  <span data-ttu-id="481cb-133">Cuando se cumplen los criterios de liberación de lotes, la orquestación de procesamiento por lotes ensambla los elementos de lote en un lote y crea un sobre.</span><span class="sxs-lookup"><span data-stu-id="481cb-133">When the batch release criteria has been met, the batching orchestration assembles the batch elements into a batch and creates an envelope.</span></span>  
  
8.  <span data-ttu-id="481cb-134">Una vez que la orquestación por lotes finaliza el procesamiento por lotes de un intercambio, promociona las siguientes propiedades en ese intercambio: EDI.DestinationPartyName = %PartyName%, EDI.BatchEncodingType = X12 o EDIFACT, y EDI.ToBeBatched = False.</span><span class="sxs-lookup"><span data-stu-id="481cb-134">After the batching orchestration completes batching an interchange, it promotes the following properties on that interchange: EDI.DestinationPartyName = %PartyName%, EDI.BatchEncodingType = X12 or EDIFACT, and EDI.ToBeBatched = False.</span></span>  
  
9. <span data-ttu-id="481cb-135">Un puerto de envío recoge los conjuntos de transacciones por lotes en función de EDI. DestinationPartyName = \<PartyName\>, EDI. BatchEncodingType = EDIFACT o X12 y EDI. ToBeBatched = False.</span><span class="sxs-lookup"><span data-stu-id="481cb-135">A send port picks up the batched transaction sets based on EDI.DestinationPartyName = \<PartyName\>, EDI.BatchEncodingType = EDIFACT or X12, and EDI.ToBeBatched = False.</span></span>  
  
## <a name="batching-orchestration-control-messages"></a><span data-ttu-id="481cb-136">Mensajes de control de orquestaciones por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-136">Batching Orchestration Control Messages</span></span>  
 <span data-ttu-id="481cb-137">La orquestación por lotes se activa, finaliza o reemplaza mediante los siguientes mensajes de control:</span><span class="sxs-lookup"><span data-stu-id="481cb-137">The batching orchestration is activated, terminated, or overridden by the following control messages:</span></span>  
  
-   <span data-ttu-id="481cb-138">**BatchActivation**: cuando la orquestación recibe este mensaje, se crea una instancia de la orquestación por lotes y la orquestación se activa para recibir los elementos por lotes (si cumple con los criterios de activación por lotes).</span><span class="sxs-lookup"><span data-stu-id="481cb-138">**BatchActivation**: When the orchestration receives this message, an instance of the batching orchestration is created and the orchestration is active to receive batch elements (if it meets the batch activation criteria).</span></span> <span data-ttu-id="481cb-139">Se envía este mensaje de control, haga clic en el **iniciar** botón de una configuración de lote en el **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-139">This control message is sent by clicking the **Start** button of a batch configuration on the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span>  
  
-   <span data-ttu-id="481cb-140">**BatchTermination**: cuando la orquestación recibe este mensaje, crea un lote a partir de elementos por lotes existentes, publica el mensaje en el cuadro de mensajes y finaliza.</span><span class="sxs-lookup"><span data-stu-id="481cb-140">**BatchTermination**: When the orchestration receives this message, it creates a batch from existing batch elements, publishes the message to the MessageBox, and terminates.</span></span> <span data-ttu-id="481cb-141">Se envía este mensaje de control, haga clic en el **detener** botón de una configuración de lote en el **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-141">This control message is sent by clicking the **Stop** button of a batch configuration on the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-142">La orquestación también se termina si alcanza el tiempo especificado para la **final por** propiedad en el **terminación** sección de la **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional del **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-142">The orchestration is also terminated if it reaches the time specified for the **End-by** property in the **Termination** section of the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span>  
  
-   <span data-ttu-id="481cb-143">**BatchOverride**: cuando la orquestación recibe este mensaje, crea un lote a partir de los elementos existentes, publica el mensaje en el cuadro de mensajes y, a continuación, espera para los mensajes para el siguiente lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-143">**BatchOverride**: When the orchestration receives this message, it creates a batch from existing elements, publishes the message to the MessageBox, and then waits for messages for the next batch.</span></span> <span data-ttu-id="481cb-144">Se envía este mensaje de control, haga clic en el **invalidar** botón de una configuración de lote en el **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-144">This control message is sent by clicking the **Override** button of a batch configuration on the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span>  
  
 <span data-ttu-id="481cb-145">La orquestación por lotes recibe los mensajes de control a través de la ubicación de recepción BatchControlMessageRecvLoc.</span><span class="sxs-lookup"><span data-stu-id="481cb-145">The batching orchestration receives the control messages via the BatchControlMessageRecvLoc receive location.</span></span> <span data-ttu-id="481cb-146">El intervalo de sondeo para esta ubicación de recepción SQL se establece en 30 segundos de forma predeterminada, pero puede cambiarse en el **propiedades de transporte SQL** cuadro de diálogo de la ubicación de recepción.</span><span class="sxs-lookup"><span data-stu-id="481cb-146">The polling interval for this SQL receive location is set by default to 30 seconds, but can be changed in the **SQL Transport Properties** dialog box for the receive location.</span></span> <span data-ttu-id="481cb-147">El descenso del intervalo de sondeo garantizará que la ubicación de recepción BatchControlMessageRecvLoc recibirá un mensaje de control poco después de que realice una acción que se envíe al mensaje de control (por ejemplo, cuando inicie la orquestación por lotes).</span><span class="sxs-lookup"><span data-stu-id="481cb-147">Decreasing the polling interval will ensure that the BatchControlMessageRecvLoc receive location will receive a control message soon after you perform the action that sent the control message (such as when you start the batching orchestration).</span></span>  
  
 <span data-ttu-id="481cb-148">Se producen los siguientes pasos cuando inicia una orquestación de lotes:</span><span class="sxs-lookup"><span data-stu-id="481cb-148">The following steps occur when you start a batch orchestration:</span></span>  
  
1.  <span data-ttu-id="481cb-149">Al hacer clic en el **iniciar** botón, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] crea un registro en una tabla que indica qué entidad e identificador de lote a activar la orquestación de lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-149">When you click the **Start** button, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] creates a record in a table indicating which party and batch id you are activating the batch orchestration for.</span></span>  
  
2.  <span data-ttu-id="481cb-150">El adaptador SQL asociado a los sondeos de la ubicación de recepción BatchControlMessageRecvLo para ver si el registro existe en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="481cb-150">The SQL adapter associated with the BatchControlMessageRecvLoc receive location polls to see if the record exists in the database.</span></span>  
  
3.  <span data-ttu-id="481cb-151">Si existe el registro, el adaptador SQL genera un mensaje de control mediante información en el registro.</span><span class="sxs-lookup"><span data-stu-id="481cb-151">If the record exists, the SQL adapter builds a control message, using information in the record.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-152">Con la generación del mensaje de control de esta forma se garantiza que la orquestación no puede iniciarse mediante un mensaje de control no válido.</span><span class="sxs-lookup"><span data-stu-id="481cb-152">Building the control message in this way ensures that the orchestration cannot be started by an invalid control message.</span></span>  
  
4.  <span data-ttu-id="481cb-153">La ubicación de recepción BatchControlMessageRecvLoc recibe el mensaje de control y [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] activa una instancia de orquestación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-153">The BatchControlMessageRecvLoc receive location receives the control message, and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] activates a batching orchestration instance.</span></span>  
  
## <a name="batch-components"></a><span data-ttu-id="481cb-154">Componentes de lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-154">Batch Components</span></span>  
 <span data-ttu-id="481cb-155">El EDI de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] procesa por lotes los conjuntos de transacciones XML en intercambios EDI mediante los componentes siguientes:</span><span class="sxs-lookup"><span data-stu-id="481cb-155">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] EDI batches XML transaction sets into EDI interchanges using the following components:</span></span>  
  
-   <span data-ttu-id="481cb-156">BatchMarkerReceivePipelineComponent en la canalización de recepción EDI</span><span class="sxs-lookup"><span data-stu-id="481cb-156">BatchMarkerReceivePipelineComponent in the EDI receive pipeline</span></span>  
  
-   <span data-ttu-id="481cb-157">Orquestación de enrutamiento</span><span class="sxs-lookup"><span data-stu-id="481cb-157">Routing Orchestration</span></span>  
  
-   <span data-ttu-id="481cb-158">Orquestación por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-158">Batching Orchestration</span></span>  
  
-   <span data-ttu-id="481cb-159">Actualizar la orquestación de procesamiento por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-159">Upgrade Batching Orchestration</span></span>  
  
-   <span data-ttu-id="481cb-160">Orquestación BatchSuspend</span><span class="sxs-lookup"><span data-stu-id="481cb-160">BatchSuspend Orchestration</span></span>  
  
-   <span data-ttu-id="481cb-161">Canalización de envío EDI</span><span class="sxs-lookup"><span data-stu-id="481cb-161">EDI Send Pipeline</span></span>  
  
 <span data-ttu-id="481cb-162">Estos componentes se instalan como DLL cuando instala y configura la funcionalidad EDI y AS2 de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="481cb-162">These components are installed as DLLs when you install and configure [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] EDI and AS2.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="481cb-163">Los componentes por lotes en la funcionalidad EDI y AS2 de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] no garantizan el orden de los conjuntos de transacciones en un lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-163">The batching components in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] EDI and AS2 do not guarantee the ordering of the transaction sets in a batch.</span></span>  
  
### <a name="batchmarkerreceivepipelinecomponent"></a><span data-ttu-id="481cb-164">BatchMarkerReceivePipelineComponent</span><span class="sxs-lookup"><span data-stu-id="481cb-164">BatchMarkerReceivePipelineComponent</span></span>  
 <span data-ttu-id="481cb-165">BatchMarkerReceivePipelineComponent en la canalización de recepción EDI habilita la orquestación por lotes para recoger los mensajes a los que se les va realizar el procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-165">BatchMarkerReceivePipelineComponent in the EDI receive pipeline enables the batching orchestration to pick up messages to be batched.</span></span> <span data-ttu-id="481cb-166">Este componente de canalización se aplica después del desensamblador en la canalización de recepción EDI.</span><span class="sxs-lookup"><span data-stu-id="481cb-166">This pipeline component is applied after the Disassembler in the EDI Receive Pipeline.</span></span> <span data-ttu-id="481cb-167">El componente evalúa los criterios de filtro establecidos en el **filtro** sección de la **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **propiedades del acuerdo de** cuadro de diálogo y las marcas de que los conjuntos de transacciones con las siguientes propiedades de contexto para el procesamiento mediante el enrutamiento y orquestaciones por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-167">The component evaluates the filter criteria set in the **Filter** section of the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box, and marks the transaction sets with the following context properties for processing by the routing and batching orchestrations</span></span>  
  
-   <span data-ttu-id="481cb-168">Si se suscribe una única entidad a un mensaje para el procesamiento por lotes, se promociona `ToBeBatched = True` y BatchId se establece en el valor del identificador de lote de la configuración de lote coincidente.</span><span class="sxs-lookup"><span data-stu-id="481cb-168">If a single party subscribes to a message to be batched, it promotes `ToBeBatched = True` and BatchId is set to the value of the batch ID of the matching batch configuration.</span></span> <span data-ttu-id="481cb-169">Esto habilita la recogida mediante la orquestación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-169">This enables pickup by the batching orchestration.</span></span>  
  
-   <span data-ttu-id="481cb-170">Si se suscriben varios lotes en un mensaje que se va a procesar por lotes, promociona `ToBeRouted = True` y establece la propiedad `EDI.BatchIds` en una lista delimitada por espacios de los identificadores de lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-170">If multiple batches subscribe to a message to be batched, it promotes `ToBeRouted = True`, and sets the `EDI.BatchIds` property set to a space-delimited list of batch IDs.</span></span> <span data-ttu-id="481cb-171">Esto habilita la recogida mediante la orquestación de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="481cb-171">This enables pickup by the routing orchestration.</span></span>  
  
-   <span data-ttu-id="481cb-172">Si no existe ninguna suscripción, no promociona una propiedad de contexto.</span><span class="sxs-lookup"><span data-stu-id="481cb-172">If no subscriptions exist, it does not promote a context property.</span></span> <span data-ttu-id="481cb-173">Esto indica que no se va a realizar el procesamiento por lotes del conjunto de transacciones.</span><span class="sxs-lookup"><span data-stu-id="481cb-173">This indicates that the transaction set is not to be batched.</span></span>  
  
 <span data-ttu-id="481cb-174">El componente de canalización no tiene en cuenta los mensajes que no sean XML ni los mensajes con la propiedad `ReuseEnvelope` (lotes conservados).</span><span class="sxs-lookup"><span data-stu-id="481cb-174">The pipeline component ignores messages other than XML and messages with the `ReuseEnvelope` property (preserved batches).</span></span> <span data-ttu-id="481cb-175">Si las confirmaciones no se van a procesar por lotes, el componente de canalización ignorará los tipos de mensajes de confirmación (CONTRL, TA1 y 997).</span><span class="sxs-lookup"><span data-stu-id="481cb-175">If acknowledgments are not to be batched, the pipeline component will ignore the ACK message types (CONTRL, TA1, and 997).</span></span> <span data-ttu-id="481cb-176">Para optimizar el procesamiento de las orquestaciones por lotes y de enrutamiento, BatchMarkerPipelineComponent aprueba el mensaje a través del cuadro de mensajes si el desensamblador establece en “SuspendedQueue” la propiedad de contexto de mensaje `MessageDestination`.</span><span class="sxs-lookup"><span data-stu-id="481cb-176">To optimize processing of the routing and batching orchestrations, the BatchMarkerPipelineComponent passes the message through to the MessageBox if the message context property `MessageDestination` is set to "SuspendedQueue" by the disassembler.</span></span>  
  
 <span data-ttu-id="481cb-177">Si está usando una canalización personaliza, en lugar de la canalización EDIReceive, puede usar el componente BatchMarker en su canalización personalizada.</span><span class="sxs-lookup"><span data-stu-id="481cb-177">If you are using a custom pipeline, rather than the EDIReceive pipeline, you can use the BatchMarker component in your custom pipeline.</span></span> <span data-ttu-id="481cb-178">Si no usa la canalización EDIReceive y publica mensajes desde una orquestación, deberá promocionar `ToBeBatched = True` y `BatchID` en el identificador de un lote activo de uno de sus componentes.</span><span class="sxs-lookup"><span data-stu-id="481cb-178">If you are not using the EDIReceive pipeline, and are publishing messages from an orchestration, you will have to promote `ToBeBatched = True` and `BatchID` to the ID of an active batch in one of your components.</span></span>  
  
### <a name="routing-orchestration"></a><span data-ttu-id="481cb-179">Orquestación de enrutamiento</span><span class="sxs-lookup"><span data-stu-id="481cb-179">Routing Orchestration</span></span>  
 <span data-ttu-id="481cb-180">La orquestación de enrutamiento se suscribe en cualquier mensaje con la propiedad de contexto `ToBeRouted = True` y `EDI.BatchIds` establecidos en una lista de identificadores de lote delimitada por espacios.</span><span class="sxs-lookup"><span data-stu-id="481cb-180">The routing orchestration subscribes to any message with the context property `ToBeRouted = True` and the context property `EDI.BatchIds` set to a space-delimited list of batch IDs.</span></span> <span data-ttu-id="481cb-181">Esto se produce cuando se suscriben varios filtros de lote en un mensaje que se va a procesar por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-181">This occurs when multiple batch filters subscribe to a message to be batched.</span></span> <span data-ttu-id="481cb-182">La orquestación de enrutamiento realizará una copia del mensaje para cada identificador de lote incluido en `EDI.BatchIds`.</span><span class="sxs-lookup"><span data-stu-id="481cb-182">The routing orchestration will make a copy of the message for each batch ID contained in `EDI.BatchIds`.</span></span> <span data-ttu-id="481cb-183">Marca cada copia con dos nuevas propiedades de contexto:</span><span class="sxs-lookup"><span data-stu-id="481cb-183">It stamps each copy with two new context properties:</span></span>  
  
-   <span data-ttu-id="481cb-184">`EDI.BatchID`, que se establece en el identificador del lote para el que se ha creado el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-184">`EDI.BatchID`, which is set to the ID of the batch that this message is intended for.</span></span>  
  
-   <span data-ttu-id="481cb-185">`EDI.ToBeBatched`, que se establece en True.</span><span class="sxs-lookup"><span data-stu-id="481cb-185">`EDI.ToBeBatched`, which is set to True.</span></span>  
  
 <span data-ttu-id="481cb-186">A continuación, enruta las copias en el cuadro de mensajes que la orquestación por lotes va a recoger.</span><span class="sxs-lookup"><span data-stu-id="481cb-186">It then routes the copies to the MessageBox to be picked up by the batching orchestration.</span></span> <span data-ttu-id="481cb-187">Cada identificador de lote de destino usa una instancia singleton de la misma orquestación, con un filtro en el identificador de lote específico.</span><span class="sxs-lookup"><span data-stu-id="481cb-187">Each destination batch ID use a singleton instance of the same orchestration, with a filter on the specific batch ID.</span></span>  
  
### <a name="batching-orchestration"></a><span data-ttu-id="481cb-188">Orquestación por lotes</span><span class="sxs-lookup"><span data-stu-id="481cb-188">Batching Orchestration</span></span>  
 <span data-ttu-id="481cb-189">La orquestación por lotes es un servicio con estado que almacena en búfer los elementos de lotes (conjuntos de transacciones) durante un período de tiempo, los ensambla en un intercambio y, a continuación, libera el intercambio a la canalización de recepción basada en los criterios de versión.</span><span class="sxs-lookup"><span data-stu-id="481cb-189">The batching orchestration is a stateful service that buffers batch elements (transaction sets) over a period of time, assembles them into an interchange, and then releases the interchange to the send pipeline based upon the release criteria.</span></span>  
  
 <span data-ttu-id="481cb-190">Después de que se active, una instancia de la orquestación por lotes puede iniciar el procesamiento por lotes de mensajes de un tipo de codificación determinado en una entidad determinada (si la **iniciar** datetime haya pasado).</span><span class="sxs-lookup"><span data-stu-id="481cb-190">After being activated, an instance of the batching orchestration can start batching messages of a particular encoding type to a given party (if the **Start** datetime has passed).</span></span> <span data-ttu-id="481cb-191">En cualquier momento puede haber varias instancias de la orquestación por lotes para cada entidad, una por cada configuración de lotes activa.</span><span class="sxs-lookup"><span data-stu-id="481cb-191">At any one time there can be many instances of the batching orchestration for each party, one per active batch configuration.</span></span> <span data-ttu-id="481cb-192">Una única instancia de la orquestación por lotes puede liberar varios lotes para una configuración de lotes única.</span><span class="sxs-lookup"><span data-stu-id="481cb-192">A single instance of the batching orchestration can release multiple batches for a single  batch configuration.</span></span> <span data-ttu-id="481cb-193">Después de que se satisfagan los criterios finales, se terminará la instancia de orquestación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-193">After the end criteria is met, the batching orchestration instance will terminate.</span></span> <span data-ttu-id="481cb-194">Una nueva instancia de la orquestación por lotes deberá crearse de forma manual de la administración de socios comerciales (TPM) mediante el **iniciar** botón.</span><span class="sxs-lookup"><span data-stu-id="481cb-194">A new instance of the batching orchestration will need to be created manually from the Trading Partner Management (TPM) using the **Start** button.</span></span>  
  
 <span data-ttu-id="481cb-195">Si inicia la orquestación del lote antes del inicio de fecha y hora se muestra en el **activación** sección en el de la **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **acuerdo Propiedades** cuadro de diálogo, sólo recibirá mensajes que se especifican en el intervalo de activación.</span><span class="sxs-lookup"><span data-stu-id="481cb-195">If the batch orchestration starts before the start date time shown in the **Activation** section on the of the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box, it will only receive messages that are specified in the activation range.</span></span> <span data-ttu-id="481cb-196">No recibirá mensajes enviados antes de la hora y fecha de inicio.</span><span class="sxs-lookup"><span data-stu-id="481cb-196">It will not receive messages sent before the start date time.</span></span>  
  
 <span data-ttu-id="481cb-197">La orquestación por lotes realiza lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="481cb-197">The batching orchestration does the following:</span></span>  
  
-   <span data-ttu-id="481cb-198">Se suscribe a elementos de lotes XML con las propiedades de contexto `EDI.ToBeBatched = True` y `EDI.BatchId`, el identificador de configuración de lotes o `EDI.ToBeBatched = True` y EDI.BatchName = el nombre del lote configurado y EDI.DestinationPartyName = el nombre de la entidad que contiene la configuración de lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-198">Subscribes to XML batch elements with the context properties `EDI.ToBeBatched = True` and `EDI.BatchId` the ID of the batch configuration, or `EDI.ToBeBatched = True` and EDI.BatchName = the name of the configured batch and EDI.DestinationPartyName = the party name that contains the batch configuration.</span></span> <span data-ttu-id="481cb-199">Recibe elementos de lotes mediante una **recepción** operación de acción en un bucle.</span><span class="sxs-lookup"><span data-stu-id="481cb-199">It receives batch elements using a **Receive** action operation in a loop.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-200">La orquestación por lotes no procesa por lotes los conjuntos de transacciones en función de los criterios de filtro establecidos en la sección Filtro de la **configuración de procesamiento por lotes** página de la ficha de acuerdo unidireccional el **propiedades del acuerdo de** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="481cb-200">The batching orchestration does not batch transaction sets based upon the filter criteria set in the Filter section of the **Batching Configuration** page of the one-way agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="481cb-201">Se suscribe a los conjuntos de transacciones que tengan las propiedades de contexto anteriores establecidas en ellos.</span><span class="sxs-lookup"><span data-stu-id="481cb-201">It subscribes to transaction sets that have the above context properties set on them.</span></span> <span data-ttu-id="481cb-202">El componente de canalización BatchMarker establece y promociona las propiedades de contexto que se basan en la configuración de filtrado en las propiedades de entidades.</span><span class="sxs-lookup"><span data-stu-id="481cb-202">The BatchMarker pipeline component sets and promotes those context properties based upon the filter settings in the party properties.</span></span>  
  
-   <span data-ttu-id="481cb-203">Recupera los valores de configuración de lotes para la entidad identificada en la propiedad de contexto `BatchId`.</span><span class="sxs-lookup"><span data-stu-id="481cb-203">Retrieves the batch configuration settings for the party identified in the `BatchId` context property.</span></span>  
  
-   <span data-ttu-id="481cb-204">Valida el elemento de lote (conjunto de transacciones) que se basa en la configuración de entidades.</span><span class="sxs-lookup"><span data-stu-id="481cb-204">Validates the batch element (transaction set) based on party settings.</span></span>  
  
-   <span data-ttu-id="481cb-205">Si se produce un error en un elemento de lote, la orquestación por lotes promocionará la siguiente propiedad en ese conjunto de transacciones: `EDI.BatchItemValidationFailure = True`</span><span class="sxs-lookup"><span data-stu-id="481cb-205">If there is an error in a batch element, the batching orchestration will promoted the following property on that transaction set: `EDI.BatchItemValidationFailure = True`.</span></span> <span data-ttu-id="481cb-206">El **BatchElementSuspend** orquestación se suscribe a cualquier conjunto de transacciones para que se ha promocionado esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="481cb-206">The **BatchElementSuspend** orchestration subscribes to any transaction set for which this property has been promoted.</span></span> <span data-ttu-id="481cb-207">Esta orquestación proporcionará información de error detallada para el primer error encontrado en el procesamiento por lotes del intercambio.</span><span class="sxs-lookup"><span data-stu-id="481cb-207">This orchestration will provide detailed error information for the first error encountered in batching the interchange.</span></span>  
  
-   <span data-ttu-id="481cb-208">Si no se produce un error en un elemento por lotes, mantiene una referencia a ese elemento de lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-208">If there is no error in a batch element, holds a reference to that batch element.</span></span>  
  
-   <span data-ttu-id="481cb-209">Cuando se recibe el mensaje de control adecuado o se cumple los criterios de versión por lotes, se interrumpe fuera de la **recepción** bucle de una acción, recupera todos los elementos por lotes del cuadro de mensajes y ensambla el intercambio.</span><span class="sxs-lookup"><span data-stu-id="481cb-209">When the appropriate control message is received or the batching release criteria is met, breaks out of the **Receive** action loop, retrieves all batch elements from the MessageBox, and assembles the interchange.</span></span>  
  
-   <span data-ttu-id="481cb-210">Establece la propiedad de contexto `ToBeBatched = False` para el intercambio y la propiedad de contexto DestinationPartyName = %PartyName% donde %PartyName% es el nombre de la entidad para el que está pensado el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-210">Sets the context property `ToBeBatched = False` for the interchange and the context property DestinationPartyName = %PartyName% where %PartyName% is the name of the party for which the message is intended.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-211">Si un puerto de envío se suscribe a alguna o ambas propiedades, `EDI.ToBeBatched = False` y EDI.DestinationPartyName = %PartyName%, el puerto de envío puede recoger el intercambio por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-211">If a send port subscribes to either or both of the properties `EDI.ToBeBatched = False` and EDI.DestinationPartyName = %PartyName%, that send port can pick up the batched interchange.</span></span> <span data-ttu-id="481cb-212">Compruebe que los filtros del puerto de envío se configuran de modo que el puerto de envío recoge solo dichos intercambios procesados por lotes para lo que ha sido diseñado.</span><span class="sxs-lookup"><span data-stu-id="481cb-212">Make sure that a send port's filters are configured such that the send port picks up only those batched interchanges that it is intended to pick up.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="481cb-213">Los intercambios que coloca la orquestación por lotes en el cuadro de mensajes solo tiene las propiedades `EDI.ToBeBatched = False`, EDI.DestinationPartyName = %PartyName% y EDI.BatchEncodingType = "X12" o "EDIFACT" promocionadas en el contexto.</span><span class="sxs-lookup"><span data-stu-id="481cb-213">Interchanges dropped by the batching orchestration into the MessageBox have only the properties `EDI.ToBeBatched = False`, EDI.DestinationPartyName = %PartyName%, and EDI.BatchEncodingType = "X12" or "EDIFACT" promoted to the context.</span></span> <span data-ttu-id="481cb-214">Se pierden todas las propiedades de contexto de los conjuntos de transacciones originales.</span><span class="sxs-lookup"><span data-stu-id="481cb-214">All context properties from the original transaction sets are lost.</span></span>  
  
-   <span data-ttu-id="481cb-215">Se aplican las siguientes propiedades al sobre para un intercambio con codificación X12:</span><span class="sxs-lookup"><span data-stu-id="481cb-215">For an X12-encoded interchange, applies the following properties to the envelope:</span></span>  
  
    -   <span data-ttu-id="481cb-216">ISA6: identificador del remitente del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-216">ISA6: Interchange Sender ID</span></span>  
  
    -   <span data-ttu-id="481cb-217">ISA8: identificador del receptor del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-217">ISA8: Interchange Receiver ID</span></span>  
  
    -   <span data-ttu-id="481cb-218">ISA15: indicador de uso</span><span class="sxs-lookup"><span data-stu-id="481cb-218">ISA15: Usage indicator</span></span>  
  
    -   <span data-ttu-id="481cb-219">ISA_Blob (escrito en el contexto)</span><span class="sxs-lookup"><span data-stu-id="481cb-219">ISA_Blob (written to context)</span></span>  
  
-   <span data-ttu-id="481cb-220">Se aplican las siguientes propiedades al sobre para un intercambio con codificación EDIFACT:</span><span class="sxs-lookup"><span data-stu-id="481cb-220">For an EDIFACT-encoded interchange, applies the following properties to the envelope:</span></span>  
  
    -   <span data-ttu-id="481cb-221">UNB2.1: identificador del remitente del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-221">UNB2.1: Interchange Sender ID</span></span>  
  
    -   <span data-ttu-id="481cb-222">UNB3.1: identificador del destinatario del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-222">UNB3.1: Interchange Recipient ID</span></span>  
  
    -   <span data-ttu-id="481cb-223">UNB2.3: dirección para el enrutamiento inverso</span><span class="sxs-lookup"><span data-stu-id="481cb-223">UNB2.3: Address for Reverse Routing</span></span>  
  
    -   <span data-ttu-id="481cb-224">UNB11: indicador de uso</span><span class="sxs-lookup"><span data-stu-id="481cb-224">UNB11: Usage indicator</span></span>  
  
    -   <span data-ttu-id="481cb-225">UNA_Blob (escrito en el contexto)</span><span class="sxs-lookup"><span data-stu-id="481cb-225">UNA_Blob (written to context)</span></span>  
  
    -   <span data-ttu-id="481cb-226">UNB_Blob (escrito en el contexto)</span><span class="sxs-lookup"><span data-stu-id="481cb-226">UNB_Blob (written to context)</span></span>  
  
-   <span data-ttu-id="481cb-227">Entrega el intercambio por lotes al cuadro de mensajes para que la canalización de recepción EDI lo recoja.</span><span class="sxs-lookup"><span data-stu-id="481cb-227">Delivers the batched interchange to the MessageBox for pickup by the EDI send pipeline.</span></span>  
  
### <a name="upgradebatching-orchestration"></a><span data-ttu-id="481cb-228">Orquestación UpgradeBatching</span><span class="sxs-lookup"><span data-stu-id="481cb-228">UpgradeBatching Orchestration</span></span>  
 <span data-ttu-id="481cb-229">La orquestación UpgradeBatching trata los mensajes que tienen la propiedad `EDI.ToBeBatched` establecida en true, pero que no tienen la propiedad `EDI.BatchID` establecida.</span><span class="sxs-lookup"><span data-stu-id="481cb-229">The UpgradeBatching orchestration handles messages that are have the `EDI.ToBeBatched` property set to true, but do not have the `EDI.BatchID` property set.</span></span>  
  
 <span data-ttu-id="481cb-230">En versiones anteriores de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], cada entidad podía tener solo una configuración de procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-230">In previous versions of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], each party could have only one batch configuration.</span></span>  <span data-ttu-id="481cb-231">Al procesar mensajes que tenían `EDI.ToBeBatched` establecido en true, `EDI.DestinationPartyId` se usaba para determinar la entidad y, a continuación, se leía la configuración de lotes de las propiedades del acuerdo.</span><span class="sxs-lookup"><span data-stu-id="481cb-231">When processing messages that had `EDI.ToBeBatched` set to true, the `EDI.DestinationPartyId` was used to determine the party and then the batch configuration was read from the agreement properties.</span></span>  
  
 <span data-ttu-id="481cb-232">En [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], cada entidad puede tener varias configuraciones de lotes asociadas, de modo que `EDI.DestinationPartyId` no proporciona información suficiente para determinar qué configuración de lotes se debe usar.</span><span class="sxs-lookup"><span data-stu-id="481cb-232">In [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], each party can have multiple batch configurations associated with it, so the `EDI.DestinationPartyId` does not provide enough information to determine which batch configuration should be used.</span></span>  <span data-ttu-id="481cb-233">Cuando [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] recibe un mensaje, la propiedad `EDI.BatchId` se usa para identificar qué configuración de lotes específica se debe usar al procesar un mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-233">When [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] receives messages, the `EDI.BatchId` property is used to identify which specific batch configuration should be used when processing a message.</span></span>  
  
 <span data-ttu-id="481cb-234">Después de actualizar a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], es posible que todavía tenga canalizaciones personalizadas que usan la propiedad `EDI.DestinationPartyId` para especificar la configuración de la entidad.</span><span class="sxs-lookup"><span data-stu-id="481cb-234">After upgrading to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], you may still have custom pipelines that use the `EDI.DestinationPartyId` property to specify the party configuration.</span></span> <span data-ttu-id="481cb-235">Cuando se recibe un mensaje que tiene `EDI.ToBeBatched` establecido en true y que tiene `EDI.DestinationPartyID` establecido en lugar de EDI.BatchID, la orquestación UpgradeBatching intenta determinar qué configuración de lotes se debe usar.</span><span class="sxs-lookup"><span data-stu-id="481cb-235">When a message is received that has `EDI.ToBeBatched` set to true, and has `EDI.DestinationPartyID` set instead of EDI.BatchID, the UpgradeBatching orchestration attempts to determine which batch configuration should be used.</span></span>  
  
 <span data-ttu-id="481cb-236">La orquestación UpgradeBatching usa los filtros de suscripción siguientes para suscribirse en documentos que están marcados para el procesamiento por lotes, pero que no especifican ningún identificador de lote:</span><span class="sxs-lookup"><span data-stu-id="481cb-236">The UpgradeBatching orchestration uses the following subscription filters to subscribe to documents that are marked for batching, but do not specify a batch ID:</span></span>  
  
-   `EDI.ToBeBatched=True`  
  
-   <span data-ttu-id="481cb-237">`EDI.EncodingType` existe</span><span class="sxs-lookup"><span data-stu-id="481cb-237">`EDI.EncodingType` exists</span></span>  
  
-   <span data-ttu-id="481cb-238">`EDI.DestinationPartyId` existe</span><span class="sxs-lookup"><span data-stu-id="481cb-238">`EDI.DestinationPartyId` exists</span></span>  
  
 <span data-ttu-id="481cb-239">Si la orquestación recibe un mensaje, usará el nombre de la entidad y el tipo de codificación para intentar buscar una configuración de lote coincidente para el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-239">When the orchestration receives a message, it will try to find a matching batch configuration for the message by using the party name and encoding type.</span></span>  <span data-ttu-id="481cb-240">El `EDI.DestinationPartyID` propiedad se utiliza para determinar el nombre de la entidad y, a continuación, la orquestación busca un nombre de lote que coincida con \<PartyName\>+\<EncodingType\>+ Default.</span><span class="sxs-lookup"><span data-stu-id="481cb-240">The `EDI.DestinationPartyID` property is used to determine the party name, and then the orchestration looks for a batch name that matches \<PartyName\>+\<EncodingType\>+Default.</span></span>  <span data-ttu-id="481cb-241">Por ejemplo, si el nombre de la entidad es Contoso, y el valor de `EDI.EncodingType` es X12, la orquestación buscará un lote con el nombre ContosoX12Default.</span><span class="sxs-lookup"><span data-stu-id="481cb-241">For example if the party name is Contoso, and the value of `EDI.EncodingType` is X12, then the orchestration will look for a batch named ContosoX12Default.</span></span>  
  
 <span data-ttu-id="481cb-242">Si se encuentra una configuración de lote coincidente, el mensaje se coloca de nuevo en el cuadro de mensajes, con las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="481cb-242">If a matching batch configuration is found, the message is placed back in the message box with the following properties:</span></span>  
  
-   `EDI.ToBeBatched = True`  
  
-   `EDI.ToBeRouted = False`  
  
-   <span data-ttu-id="481cb-243">EDI.BatchId = el identificador de lote para el lote coincidente</span><span class="sxs-lookup"><span data-stu-id="481cb-243">EDI.BatchId = the batch ID for the matching batch</span></span>  
  
 <span data-ttu-id="481cb-244">A continuación, la orquestación de procesamiento por lotes procesa el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-244">The batching orchestration will then process the message</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="481cb-245">Si no se encuentra ningún lote que coincida, sucederá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="481cb-245">If no matching batch is found, then the following will happen:</span></span>  
>   
>  -   <span data-ttu-id="481cb-246">No se enviará el mensaje a la orquestación BatchSuspend.</span><span class="sxs-lookup"><span data-stu-id="481cb-246">The message will not be sent to the BatchSuspend orchestration.</span></span>  
> -   <span data-ttu-id="481cb-247">Se suspenderá la instancia de orquestación UpgradeBatching y el mensaje.</span><span class="sxs-lookup"><span data-stu-id="481cb-247">The UpgradeBatching orchestration instance and message will be suspended.</span></span>  
> -   <span data-ttu-id="481cb-248">Se registrará un error en el registro de eventos, lo que indica que no se ha encontrado ningún lote.</span><span class="sxs-lookup"><span data-stu-id="481cb-248">An error will be logged to the event log stating that a batch was not found.</span></span>  
  
### <a name="batchsuspend-orchestration"></a><span data-ttu-id="481cb-249">Orquestación BatchSuspend</span><span class="sxs-lookup"><span data-stu-id="481cb-249">BatchSuspend Orchestration</span></span>  
 <span data-ttu-id="481cb-250">La orquestación BatchSuspend controla los mensajes no válidos que recibe la orquestación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-250">The BatchSuspend orchestration handles invalid messages received by the batching orchestration.</span></span> <span data-ttu-id="481cb-251">La orquestación BatchSuspend es necesaria porque no hay forma directa de suspender un mensaje de una orquestación (en este caso, la orquestación por lotes) sin detener la ejecución de la instancia de la orquestación.</span><span class="sxs-lookup"><span data-stu-id="481cb-251">The BatchSuspend orchestration is needed because there is no direct way to suspend a message from an orchestration (in this case, the batching orchestration) without stopping the execution of the instance of the orchestration.</span></span>  
  
 <span data-ttu-id="481cb-252">Cuando una instancia de orquestación por lotes recibe un mensaje, intenta validarlo.</span><span class="sxs-lookup"><span data-stu-id="481cb-252">When an instance of the batching orchestration receives a message, it attempts to validate it.</span></span> <span data-ttu-id="481cb-253">Si se produce un error en la validación del mensaje, la orquestación por lotes crea una instancia de la orquestación BatchSuspend y establece la propiedad de contexto `EDI.BatchItemValidationFailure` en True.</span><span class="sxs-lookup"><span data-stu-id="481cb-253">If the message fails validation, the batching orchestration creates an instance of the BatchSuspend orchestration, and sets the `EDI.BatchItemValidationFailure` context property to True.</span></span> <span data-ttu-id="481cb-254">La orquestación BatchSuspend se suscribe a todos los mensajes con la propiedad de contexto establecida en True.</span><span class="sxs-lookup"><span data-stu-id="481cb-254">The BatchSuspend orchestration subscribes to all messages with that context property set to True.</span></span> <span data-ttu-id="481cb-255">Después de que el conjunto de transacciones no válidas se enrutan en la orquestación BatchSuspend, se suspende la instancia de orquestaciones BatchSuspend.</span><span class="sxs-lookup"><span data-stu-id="481cb-255">After the invalid transaction set is routed to the BatchSuspend orchestration, the BatchSuspend orchestration instance is suspended.</span></span>  
  
 <span data-ttu-id="481cb-256">La orquestación BatchSuspend proporciona la información de error detallada para el primer error que se haya encontrado.</span><span class="sxs-lookup"><span data-stu-id="481cb-256">Detailed error information for the first error encountered is provided by the BatchSuspend orchestration.</span></span>  
  
 <span data-ttu-id="481cb-257">Puede usar la propiedad `EDI.BatchElementValidationFailure` en un filtro para crear una orquestación personalizada con el fin de controlar los conjuntos de transacciones que produzcan un error en la validación mediante la orquestación por lotes.</span><span class="sxs-lookup"><span data-stu-id="481cb-257">You can create a custom orchestration to handle transaction sets that fail validation by the batching orchestration, by using the `EDI.BatchElementValidationFailure` property in a filter.</span></span>  
  
### <a name="edi-send-pipeline"></a><span data-ttu-id="481cb-258">Canalización de envío EDI</span><span class="sxs-lookup"><span data-stu-id="481cb-258">EDI Send Pipeline</span></span>  
 <span data-ttu-id="481cb-259">Después de recibir un intercambio de lotes para la orquestación por lotes, la canalización de envío EDI realiza lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="481cb-259">After receiving a batched interchange from the batching orchestration, the EDI send pipeline does the following:</span></span>  
  
-   <span data-ttu-id="481cb-260">Para un intercambio con codificación X12, la canalización de envío aplica las siguientes propiedades al sobre:</span><span class="sxs-lookup"><span data-stu-id="481cb-260">For an X12-encoded interchange, the send pipeline applies the following properties to the envelope:</span></span>  
  
    -   <span data-ttu-id="481cb-261">ISA2: información de autorización</span><span class="sxs-lookup"><span data-stu-id="481cb-261">ISA2: Authorization Information</span></span>  
  
    -   <span data-ttu-id="481cb-262">ISA4: información de seguridad</span><span class="sxs-lookup"><span data-stu-id="481cb-262">ISA4: Security Information</span></span>  
  
    -   <span data-ttu-id="481cb-263">ISA9: fecha del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-263">ISA9: Interchange Date</span></span>  
  
    -   <span data-ttu-id="481cb-264">ISA10: hora del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-264">ISA10: Interchange Time</span></span>  
  
    -   <span data-ttu-id="481cb-265">ISA13: número de control del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-265">ISA13: Interchange Control Number</span></span>  
  
    -   <span data-ttu-id="481cb-266">GS4: fecha</span><span class="sxs-lookup"><span data-stu-id="481cb-266">GS4: Date</span></span>  
  
    -   <span data-ttu-id="481cb-267">GS5: hora</span><span class="sxs-lookup"><span data-stu-id="481cb-267">GS5: Time</span></span>  
  
    -   <span data-ttu-id="481cb-268">GS6: número de control de grupo</span><span class="sxs-lookup"><span data-stu-id="481cb-268">GS6: Group Control Number</span></span>  
  
    -   <span data-ttu-id="481cb-269">ST2: número de control de conjunto de transacciones</span><span class="sxs-lookup"><span data-stu-id="481cb-269">ST2: Transaction Set Control Number</span></span>  
  
-   <span data-ttu-id="481cb-270">Para un intercambio con codificación EDIFACT, la canalización de envío aplica las siguientes propiedades al sobre:</span><span class="sxs-lookup"><span data-stu-id="481cb-270">For an EDIFACT-encoded interchange, the send pipeline applies the following properties to the envelope:</span></span>  
  
    -   <span data-ttu-id="481cb-271">UNB4.1: fecha</span><span class="sxs-lookup"><span data-stu-id="481cb-271">UNB4.1: Date</span></span>  
  
    -   <span data-ttu-id="481cb-272">UNB4.2: hora</span><span class="sxs-lookup"><span data-stu-id="481cb-272">UNB4.2: Time</span></span>  
  
    -   <span data-ttu-id="481cb-273">UNB5: referencia de control del intercambio</span><span class="sxs-lookup"><span data-stu-id="481cb-273">UNB5: Interchange Control Reference</span></span>  
  
    -   <span data-ttu-id="481cb-274">UNB6.1: contraseña de referencia de destinatario</span><span class="sxs-lookup"><span data-stu-id="481cb-274">UNB6.1: Recipient Reference Password</span></span>  
  
    -   <span data-ttu-id="481cb-275">UNG4.1: fecha</span><span class="sxs-lookup"><span data-stu-id="481cb-275">UNG4.1: Date</span></span>  
  
    -   <span data-ttu-id="481cb-276">UNG4.2: hora</span><span class="sxs-lookup"><span data-stu-id="481cb-276">UNG4.2: Time</span></span>  
  
    -   <span data-ttu-id="481cb-277">UNG5: referencia de grupo funcional</span><span class="sxs-lookup"><span data-stu-id="481cb-277">UNG5: Functional Group Reference</span></span>  
  
    -   <span data-ttu-id="481cb-278">UNG8: contraseña de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="481cb-278">UNG8: Application Password</span></span>  
  
-   <span data-ttu-id="481cb-279">Entrega el mensaje a través del adaptador asociado.</span><span class="sxs-lookup"><span data-stu-id="481cb-279">Delivers the message via the associated adapter</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="481cb-280">Vea también</span><span class="sxs-lookup"><span data-stu-id="481cb-280">See Also</span></span>  
 [<span data-ttu-id="481cb-281">Procesamiento por lotes mensajes EDI salientes</span><span class="sxs-lookup"><span data-stu-id="481cb-281">Batching Outgoing EDI Messages</span></span>](../core/batching-outgoing-edi-messages.md)