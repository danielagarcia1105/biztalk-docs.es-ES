---
title: Base de datos de configuración previa Optimizations2 | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 8c525c3a-249c-4694-b287-a8c35a6aa524
caps.latest.revision: 17
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2f863ae780dd99a7f0aa7d9acc3884f860686c86
ms.sourcegitcommit: dd7c54feab783ae2f8fe75873363fe9ffc77cd66
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/07/2017
ms.locfileid: "24015435"
---
# <a name="pre-configuration-database-optimizations"></a><span data-ttu-id="82a8c-102">Optimizaciones de base de datos de configuración previa</span><span class="sxs-lookup"><span data-stu-id="82a8c-102">Pre-Configuration Database Optimizations</span></span>
<span data-ttu-id="82a8c-103">Debido a la función crítica que SQL Server se reproduce en cualquier entorno de BizTalk Server, resulta de gran importancia que SQL Server sea configurado/optimizado para un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="82a8c-103">Because of the critical role that SQL Server plays in any BizTalk Server environment, it is of paramount importance that SQL Server be configured/tuned for optimal performance.</span></span> <span data-ttu-id="82a8c-104">Si SQL Server no está optimizado para llevar a cabo correctamente, las bases de datos usados por BizTalk Server se convertirá en un cuello de botella y se verá afectado el rendimiento general del entorno de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-104">If SQL Server is not tuned to perform well, then the databases used by BizTalk Server will become a bottleneck and the overall performance of the BizTalk Server environment will suffer.</span></span> <span data-ttu-id="82a8c-105">En este tema se describe varias optimizaciones de rendimiento de SQL Server que hay que seguir antes de instalar a BizTalk Server y configurar las bases de datos de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-105">This topic describes several SQL Server performance optimizations that should be followed before installing BizTalk Server and configuring the BizTalk Server databases.</span></span>  
  
## <a name="set-ntfs-file-allocation-unit"></a><span data-ttu-id="82a8c-106">Establecer la unidad de asignación de archivo NTFS</span><span class="sxs-lookup"><span data-stu-id="82a8c-106">Set NTFS File Allocation Unit</span></span>  
 <span data-ttu-id="82a8c-107">SQL Server almacena sus datos en **extensiones**, que son colecciones de ocho páginas físicamente contiguas de 8 K o 64 KB.</span><span class="sxs-lookup"><span data-stu-id="82a8c-107">SQL Server stores its data in **Extents**, which are collections of eight physically contiguous 8K pages, or 64 KB.</span></span> <span data-ttu-id="82a8c-108">Por lo tanto, para optimizar el rendimiento de disco, establezca el tamaño de unidad de asignación de NTFS a 64KB como se describe en el "disco configuración prácticas recomendadas" en [prácticas recomendadas de E/S antes de la implementación](https://msdn.microsoft.com/library/cc966412.aspx).</span><span class="sxs-lookup"><span data-stu-id="82a8c-108">Therefore, to optimize disk performance, set the NTFS Allocation Unit size to 64KB as described in the “Disk Configuration Best Practices” at  [Predeployment I/O Best Practices](https://msdn.microsoft.com/library/cc966412.aspx).</span></span>  
  
## <a name="considerations-for-the-version-and-edition-of-sql-server"></a><span data-ttu-id="82a8c-109">Consideraciones para la versión y edición de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-109">Considerations for the version and edition of SQL Server</span></span>  
 <span data-ttu-id="82a8c-110">Varias versiones y ediciones de [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] proporcionan diferentes características que pueden afectar al rendimiento de su [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] entorno.</span><span class="sxs-lookup"><span data-stu-id="82a8c-110">Various versions and editions of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] provide different features that can affect the performance of your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="82a8c-111">Por ejemplo, en condiciones de carga elevada, el número de bloqueos de base de datos que están disponibles para la versión de 32 bits de [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] puede que se superara, que es negativo en el rendimiento de la solución de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="82a8c-111">For example, under high-load conditions, the number of database locks that are available for the 32-bit version of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] might be exceeded, which is detrimental to the performance of the BizTalk solution.</span></span> <span data-ttu-id="82a8c-112">Considere la posibilidad de alojamiento de la base de datos de cuadro de mensajes en una versión de 64 bits de SQL Server si se producen errores de "sin bloqueo" en el entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="82a8c-112">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors in your test environment.</span></span> <span data-ttu-id="82a8c-113">El número de bloqueos disponible es significativamente superior en la versión de 64 bits de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-113">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
 <span data-ttu-id="82a8c-114">Considere la siguiente tabla cuando se decida por las características del motor de base de datos que necesita para su entorno de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="82a8c-114">Consider the following table when deciding on the database engine features that you will need for your BizTalk environment.</span></span> <span data-ttu-id="82a8c-115">Para gran escala, compatibilidad con soluciones de nivel de empresa que requieren la agrupación en clústeres, soporte técnico, de trasvase de registros de servidor BizTalk Server o Analysis Services admite y, a continuación, se necesita SQL Server Enterprise Edition host la [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] bases de datos.</span><span class="sxs-lookup"><span data-stu-id="82a8c-115">For large scale, enterprise-level solutions that require clustering support, BizTalk Server log shipping support, or Analysis Services support, then you need SQL Server Enterprise Edition to host the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases.</span></span>   

 <span data-ttu-id="82a8c-116">Para obtener una lista completa de las características compatibles con las ediciones de SQL Server, vea [ediciones de SQL Server y las características admitidas](https://docs.microsoft.com/sql/sql-server/editions-and-components-of-sql-server-2016).</span><span class="sxs-lookup"><span data-stu-id="82a8c-116">For a complete list of the features supported by the SQL Server editions, see [SQL Server Editions and supported features](https://docs.microsoft.com/sql/sql-server/editions-and-components-of-sql-server-2016).</span></span>
  
## <a name="database-planning-considerations"></a><span data-ttu-id="82a8c-117">Consideraciones de planeación de la base de datos</span><span class="sxs-lookup"><span data-stu-id="82a8c-117">Database planning considerations</span></span>  
 <span data-ttu-id="82a8c-118">Se recomienda que hospedan las bases de datos de SQL Server en almacenamiento rápido (por ejemplo, discos rápidos de SAN o discos SCSI rápidos).</span><span class="sxs-lookup"><span data-stu-id="82a8c-118">We recommend that you host your SQL Server databases on fast storage (for example, fast SAN disks or fast SCSI disks).</span></span> <span data-ttu-id="82a8c-119">RAID 10 (1 + 0) en lugar de RAID 5 se recomienda ya que raid 5 es más lento en escritura.</span><span class="sxs-lookup"><span data-stu-id="82a8c-119">We recommend RAID 10 (1+0) instead of RAID 5 since raid 5 is slower at writing.</span></span> <span data-ttu-id="82a8c-120">Discos de SAN más recientes tienen las memorias caché grandes cantidades de memoria, por lo que en estos casos no es tan importante la selección de raid.</span><span class="sxs-lookup"><span data-stu-id="82a8c-120">Newer SAN disks have very large memory caches, so in these cases the raid selection is not as important.</span></span> <span data-ttu-id="82a8c-121">Para aumentar el rendimiento, las bases de datos y sus archivos de registro pueden residir en diferentes discos físicos.</span><span class="sxs-lookup"><span data-stu-id="82a8c-121">To increase performance, databases and their log files can reside on different physical disks.</span></span>  
  
 <span data-ttu-id="82a8c-122">Considere también la profundidad de cola host (HBA) del adaptador de bus de optimización si utiliza una red de área de almacenamiento (SAN).</span><span class="sxs-lookup"><span data-stu-id="82a8c-122">Also consider tuning the host bus adapter (HBA) queue depth if using a storage area network (SAN).</span></span> <span data-ttu-id="82a8c-123">Esto puede afectar significativamente al rendimiento de E/S y cuadro fuera de los valores pueden ser suficientes para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-123">This can significantly impact I/O throughput and out-of-the box values can be insufficient for SQL Server.</span></span> <span data-ttu-id="82a8c-124">Es necesario para determinar el valor óptimo, realizar pruebas aunque la profundidad de cola de 64 suele aceptarse como un buen punto de partida en ausencia de las recomendaciones del proveedor específico</span><span class="sxs-lookup"><span data-stu-id="82a8c-124">Testing is required to determine optimal value, although queue depth of 64 is generally accepted as a good starting point in the absence of any specific vendor recommendations</span></span>  
  
## <a name="install-the-latest-service-pack-and-cumulative-updates-for-sql-server"></a><span data-ttu-id="82a8c-125">Instale el service pack más reciente y las actualizaciones acumulativas para SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-125">Install the latest service pack and cumulative updates for SQL Server</span></span>  
 <span data-ttu-id="82a8c-126">Instale los últimos service packs y las últimas actualizaciones acumulativas para SQL Server, así como los service Pack más recientes de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="82a8c-126">Install the latest service packs and the latest cumulative updates for SQL Server as well as the latest .NET Framework service packs.</span></span>  
  
## <a name="install-sql-service-packs-and-cumulative-updates-on-both-biztalk-server-and-sql-server"></a><span data-ttu-id="82a8c-127">Instalar Service Packs de SQL y las actualizaciones acumulativas en BizTalk Server y SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-127">Install SQL Service Packs and cumulative updates on both BizTalk Server and SQL Server</span></span>  
 <span data-ttu-id="82a8c-128">Al instalar el service Pack o actualizaciones acumulativas para SQL Server, instalar el service pack o actualización acumulativa en el equipo de servidor BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-128">When installing service packs or cumulative updates for SQL Server, also install the service pack or cumulative update on the BizTalk Server computer.</span></span> <span data-ttu-id="82a8c-129">BizTalk Server utiliza los componentes de cliente de SQL que se actualizan mediante SQL Server service Pack y las actualizaciones acumulativas.</span><span class="sxs-lookup"><span data-stu-id="82a8c-129">BizTalk Server uses SQL Client components that are updated by SQL Server service packs and cumulative updates.</span></span>  
  
## <a name="consider-using-a-fast-solid-state-drive-ssd-to-house-the-sql-server-tembdb"></a><span data-ttu-id="82a8c-130">Considere el uso de una unidad de estado rápido sólido (SSD) para alojar el tembdb de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-130">Consider using a fast solid state drive (SSD) to house the SQL Server tembdb</span></span>  
 <span data-ttu-id="82a8c-131">Considere el uso de una o varias unidades de disco de estado sólido (SSD) para alojar el TempDB.</span><span class="sxs-lookup"><span data-stu-id="82a8c-131">Consider using one or more Solid State Disk (SSD) drives to house the TempDB.</span></span> <span data-ttu-id="82a8c-132">Las unidades SSD ofrecen ventajas de rendimiento importante sobre unidades de disco duro tradicionales y se quita rápidamente en el precio según va entrando en mercados estándar.</span><span class="sxs-lookup"><span data-stu-id="82a8c-132">SSD drives offer significant performance advantages over traditional hard drives and are quickly dropping in price as they enter mainstream markets.</span></span> <span data-ttu-id="82a8c-133">Porque el rendimiento de TempDB a menudo es un factor clave completo [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] rendimiento, el costo inicial de agregado de las unidades de disco se suelen rápidamente recuperar al aumenta el global [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] rendimiento, especialmente cuando se ejecutan las aplicaciones empresariales para que [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] el rendimiento resulta esencial.</span><span class="sxs-lookup"><span data-stu-id="82a8c-133">Because TempDB performance is often a key factor for overall [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance, the added initial cost of the drives will often be quickly recouped by the overall increased [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance, especially when running enterprise applications for which [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance is critical.</span></span>  
  
## <a name="consider-implementing-the-sql-server-2008-r2-data-collector-and-management-data-warehouse"></a><span data-ttu-id="82a8c-134">Considere la posibilidad de implementar el recopilador de datos de SQL Server 2008 R2 y el almacenamiento de datos de administración</span><span class="sxs-lookup"><span data-stu-id="82a8c-134">Consider implementing the SQL Server 2008 R2 Data Collector and Management Data Warehouse</span></span>  
 <span data-ttu-id="82a8c-135">SQL Server 2008 R2 permite el uso del nuevo recopilador de datos y almacenamiento de datos de administración para recopilar el rendimiento del entorno/base de datos relacionadas con datos de prueba y análisis de tendencias.</span><span class="sxs-lookup"><span data-stu-id="82a8c-135">SQL Server 2008 R2 accommodates the use of the new Data Collector and Management Data Warehouse to collect environment/database performance related data for test and trend analysis.</span></span> <span data-ttu-id="82a8c-136">El recopilador de datos conserva los datos de todos los recopilados en el almacén de datos de administración especificada.</span><span class="sxs-lookup"><span data-stu-id="82a8c-136">The Data Collector persists all collected data to the specified Management Data Warehouse.</span></span> <span data-ttu-id="82a8c-137">Aunque esto no es una optimización del rendimiento esto será útil para el análisis de los problemas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="82a8c-137">While this is not a performance optimization this will be useful for analysis of any performance issues.</span></span>  
  
## <a name="grant-the-account-which-is-used-for-sql-server-the-windows-lock-pages-in-memory-privilege"></a><span data-ttu-id="82a8c-138">Conceda a la cuenta que se usa para el bloqueo de Windows páginas de privilegio de memoria de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-138">Grant the account which is used for SQL Server the Windows Lock Pages In Memory privilege</span></span>  
 <span data-ttu-id="82a8c-139">Conceda el Windows privilegio Bloquear páginas en memoria a la cuenta de servicio de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-139">Grant the Windows Lock Pages in Memory privilege to the SQL Server service account.</span></span> <span data-ttu-id="82a8c-140">Esto debe hacerse para evitar que el sistema operativo Windows de paginación a la memoria del grupo de búferes del proceso de SQL Server bloqueando la memoria asignada para el grupo de búferes en la memoria física.</span><span class="sxs-lookup"><span data-stu-id="82a8c-140">This should be done to prevent the Windows operating system from paging out the buffer pool memory of the SQL Server process by locking memory that is allocated for the buffer pool in physical memory.</span></span>  
  
 <span data-ttu-id="82a8c-141">En nuestro entorno de laboratorio, la directiva de Windows **Lock Pages in Memory** opción estaba habilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="82a8c-141">In our lab environment, the Windows policy **Lock Pages in Memory** option was enabled by default.</span></span> <span data-ttu-id="82a8c-142">Vea [habilitar la opción Bloquear páginas en memoria](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows).</span><span class="sxs-lookup"><span data-stu-id="82a8c-142">See [Enable the Lock Pages in Memory Option](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="82a8c-143">Al conceder a la cuenta de servicio de SQL Server el Windows privilegio Bloquear páginas en memoria se aplican ciertas limitaciones.</span><span class="sxs-lookup"><span data-stu-id="82a8c-143">Certain limitations apply when granting the SQL Server service account the Windows Lock Pages in Memory privilege.</span></span> <span data-ttu-id="82a8c-144">Vea lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="82a8c-144">See the following:</span></span> 
>   
> - [<span data-ttu-id="82a8c-145">Extensión del grupo de búferes</span><span class="sxs-lookup"><span data-stu-id="82a8c-145">Buffer Pool Extension</span></span>](https://docs.microsoft.com/sql/database-engine/configure-windows/buffer-pool-extension)  
> - [<span data-ttu-id="82a8c-146">Habilitar la opción Bloquear páginas en memoria</span><span class="sxs-lookup"><span data-stu-id="82a8c-146">Enable the Lock Pages in Memory Option </span></span>](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows)  
  
## <a name="grant-the-semanagevolumename-right-to-the-sql-server-service-account"></a><span data-ttu-id="82a8c-147">Conceder el SE_MANAGE_VOLUME_NAME de derecha a la cuenta de servicio de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-147">Grant the SE_MANAGE_VOLUME_NAME right to the SQL Server Service Account</span></span>  
 <span data-ttu-id="82a8c-148">Asegúrese de que la cuenta que ejecuta el servicio SQL Server tiene el privilegio de Windows 'Realizar tareas de mantenimiento de volumen' o asegúrese de que pertenece a un grupo que.</span><span class="sxs-lookup"><span data-stu-id="82a8c-148">Ensure the account running the SQL Server service has the ‘Perform Volume Maintenance Tasks’ Windows privilege or ensure it belongs to a group that does.</span></span> <span data-ttu-id="82a8c-149">Esto le permitirá instantánea de archivos inicialización garantizar un rendimiento óptimo si tiene una base de datos para el crecimiento automático.</span><span class="sxs-lookup"><span data-stu-id="82a8c-149">This will allow instant file Initialization ensuring optimum performance if a database has to Auto-grow.</span></span>  
  
## <a name="set-min-and-max-server-memory"></a><span data-ttu-id="82a8c-150">Establecer Min y Max Server Memory</span><span class="sxs-lookup"><span data-stu-id="82a8c-150">Set Min and Max Server Memory</span></span>  
 <span data-ttu-id="82a8c-151">Los equipos que ejecutan a SQL Server que hospedan las bases de datos de BizTalk Server deben estar dedicados a ejecutar SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-151">The computers running SQL Server that host the BizTalk Server databases should be dedicated to running SQL Server.</span></span> <span data-ttu-id="82a8c-152">Cuando los equipos que ejecutan a SQL Server que hospedan las bases de datos de BizTalk Server se dedican a ejecutar SQL Server, se recomienda que la 'min server memory' y opciones de 'max server memory' en cada instancia de SQL Server se establecen para especificar la cantidad de memoria fija asignar a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-152">When the computers running SQL Server that host the BizTalk Server databases are dedicated to running SQL Server, we recommend that the 'min server memory' and 'max server memory' options on each SQL Server instance are set to specify the fixed amount of memory to allocate to SQL Server.</span></span> <span data-ttu-id="82a8c-153">En este caso, debe establecer el "min server memory" y "max server memory" en el mismo valor (es igual a la cantidad máxima de memoria física que se va a usar SQL Server).</span><span class="sxs-lookup"><span data-stu-id="82a8c-153">In this case, you should set the “min server memory” and “max server memory” to the same value (equal to the maximum amount of physical memory that SQL Server will use).</span></span> <span data-ttu-id="82a8c-154">Esto disminuirá la sobrecarga que utilizaría en caso contrario, SQL Server administrar dinámicamente estos valores.</span><span class="sxs-lookup"><span data-stu-id="82a8c-154">This will reduce overhead that would otherwise be used by SQL Server dynamically managing these values.</span></span> <span data-ttu-id="82a8c-155">Ejecute los siguientes comandos de T-SQL en cada equipo que ejecuta SQL Server para especificar la cantidad fija de memoria para asignar a SQL Server:</span><span class="sxs-lookup"><span data-stu-id="82a8c-155">Run the following T-SQL commands on each computer running SQL Server to specify the fixed amount of memory to allocate to SQL Server:</span></span>  
  
```  
sp_configure ‘Max Server memory (MB)’,(max size in MB)  
sp_configure ‘Min Server memory (MB)’,(min size in MB)  
```  
  
 <span data-ttu-id="82a8c-156">Antes de configurar la cantidad de memoria para SQL Server, determine la configuración de memoria apropiada restando la memoria necesaria para Windows Server desde la memoria física total.</span><span class="sxs-lookup"><span data-stu-id="82a8c-156">Before you set the amount of memory for SQL Server, determine the appropriate memory setting by subtracting the memory required for Windows Server from the total physical memory.</span></span> <span data-ttu-id="82a8c-157">Se trata de la cantidad máxima de memoria que puede asignar a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="82a8c-157">This is the maximum amount of memory you can assign to SQL Server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="82a8c-158">Si los equipos que ejecutan a SQL Server que hospedan las bases de datos de BizTalk Server también hospedan el Enterprise Single Sign-On servidor secreto principal, a continuación, que necesite ajustar este valor para asegurarse de que hay suficiente memoria disponible para ejecutar la Enterprise Single Sign-On Servicio.</span><span class="sxs-lookup"><span data-stu-id="82a8c-158">If the computers running SQL Server that host the BizTalk Server databases also host the Enterprise Single Sign-On Master Secret Server, then you may need to adjust this value to ensure that there is sufficient memory available to run the Enterprise Single Sign-On Service.</span></span> <span data-ttu-id="82a8c-159">No es una práctica poco habitual para ejecutar una instancia en clúster del servicio de Enterprise Single Sign-On en un clúster de SQL Server para proporcionar alta disponibilidad para el servidor secreto principal.</span><span class="sxs-lookup"><span data-stu-id="82a8c-159">It is not an uncommon practice to run a clustered instance of the Enterprise Single Sign-On service on a SQL Server cluster to provide high availability for the Master Secret Server.</span></span> <span data-ttu-id="82a8c-160">Vea [el servidor secreto principal de agrupación en clústeres](../technical-guides/clustering-the-master-secret-server.md)</span><span class="sxs-lookup"><span data-stu-id="82a8c-160">See [Clustering the Master Secret Server](../technical-guides/clustering-the-master-secret-server.md)</span></span>  
  
## <a name="split-the-tempdb-database-into-multiple-data-files-of-equal-size-on-each-sql-server-instance-used-by-biztalk-server"></a><span data-ttu-id="82a8c-161">Dividir la base de datos tempdb en varios archivos de datos del mismo tamaño en cada instancia de SQL Server utilizado por BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-161">Split the tempdb database into multiple data files of equal size on each SQL Server instance used by BizTalk Server</span></span>  
 <span data-ttu-id="82a8c-162">Es fundamental asegurarse de que los archivos de datos que se usan para tempdb del mismo tamaño, dado que el algoritmo de relleno proporcional utilizado por SQL Server se basa en el tamaño de los archivos de datos.</span><span class="sxs-lookup"><span data-stu-id="82a8c-162">Ensuring that the data files used for the tempdb are of equal size is critical because the proportional fill algorithm used by SQL Server is based on the size of the data files.</span></span> <span data-ttu-id="82a8c-163">Si se crean archivos de datos con diferentes tamaños, el algoritmo de relleno proporcional usará el archivo más grande más para las asignaciones de página GAM en lugar de repartir las asignaciones entre todos los archivos, evitando así la finalidad de crear varios archivos de datos.</span><span class="sxs-lookup"><span data-stu-id="82a8c-163">If data files are created with unequal sizes, the proportional fill algorithm will use the largest file more for GAM allocations rather than spreading the allocations between all the files, thereby defeating the purpose of creating multiple data files.</span></span> <span data-ttu-id="82a8c-164">El número óptimo de archivos de datos tempdb depende del grado de contención de bloqueos temporales que se ve en tempdb.</span><span class="sxs-lookup"><span data-stu-id="82a8c-164">The optimal number of tempdb data files depends on the degree of latch contention seen in tempdb.</span></span> <span data-ttu-id="82a8c-165">Como regla general, el número de archivos de datos debe ser menor o igual al número de núcleos de procesador/CPU que el número de CPU es 8.</span><span class="sxs-lookup"><span data-stu-id="82a8c-165">As a general rule of thumb, the number of data files should be equal to number of processor cores/CPUs where number of CPUs is 8 or less.</span></span> <span data-ttu-id="82a8c-166">Para los servidores con más de 8 CPU, crear archivos de datos en la mitad el número de CPU (una vez más, solo tiene contención de bloqueos temporales).</span><span class="sxs-lookup"><span data-stu-id="82a8c-166">For servers with more than 8 CPUs, create data files for half the number of CPUs (again, only you have latch contention).</span></span>  
  
 <span data-ttu-id="82a8c-167">En nuestro entorno de laboratorio, usamos el siguiente script para crear 8 archivos de datos de TempDB, cada uno de ellos tenía un tamaño de archivo de 1024 MB con el crecimiento de 100 MB y un archivo de registro de 512 MB con el crecimiento de 100 MB.</span><span class="sxs-lookup"><span data-stu-id="82a8c-167">In our lab environment, we used the script below to create 8 TempDB data files each of which had a file size of 1024 MB with 100 MB growth and a log file of 512 MB with 100 MB growth.</span></span> <span data-ttu-id="82a8c-168">Los archivos de datos se mueven a la unidad H: y archivo de registro se mueve a la unidad I:.</span><span class="sxs-lookup"><span data-stu-id="82a8c-168">The data files are moved to drive H: and log file are moved to drive I:.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="82a8c-169">Esta secuencia de comandos está "tal cual", está diseñado para demostración o solo con fines educativos y debe utilizarse bajo su responsabilidad.</span><span class="sxs-lookup"><span data-stu-id="82a8c-169">This script is provided “as is,” is intended for demo or educational purposes only, and is to be used at your own risk.</span></span> <span data-ttu-id="82a8c-170">Uso de esta secuencia de comandos no es compatible con Microsoft y Microsoft no otorga ninguna garantía sobre la idoneidad de este script.</span><span class="sxs-lookup"><span data-stu-id="82a8c-170">Use of this script is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this script.</span></span>  
  
```  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
-- Use of included script samples are subject to the terms specified at   
-- http://www.microsoft.com/info/cpyright.htm  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
--***Instructions***  
-- 1. If running the script from a remote server, change the context in SSMS to target instance  
-- 2. Enable SQLCMD mode (add & click toolbar button or toggle by clicking Query > SQLCMD Mode)  
-- 3. Commence execution of scripts (recommend running statements discretely to more easily remedy potential problems)  
-- 4. Examine servername & temp configuration  
-- 5. If necessary, 1) Replace instance name in path to reflect target instance *all throughout script*  
      --            2) Modify root drives to reflect drives designated for data & log (folder creation *and* ALTER DB statements)  
-- 6. Resume script execution  
-- 7. If necessary, create new folders  
-- 8. Modify/Add data & log files   
-- 9. Recycle SQL service using sqlservermanager10.msc  
--10. Examine results & if appropriate, delete original tempdb data log files   
 --(if they were "moved", the original files aren't automatically deleted)  
  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
--1. If running the script from a remote server, change the context in SSMS to target instance  
--2. Enable SQLCMD mode (add & click toolbar button or toggle by clicking Query > SQLCMD Mode)  
--3. Commence execution of scripts (recommend running statements discretely to more easily remedy potential problems)  
--4. Examine servername & temp configuration  
SELECT @@SERVERNAME  
EXEC dbo.sp_helpdb tempdb  
--tempdev   1   C:\tempdb.mdf   PRIMARY  8192 KB  Unlimited  10%  data only  
--templog   2   C:\templog.ldf  NULL      512 KB  Unlimited  10%  log only  
GO  
--5. If necessary, 1) Replace instance name in path to reflect target instance *all throughout script*  
     --            2) Modify root drives to reflect drives designated for data & log (folder creation *and* ALTER DB statements)  
--6. Resume script execution  
--7. If necessary, create new folders  
--!!md H:\MSSQL10.<instance>  
--!!md H:\MSSQL10.<instance>\MSSQL  
--!!md H:\MSSQL10.<instance>\MSSQL\DATA  
GO  
-- 8. Modify/Add data & log files   
 --note: even if the out-of-box mdf is already where it needs to be,   
   --the first command is necessary to modify size & filegrowth  
ALTER DATABASE tempdb MODIFY FILE (NAME = tempdev  , FILENAME = 'H:\tempdb.mdf'   , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat2 , FILENAME = 'H:\tempdat2.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat3 , FILENAME = 'H:\tempdat3.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat4 , FILENAME = 'H:\tempdat4.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat5 , FILENAME = 'H:\tempdat5.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat6 , FILENAME = 'H:\tempdat6.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat7 , FILENAME = 'H:\tempdat7.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat8 , FILENAME = 'H:\tempdat8.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
GO  
ALTER DATABASE tempdb MODIFY FILE (NAME = templog , FILENAME = 'I:\templog.ldf', SIZE =  512MB , FILEGROWTH = 100MB)  
GO  
--8b. Modify log file:  modify drive & instance name to reflect designated destination for tempdb log   
--!!md I:\MSSQL10.<instance>  
--!!md I:\MSSQL10.<instance>\MSSQL  
--!!md I:\MSSQL10.<instance>\MSSQL\DATA  
GO  
-- 9. Recycle SQL service in SQL Server Services node of sqlservermanager10.msc  
    --note, if running script from a UNC share, SSMS will report an error,   
      --but SQL Server Configuration Manager will open if its location is in %path%  
!!sqlservermanager10.msc  
  
--10. Examine results & if appropriate, delete original tempdb data log files   
 --(if they were "moved", the original files aren't automatically deleted)  
EXEC dbo.sp_helpdb tempdb  
--!!del C:\tempdb.mdf     
--!!del C:\templog.ldf  
GO  
  
```  
  
 <span data-ttu-id="82a8c-171">Utilice el Monitor de actividad de SQL Server 2008 o SQL Server 2005 rendimiento panel informes descritos en [supervisión de rendimiento de SQL Server](../technical-guides/monitoring-sql-server-performance.md) para identificar los problemas de contención de bloqueos temporales.</span><span class="sxs-lookup"><span data-stu-id="82a8c-171">Use the SQL Server 2008 Activity Monitor or the SQL Server 2005 Performance Dashboard Reports described in [Monitoring SQL Server Performance](../technical-guides/monitoring-sql-server-performance.md) to identify problems with latch contention.</span></span>  
  
## <a name="manually-set-sql-server-process-affinity"></a><span data-ttu-id="82a8c-172">Establecer manualmente la afinidad de proceso de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-172">Manually set SQL Server Process Affinity</span></span>  
 <span data-ttu-id="82a8c-173">La opción de afinidad de proceso puede proporcionar mejoras de rendimiento en entornos de SQL Server de tecnología avanzados, nivel de empresa que se ejecutan en equipos no NUMA con 16 CPU o más.</span><span class="sxs-lookup"><span data-stu-id="82a8c-173">The Process Affinity option can provide performance enhancements in high-end, enterprise-level SQL Server environments that are running on non-NUMA computers with 16 or more CPUs.</span></span> <span data-ttu-id="82a8c-174">Esto es especialmente cierto en entornos de BizTalk de alto rendimiento donde haya contención en tablas compartidas en la base de datos de cuadro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="82a8c-174">This is especially true in high-throughput BizTalk environments where you have contention on shared tables in the MessageBox database.</span></span> <span data-ttu-id="82a8c-175">Dado que los equipos de SQL Server que se utilizaron en nuestro entorno de laboratorio no habilitada para NUMA y tuvieron 16 núcleos, para optimizar el rendimiento, se usaron los siguientes comandos para establecer la afinidad de proceso:</span><span class="sxs-lookup"><span data-stu-id="82a8c-175">Because the SQL Server computers that were used in our lab environment were not NUMA-enabled and had 16 cores, to optimize performance, we used the commands below to set process affinity:</span></span>  
  
 <span data-ttu-id="82a8c-176">**Para establecer manualmente la afinidad de proceso de SQL Server entre 0 y 15**</span><span class="sxs-lookup"><span data-stu-id="82a8c-176">**To manually set the SQL Server Process Affinity from 0 to 15**</span></span>  
  
```  
ALTER SERVER CONFIGURATION  
SET PROCESS AFFINITY CPU = 0 to 15  
```  
  
 <span data-ttu-id="82a8c-177">Para obtener más información, consulte [ALTER SERVER CONFIGURATION (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="82a8c-177">For more information, see [ALTER SERVER CONFIGURATION (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/alter-server-configuration-transact-sql).</span></span>
  
## <a name="configure-msdtc"></a><span data-ttu-id="82a8c-178">Configurar MSDTC</span><span class="sxs-lookup"><span data-stu-id="82a8c-178">Configure MSDTC</span></span>  
 <span data-ttu-id="82a8c-179">Para facilitar las transacciones entre SQL Server y BizTalk Server, debe habilitar el Coordinador de transacciones distribuidas de Microsoft (MS DTC).</span><span class="sxs-lookup"><span data-stu-id="82a8c-179">To facilitate transactions between SQL Server and BizTalk Server, you must enable Microsoft Distributed Transaction Coordinator (MS DTC).</span></span> <span data-ttu-id="82a8c-180">Para configurar MSDTC en SQL Server, vea el tema [directrices generales para mejorar el rendimiento del sistema operativo](../technical-guides/general-guidelines-for-improving-operating-system-performance.md).</span><span class="sxs-lookup"><span data-stu-id="82a8c-180">To configure MSDTC on SQL Server, see the topic [General Guidelines for Improving Operating System Performance](../technical-guides/general-guidelines-for-improving-operating-system-performance.md).</span></span>  
  
## <a name="enable-trace-flag-t1118-as-a-startup-parameter-for-all-instances-of-sql-server"></a><span data-ttu-id="82a8c-181">Habilitar T1118 de marca de seguimiento como un parámetro de inicio para todas las instancias de SQL Server</span><span class="sxs-lookup"><span data-stu-id="82a8c-181">Enable Trace Flag T1118 as a startup parameter for all instances of SQL Server</span></span>  
 <span data-ttu-id="82a8c-182">Implementar seguimiento marca – T1118 ayuda a reducir la contención en todas las instancias de SQL Server mediante la eliminación de casi todas las asignaciones de páginas individuales.</span><span class="sxs-lookup"><span data-stu-id="82a8c-182">Implementing Trace Flag –T1118 helps reduce contention across the SQL Server instances by removing almost all single page allocations.</span></span> <span data-ttu-id="82a8c-183">Para obtener más información, consulte [KB 328551: PRB: mejoras de concurrencia para la base de datos tempdb](https://support.microsoft.com/help/328551/concurrency-enhancements-for-the-tempdb-database).</span><span class="sxs-lookup"><span data-stu-id="82a8c-183">For more information, see [KB 328551: PRB: Concurrency enhancements for the tempdb database](https://support.microsoft.com/help/328551/concurrency-enhancements-for-the-tempdb-database).</span></span>
  
## <a name="do-not-change-default-sql-server-settings-for-max-degree-of-parallelism-sql-server-statistics-or-database-index-rebuilds-and-defragmentation"></a><span data-ttu-id="82a8c-184">No cambie la configuración de SQL Server predeterminada de max degree of parallelism, las estadísticas de SQL Server, o si vuelve a generar el índice de base de datos y desfragmentación</span><span class="sxs-lookup"><span data-stu-id="82a8c-184">Do not change default SQL Server settings for max degree of parallelism, SQL Server statistics, or database index rebuilds and defragmentation</span></span>  
 <span data-ttu-id="82a8c-185">Si una instancia de SQL Server hospedará las bases de datos de BizTalk Server, hay ciertas opciones de SQL Server que no se deben cambiar.</span><span class="sxs-lookup"><span data-stu-id="82a8c-185">If a SQL Server instance will house BizTalk Server databases, then there are certain SQL Server settings that should not be changed.</span></span> <span data-ttu-id="82a8c-186">En concreto, las estadísticas de SQL Server en la base de datos de cuadro de mensajes y las opciones para el índice de base de datos de la SQL Server max degree of parallelism, vuelve a generar y no debe modificarse la desfragmentación.</span><span class="sxs-lookup"><span data-stu-id="82a8c-186">Specifically, the SQL Server max degree of parallelism, the SQL Server statistics on the MessageBox database, and the settings for the database index rebuilds and defragmentation should not be modified.</span></span> <span data-ttu-id="82a8c-187">Vea [configuración de SQL Server que no se debe cambiar](../technical-guides/sql-server-settings-that-should-not-be-changed.md).</span><span class="sxs-lookup"><span data-stu-id="82a8c-187">See [SQL Server Settings That Should Not Be Changed](../technical-guides/sql-server-settings-that-should-not-be-changed.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="82a8c-188">Vea también</span><span class="sxs-lookup"><span data-stu-id="82a8c-188">See Also</span></span>  
 [<span data-ttu-id="82a8c-189">Optimización del rendimiento de la base de datos</span><span class="sxs-lookup"><span data-stu-id="82a8c-189">Optimizing Database Performance</span></span>](../technical-guides/optimizing-database-performance.md)
