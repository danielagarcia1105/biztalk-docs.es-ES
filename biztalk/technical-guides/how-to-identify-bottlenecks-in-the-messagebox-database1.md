---
title: Cómo identificar cuellos de botella en la base de datos1 del cuadro de mensajes | Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1a039164-5ca6-4cbc-b307-c5d4ae800689
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 55d766405716a63249eae8fd47fd1f82077e05d5
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/27/2018
ms.locfileid: "37001124"
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a><span data-ttu-id="ef9b5-102">Cómo identificar cuellos de botella en la base de datos de cuadro de mensajes</span><span class="sxs-lookup"><span data-stu-id="ef9b5-102">How to Identify Bottlenecks in the MessageBox Database</span></span>
<span data-ttu-id="ef9b5-103">Para identificar cuellos de botella en la base de datos de cuadro de mensajes, en primer lugar debe asegurarse de que se haya iniciado el servicio del Agente de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-103">To identify bottlenecks in the MessageBox database, first ensure that the SQL-Server-Agent Service is started.</span></span> <span data-ttu-id="ef9b5-104">Cambiar el estado de inicio del servicio de Manual a automático de modo que si se reinicia el servidor, el servicio se reiniciará automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-104">Change the Service startup state from Manual to Auto so that if the server is restarted, the service will automatically restart.</span></span>  
  
 <span data-ttu-id="ef9b5-105">De forma predeterminada, el servicio de BizTalk limitará si el crecen de las tablas Spool, TrackingData o applicationq aumentan.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-105">By default, the BizTalk service will throttle if the Spool, TrackingData, or ApplicationQ tables grow.</span></span> <span data-ttu-id="ef9b5-106">Trabajos del agente de SQL, que, si no se está ejecutando hará que la cola de impresión crezca y provocará una limitación para iniciar y proteger la base de datos contra presiones adicionales purgan estas tablas.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-106">These tables are pruned by SQL-Agent jobs, which, if not running will cause the Spool to grow causing throttling to start and protect the database from additional pressure.</span></span> <span data-ttu-id="ef9b5-107">Compruebe el estado de los siguientes contadores de rendimiento:</span><span class="sxs-lookup"><span data-stu-id="ef9b5-107">Check the status of the following performance counters:</span></span>  
  
- <span data-ttu-id="ef9b5-108">BizTalk:Agente de mensaje (nombre de host) Estado de limitación de entrega de mensajes</span><span class="sxs-lookup"><span data-stu-id="ef9b5-108">BizTalk:Message Agent (Host Name) Message Delivery Throttling State</span></span>  
  
- <span data-ttu-id="ef9b5-109">BizTalk:Agente de mensaje (nombre de host) Estado de limitación de publicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="ef9b5-109">BizTalk:Message Agent (Host Name) Message Publishing Throttling State</span></span>  
  
  <span data-ttu-id="ef9b5-110">Un valor de "0" indica que no se produce ninguna limitación.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-110">A value of “0” indicates no throttling is occurring.</span></span> <span data-ttu-id="ef9b5-111">Un valor de "6" indica que el sistema limita debido al crecimiento de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-111">A value of “6” indicates the system is throttling due to database growth.</span></span> <span data-ttu-id="ef9b5-112">Para obtener información sobre cómo interpretar los valores de estos contadores, vea [¿qué es la limitación de Host?](http://go.microsoft.com/fwlink/?LinkID=154694)</span><span class="sxs-lookup"><span data-stu-id="ef9b5-112">For information about how to interpret the values of these counters, see [What is Host Throttling?](http://go.microsoft.com/fwlink/?LinkID=154694)</span></span> <span data-ttu-id="ef9b5-113">(http://go.microsoft.com/fwlink/?LinkID=154694) y [los contadores de rendimiento de limitación de Host](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285) en la documentación de BizTalk Server 2010.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-113">(http://go.microsoft.com/fwlink/?LinkID=154694) and [Host Throttling Performance Counters](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285) in the BizTalk Server 2010 documentation.</span></span>  
  
## <a name="spool-table-growth"></a><span data-ttu-id="ef9b5-114">Crecimiento de la tabla de cola de impresión</span><span class="sxs-lookup"><span data-stu-id="ef9b5-114">Spool table growth</span></span>  
 <span data-ttu-id="ef9b5-115">La tabla Spool puede empezar a crecer por distintos motivos.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-115">The Spool can start growing for multiple reasons.</span></span> <span data-ttu-id="ef9b5-116">Una razón para el crecimiento de la cola de impresión es si las colas de aplicaciones están creciendo.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-116">One reason for Spool growth is if the Application Queues are growing.</span></span> <span data-ttu-id="ef9b5-117">Podía crecer debido a razones como cuellos de botella descendentes o contención de recursos.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-117">They could grow due to reasons such as downstream bottlenecks and/or resource contention.</span></span>  
  
 <span data-ttu-id="ef9b5-118">Si las colas de aplicaciones son pequeñas y la cola de impresión sigue siendo muy grande, compruebe que los trabajos de purga se mantienen actualizados.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-118">If the Application Queues are small and the Spool is still large, verify that the purge jobs are keeping up.</span></span> <span data-ttu-id="ef9b5-119">Asegúrese de que el servicio de Agente de SQL Server esté en ejecución y, a continuación, compruebe que los siguientes trabajos se estén realizando correctamente:</span><span class="sxs-lookup"><span data-stu-id="ef9b5-119">Ensure that the SQL-Agent Service is running and then verify that the following jobs are successfully completing:</span></span>  
  
- <span data-ttu-id="ef9b5-120">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="ef9b5-120">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span></span>  
  
- <span data-ttu-id="ef9b5-121">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="ef9b5-121">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span></span>  
  
  <span data-ttu-id="ef9b5-122">Si la tabla MessageZeroSum es grande, indica que se han procesado los mensajes.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-122">If the MessageZeroSum table is large, it indicates that the messages have been processed.</span></span> <span data-ttu-id="ef9b5-123">Esto significa que DeQueue ha completado correctamente y se eliminan los datos de las tablas de cola de la aplicación y las filas se han marcado para su eliminación.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-123">This means that DeQueue has successfully completed and deleted data from the Application Queue tables and the rows have been flagged for deletion.</span></span> <span data-ttu-id="ef9b5-124">Sin embargo, los trabajos de purga no pueden eliminar los datos a la velocidad necesaria.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-124">However, the purge jobs are unable to keep up with deleting the data.</span></span> <span data-ttu-id="ef9b5-125">Esto puede ocurrir si el equipo que ejecuta SQL Server está experimentando una contención grave de CPU, que afectan a la capacidad de los trabajos de purga para mantenerse al día debido a la privación de la CPU.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-125">This can happen if the computer running SQL Server is experiencing severe CPU contention, affecting the ability of the purge jobs to keep up due to CPU starvation.</span></span>  
  
## <a name="application-queue-table-growth"></a><span data-ttu-id="ef9b5-126">Crecimiento de tabla de cola de aplicación</span><span class="sxs-lookup"><span data-stu-id="ef9b5-126">Application queue table growth</span></span>  
 <span data-ttu-id="ef9b5-127">Colas de la aplicación hospedan los datos de transición en curso que, una vez procesados, son eliminados por DeQueue.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-127">Application Queues host in-flight transition data that, once processed, are cleaned up by DeQueue.</span></span>  
  
 <span data-ttu-id="ef9b5-128">Después de procesan estos mensajes, puede limpiar la tabla Spool (que contiene referencias a estas filas).</span><span class="sxs-lookup"><span data-stu-id="ef9b5-128">After these messages are processed, the Spool table (holding references to these rows) can be cleaned.</span></span>  
  
 <span data-ttu-id="ef9b5-129">Por ejemplo, la cola RxHostQ publica datos en la cola PxHostQ de orquestación.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-129">For example, the RxHostQ publishes data to the orchestration PxHostQ.</span></span> <span data-ttu-id="ef9b5-130">Esta cola publica datos en el envío TxHostQ cada uno de los que hacen referencia a una fila en la tabla de cola de impresión.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-130">This queue publishes data to the sending TxHostQ each referencing a row in the Spool table.</span></span> <span data-ttu-id="ef9b5-131">Después de que se procesaron correctamente los mensajes de una cola HostQ concreta a través del sistema, DeQueue elimina estas filas.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-131">After the messages for a particular HostQ have successfully processed through the system, these rows are deleted by DeQueue.</span></span> <span data-ttu-id="ef9b5-132">Una vez eliminadas las filas, los trabajos de purga pueden borrar el contenido de la tabla Spool (a la que estas filas ya no hacen referencia).</span><span class="sxs-lookup"><span data-stu-id="ef9b5-132">After these rows are deleted, the Spool (which is no longer referenced by these rows) can then be cleaned by the purge jobs.</span></span>  
  
 <span data-ttu-id="ef9b5-133">Crecimiento de la cola de aplicación indica que las instancias de host responsables de purga de la cola de aplicación no se puede hacer frente a la velocidad de entrada.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-133">Application Queue growth indicates that the host instances responsible for draining the Application Queue are unable to keep up with the incoming rate.</span></span>  
  
 <span data-ttu-id="ef9b5-134">Por ejemplo, la cola de aplicación de orquestación (PxHostQ) puede aumentar de tamaño porque el servidor responsable de procesar las orquestaciones está enlazado a la CPU y no puede procesar más rápidamente.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-134">For example, the orchestration application queue (PxHostQ) may grow because the server responsible for processing orchestrations is CPU bound and unable to process any faster.</span></span> <span data-ttu-id="ef9b5-135">Sin embargo, si el servidor de recepción es rápido puede publicar más rápido que la que el servidor puede procesar, por lo que el crecimiento de la cola de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-135">However, if the receiving server is fast it may publish faster than what the orchestration server can process leading to the Application Queue growth.</span></span>  
  
 <span data-ttu-id="ef9b5-136">Otra razón para el crecimiento de la cola de orquestación podría ser debido a la contención de memoria.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-136">Another reason for orchestration queue growth could be due to memory contention.</span></span> <span data-ttu-id="ef9b5-137">Cuando varias instancias de orquestación de larga ejecución al mismo tiempo se crean instancias en memoria, inundación de memoria consecuencia indirecta de limitación para reducir el grupo de subprocesos hasta que se alivia la presión de memoria.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-137">When many long running orchestration instances are concurrently instantiated in memory, memory bloat indirectly causes throttling to shrink the thread pool until memory pressure is relieved.</span></span>  
  
 <span data-ttu-id="ef9b5-138">Un motivo por qué se puede alcanzar la cola de la aplicación de envío es si el sistema de nivel inferior no puede recibir mensajes (de salida desde BizTalk Server) lo suficientemente rápido.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-138">A reason why the send application queue may grow is if the downstream system is unable to receive messages (outgoing from BizTalk Server) fast enough.</span></span> <span data-ttu-id="ef9b5-139">Por tanto, los mensajes siguen residiendo en el crecimiento de cola de la aplicación que causan de sistema de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-139">Thus the messages will continue to reside within the BizTalk system causing Application Queue growth.</span></span> <span data-ttu-id="ef9b5-140">Esto puede causar la limitación iniciar y reducir la velocidad de recepción afectar el rendimiento general del sistema.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-140">This can cause throttling to start and reduce the receiving rate impacting the overall throughput of the system.</span></span>  
  
## <a name="trackingdata-table-growth"></a><span data-ttu-id="ef9b5-141">Crecimiento de la tabla TrackingData</span><span class="sxs-lookup"><span data-stu-id="ef9b5-141">TrackingData table growth</span></span>  
 <span data-ttu-id="ef9b5-142">La tabla TrackingData en la base de datos de cuadro de mensajes es una tabla de transición en la que los interceptores escriben datos de seguimiento para el seguimiento de estado y actividad (HAT) y supervisión de la actividad económica (BAM).</span><span class="sxs-lookup"><span data-stu-id="ef9b5-142">The TrackingData table in the MessageBox database is a transition table into which interceptors write tracking data for both Health and Activity (HAT) and Business Activity Monitoring (BAM) tracking.</span></span> <span data-ttu-id="ef9b5-143">Si el seguimiento está deshabilitado, esta tabla debe estar vacía.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-143">If tracking is disabled, this table should be empty.</span></span> <span data-ttu-id="ef9b5-144">De forma predeterminada, el seguimiento de HAT está habilitado para las canalizaciones y orquestaciones de eventos de entrada/salida.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-144">By default, HAT-tracking is enabled for the pipelines and orchestrations In/Out events.</span></span>  
  
 <span data-ttu-id="ef9b5-145">Si está habilitado el seguimiento de partes de mensaje, asegúrese de que se está ejecutando el servidor de base de datos de cuadro de mensajes (es decir, el host con "Permitir seguimiento de host").</span><span class="sxs-lookup"><span data-stu-id="ef9b5-145">If Message Body Tracking is enabled, ensure that the MessageBox database server (that is, the host with "allow host tracking") is running.</span></span> <span data-ttu-id="ef9b5-146">Asegurarse de que se está ejecutando el host con "Permitir seguimiento de host" reducirá la posibilidad de un cuello de botella como el host mueve los datos de la tabla TrackingData en la base de datos de cuadro de mensajes a las tablas de base de datos de seguimiento de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-146">Ensuring that the host with "allow host tracking" is running will reduce the chance of a bottleneck occurring as the host moves data from TrackingData table in the MessageBox database to the BizTalk Tracking database tables.</span></span>  
  
 <span data-ttu-id="ef9b5-147">Es posible realizar el seguimiento de eventos personalizados mediante la habilitación del seguimiento de HAT personalizado, por ejemplo, en propiedades promocionadas y seguimiento de cuerpos de mensaje.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-147">It is possible to track custom events by enabling custom HAT-tracking, for example, on promoted properties and message body tracking.</span></span> <span data-ttu-id="ef9b5-148">Además de los datos de seguimiento de HAT, los datos de BAM también se escriben en la tabla TrackingData.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-148">In addition to HAT-tracking data, BAM data is also written to the TrackingData table.</span></span> <span data-ttu-id="ef9b5-149">Los datos descodificar servicio de seguimiento (TDDS, que se ejecuta en la instancia de host en el que el seguimiento está habilitado) es responsable de mover estos datos de la base de datos de cuadro de mensajes para las bases de datos de importación principal de BAM y de seguimiento de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-149">The Tracking Data Decode Service (TDDS, which runs on the host instance on which tracking is enabled) is responsible for moving this data from the MessageBox database to the BizTalk Tracking and BAM Primary Import databases.</span></span> <span data-ttu-id="ef9b5-150">A continuación, una vez se haya movido correctamente los datos, TDDS elimina estos datos.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-150">Then after the data is successfully moved, TDDS deletes this data.</span></span> <span data-ttu-id="ef9b5-151">Los datos de seguimiento de partes de mensaje los mueve por separado el trabajo TrackedMessages_Copy_BizTalkMsgBoxDb del Agente de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-151">Message body tracking data is moved separately by a SQL-Agent job TrackedMessages_Copy_BizTalkMsgBoxDb.</span></span>  
  
 <span data-ttu-id="ef9b5-152">Si TDDS no puede mantener el ritmo en el que los interceptores escriben datos en la tabla TrackingData, esta tabla crece y provoca una limitación empezar.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-152">If TDDS is unable to keep up with the rate at which the interceptors are writing data to the TrackingData table, this table will grow, causing throttling to start.</span></span> <span data-ttu-id="ef9b5-153">Esto afecta al rendimiento sostenible.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-153">This impacts sustainable throughput.</span></span> <span data-ttu-id="ef9b5-154">Para reducir este problema, asegúrese de que se está ejecutando al menos un host con el seguimiento habilitado.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-154">To lessen this problem, ensure at least one host is running with tracking enabled.</span></span>  
  
 <span data-ttu-id="ef9b5-155">Si los datos siguen acumulándose, asegúrese de que la base de datos de seguimiento de BizTalk no crezca sin control.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-155">If the data still builds up, ensure the BizTalk Tracking database is not growing out of control.</span></span> <span data-ttu-id="ef9b5-156">Además, asegúrese del archivado y purga el trabajo se está ejecutando y es capaz de hacer frente a la velocidad a la que llegan los datos.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-156">Also, ensure the archiving and purging job is running and is able to keep up with the rate at which data is arriving.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ef9b5-157">De forma predeterminada, el trabajo de purga no puede eliminar los datos de las tablas de base de datos de seguimiento de BizTalk hasta que estos datos se ha archivado.</span><span class="sxs-lookup"><span data-stu-id="ef9b5-157">By default, the purge job is unable to delete data from the BizTalk Tracking database tables until this data has been archived.</span></span> <span data-ttu-id="ef9b5-158">Si no necesita archivar los datos de seguimiento, puede modificar el trabajo para purgar la base de datos de seguimiento de BizTalk sin archivar siguiendo los pasos descritos en [cómo purgar datos de la base de datos de seguimiento de BizTalk](http://go.microsoft.com/fwlink/?LinkID=153817) (http://go.microsoft.com/fwlink/?LinkID=153817).</span><span class="sxs-lookup"><span data-stu-id="ef9b5-158">If you do not need to archive the tracking data, you can modify the job to purge the BizTalk Tracking database without archiving by following the steps at [How to Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153817) (http://go.microsoft.com/fwlink/?LinkID=153817).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ef9b5-159">Vea también</span><span class="sxs-lookup"><span data-stu-id="ef9b5-159">See Also</span></span>  
 [<span data-ttu-id="ef9b5-160">Cuellos de botella en el nivel de base de datos</span><span class="sxs-lookup"><span data-stu-id="ef9b5-160">Bottlenecks in the Database Tier</span></span>](../technical-guides/bottlenecks-in-the-database-tier.md)