---
title: Ejecuta el mensaje de ejemplo del controlador de excepciones personalizadas de conservar | Documentos de Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: a0a4c819-f6bd-4dea-8be9-e3006337665f
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f6d7927357e4c2be03ecd8b2e77d45558b5bc692
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/20/2017
ms.locfileid: "22295332"
---
# <a name="running-the-message-persisting-custom-exception-handler-sample"></a><span data-ttu-id="c196b-102">Ejecuta el mensaje conservar ejemplo del controlador de excepciones personalizadas</span><span class="sxs-lookup"><span data-stu-id="c196b-102">Running the Message Persisting Custom Exception Handler Sample</span></span>
<span data-ttu-id="c196b-103">El ejemplo de controlador de excepciones de personalizada de conservación de mensaje muestra un controlador de acoplamiento flexible, genérico que recibe mensajes de error, extrae los mensajes que contienen y se escribe como archivos de disco en el sistema de archivos de Microsoft BizTalk.</span><span class="sxs-lookup"><span data-stu-id="c196b-103">The Message Persisting Custom Exception Handler sample demonstrates a loosely coupled, generic handler that receives fault messages, extracts the Microsoft BizTalk messages they contain, and writes them as disk files to the file system.</span></span>  
  
 <span data-ttu-id="c196b-104">El ejemplo muestra cómo puede utilizar un controlador de excepciones personalizado en una orquestación.</span><span class="sxs-lookup"><span data-stu-id="c196b-104">The sample shows how you can use a custom exception handler in an orchestration.</span></span> <span data-ttu-id="c196b-105">Cuando un proceso en la orquestación (EAIProcess.odx) encuentra un error, el controlador de excepciones genera y publica un mensaje de error ESB.</span><span class="sxs-lookup"><span data-stu-id="c196b-105">When a process in the orchestration (EAIProcess.odx) encounters an error, the exception handler generates and publishes an ESB fault message.</span></span> <span data-ttu-id="c196b-106">Este mensaje de error que incluye en su carga de los mensajes (incluidos sus propiedades de contexto relacionadas con BizTalk) que estaban "en proceso" cuando se produjo la excepción, así como la instancia actual de System.Exception detectada por el motor de orquestación de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="c196b-106">This fault message includes in its payload the messages (including their BizTalk-related context properties) that were "in flight" when the exception occurred, as well as the current System.Exception instance caught by the BizTalk Orchestration engine.</span></span> <span data-ttu-id="c196b-107">Cuando esto ocurre, un mensaje de "Denegado" y un mensaje de "Aprobado" se conservan con el mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="c196b-107">When this occurs, a "Denied" message and an "Approved" message are persisted with the fault message.</span></span>  
  
 <span data-ttu-id="c196b-108">Una segunda orquestación denominada EAIGenericHandler.odx, que se implementa de manera desacoplada y actúa como un controlador de excepciones personalizado, se suscribe al código de error concreto generado en la orquestación EAIGenericHandler.odx y consume el mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="c196b-108">A second orchestration named EAIGenericHandler.odx, which is deployed in a decoupled manner and acts as a custom exception handler, subscribes to the specific fault code generated in the EAIGenericHandler.odx orchestration and consumes the fault message.</span></span> <span data-ttu-id="c196b-109">Este controlador de excepciones extrae los mensajes originales (como documentos sin tipo) y las instancias de System.Exception originalmente se conservan en el mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="c196b-109">This exception handler extracts the original messages (as type-less documents) and the System.Exception instances originally persisted in the fault message.</span></span>  
  
 <span data-ttu-id="c196b-110">El ejemplo del controlador de excepción de personalizado de conservación de mensaje difiere de la muestra de reparación y volver a enviar controlador de excepciones personalizado en que la orquestación EAIGenericHandler.odx usada en este ejemplo no tiene una dependencia en los esquemas utilizados en la publicación de error proceso de orquestación (EAIProcess.odx).</span><span class="sxs-lookup"><span data-stu-id="c196b-110">The Message Persisting Custom Exception Handler sample differs from the Repair and Resubmit Custom Exception Handler sample in that the EAIGenericHandler.odx orchestration used in this sample does not have a dependency on the schemas used in the fault publishing orchestration process (EAIProcess.odx).</span></span> <span data-ttu-id="c196b-111">En concreto, la orquestación EAIGenericHandler.odx recupera los mensajes originales desde el mensaje de error como System.Xml.XmlDocument instancias en lugar de mensajes con tipo en función de los esquemas utilizados en la orquestación EAIProcess.odx.</span><span class="sxs-lookup"><span data-stu-id="c196b-111">Specifically, the EAIGenericHandler.odx orchestration retrieves the original messages from the fault message as System.Xml.XmlDocument instances instead of typed messages based on the schemas used in the EAIProcess.odx orchestration.</span></span> <span data-ttu-id="c196b-112">También devuelve los mensajes como una colección que fácilmente puede mostrar el código.</span><span class="sxs-lookup"><span data-stu-id="c196b-112">It also returns the messages as a collection that code can easily enumerate.</span></span>  
  
 <span data-ttu-id="c196b-113">El controlador de excepciones personalizado (EAIGenericHandler.odx), a continuación, escribe "Denegado" y los mensajes de "Aprobado" en el archivo sistema ubicación \Source\Samples\Exception Handling\Test\Filedrop\EAIGenericHandler.PostTmpMsg.</span><span class="sxs-lookup"><span data-stu-id="c196b-113">The custom exception handler (EAIGenericHandler.odx) then writes both the "Denied" and the "Approved" messages to the file system location \Source\Samples\Exception Handling\Test\Filedrop\EAIGenericHandler.PostTmpMsg.</span></span>  
  
 <span data-ttu-id="c196b-114">Además, hay un puerto de envío genérico llamado todos. Exceptions_FILE configurado para usar la canalización de GlobalFaultProcessor instalada como parte de la [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] marco de administración de excepciones.</span><span class="sxs-lookup"><span data-stu-id="c196b-114">Additionally, there is a generic send port named ALL.Exceptions_FILE configured to use the GlobalFaultProcessor pipeline installed as part of the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] Exception Management Framework.</span></span> <span data-ttu-id="c196b-115">Este puerto se suscribe a todas las excepciones en el sistema, ambos BizTalk no pudo mensaje enrutamiento de mensajes y mensajes de error ESB.</span><span class="sxs-lookup"><span data-stu-id="c196b-115">This port subscribes to all exceptions in the system, both BizTalk failed message routing messages and ESB fault messages.</span></span> <span data-ttu-id="c196b-116">El marco de trabajo de administración de excepción normaliza ellos todo ello en un único formato y serializa utilizando una instrucción de procesamiento de Microsoft InfoPath en la ubicación \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span><span class="sxs-lookup"><span data-stu-id="c196b-116">The Exception Management Framework normalizes them all to a single format and serializes them using a Microsoft InfoPath processing instruction to the location \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="c196b-117">Installation</span><span class="sxs-lookup"><span data-stu-id="c196b-117">Installation</span></span>  
 <span data-ttu-id="c196b-118">Todos los ejemplos de administración de excepciones utilizan el mismo conjunto de servicios principales y artefactos de la aplicación de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="c196b-118">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="c196b-119">Por lo tanto, tendrá que instalar los artefactos de ejemplo de administración de excepción sólo una vez para poder ejecutar la excepción de todos los ejemplos de administración.</span><span class="sxs-lookup"><span data-stu-id="c196b-119">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="c196b-120">Para obtener información acerca de cómo instalar los ejemplos de administración de excepciones, vea [instalar los ejemplos de administración de excepción](../esb-toolkit/installing-the-exception-management-samples.md).</span><span class="sxs-lookup"><span data-stu-id="c196b-120">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="c196b-121">Ejecutar la aplicación de ejemplo</span><span class="sxs-lookup"><span data-stu-id="c196b-121">Running the Sample Application</span></span>  
 <span data-ttu-id="c196b-122">**Para ejecutar el ejemplo del controlador de excepciones de personalizada de conservación de mensaje**</span><span class="sxs-lookup"><span data-stu-id="c196b-122">**To run the Message Persisting Custom Exception Handler sample**</span></span>  
  
1.  <span data-ttu-id="c196b-123">Antes de ejecutar este ejemplo por primera vez, asegúrese de que la recepción dirección URL de puerto de envío y de ubicación apuntan a los directorios adecuados en la carpeta \Source\Samples\Exception Handling\Test\Filedrop.</span><span class="sxs-lookup"><span data-stu-id="c196b-123">Before you run this sample for the first time, make sure that the receive location and send port URL point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="c196b-124">La ubicación de recepción debe especificar la carpeta EAIProcess.RequestPort y la dirección URL de puerto de envío debe especificar la carpeta EAIGenericHandler.PostTmpMsg.</span><span class="sxs-lookup"><span data-stu-id="c196b-124">The receive location should specify the folder EAIProcess.RequestPort, and the send port URL should specify the folder EAIGenericHandler.PostTmpMsg.</span></span>  
  
2.  <span data-ttu-id="c196b-125">Si aún no se está ejecutando la aplicación GlobalBank.ESB, use la consola de administración de BizTalk para iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="c196b-125">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="c196b-126">Iniciar el ejemplo copiando el archivo de ejemplo denominado Request_EAIGenericHandler.xml, ubicado en la carpeta \Source\Samples\Exception Handling\Test\Data, en la carpeta especificada para la ubicación de recepción de la EAIProcess.RequestPort_FILE: \Source\Samples\ Excepción Handling\Test\Filedrop\EAIProcess.RequestPort.</span><span class="sxs-lookup"><span data-stu-id="c196b-126">Start the sample by copying the sample file named Request_EAIGenericHandler.xml, located in the \Source\Samples\Exception Handling\Test\Data folder, to the folder specified for the EAIProcess.RequestPort_FILE receive location: \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
4.  <span data-ttu-id="c196b-127">Abra la carpeta denominada EAIGenericHandler.PostTmpMsg (en la carpeta \Source\Samples\Exception Handling\Test\Filedrop\).</span><span class="sxs-lookup"><span data-stu-id="c196b-127">Open the folder named EAIGenericHandler.PostTmpMsg (in the \Source\Samples\Exception Handling\Test\Filedrop\ folder).</span></span> <span data-ttu-id="c196b-128">Verá el mensaje original.</span><span class="sxs-lookup"><span data-stu-id="c196b-128">You will see the original message.</span></span>  
  
## <a name="how-the-sample-works"></a><span data-ttu-id="c196b-129">Cómo funciona el ejemplo</span><span class="sxs-lookup"><span data-stu-id="c196b-129">How the Sample Works</span></span>  
 <span data-ttu-id="c196b-130">El mensaje que se envía, activa la orquestación EAIProcess.</span><span class="sxs-lookup"><span data-stu-id="c196b-130">The message you submit activates the EAIProcess orchestration.</span></span> <span data-ttu-id="c196b-131">Cuando la orquestación EAIProcess procesa el mensaje, intenta dividir 1 por el precio unitario.</span><span class="sxs-lookup"><span data-stu-id="c196b-131">When the EAIProcess orchestration processes the message, it attempts to divide 1 by the unit price.</span></span> <span data-ttu-id="c196b-132">Dado que el precio unitario es cero, se produce una excepción de división por cero.</span><span class="sxs-lookup"><span data-stu-id="c196b-132">Because the unit price is zero, a divide-by-zero exception occurs.</span></span> <span data-ttu-id="c196b-133">Código del controlador de eventos de la orquestación detecta esta excepción y crea un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="c196b-133">Code in the event handler of the orchestration catches this exception and creates a fault message.</span></span> <span data-ttu-id="c196b-134">La cantidad del pedido en el mensaje es menor que 10, por lo que la lógica de negocios indica que esta excepción tiene un **FaultCode** campo de valor de **2000**.</span><span class="sxs-lookup"><span data-stu-id="c196b-134">The order quantity in the message is less than 10, so the business logic dictates that this exception has a **FaultCode** field value of **2000**.</span></span>  
  
 <span data-ttu-id="c196b-135">La orquestación de EAIProcess, a continuación, publica el mensaje de error en el cuadro de mensaje de BizTalk a través de un puerto de enlace directo y finaliza la orquestación.</span><span class="sxs-lookup"><span data-stu-id="c196b-135">The EAIProcess orchestration then publishes the fault message to the BizTalk Message Box through a direct-bound port, and the orchestration ends.</span></span>  
  
 <span data-ttu-id="c196b-136">Una orquestación de controlador de error personalizado denominada EAIGenericHandler, que se suscribe a mensajes con un **FaultCode** campo de valor de **2000**, recoge el mensaje de error de nuevo.</span><span class="sxs-lookup"><span data-stu-id="c196b-136">A custom fault handler orchestration named EAIGenericHandler, which subscribes to messages with a **FaultCode** field value of **2000**, picks up the new fault message.</span></span> <span data-ttu-id="c196b-137">El código en la orquestación extrae el mensaje de excepción (error) en todos los mensajes y los escribe en archivos de disco.</span><span class="sxs-lookup"><span data-stu-id="c196b-137">The code in the orchestration extracts all the messages from the exception (fault) message and writes them to disk files.</span></span>